define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/All",["require","exports","f","o","ko","FxInternal/Controls/Grid2/GridB","FxInternal/Data/GroupNavigator","HubsExtension/Browse/BrowseClientStrings","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ArmHelpers/Models/ArmResource","HubsExtension/Browse/BrowseArea","HubsExtension/Common/AssetTypeCache","HubsExtension/BrowseGrid2/BrowseGrid2Startup","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Base","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/BrowseBulkCommandConfig"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";r.defineProperty(t,"__esModule",{value:!0});var k=i.Base,b=i.ViewModels,p=b.Services.ResourceTypes,d=u.utils.peekObservable,w=o.Aria.Group,g=(function(n){function t(t,r){var f=n.call(this,t,r)||this,e;return f._assetTypeInfoMap=new i.Map,f._options=r,e=p.isResourceGroupId(f._listScope)||p.isResourceGroupId(f._scope)?[{text:o.GroupBy.noGrouping,value:""},{text:o.GroupBy.assetType,value:"assetType"},{text:o.GroupBy.location,value:"location"},]:p.isSubscriptionId(f._listScope)||p.isSubscriptionId(f._scope)?[{text:o.GroupBy.noGrouping,value:""},{text:o.GroupBy.resourceGroup,value:"resourceGroup"},{text:o.GroupBy.assetType,value:"assetType"},{text:o.GroupBy.location,value:"location"},]:[{text:o.GroupBy.noGrouping,value:""},{text:o.GroupBy.resourceGroup,value:"resourceGroup"},{text:o.GroupBy.assetType,value:"assetType"},{text:o.GroupBy.subscription,value:"subscription"},{text:o.GroupBy.location,value:"location"},],f.groupByItems(e),f._groupAriaLabelLookup.resourceGroup=w.resourceGroupDescription,f._groupAriaLabelLookup.assetType=w.assetTypeDescription,f._groupAriaLabelLookup.subscription=w.subscriptionDescription,f._groupAriaLabelLookup.location=w.locationDescription,u.reactor(f._ltm,(function(){f.selectedItemsCount(f._selectedBrowseItems().length)})),f}return __extends(t,n),t.prototype._fetchData=function(){var t=this,n={sourceHandler:function(i,r,u,f){var e=function(n){return u.matchSubscription(n)};return(r||[]).forEach((function(i){if(p.isResourceId(i.id)){var r=h.toResource(i);t._options.includeTypes()?c.showResource(r,n,e)&&f.push(r):t._assetTypeInfoMap.get(r.type.toLowerCase())&&c.showResource(r,n,e)&&f.push(h.toResource(r))}})),f.length<2e3},loading:this.gridViewModel.loading,partialErrors:this._hasErrors,scope:this._scope,excludedResourceTypes:!this._options.includeTypes()&&this._excludedResourceTypes,filter:this._getSearchString(),selectedSubscriptions:this._resourceFilter.selectedSubscriptions,selectedTypes:this._resourceFilter.selectedTypes(),selectedResourceGroups:this._resourceFilter.selectedResourceGroups(),invertResourceGroupFilter:this._resourceFilter.invertResourceGroupFilter(),selectedLocations:this._resourceFilter.selectedLocations(),tagFilterData:this._selectedTags(),telemetry:s.makeResourceManagerTelemetry("GridV2Browse.all")};return this._performGetResources(Q(new c.AllResourcesSource),n)},t.prototype._makeBrowseItem=function(n){if(p.isResourceId(n.id))return this._createBrowseResourceItemFromResource(n,!0,this._assetTypeInfoMap,{},!0)},t.prototype.loadData=function(){var n=this,t,r,u;return this._resourceInstanceMap=new i.Map,t=this._assetTypeInfoMap,r=function(n){var i=n.lowerCaseResourceType;i&&t.set(i,n)},this._chooseColumnsAllowed(!0),u=l.getAssetTypesInformation().then((function(t){t.subscribeAndRun(n._ltm,(function(n){n.forEach((function(n){r(n)}))}))})),u.then((function(){n._resourceTypeName=o.AssetTypeNames.AllResource.lowerPlural;n._resourceFilter.subscriptionsLoaded.fxOnceAndRun(n._ltm,(function(){n._createFilteringComputed();n._fetchData()}))}))},t.prototype.createGridViewModel=function(){var n=this,s=new e(this._ltm,{sourceItems:this._items,getId:function(n){return d(n.id)},groupBy:this.groupBy,compare:v.browseCompare}),h=this._createGridOptions({dataNavigator:s,selection:{dynamicSelectionProvider:this._getSelectionFactory(),pinProvider:this._getPinProvider(),activationMode:2,selectionMode:3,enabled:!0,selectedIds:this._selectedIds,unselectedIds:this._unselectedIds,selectedAll:this._selectedAll,hiddenInCollapsed:!0,linkUriProperty:"externalLink",activationContainer:this._container},resizing:{resizeToPercent:u.observable(!0)},sorting:{enabled:!0},grouping:{enabled:!0,groupBy:this.groupBy,getGroupAriaLabel:function(t){var i=n._groupAriaLabelLookup[n.groupBy()];return i&&i.format(t)}},ariaLabel:o.Aria.allDescription,getRowAriaLabel:function(n){return o.Aria.rowDescription.format(n.name,o.AssetTypeNames.AllResource.lowerSingular)}});this.gridViewModel=new f.ViewModel(this._ltm,h);var t=this._columnsType,i=this._columnsScopeType,r=this._getResourceColumns(!this._listScope);a.setDefaultBrowseColumns(t,i,r);a.getVisibleBrowseColumns(t,i).subscribeAndRun(this._ltm,(function(t){var f=t||r,i=[v.getNameColumn(),];f.forEach((function(n){n&&n.visible&&i.push({id:n.itemKey||n.id,name:u.observable(n.name),format:n.format,dynamicSelectionProvider:n.dynamicSelectionProvider,activatable:n.activatable,width:u.observable("100px"),hiddenInCollapsed:!0,sortable:!0})}));n.gridViewModel.columns(i)}));this.gridViewModel.loading(!0)},t.prototype.populateCommandBar=function(){var n=[],r=this._options.allowOperations,t,i;r&&n.push(this._createAddResourceButton(this._ltm,this._resourceType,null,k.Constants.GalleryMenuItems.HomeMenuItem));n.push(this._createChooseColumnButton());t=this._createRefreshButton();r?(p.isResourceGroupId(this._listScope)?(n.push(this._createDeleteButton(this._listScope),t,this._createMoveButton(this._listScope)),this._watchResourceGroupScope()):n.push(t),n.push(new b.Toolbars.Separator),n.push(this._createAssignTagsButton()),i=y.BulkCommandDefinitions[this._resourceType.toLowerCase()],i&&n.push.apply(n,this._createBulkCommands(i))):n.push(t);this._toolbar.setItems(n)},t.prototype.refresh=function(){return this._performRefresh(this._fetchData())},t})(v.BaseConfiguration);t.BrowseAllConfiguration=g}))