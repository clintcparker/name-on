var __extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("Build/TypeScript/TFS.BuildDef.Data",["require","exports","f","o","$","Core/TypeScript/TFS.Azure","Core/TypeScript/TFS.Core","Core/TypeScript/TFS.Data.Cache","Core/TypeScript/TFS.Data","Build/TypeScript/TFS.Build.WebApi","Core/TypeScript/TFS.Message","Core/TypeScript/TFS.ObjectModel"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function y(n,t,i){return{accountId:n,projectId:t,projectName:i}}function k(){return a||(a=o.createQueryCache(new p)),a}function v(n,t,i,r,f){var e=u.Deferred(),o=k().createView(n),c=o.fetch(y(t,i,r)),h=c;return f===s.LoadBehavior.ForceRefresh&&(h=o.refresh()),h.then((function(){e.resolve(o.items)}),(function(){e.reject()})),e.promise()}function d(n,t,i,r,f,e){var s=function(n){return n.id()===f},o=u.Deferred();return v(n,t,i,r,e).then((function(n){var t=n().first(s);t?o.resolve(t):o.reject()}),(function(){o.reject()})),o.promise()}function g(n,t,i,r,f,e){var s=function(n){return n.name()===f},o=u.Deferred();return v(n,t,i,r,e).then((function(n){var t=n().first(s);t?o.resolve(t):o.reject()}),(function(){o.reject()})),o.promise()}function nt(n){var i=n.name(),t=i.match(/^(.*)_CD$/);return t&&t.length&&t.length>0?t[1]:null}function tt(n,t,i){var r=u.Deferred(),e=function(n){var t=l.TfsTeamProjectCollection.getConnection(n).getHttpClient(h.BuildHttpClient);t.beginGetAllDefinitions(i).done(r.resolve).fail(r.reject)};return f.awaitTfsContext({accountId:n}).then(e,r.reject),r.promise()}var p,w,b,a;r.defineProperty(t,"__esModule",{value:!0});t.createDefinitionSetDescriptor=y;p=(function(n){function t(){return n.call(this,"definition",36e5)||this}return __extends(t,n),t.prototype.getDataSetName=function(n){return this.getTypeName()+"-"+n.accountId+"-"+n.projectId},t.prototype.getMergeInfo=function(){return{typeName:this.getTypeName(),id:"uri",properties:[{name:"properties",mergeInfo:{typeName:"property",id:"name"}},{name:"propertyCollection",mergeInfo:{typeName:"propertyCollection",id:"name"}},{name:"schedules",mergeInfo:{typeName:"schedule",id:"id"}},{name:"sourceProviders",mergeInfo:{typeName:"sourceProvider",id:"name"}}]}},t.prototype.preserveOrdering=function(){return!0},t.prototype.getData=function(n){var t=u.Deferred(),i=function(i){var r=l.TfsTeamProjectCollection.getConnection(i).getHttpClient(h.BuildHttpClient);r.beginGetAllDefinitions(n.projectName).done((function(n){t.resolve(n.stableSort((function(n,t){return e.StringUtils.ignoreCaseComparer(n.name,t.name)})))})).fail(t.reject)};return f.awaitTfsContext(n).then(i,t.reject),t.promise()},t.prototype.getMessagesToSubscribeTo=function(){return[c.MessageTypes.BuildDefinition]},t.prototype.shouldRefreshForMessage=function(n,t,i){var r=c.Utils.getMessagePropertyValue(t,"projectId");return t.accountId===i.accountId&&r===i.projectId},t})(o.ContextAwareLoadable);w=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t})(i.Data.QueryCache);t.DefinitionQueryCache=w;b=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t})(i.Data.QueryView);t.DefinitionQueryView=b;a=null;t.getDefinitionQueryCache=k;t.getBuildDefinitions=v;t.getBuildDefinitionById=d;t.getBuildDefinitionByName=g;t.getWebsiteName=nt;t.getBuildDefinitionsDirect=tt}))