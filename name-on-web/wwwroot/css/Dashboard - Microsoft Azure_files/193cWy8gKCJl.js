var __extends;
define("Core/TypeScript/Generated/TFS.Azure.Common",["require","exports","o"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});var r;(function(n){n.CsmResourcesLocationId="B7D81B69-0581-40D4-99A0-5F968DE1B1F3";n.CsmResourceGroupsRouteId="B6B167BE-FE65-41C9-979D-BEBD8B7F070E";n.CsmResourcesInResourceGroupId="0C37F95C-16FE-4640-B755-E1070F374C65";n.CsmTemplateDeploymentsRouteId="2F2FC2CB-0A8F-4583-BDDC-F4CD76D8926E";n.AzureContextRouteId="3C0DA285-4BBC-4CCC-B299-D2FF91908FD6";n.AreaName="AzureTfs"})(r=t.AzureResourceIds||(t.AzureResourceIds={}))}));
define("Core/TypeScript/Generated/TFS.UserContext.Constants",["require","exports","o"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});var r;(function(n){n.UserContextLocationId="8CD849F1-CD51-4774-A0B0-9143DA7A6AC7";n.UserContextServiceArea="AzureTfs";n.UserContextResource="UserContext"})(r=t.UserContextResourceIds||(t.UserContextResourceIds={}));t.TypeInfo={AzureClientTraceData:{fields:null},AzureTfsContext:{fields:null},AzureUserContext:{fields:null},AzureTfsPortalEnvironment:{fields:null},AzureTfsTelemetryTrace:{fields:null},CsmConfiguration:{fields:null},CsmResource:{fields:null},CsmResourceGroup:{fields:null},CsmTemplateDeployment:{fields:null},ExtensionConfiguration:{fields:null}};t.TypeInfo.AzureTfsContext.fields={csmConfiguration:{typeInfo:t.TypeInfo.CsmConfiguration},extensionConfiguration:{typeInfo:t.TypeInfo.ExtensionConfiguration}};t.TypeInfo.AzureTfsTelemetryTrace.fields={timestamp:{isDate:!0}}}));
define("Core/TypeScript/Models/TFS.Account.Models",["require","exports","f","i","o","ko"],(function(n,t,i,r,u,f){"use strict";u.defineProperty(t,"__esModule",{value:!0});var e=(function(){function n(){this.subscriptionId=f.observable();this.id=f.observable();this.name=f.observable();this.tenantId=f.observable();this.tfsAccountUrl=f.observable();this.cltAccountUrl=f.observable();this.rmAccountUrl=f.observable();this.peAccountUrl=f.observable();this.subscriptionStatus=f.observable();this.resourceGroupName=f.observable();this.resourceName=f.observable();this.location=f.observable();this.IsAccountOwner=f.observable();this.IsAccountDisabled=f.observable();this.DisabledReason=f.observable();this.infoBalloon=new i.ViewModels.Controls.DockedBalloon.ViewModel(new r.TriggerableLifetimeManager)}return n})();t.Account=e}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("Core/TypeScript/TFS.Azure.WebApi",["require","exports","o","Core/TypeScript/TFS.WebApi","Core/TypeScript/Generated/TFS.Azure.Common"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.beginGetCsmResources=function(n,t){return this._beginRequest({area:u.AzureResourceIds.AreaName,locationId:u.AzureResourceIds.CsmResourcesLocationId,responseIsCollection:!0,routeValues:{subscriptionId:n},data:{resourceType:t}})},t.prototype.beginGetCsmResourcesInResourceGroup=function(n,t,i,r){return this._beginRequest({area:u.AzureResourceIds.AreaName,locationId:u.AzureResourceIds.CsmResourcesInResourceGroupId,responseIsCollection:!0,routeValues:{subscriptionId:n,resourceGroupName:t,resourceProviderNamespace:i,resourceType:r}})},t.prototype.beginGetCsmResourceGroup=function(n,t){return this._beginRequest({area:u.AzureResourceIds.AreaName,locationId:u.AzureResourceIds.CsmResourceGroupsRouteId,routeValues:{subscriptionId:n,resourceGroupName:t}})},t.prototype.beginGetCsmResourceGroups=function(n){return this._beginRequest({area:u.AzureResourceIds.AreaName,locationId:u.AzureResourceIds.CsmResourceGroupsRouteId,responseIsCollection:!0,routeValues:{subscriptionId:n}})},t.prototype.beginCreateCsmResourceGroup=function(n,t,i){return this._beginRequest({area:u.AzureResourceIds.AreaName,httpMethod:"PUT",locationId:u.AzureResourceIds.CsmResourceGroupsRouteId,routeValues:{subscriptionId:n,resourceGroupName:t},data:i})},t.prototype.beginGetCsmTemplateDeployments=function(n,t){return this._beginRequest({area:u.AzureResourceIds.AreaName,locationId:u.AzureResourceIds.CsmTemplateDeploymentsRouteId,routeValues:{subscriptionId:n,resourceGroupName:t},responseIsCollection:!0})},t.prototype.beginGetCsmTemplateDeployment=function(n,t,i){return this._beginRequest({area:u.AzureResourceIds.AreaName,locationId:u.AzureResourceIds.CsmTemplateDeploymentsRouteId,routeValues:{subscriptionId:n,deploymentName:i,resourceGroupName:t}})},t.prototype.beginCreateTemplateDeployment=function(n,t,i){return this._beginRequest({area:u.AzureResourceIds.AreaName,locationId:u.AzureResourceIds.CsmTemplateDeploymentsRouteId,httpMethod:"POST",routeValues:{subscriptionId:n,resourceGroupName:t},data:i})},t})(r.VssHttpClient);t.AzureHttpClient=f}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("Core/TypeScript/TFS.AzureContext.WebApi",["require","exports","o","Core/TypeScript/TFS.WebApi","Core/TypeScript/Generated/TFS.UserContext.Constants"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.beginGetAzureContext=function(){var n=this._rootRequestPath+"_apis/AzureTfs/Context";return this._beginRequestUrl(n,{responseType:u.TypeInfo.AzureTfsContext})},t})(r.VssHttpClient);t.AzureContextHttpClient=f}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("Core/TypeScript/TFS.User.WebApi",["require","exports","o","Core/TypeScript/TFS.WebApi","Core/TypeScript/Generated/TFS.UserContext.Constants"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.beginGetUserContext=function(){var n=this._rootRequestPath+"_apis/AzureTfs/UserContext";return this._beginRequestUrl(n,{responseType:u.TypeInfo.AzureUserContext})},t})(r.VssHttpClient);t.UserHttpClient=f}));
define("Core/TypeScript/TFS.Azure",["require","exports","f","i","o","ko","$","Core/TypeScript/Models/TFS.Account.Models","Core/TypeScript/TFS.Azure.WebApi","Core/TypeScript/TFS.Host","Core/TypeScript/TFS.Diag","Core/TypeScript/TFS.AzureContext.WebApi","Core/TypeScript/TFS.Service","Core/TypeScript/TFS.User.WebApi","Core/TypeScript/TFS.Core","Core/TypeScript/TFS.Azure.Context","Core/TypeScript/TFS.Service"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function dt(){return k.promise()}function hi(){return ct.promise()}function ci(){c.logInfo("Create the Profile");var t=p.getAzureTfsContext(),n={};n.UseCORS=!0;p.setEnabledFeaturesLookup(n);gt(t,n).fail((function(){c.logInfo("Create the Profile for new accounts");var i=a.AccountManager.beginCreateProfile();i.then((function(){gt(t,n).fail((function(){ct.reject();k.reject()}))})).fail((function(){ct.reject();k.reject()}))}))}function gt(n,t){var r=new l.AzureContextHttpClient(n.extensionConfiguration.serverUrl),u=new v.UserHttpClient(n.extensionConfiguration.serverUrl),f=r.beginGetAzureContext(),o=u.beginGetUserContext();return Q.all([f,o]).spread((function(r,u){n.csmConfiguration=r.csmConfiguration;n.deploymentHostId=r.deploymentHostId;n.defaultCollectionName=r.defaultCollectionName;e.each(r.enabledFeatureNames||[],(function(n,i){t[i]=!0}));p.setEnabledFeaturesLookup(t);tt=u;y.DateUtils.setTimeZoneOffset(u.preferredTimeZoneOffset);ct.resolve();i.Base.Security.getAuthorizationToken({resourceName:"self"});li()}))}function li(){c.logInfo("Getting the account list.");a.AccountManager.beginGetAllAccountsWithSubscription(tt.id,(function(n){if(c.logInfo("Received the account list."),n){var t=c.startAzureTrace("AzureTfs","BootstrapEndToEnd");ii(n).done((function(){vi()})).fail((function(){k.reject()}));c.completeAzureTrace(t)}else c.logError("Unable to get the account list."),k.reject()}),(function(n){c.logError("Error on getting account list call "+n);k.reject()}))}function ai(n){c.logInfo("Failed to get the subscription list: "+n.message);cu();k.reject()}function vi(){c.logInfo("Attempting to get subscription list from HubsExtension...");i.Azure.getAllSubscriptions().then(yi,ai)}function yi(n){!n||f.computed(new r.TriggerableLifetimeManager,(function(){!n||(g=[],nt={},c.logInfo("Have subscriptions. Continuing initialization."),e.each(n,(function(n,t){g.push(t.subscriptionId);nt[t.subscriptionId]=t})),g.length?k.resolve():y.delay(null,2e3,(function(){k.resolve()})))}))}function pi(n){ut.push(n)}function wi(){}function yt(n,t){if(t){if(et[n])return et[n]}else if(st[n])return st[n];return null}function bi(n){return n=n?n.toLowerCase():null,n&&it[n]?it[n]:null}function ni(n){return n=n?n.toLowerCase():null,n&&rt[n]?rt[n]:null}function ki(n){return n&&b[n]?b[n].accountName:""}function di(n){var i=ft[n],t;return i&&(t=nt[i],t)?t.tenantId:null}function gi(){var n=Q.defer();return i.Base.Security.getUserInfo().then((function(t){var i={tenantId:t.directoryId,tenantName:t.directoryName};n.resolve(i)}),(function(){c.logError("Error on getting the tenantId");n.resolve(null)})),n.promise}function nr(n){if(n){var t=nt[n];if(t)return t.subscriptionPolicies.quotaId.toLowerCase()}return null}function tr(){return tt}function ir(n){return ft[n]?ft[n]:null}function rr(n){for(var i=d(),t=0;t<i.length;t++)if(n===i[t].subscriptionId())return i[t].name();return""}function ti(n){return n=n?n.toLowerCase():null,n&&(it[n]||rt[n])?!0:!1}function ur(n){if(!n&&d&&d()&&d().length>0){var t=f.observableArray();return d().forEach((function(n){n&&(n.subscriptionId()||n.IsAccountOwner())&&t.push(n)})),t}return d}function fr(){return bt}function er(n){var r,t,u;return n?(r=ni(n),r&&b[r])?Q(b[r]):(t=Q.defer(),u=new w.SubscriptionHttpClient(w.AccountManager.getSpsLocation("")),u.beginGetAllAccountsWithSubscription(w.SubscriptionConstants.VSOProviderNamespaceId,tt.id).done((function(r){var u=i.find(r,(function(t){return t.resourceName&&t.resourceName.toLowerCase()==n.toLowerCase()})),f;u||(u=i.find(r,(function(t){return t.accountName&&t.accountName.toLowerCase()==n.toLowerCase()})));u?(f=ri(u),ei(f),t.resolve(f)):t.reject("VSTS organization does not exist or you do not have permission to access it.")})).fail((function(){c.logError("Failed to subscriptionAccounts from the SPS subscription service.");t.reject("Failed to get the list of VSTS organizations.")})),t.promise):Q.reject("AccountName is null")}function or(n){var t=e.Deferred();return n&&ti(n)?(t.resolve(),t.promise()):(lt?(c.logInfo("Refreshing the account list."),a.AccountManager.beginGetAllAccountsWithSubscription(tt.id,(function(n){ii(n).always((function(){t.resolve();lt=!1}))}),(function(){c.logError("Error on refreshing account list call with accountName: {0}".format(n));t.resolve()}))):t.resolve(),t.promise())}function sr(){lt=!0}function ii(n){var i=e.Deferred(),r,u,t;if(n){for(r=[],bt=n,d.removeAll(),u=0;u<n.length;u++)t=n[u],p.addSpsAccountUrl(t.serviceUrls[a.SubscriptionConstants.SPSGuid]),t.accountTenantId==a.SubscriptionConstants.EmptyGuid&&(p.addMsaAccount(t.accountName),pt||(r.push(lr()),pt=!0)),r.push(hr(t).then((function(n){var t=ri(n),i=cr(t);d.push(i);ei(t)})));Q.all(r).then((function(){return i.resolve()})).catch((function(){c.logError("error retrieving tfs deployment urls");i.resolve()}))}else i.resolve();return i.promise()}function hr(n){return b[n.accountId]?(n.tfsDeploymentUrl=b[n.accountId].tfsDeploymentUrl,Q.resolve(n)):Q(a.AccountManager.beginGetTfsDeploymentUrl(n))}function cr(n){var t=new o.Account;return n.accountId&&t.id(n.accountId),n.accountName&&t.name(n.accountName),n.subscriptionId&&t.subscriptionId(n.subscriptionId),n.resourceName&&t.resourceName(n.resourceName),n.resourceGroupName&&t.resourceGroupName(n.resourceGroupName),n.location&&t.location(n.location),n.isOwner&&t.IsAccountOwner(n.isOwner),n.tenantId&&t.tenantId(n.tenantId),n.tfsAccountUrl&&t.tfsAccountUrl(n.tfsAccountUrl),n.cltAccountUrl&&t.cltAccountUrl(n.cltAccountUrl),n.rmAccountUrl&&t.rmAccountUrl(n.rmAccountUrl),n.peAccountUrl&&t.peAccountUrl(n.peAccountUrl),typeof n.isDisabled!="undefined"&&t.IsAccountDisabled(n.isDisabled),typeof n.disabledReason!="undefined"&&t.DisabledReason(n.disabledReason),t}function lr(){return fi()?Q(a.AccountManager.beginCreateProfile(!0)):Q.resolve(null)}function ri(n){var t={accountId:n.accountId,accountName:n.accountName,subscriptionId:n.subscriptionId,subscriptionStatus:n.subscriptionStatus,resourceName:n.resourceName,resourceGroupName:n.resourceGroupName,location:n.geoLocation,isOwner:n.isAccountOwner,spsAccountUrl:n.serviceUrls[a.SubscriptionConstants.SPSGuid],tfsAccountUrl:n.serviceUrls[a.SubscriptionConstants.TFSGuid],cltAccountUrl:n.serviceUrls[a.SubscriptionConstants.CLTGuid],rmAccountUrl:n.serviceUrls[a.SubscriptionConstants.RMGuid],peAccountUrl:n.serviceUrls[a.SubscriptionConstants.PEGuid],tfsDeploymentUrl:n.tfsDeploymentUrl,tenantId:n.accountTenantId,isDisabled:!1,disabledReason:""};return t.subscriptionId==null&&(t.isDisabled=!0,t.disabledReason=a.SubscriptionConstants.disabledNoSub),t}function ui(){return p.getAzureTfsContext().csmConfiguration}function ar(){return p.getAzureTfsContext().csmConfiguration.csmManagementUrl}function vr(){return p.getAzureTfsContext().csmConfiguration.useCsm}function fi(){return p.isPortalFeatureEnabled("VisualStudio.Services.Commerce.EnableMSABackedAccounts")}function yr(){return p.getAzureTfsContext().csmConfiguration.vsoNewAccountProjectTemplateName}function pr(){return p.getAzureTfsContext().csmConfiguration.vsoNewProjectExistingAccountTemplateName}function wr(){return p.getAzureTfsContext().csmConfiguration.vsoResourceProviderName}function br(n){return nt[n]?nt[n].uniqueDisplayName:null}function ei(n,t){t===void 0&&(t=!1);var r=0,o,l,u,i=n.accountId,f=n.accountName,v=n.accountName.toLowerCase(),s=n.subscriptionId,y=p.getAzureTfsContext(),h=n.resourceName?n.resourceName.toLowerCase():n.resourceName;if(b[i]&&b[i].subscriptionId===s)c.logInfo("Account already registered "+i+" [currently "+b[i].accountName+" trying to register "+f+"]");else return c.logInfo("Registering account "+f+" for subscription id "+s),b[i]=n,st[i]=oi(n.tfsDeploymentUrl,i,f,n.tfsAccountUrl,y.defaultCollectionName),o=oi(n.tfsDeploymentUrl,i,f,n.tfsAccountUrl,null),et[i]=o,ft[i]=s,ht[i]=n.spsAccountUrl,wt.push(n.spsAccountUrl),it[v]||(it[v]=i),h&&!rt[h]&&(rt[h]=i),n.subscriptionId?(vt.push(n.subscriptionId),ot.push(i)):ot.remove(n.accountId),u=e.Deferred(),l=t?a.AccountManager.beginWaitForAccountReady(o):e.Deferred().resolve(),l.done((function(){if(ut&&ut.length>0)for(r=0;r<ut.length;r++)try{ut[r](n)}catch(t){t&&t.message?c.logError(t.message):c.logError("Tfs.Azure.registerAccount: Error occurred invoking callback for new account creation.")}u.resolve()})).fail(u.reject),u}function kr(n){var u=e.Deferred(),t,r;return n==null||n==undefined?(u.reject("invalid"),u.promise()):(t=kt[n],t!=null||t!=undefined)?(u.resolve(t),u.promise()):(r=ui(),i.isNullOrUndefined(r)&&(r={csmApiVersion:"2014-02-26",csmManagementUrl:"https://management.azure.com",useCsm:!0,vsoNewAccountProjectTemplateName:null,vsoNewAccountProjectWithIdTemplateName:null,vsoNewProjectExistingAccountTemplateName:null,vsoResourceProviderName:null}),(i.isNullOrUndefined(r.csmManagementUrl)||r.csmManagementUrl==="")&&(r.csmManagementUrl="https://management.azure.com"),a.AccountManager.beginGetProviderManifest(r.csmManagementUrl,r.csmApiVersion,n).done((function(i){t=[];i&&i.resourceTypes&&i.resourceTypes.length>0&&(t=i.resourceTypes[0].locations);kt[n]=t;u.resolve(t)})).fail((function(){u.reject()})),u.promise())}function dr(n){var t=n?n.getHost(h.TeamFoundationHostType.Application):null;return t?t.name:null}function gr(){return at||(at=new s.AzureHttpClient(p.getAzureTfsContext().extensionConfiguration.serverUrl)),at}function nu(n){return yt(n.accountId)}function tu(n){var t=e.Deferred(),i=n?n.accountId:null;return dt().then((function(){i?t.resolve(yt(i)):t.reject()}),(function(){t.reject()})),t.promise()}function iu(n){if(typeof n=="string"||n instanceof String)try{return e.parseJSON(n)}catch(t){return n}else return n}function ru(){return g}function uu(){return vt}function fu(){return ot}function eu(n){if(!n)return!1;n=n.toLowerCase();for(var t=0;t<g.length;t++)if(g[t].toLowerCase()==n)return!0;return!1}function ou(n){return ht[n]?ht[n]:""}function su(n){return b[n]?b[n]:null}function hu(){si=null;et={};g=[];vt=f.observableArray();ot=f.observableArray();st={};ft={};b={};ht={};wt=[];k=e.Deferred();nt={};it={};tt=null;ut=[];d=f.observableArray();lt=!1;rt={}}function oi(n,t,i,r,u){var f,e;return e=r,e[e.length-1]==="/"&&(e=e.substr(0,e.length-1)),f={currentIdentity:tt,serviceHosts:{serviceHost:null,deployment:null,account:null,collection:null}},f.serviceHosts.deployment={hostType:h.TeamFoundationHostType.Deployment,instanceId:"",name:"",uri:n},f.serviceHosts.account={hostType:h.TeamFoundationHostType.Application,instanceId:t,name:i,uri:e+"/"},f.serviceHosts.serviceHost=f.serviceHosts.account,p.isHosted?(f.serviceHosts.collection={hostType:h.TeamFoundationHostType.ProjectCollection,instanceId:"",name:i,uri:e+"/"},f.serviceHosts.serviceHost=f.serviceHosts.collection):u&&(f.serviceHosts.collection={hostType:h.TeamFoundationHostType.ProjectCollection,instanceId:"",name:u,uri:e+"/"+u+"/"},f.serviceHosts.serviceHost=f.serviceHosts.collection),new h.TfsContext(f)}function cu(){var n=new i.UI.NotificationManager.Notification("AzureTfsExtension","genericError",i.UI.NotificationManager.NotificationState.Error,["Team Foundation Services could not be loaded."],null,null,100,null);i.UI.NotificationManager.addNotifications([n])}var pt;u.defineProperty(t,"__esModule",{value:!0});var at,si=null,et={},g=[],vt=f.observableArray(),ot=f.observableArray(),st={},ft={},b={},ht={},wt=[],k=e.Deferred(),ct=e.Deferred(),nt={},it={},rt={},tt=null,ut=[],d=f.observableArray(),bt=[],lt=!1,kt={};t.ready=dt;t.extensionReadyWithoutAccountsLoad=hi;t.initialize=ci;t.addAccountRegisteredCallback=pi;t.dispose=wi;t.mapAccountIdToTfsContext=yt;t.getAccountId=bi;t.getAccountIdFromResourceName=ni;t.getAccountName=ki;t.getTenantId=di;t.getCurrentDirectoryInfo=gi;t.getQuotaId=nr;t.getCurrentIdentity=tr;t.mapAccountIdToSubscription=ir;t.getFirstAccount=rr;t.isAccountExists=ti;t.getAccounts=ur;t.getUnfilteredAccounts=fr;t.getSingleAccountMapping=er;t.refreshAccounts=or;t.setFlagToRefreshAccountList=sr;pt=!1;t.getCsmConfiguration=ui;t.getCsmUrl=ar;t.useCsm=vr;t.IsSuportForMSABackedAccountsEnabled=fi;t.getCsmTemplateName=yr;t.getCsmTemplateNameForExistingAccount=pr;t.getCsmResourceProviderName=wr;t.getSubscriptionName=br;t.getSupportedRegionForSubscription=kr;t.getTfsAccountName=dr;t.getExtensionHttpClient=gr;t.getTfsContext=nu;t.awaitTfsContext=tu;t.acceptAssetIdAs=iu;t.getSubscriptionList=ru;t.activeSubscriptions=uu;t.activeAccounts=fu;t.IsMemberOfSubscription=eu;t.getSpsAccountUrl=ou;t.getAccountMapping=su;t.reset=hu}))