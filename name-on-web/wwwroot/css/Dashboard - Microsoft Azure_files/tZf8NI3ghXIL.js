define("Shared/AuthTokenHelper",["require","exports","f","o","$","Shared/InsightsTelemetry"],(function(n,t,i,r,u,f){"use strict";r.defineProperty(t,"__esModule",{value:!0});var e=(function(){function n(){}return n.isTokenAvailable=function(t){return!!n._token[t]},n.getIbizaAuthorizationHeaderAsync=function(n,t){var i=u.Deferred();return this.getIbizaAuthorizationHeaderPromiseVAsync(n,t).then((function(n){i.resolve(n)}),(function(n){i.reject(n)})),i.promise()},n.getIbizaAuthorizationHeaderPromiseVAsync=function(t,r){var u=null;return i.isNullOrWhiteSpace(r)||(u={resourceName:r}),i.Base.Security.getAuthorizationToken(u).then((function(t){return n._token[r]=t.header,t.header}),(function(n){var u={};return i.isNullOrWhiteSpace(r)||(u.Source=r),i.isNullOrUndefined(n)?(u.Status=f.AITelemetryConstants.GetAuthorizationTokenReturnsFailed,u.StatusText="error object is falsy",n={Status:u.Status,StatusText:u.StatusText}):(u=f._extractProperty(n),i.isNullOrUndefined(u.Status)&&(u.Status=f.AITelemetryConstants.GetAuthorizationTokenReturnsFailed,n.Status=u.Status),i.isNullOrUndefined(u.StatusText)&&!i.isNullOrUndefined(u.ErrorMessage)&&(u.StatusText=u.ErrorMessage,n.StatusText=u.StatusText)),f.traceMessage("getIbizaAuthorizationHeader: MsPortalFx.Base.Security.getAuthorizationToken()",4,"AjaxHelper",t,u),n}))},n})();e._token={};t.AuthTokenHelper=e}));
define("Shared/Flighting/FlightingTypes",["require","exports","o"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});var r;(function(n){n[n.Auto=0]="Auto";n[n.Always=1]="Always";n[n.Never=2]="Never"})(r=t.AutoEnroll||(t.AutoEnroll={}))}));
define("Shared/Flighting/PreviewDefinitionProvider",["require","exports","o","Shared/Flighting/PreviewDefinitionClientResources","Shared/Constants/ExternalUrls"],(function(n,t,i,r,u){"use strict";function f(){var n=[];return n.push({key:"appMapSingleIKeySegmentation",name:r.AppMapSingleIKeySegmentation.name,description:r.AppMapSingleIKeySegmentation.description,url:u.ExternalUrls.AppMapPreview,date:"2/1/2018"}),n.push({key:"applicationMapV3Enabled",name:r.AppMapSingleIKeySegmentation.name,description:r.AppMapSingleIKeySegmentation.description,date:"2/1/2018"}),n.push({key:"detailsV2InPlace",name:r.DetailsV2.name,description:r.DetailsV2.description,url:u.ExternalUrls.AppInsightsDoc_DetailsV2,date:"12/4/2017"}),n}i.defineProperty(t,"__esModule",{value:!0});t.getPreviewDefinitions=f}));
define("Shared/Flighting/FlightingService",["require","exports","f","o","$","Shared/AuthTokenHelper","Shared/Flighting/PreviewDefinitionProvider","Shared/InsightsTelemetry","Shared/Enumerations","Shared/Configuration","Shared/Flighting/FlightingCache","Shared/Flighting/FlightingTypes"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";var a,y,v;r.defineProperty(t,"__esModule",{value:!0}),(function(n){function r(){if(i.isNull(t)){try{t=h.getSettings().getAppInsightsEnvironmentUrl()}catch(n){t=""}t+="/api/Flighting"}return t}function o(n){var t=Q.defer(),i=r();return e("getFlights",n,{url:i+"/GetFlights",type:"GET",cache:!1,success:function(n){t.resolve(n)},error:function(){t.reject()}}),t.promise}function c(n,t){var i=Q.defer(),u=r();return e("setUserAutoEnrollValue",n,{url:u+"/SetUserAutoEnrollValue/"+l.AutoEnroll[t],type:"POST",success:function(){i.resolve()},error:function(){i.reject()}}),i.promise}function a(n,t){var i=Q.defer(),u=r();return e("enablePreviews",n,{url:u+"/Enable",type:"POST",data:JSON.stringify(t),contentType:"application/json",success:function(){i.resolve()},error:function(){i.reject()}}),i.promise}function y(n,t){var i=Q.defer(),u=r();return e("disablePreviews",n,{url:u+"/Disable",type:"POST",data:JSON.stringify(t),contentType:"application/json",success:function(){i.resolve()},error:function(){i.reject()}}),i.promise}function e(n,t,r){return f.AuthTokenHelper.getIbizaAuthorizationHeaderPromiseVAsync().then((function(f){var e=i.newGuid(),o,h,c;return r.headers=p(e,f,t),o=window.performanceNow(),h=r.success,r.success=function(i,u,f){var c=window.performanceNow()-o;v.logAjax(n,r.url,t,e,s.Result.Succeed,f,c);h(i,u,f)},c=r.error,r.error=function(i,u,f){var h=window.performanceNow()-o;v.logAjax(n,r.url,t,e,s.Result.Fail,i,h);c(i,u,f)},u.ajax(r)}))}function p(n,t,r){var u={};return t&&(u.Authorization=t),u["x-ms-client-request-id"]=n,u["x-ms-client-session-id"]=i.sessionId,r&&(u.SubscriptionId=r.SubscriptionId,u.ResourceGroup=r.ResourceGroup,u.ComponentName=r.Name),u}var t=null;n.getFlightsAsync=o;n.setUserAutoEnrollValueAsync=c;n.enablePreviewsAsync=a;n.disablePreviewsAsync=y})(a=t.Ajax||(t.Ajax={})),(function(n){function u(n){if(c.FlightingCache.hasFlights(n))return Q();var r=c.FlightingCache.getFlightsPromise(n);return r?r.promise:(r=Q.defer(),c.FlightingCache.setFlightsPromise(n,r),a.getFlightsAsync(n).then((function(t){i.isNullOrUndefined(t)||(c.FlightingCache.setFlights(n,t),y(n));c.FlightingCache.deleteFlightsPromise(n);r.resolve()})).catch((function(){c.FlightingCache.deleteFlightsPromise(n);r.reject()})),t=v(),r.promise)}function f(n){return c.FlightingCache.getFlights(n)}function o(n,t,i){switch(typeof i){case"string":return s(n,t,i);case"boolean":return h(n,t,i);case"number":return l(n,t,i);default:throw new Error("Unexpected DataType for flight "+t+": "+typeof i+"!");}}function s(n,t,i){i===void 0&&(i=undefined);try{return r(n,t)}catch(u){return i}}function h(n,t,u){u===void 0&&(u=!1);try{var f=r(n,t);return i.isNullOrUndefined(f)?u:f.toLowerCase()==="true"}catch(e){return u}}function l(n,t,u){var f,e;u===void 0&&(u=0);try{return(f=r(n,t),!i.isNullOrUndefined(f)&&(e=parseInt(f,10),!isNaN(e)))?e:u}catch(o){return u}}function r(n,i){var s,u,r,f,e,o;if(t[i.toLowerCase()])return t[i.toLowerCase()];if(!c.FlightingCache.hasFlights(n)){s=c.FlightingCache.componentIdToResourceId(n);u="AppInsightsExtension: FlightingService: Cannot get value for '"+i+"' because flighting has not been initialized for '"+s+"'.";console.error(u);throw new Error(u);}for(r=0,f=c.FlightingCache.getFlights(n).flights;r<f.length;r++)if(e=f[r],e.key===i)return e.value;o="AppInsightsExtension: FlightingService: Flight '"+i+"' was not found.";console.error(o);throw new Error(o);}function v(){var u={},f=i.getFeatureValue("OverrideSettings"),e,n,r,t;if(f)for(e=f.toLowerCase().split(/[,;]/).map((function(n){return n.split(/:/)})),n=0,r=e;n<r.length;n++)t=r[n],t.length===2&&(u[t[0]]=t[1]);return u}function y(n){var a=e.getPreviewDefinitions(),l=c.FlightingCache.getFlights(n),u,o,t,s,f,h,r;if(!i.isNullOrUndefined(l))for(u=0,o=l.flights;u<o.length;u++)if(t=o[u],!i.isNullOrUndefined(t.previewDefinition)){for(s=!1,f=0,h=a;f<h.length;f++)if(r=h[f],t.key===r.key){s=!0;t.previewDefinition.name=r.name;t.previewDefinition.description=r.description;t.previewDefinition.detailsUrl=r.url;t.previewDefinition.releaseDateString=r.date;t.previewDefinition.isShuttingDown=r.isShuttingDown;t.previewDefinition.shutDownDate=r.shutDownDate;break}s||(t.previewDefinition=null)}}function p(){c.FlightingCache.clear()}var t={},w;n.initializeAsync=u;n.getAllFlights=f;n.getValue=o;n._resetFlightCache=p,(function(n){function u(n,t){a.setUserAutoEnrollValueAsync(n,t);var r=c.FlightingCache.getFlights(n);i.isNullOrUndefined(r)||(r.enrollment=t)}function f(n,t){var e,h,r,o,l,u,s,f;if(a.enablePreviewsAsync(n,t),e=c.FlightingCache.getFlights(n),!i.isNullOrUndefined(e))for(h=e.flights,r=0,o=t;r<o.length;r++)for(l=o[r],u=0,s=h;u<s.length;u++)if(f=s[u],f.key===l){f.value=f.previewDefinition.optInValue;break}}function e(n,t){var e,h,r,o,l,u,s,f;if(a.disablePreviewsAsync(n,t),e=c.FlightingCache.getFlights(n),!i.isNullOrUndefined(e))for(h=e.flights,r=0,o=t;r<o.length;r++)for(l=o[r],u=0,s=h;u<s.length;u++)if(f=s[u],f.key===l){f.value=f.previewDefinition.optOutValue;break}}function t(n){var t=c.FlightingCache.getFlights(n);return i.isNullOrUndefined(t)?[]:t.flights.filter((function(n){return n.previewDefinition!==null&&n.previewDefinition.enabled&&!n.previewDefinition.isShuttingDown}))}function r(n){var i=t(n);return i.filter((function(n){return n.value!==n.previewDefinition.optInValue}))}function o(n){var t=r(n),u;return!i.isNullOrUndefined(t)&&t.length!==0?(u=Math.floor(Math.random()*t.length),u===t.length&&(u=u-1),t[u].previewDefinition):null}n.setAutoEnroll=u;n.setOptIn=f;n.setOptOut=e;n.getAvailablePreviews=t;n.getAvailableNotOptedInPreviews=r;n.getRandomAvailableNotOptedInPreview=o})(w=n.Previews||(n.Previews={}))})(y=t.FlightingProvider||(t.FlightingProvider={})),(function(n){function r(n,i,r,u,f,e,s){var h={_containerName:t,_componentId:null,_queryName:n},c={Url:i,SubscriptionId:r?r.SubscriptionId:"NULL",ResourceGroup:r?r.ResourceGroup:"NULL",Name:r?r.Name:"NULL",ClientRequestId:u};o.logAjaxQuery(h,f,null,e,c,s)}function u(n,r,u,f,e){var s={ErrorMessage:f,HandledAt:u,ErrorObject:n,Error:n&&n.stack?n.stack:""},h=e?e:t;o.logCustomEvent(i,null,h,r,s)}var t="FlightingService",i="Flighting failure";n.logAjax=r;n.logError=u})(v=t.FlightingTelemetry||(t.FlightingTelemetry={}))}));
define("Shared/UserInfo",["require","exports","f","o"],(function(n,t,i,r){"use strict";r.defineProperty(t,"__esModule",{value:!0});var u="@microsoft.com",f=".microsoft.com",e=(function(){function n(n,t,i,r){r===void 0&&(r=!1);this.userId=n;this.userAlias=t;this.userIdentityProvider=i;this.isMicrosoftUser=r}return n.getUserInfo=function(){var t=Q.defer();try{i.Base.Security.getAuthorizationToken().then((function(i){try{var r=n._parseUserInfo(i.header);r?t.resolve(r):t.reject(new Error("Failed parsing auth header"))}catch(u){t.reject(u)}}),(function(n){t.reject(n)}))}catch(r){t.reject(r)}return t.promise},n._parseUserInfo=function(t){var i,c,l=!1,o,a,s,e,h,r;if(!t||typeof t!="string")throw new Error("Unique UserId: Header undefined or of wrong type");if(o=t.split(" "),o.length<2)throw new Error("Unique UserId: Header incorrect format");if(a=o[1],s=a.split("."),s.length<2)throw new Error("Unique UserId: Header tokens incorrect format");e=s[1];e=e.replace("-","+").replace("_","/");c=atob(e);try{return i=JSON.parse(c),h="external",i&&i.upn&&(r=i.upn.toLowerCase(),(r.endsWith(u)||r.endsWith(f))&&(l=!0,h=r.substring(0,r.indexOf("@")))),i?new n(i.oid,h,i.idp,l):undefined}catch(v){throw new Error("Failed parsing header:["+t+"] with exception: {"+v+"}");}},n})();t.UserInfo=e}));
define("Shared/Flighting/FlightingConfiguration",["require","exports","f","o","$","Shared/Configuration","Shared/Flighting/FlightingService","Shared/UserInfo"],(function(n,t,i,r,u,f,e,o){"use strict";var h,c,s;r.defineProperty(t,"__esModule",{value:!0});h=(function(){function n(){}return n})();t.ClientFlightDefinition=h;t.ClientFlights={FunnelsIframe:{Key:"funnelsIframe",DefaultValue:!1},SegmentationEventsTable:{Key:"segmentationEventsTable",DefaultValue:!1},NotebookSettingsEnabled:{Key:"notebookSettingsEnabled",DefaultValue:!1},UsageSegmentationPinChartEnabled:{Key:"usageSegmentationPinChartEnabled",DefaultValue:!1},UsageOverviewMauChartEnabled:{Key:"usageOverviewMauChartEnabled",DefaultValue:!1},CuratedApmEnabled:{Key:"curatedApmEnabled",DefaultValue:!1},CuratedPreAggs:{Key:"curatedPreAggs",DefaultValue:!1},UseMStore:{Key:"useMStore",DefaultValue:!1},AquaTimerEnabled:{Key:"aquatimerenabled",DefaultValue:!1},AquaTimerProxied:{Key:"aquatimerproxied",DefaultValue:!1},AquaOverrideEnabled:{Key:"aquaoverrideenabled",DefaultValue:!1},ProactiveDetectionProfilerHotspotEnabled:{Key:"EnableProactiveDetectionProfilerHotspot",DefaultValue:!1},ProactiveDetectionDemoAppEnabled:{Key:"ProactiveDetectionDemoApp",DefaultValue:!1},ProactiveDetectionDetailsCollapsed:{Key:"ProactiveDetectionDetailsCollapsed",DefaultValue:!1},ShowPreviewMetrics:{Key:"showPreviewMetrics",DefaultValue:!1},CustomWorkItemIntegrationEnabled:{Key:"customWorkItemIntegration",DefaultValue:!1},NotebookExportEnabled:{Key:"notebookExport",DefaultValue:!1},NotebooksInCuratedBlades:{Key:"notebooksInCuratedBlades",DefaultValue:!1},CuratedRoleInstanceTab:{Key:"curatedRoleInstanceTab",DefaultValue:!1},CuratedTransitionExperiment:{Key:"curatedTransitionExperiment",DefaultValue:""},CuratedClientTypeFilter:{Key:"curatedClientTypeFilter",DefaultValue:!1},AlertPreviewAvailable:{Key:"alertPreviewAvailable",DefaultValue:!1},NotebookMetricsEnabled:{Key:"notebookMetricsEnabled",DefaultValue:!1},XCloudEnabled:{Key:"xcloudEnabled",DefaultValue:!1},LiveMetricPinChartEnabled:{Key:"liveMetricPinChartEnabled",DefaultValue:!1},TaggingEnabled:{Key:"taggingEnabled",DefaultValue:!1},LiveTransitionsEnabled:{Key:"liveTransitionsEnabled",DefaultValue:!1},DetailsV2Enabled:{Key:"detailsV2",DefaultValue:!1},DetailsV2WebTestsEnabled:{Key:"detailsV2webtests",DefaultValue:!1},DetailsV2InPlaceEnabled:{Key:"detailsV2InPlace",DefaultValue:!1},SubscriptionRequestEnabled:{Key:"subscriptionRequestEnabled",DefaultValue:!1},ProactiveDetectionDigestEmailEnabled:{Key:"proactiveDetectionDigestEmailEnabled",DefaultValue:!1},UserflowsCheckForTableSummary:{Key:"userflowsCheckForTableSummary",DefaultValue:!1},CohortTypeDropdownEnabled:{Key:"cohortTypeDropdownEnabled",DefaultValue:!1},CohortAdvancedModeEnabled:{Key:"cohortAdvancedModeEnabled",DefaultValue:!1},FlowsEntryPointEnabled:{Key:"flowsentrypointenabled",DefaultValue:!1},DraftDebouncingEnabled:{Key:"draftDebouncingEnabled",DefaultValue:"false"},OverviewBannerFeature:{Key:"overviewBannerFeature",DefaultValue:"previewsBlade"},EnableBlankSearch:{Key:"blanksearch",DefaultValue:!1},EnableDashboardTimeRange:{Key:"enableDashboardTimeRange",DefaultValue:!1},billingRpcDisabled:{Key:"billingrpcdisabled",DefaultValue:!1},MaxWebtestLimitOverride:{Key:"maxWebtestLimitOverride",DefaultValue:!1},WebTestNopdl:{Key:"webTestNopdl",DefaultValue:!1},ShouldFetchNrtAlertsFromAms:{Key:"shouldFetchNrtAlertsFromAms",DefaultValue:!1}};c=(function(){function n(){}return n.initializeStaticAsync=function(){return s.initializeAsync(null)},n.getStaticValueAsync=function(n){return s.getValueAsync(null,n)},n.prototype.getStaticValue=function(n){return s.getNullComponentIdValue(n)},n})();t.StaticFlightConfiguration=c;s=(function(){function n(){}return n.initializeAsync=function(t){var i=new n;return i._componentId=t,n._initAsync(t).then((function(){return i}))},n.getIsMicrosoftUserAsync=function(){var n=this;return i.isNullOrUndefined(this._userInfo)?o.UserInfo.getUserInfo().then((function(t){return n._userInfo=t,t.isMicrosoftUser})).catch((function(){return!1})):Q.resolve(this._userInfo.isMicrosoftUser)},n.getUserIdentityProvider=function(){return Q(o.UserInfo.getUserInfo().then((function(n){return n.userIdentityProvider})))},n.prototype.getValue=function(t){return n._getValue(this._componentId,t)},n.getValueAsync=function(t,i){return n._initAsync(t).then((function(){return n._getValue(t,i)}))},n.getNullComponentIdValue=function(t){return n._getValue(null,t)},n._initAsync=function(t){var i="initAsync";return e.FlightingProvider.initializeAsync(t).catch((function(r){return n.logError(r,"An error occurred while trying to initialize flights. Flights for this componentId will use default values.",i,t),Q.resolve}))},n._getValue=function(t,i){var u="getValue",r;try{return e.FlightingProvider.getValue(t,i.Key,i.DefaultValue)}catch(f){return r="An error occurred while trying to get value of '"+i.Key+"'. Returning default value.",n.logError(f,r,u,t),i.DefaultValue}},n.logError=function(t,i,r,u){var f=n._className;console.error("AppInsightsExtension: "+f+": "+i,t);e.FlightingTelemetry.logError(t,u,r,f+": "+i,f)},n.getAquaTimerUrlAsync=function(i,r){var e=this,f=u.Deferred(),o=this._configuration.getAIMonEndpointsByServiceNameMapping("aquatimer",r);return o?f.resolve(o):n.getValueAsync(i,t.ClientFlights.AquaTimerProxied).then((function(n){f.resolve(n?e._configuration.getAquaTimerProxyUrl():e._configuration.getAquatimerurlInternal())})),f.promise()},n})();s._className="FlightConfiguration";s._configuration=f.getSettings();t.FlightConfiguration=s}))