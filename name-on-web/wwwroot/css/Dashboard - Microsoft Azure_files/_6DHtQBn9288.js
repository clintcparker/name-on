define("Core/TypeScript/TFS.WebApi",["require","exports","f","o","$","Core/TypeScript/TFS.Diag","Core/TypeScript/TFS.Azure.Context"],(function(n,t,i,r,u,f,e){"use strict";r.defineProperty(t,"__esModule",{value:!0});var o=(function(){function n(n,t){this._useCors=!1;this._locationsByAreaPromises={};this._eventListeners=[];this._useCors=t;n&&n[n.length-1]!=="/"&&(n+="/");this._rootRequestPath=n}return n.prototype.addEventListener=function(n){this._eventListeners.push(n)},n.prototype.removeEventListener=function(n){this._eventListeners=u.grep(this._eventListeners,(function(t){return t!==n}))},n.prototype._beginRequest=function(t){var i=this,e=u.Deferred(),r=++n._overallRequestId;return this._beginGetLocation(t.area,t.locationId).done((function(n){var c=i._getRequestUrl(n,t.routeValues,t.queryParams),o={},h,s;o.type=t.httpMethod||"GET";o.dataType=t.httpResponseType||"json";o.type==="GET"&&f.assert(!(t.queryParams&&t.data),"Shouldnt provide both queryParams and data with GET request");!t.isRawData&&t.data&&o.type.toUpperCase()!=="GET"?(o.data=JSON.stringify(t.data),o.jsonp=!1):o.data=t.data;t.isRawData&&(o.processData=!1);h=t.headers&&t.headers.Accept?t.headers.Accept:t.httpResponseType&&t.httpResponseType.toLowerCase()!=="json"?"*/*":"application/json";t.attachMsaPassthroughHeader&&(o.useMsaPassthrough=!0);h.indexOf("json")>=0&&(o.converters={});t.timeout&&(o.timeout=t.timeout);o.headers=t.headers||{};s="";t.version?(s+=h+";api-version="+t.version,t.previewVersion&&(s+="-preview."+t.previewVersion)):s=h+";api-version="+n.maxVersion+"-preview."+n.resourceVersion;o.headers.Accept=s;o.headers["Content-Type"]||(o.headers["Content-Type"]="application/json");(t.rangeFrom||t.rangeTo)&&u.extend(o.headers,{Range:"bytes="+(t.rangeFrom||"0")+"-"+(t.rangeTo||"")});u.each(i._eventListeners,(function(n,t){t.beforeRequest&&t.beforeRequest.call(i,r,c,o)}));i._issueAjaxRequest(c,o).done((function(n,f,o){var s=i._deserializeAjaxResult(n,t.responseType,t.responseIsCollection);u.each(i._eventListeners,(function(n,t){t.responseReceived&&t.responseReceived.call(i,r,s,f,o)}));try{e.resolve(s)}finally{u.each(i._eventListeners,(function(n,t){t.postResponseCallback&&t.postResponseCallback.call(i,r,s,f,o)}))}})).fail((function(n,t,f){var o=i._getFailedRequestError(n,t,f);u.each(i._eventListeners,(function(u,f){f.responseReceived&&f.responseReceived.call(i,r,o,t,n)}));try{e.reject(o,n,t,f)}finally{u.each(i._eventListeners,(function(u,f){f.postResponseCallback&&f.postResponseCallback.call(i,r,o,t,n)}))}}))})).fail((function(){e.reject()})),e.promise()},n.prototype._beginRequestUrl=function(n,t){var i=Q.defer();return this._beginReqeustInternal(n,t,null).then((function(n){i.resolve(n)})).catch((function(n){i.reject(n)})),i.promise},n.prototype._beginRequest2=function(n){var i=this,t=u.Deferred();return this._beginGetLocation(n.area,n.locationId).done((function(r){var u=i._getRequestUrl(r,n.routeValues,n.queryParams);i._beginReqeustInternal(u,n,r).then((function(n,i){return t.resolve(n,i)}),(function(){return t.reject()}))})).fail((function(){t.reject()})),t.promise()},n.prototype._beginReqeustInternal=function(t,i,r){var o=this,l=u.Deferred(),s=++n._overallRequestId,e={},c,h;return e.type=i.httpMethod||"GET",e.dataType=i.httpResponseType||"json",e.type==="GET"&&f.assert(!(i.queryParams&&i.data),"Shouldnt provide both queryParams and data with GET request"),!i.isRawData&&i.data&&e.type.toUpperCase()!=="GET"?(e.data=JSON.stringify(i.data),e.jsonp=!1):e.data=i.data,i.isRawData&&(e.processData=!1),c=i.headers&&i.headers.Accept?i.headers.Accept:i.httpResponseType&&i.httpResponseType.toLowerCase()!=="json"?"*/*":"application/json",c.indexOf("json")>=0&&(e.converters={}),i.timeout&&(e.timeout=i.timeout),e.headers=i.headers||{},h="",i.version?(h+=c+";api-version="+i.version,i.previewVersion&&(h+="-preview."+i.previewVersion)):r&&(h=c+";api-version="+r.maxVersion+"-preview."+r.resourceVersion),e.headers.Accept=h,e.headers["Content-Type"]||(e.headers["Content-Type"]="application/json"),(i.rangeFrom||i.rangeTo)&&u.extend(e.headers,{Range:"bytes="+(i.rangeFrom||"0")+"-"+(i.rangeTo||"")}),u.each(this._eventListeners,(function(n,i){i.beforeRequest&&i.beforeRequest.call(o,s,t,e)})),this._issueAjaxRequest(t,e).done((function(n,t,r){var f=o._deserializeAjaxResult(n,i.responseType,i.responseIsCollection);u.each(o._eventListeners,(function(n,i){i.responseReceived&&i.responseReceived.call(o,s,f,t,r)}));try{l.resolve(f,r)}finally{u.each(o._eventListeners,(function(n,i){i.postResponseCallback&&i.postResponseCallback.call(o,s,f,t,r)}))}})).fail((function(n,t,i){var r=o._getFailedRequestError(n,t,i);u.each(o._eventListeners,(function(i,u){u.responseReceived&&u.responseReceived.call(o,s,r,t,n)}));try{l.reject(r,n,t,i)}finally{u.each(o._eventListeners,(function(i,u){u.postResponseCallback&&u.postResponseCallback.call(o,s,r,t,n)}))}})),l.promise()},n.prototype.beginRequestQ=function(n){var t=Q.defer();return this._beginRequest(n).then((function(n){t.resolve(n)})).catch((function(n){t.reject(n)})),t.promise},n.prototype.beginRequest2Q=function(n){var t=Q.defer();return this._beginRequest2(n).then((function(n,i){t.resolve({resolvedData:n,jqXHR:i})})).catch((function(n){t.reject(n)})),t.promise},n.prototype._getFailedRequestError=function(n,t,i){var r,u,f;if(t!=="abort")try{r=JSON.parse(n.responseText);r&&r.message&&(u=r.message)}catch(e){}return u||(u=n.status+": "+t),f=new Error(u),f.name="TFS.WebApi.Exception",i=="timeout"&&(f.name="TFS.WebApi.Exception.Timeout"),f},n.prototype._issueAjaxRequest=function(t,r,f){if(n._customIssueAjaxRequestDelegate&&!this._useCors)return n._customIssueAjaxRequestDelegate(t,r);var o=u.Deferred();return r.headers=r.headers||{},(e.isMsaAccountUrl(t)||r&&r.useMsaPassthrough)&&(r.headers["X-VSS-ForceMsaPassThrough"]="true"),i.Base.Security.getAuthorizationToken({resourceName:"self"}).then((function(n){if(i.isFeatureEnabled("canmodifyextensions")&&!!i.getFeatureValue("authTokenOverride")){var u="Basic ",e=":";e=e.concat(i.getFeatureValue("authTokenOverride"));u=u.concat(btoa(e));r.headers.Authorization=u}else r.headers.Authorization=i.isFeatureEnabled("canmodifyextensions")&&!!i.getFeatureValue("bearerTokenOverride")?"Bearer "+i.getFeatureValue("bearerTokenOverride"):n.header;return r.dataType=f||"json",r.contentType="application/json",jQuery.ajax(t,r).then(o.resolve,o.reject)})),o.promise()},n._setCustomIssueAjaxRequestDelegate=function(t){n._customIssueAjaxRequestDelegate=t},n.prototype._beginGetLocation=function(n,t){var i=u.Deferred();return this.beginGetAreaLocations(n).done((function(n){var r=n[(t||"").toLowerCase()];i.resolve(r)})).fail((function(){i.reject()})),i.promise()},n.prototype.beginGetAreaLocations=function(t){var i=this._locationsByAreaPromises[t],r,f;return i||(r=u.Deferred(),i=r.promise(),f=this._rootRequestPath+n.APIS_RELATIVE_PATH+"/"+t,this._issueAjaxRequest(f,{type:"OPTIONS"}).done((function(n){var t={};u.each(n.value,(function(n,i){t[i.id.toLowerCase()]=i}));r.resolve(t)})).fail((function(){r.reject()})),this._locationsByAreaPromises[t]=i),i},n.prototype._getRequestUrl=function(n,t,i){var o,r,e,f;return t=t||{},t.area||(t.area=n.area),t.resource||(t.resource=n.resourceName),o=t.project?t.project+"/":"",r=this._rootRequestPath+this.replaceRouteValues(n.routeTemplate,t),i&&(e=r.indexOf("?")!==-1,f=u.param(i),f&&(r+=(e?"&":"?")+f)),r},n.prototype.replaceRouteValues=function(n,t){for(var f="",r="",e="",o=!1,s=n.length,u,i=0;i<s;i++)u=n[i],o?u=="}"?(o=!1,e[0]==="*"&&(e=e.substr(1)),t[e]&&(r+=t[e]),e=""):e+=u:u=="/"?r&&(f&&(f+="/"),f+=r,r=""):u=="{"?i+1<s&&n[i+1]=="{"?(r+=u,i++):o=!0:u=="}"?(r+=u,i+1<s&&n[i+1]=="}"&&i++):r+=u;return r&&(f&&(f+="/"),f+=r),f},n.prototype._deserializeAjaxResult=function(n,t,i){var r=this;return i&&u.isArray(n.value)?(n=n.value,t&&u.each(n,(function(n,i){u.isArray(i)?r._processDeserializedArray(i,t):r._processDeserializedType(i,t)}))):t&&this._processDeserializedType(n,t),n},n.prototype._processDeserializedArray=function(n,t){var i=this;u.each(n,(function(n,r){u.isArray(r)?i._processDeserializedArray(r,t):i._processDeserializedType(r,t)}))},n.prototype._processDeserializedType=function(n,t){var i=this;n&&t.fields&&u.each(t.fields,(function(t,r){var f=n[t],e;f&&(r.isArray?u.isArray(f)&&u.each(f,(function(n,t){r.isDate&&typeof t=="string"?f[n]=i._getDateValueFromISOString(t):r.enumType&&typeof t=="string"?f[n]=i._getValueFromEnumString(r.enumType,t):r.typeInfo&&i._processDeserializedType(t,r.typeInfo)})):r.isDictionary?(e={},u.each(f,(function(n,t){var f=n,u=t;r.dictionaryKeyIsDate&&typeof n=="string"?f=i._getDateValueFromISOString(n):r.dictionaryKeyEnumType&&typeof n=="string"&&(f=i._getValueFromEnumString(r.dictionaryKeyEnumType,n));r.dictionaryValueIsDate&&typeof t=="string"?u=i._getDateValueFromISOString(t):r.dictionaryValueEnumType&&typeof t=="string"?u=i._getValueFromEnumString(r.dictionaryValueEnumType,t):r.dictionaryValueTypeInfo&&i._processDeserializedType(u,r.dictionaryValueTypeInfo);e[f]=u})),n[t]=e):r.isDate&&typeof f=="string"?n[t]=i._getDateValueFromISOString(f):r.enumType&&typeof f=="string"?n[t]=i._getValueFromEnumString(r.enumType,f):r.typeInfo&&i._processDeserializedType(f,r.typeInfo))}))},n.prototype._getValueFromEnumString=function(n,t){var i=0;return t&&u.each(t.split(","),(function(t,r){var f=n.enumValues[u.trim(r)];f&&(i|=f)})),i},n.prototype._getDateValueFromISOString=function(n){var t=new Date(n);return isNaN(t)&&(t=this._convertLegacyIEDate(n)),t},n.prototype._convertLegacyIEDate=function(t){var i;return n._legacyDateRegExp||(n._legacyDateRegExp=new RegExp("(\\d+)-(\\d+)-(\\d+)T(\\d+):(\\d+):(\\d+).(\\d+)Z")),i=n._legacyDateRegExp.exec(t),i?new Date(Date.UTC(parseInt(i[1]),parseInt(i[2])-1,parseInt(i[3]),parseInt(i[4]),parseInt(i[5]),parseInt(i[6]),parseInt(i[7]))):null},n.prototype._getLinkResponseHeaders=function(n){var r={},u=n.getAllResponseHeaders(),f=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,e=/\<(.*?)\>;rel=\"(.*?)\"/g,t,i;if(u)while(t=f.exec(u))if(t[1].toLowerCase()==="link")while(i=e.exec(t[2]))r[i[2]]=i[1];return r},n})();o.APIS_RELATIVE_PATH="_apis";o.DEFAULT_REQUEST_TIMEOUT=3e5;o._overallRequestId=0;t.VssHttpClient=o}))