var __extends;define("WebsitesExtension/TypeScript/AppHub/Data/AppHubData",["require","exports","f","o","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Utility/Utility.Urls"],(function(n,t,i,r,u,f){"use strict";r.defineProperty(t,"__esModule",{value:!0});var e=(function(){function n(){this.powerAppsRegistrations=new i.Data.QueryCache({entityTypeName:AppService.DataModels.ManagedHostingEnvironmentType,sourceUri:function(t){return"{0}{1}/powerappsregistrations?api-version={2}".format(f.getCSMManagementEndpoint(),t,n.GetPowerAppsApiVersion())},setAuthorizationHeader:!0,processServerResponse:function(n){return{data:n.value}},extendEntryLifetimes:!0})}return n.GetPowerAppsApiVersion=function(){var n=!!window&&!!window.fx&&!!window.fx.environment&&window.fx.environment.extensionTelemetryUri,t;return n=n.toLowerCase(),t=u.Asset.ApiHubApiVersion,!n||(n.indexOf("microsoft_powerapps_admin=tip1")!==-1?t=u.Asset.tip1PowerAppsVersion:n.indexOf("microsoft_powerapps_admin=tip2")!==
-1&&(t=u.Asset.tip2PowerAppsVersion)),t},n})();t.AppHubData=e}));define("WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ResourceBase",["require","exports","o","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});var u=(function(){function n(n,t,i){this._hasloaded=!1;this._dataContext=i;this.form=t;this.container=n;this.partName=r.EnvPartNames.CreateWebsiteWizardPartV2;this.tCount=this._dataContext.objectCache.getObjCount(this.partName,this.partName);this.antaresApiVersion="2015-02-01"}return n.prototype.dataModel=function(){var n=this.form.editScope();return n&&n.root},n.prototype.shouldResetDefaults=function(){return this._hasloaded?!1:(this._hasloaded=!0,!0)},n.prototype.getHint=function(){return null},n.prototype.GetObject=function(){return null},n.prototype.SetupForm=function(){},n.prototype.GetParametersValues=function(){return null},n.prototype.SetDefaults=function(){var n=Q.
defer();return n.resolve(null),n.promise},n.prototype.GetResourceTemplate=function(){return null},n.prototype.CloseAnyBlades=function(){},n})();t.ResourceBase=u}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ApiManagementAccount",["require","exports","f","o","ko","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ResourceBase","WebsitesExtension/TypeScript/AppHub/Data/AppHubData"],(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var h=(function(n){function t(
t,i,r){var u=n.call(this,t,i,r)||this;return u._servicePrincipalId="",u}return __extends(t,n),t.prototype.GetParametersValues=function(){return{powerappsServicePrincipalId:this._servicePrincipalId,roleAssignmentGuid:f.Guid.newGuid(),apiManagementAccountName:this.form.nameTextbox.value(),powerAppsRegistrationName:this.form.nameTextbox.value()}},t.prototype.GetResourceTemplate=function(){return{parameters:{powerappsServicePrincipalId:{type:"string"},roleAssignmentGuid:{type:"string"},apiManagementAccountName:{type:"string"},powerAppsRegistrationName:{type:"string"}},resources:[this.getApiAccountJson(),this.getRoleAssignmentsJson(),this.getPowerAppsRegistrationJson()]}},t.prototype.SetDefaults=function(){var n=this;return i.Base.Net.ajax({uri:e.Asset.listServicePrincipal,type:"POST",contentType:"application/json",data:u.toJSON(null),setAuthorizationHeader:!0}).then((function(t){n._servicePrincipalId=t&&t.servicePrincipalId}))},t.prototype.getRoleAssignmentsJson=function(){return{apiVersion:
"2015-07-01",name:"[concat(parameters('apiManagementAccountName'), '/Microsoft.Authorization/', parameters('roleAssignmentGuid'))]",type:"Microsoft.Web/apiManagementAccounts/providers/roleAssignments",properties:{roleDefinitionId:"/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635",principalId:"[parameters('powerappsServicePrincipalId')]"},dependsOn:["[concat('Microsoft.Web/apiManagementAccounts/', parameters('apiManagementAccountName'))]"]}},t.prototype.getPowerAppsRegistrationJson=function(){var n=s.AppHubData.GetPowerAppsApiVersion();return{apiVersion:n,name:"[concat(parameters('apiManagementAccountName'), '/', parameters('powerAppsRegistrationName'))]",type:"Microsoft.Web/apiManagementAccounts/powerAppsRegistrations",dependsOn:["[concat('Microsoft.Web/apiManagementAccounts/', parameters('apiManagementAccountName'), '/providers/Microsoft.Authorization/roleAssignments/', parameters('roleAssignmentGuid'))]"]}},t.prototype.getApiAccountJson=function(
){var n=e.Asset.managedHostingEnvironmentUriTemplate.format(this.form.subscriptionSelector.value(),this.form.resourceGroupDropdown.value().value.name,this.form.nameTextbox.value());return{name:"[parameters('apiManagementAccountName')]",type:"Microsoft.Web/apiManagementAccounts",location:"[parameters('location')]",apiVersion:"2015-11-01-rc",dependsOn:["[concat('Microsoft.Web/managedHostingEnvironments/', parameters('name'))]"],properties:{name:"[parameters('apiManagementAccountName')]",hostEnvironments:[{id:n,state:"online"}]}}},t})(o.ResourceBase);t.ApiManagementAccount=h}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ASEResource",
["require","exports","o","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ResourceBase"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._entitlement=!1,u._ASEv1=!1,u._apiManagementAccountId="",u}return __extends(t,n),t.prototype.GetParametersValues=function(){return{name:this.dataModel().name(),kind:!this._ASEv1?r.ASEv2.kind:r.ASEv1.kind}},t.prototype.GetResourceTemplate=function(){return{parameters:{name:{type:"string"},kind:{type:"string"}},resources:[this._getASEJson()]}},t.prototype.SetupForm=function(n){this._entitlement=!!n&&!!n.entitlement;this._ASEv1=!!n&&!!n.ASEv1;this._apiManagementAccountId=!!n&&n.apiManagementAccount},t.prototype._getASEJson=function(n){n===void 0&&(n=!1);var t={apiVersion:r.Asset.AseApiVersion,name:"[parameters('name')]",type:"Microsoft.Web/hostingEnvironments",kind:"[parameters('kind')]"};
return this._entitlement&&(t.type="Microsoft.Web/managedHostingEnvironments"),t},t})(u.ResourceBase);t.AseResource=f}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ScaleResource",["require","exports","o","ko","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ResourceBase"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._ASEv1=i.ASEv1,u}return __extends(t,n),t.prototype.GetObject=function(){return r.observable()},t.prototype.SetDefaults=function(){var n=Q.defer();return n.resolve(),n.promise},t.
prototype.GetParametersValues=function(){return{}},t.prototype.GetResourceTemplate=function(){return{parameters:this._getJsonParameters(),resources:[this._getJsonResources()]}},t.prototype._getJsonParameters=function(){return{}},t.prototype._getJsonResources=function(){return{name:"[parameters('name')]",type:"Microsoft.Web/hostingEnvironments",properties:{}}},t.prototype.CloseAnyBlades=function(){},t})(u.ResourceBase);t.ScaleResource=f}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/VNETResource",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/_generated/ExtensionDefinition",
"WebsitesExtension/TypeScript/Environment/RuntimeType","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateTelemLogger","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ResourceBase","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";r.defineProperty(t,"__esModule",{value:!0});var l=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f._vnetList=u.observableArray(),f._hasExistingVNETS=u.observable(!1),f._locationMap=null,f._defaultVnetSelected=!0,f._nameGUID="",f._entitlementASE=!1,f._ASEv1=!1,f}return __extends(t,n),t.prototype.GetObject=function(){return u.observable()},t.prototype.SetupForm=function(n){var t=this;this._entitlementASE=!!n&&!!n.entitlement;this._ASEv1=!!n&&!!n.ASEv1;this.vnetSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,this.form,"vnet",{label:u.observable(f.vNETLocationLabel),validations:u.observableArray([new i.ViewModels.RequiredValidation(
"")]),infoBalloonText:u.observable(f.vnetInfoLabel),displayText:u.pureComputed((function(){var r=t.vnetSelector.value()&&t.vnetSelector.value().name()||"",n=t.vnetSelector.value()&&t.vnetSelector.value().location()||"",i;return!!n&&t._locationMap&&(i=t._locationMap[n],!i||(n=i)),"{0}({1})".format(r,n)}))});this.vnetCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){return s.logCreateStep(t._dataContext,"Virutal Network Collector Opened","ExistingVirtualNetworks={0}".format(t._hasExistingVNETS())),t.vnetSelector.value()},supplyProviderConfig:function(){return{vnetList:t._vnetList(),subscriptionId:t.form.subscriptionSelector.value().subscriptionId}},receiveResult:function(n){if(n.ILBon()&&n.Subdomain()?t.form.dnsSuffix(""):t.form.dnsSuffix(o.isFairfax()?c.DNSSuffix.ASESuffixFF:c.DNSSuffix.ASESuffix),s.logCreateStep(t._dataContext,"Virutal Network Collector Closed","ExistingVirtualNetwork={0};ExistingSubnet={1};Location={2}".format(!!n.existingVNETId(
),!!n.subnetAddressSpace(),n.location())),t._defaultVnetSelected=!1,!n.subnetAddressSpace()||!n.existingVNETId())t.form.resourceGroupDropdown.enabled&&t.form.resourceGroupDropdown.enabled(!0);else{t.form.resourceGroupDropdown.enabled&&t.form.resourceGroupDropdown.enabled(!1);var r=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(n.existingVNETId()).resourceGroup;t.dataModel().resourceGroup({value:{name:r},createNew:!1})}t.dataModel().vnet(n)},selectable:this.vnetSelector.selectable});this.vnetSelector.selectable.selectedValue({detailBlade:e.BladeNames.vNETSelectionBlade,detailBladeInputs:{}});this.container.registerSelectable(this.container,"VNETChevron",this.vnetSelector.selectable,{parameterCollector:this.vnetCollector});this.form.generalSection.children.push(this.vnetSelector)},t.prototype.SetDefaults=function(n,t){var r=this,o=Q.defer(),y=i.Azure.getLocations().then((function(n){r._locationMap=n})),f,e,v;this.form.nameTextbox.value.subscribe(this.container,(function(n){while(
!!n&&!isNaN(n.charAt(0)))n=n.substring(1);r._defaultVnetSelected&&r.dataModel()&&r.dataModel().vnet()&&(n?r.dataModel().vnet().name(n+"-vnet"):r.dataModel().vnet().name("vnet"))}));var h=[],l=[],a=[];return this._ASEv1&&(f=Q.defer(),this._dataContext.aseData.vnetV1Cache.fetch(t.subscriptionId,this.container).then((function(n){h=u.toJS(n.data);f.resolve()}),(function(){f.resolve()})),a.push(f.promise)),e=Q.defer(),this._dataContext.aseData.vnetV2Cache.fetch(t.subscriptionId,this.container).then((function(n){l=u.toJS(n.data);e.resolve()}),(function(){e.resolve()})),a.push(e.promise),v=Q.all(a).then((function(){var n=[];return h.length>0&&(n=h),l.length>0&&(n=n.concat(l)),n})),v.then((function(i){r._vnetList(i.filter((function(n){return n.subscriptionId===t.subscriptionId})));s.logTelemetry("Virtual Network List Loaded","ExistingVNETS={0}".format(r._vnetList().length>0));n.vnet(r._getDefaultVNET(c.VirtualNetworks.DefaultVnetAddress));o.resolve()}),(function(){r._vnetList([]);n.vnet(r._getDefaultVNET(c.VirtualNetworks.
DefaultVnetAddress));o.resolve()})),Q.all([o.promise,y])},t.prototype._getLocationFromId=function(n){return c.ArmHelper.locationsMap[n]||this._locationMap[n]||n},t.prototype.GetParametersValues=function(){var n=this.dataModel()&&this.dataModel().vnet(),f=c.Asset.vnetUriTemplate.format(this.form.subscriptionSelector.value().subscriptionId,this.form.resourceGroupDropdown.value().value.name,n.name()),t={vnetName:n.name(),location:this._getLocationFromId(n.location()),locationId:n.location(),subnetName:n.subnetName(),vnetId:f,VNetResourceGroupName:this.form.resourceGroupDropdown.value().value.name},r=this.form.nameTextbox.value()?this.form.nameTextbox.value():"ASE",u;return n.existingVNETId()?(u=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(n.existingVNETId()).resourceGroup,t.VNetResourceGroupName=u,t.vnetId=n.existingVNETId()):(t.vnetAddress=n.addressSpace(),t.subnetName===c.VirtualNetworks.DefaultSubnetName&&(t.subnetName=r+"-subnet")),!n.subnetAddressSpace()||(t.subnetAddress=
n.subnetAddressSpace()),t.subnetRouteTableName=r+"-Route-Table",t.subnetNSGName=r+"-NSG",t},t.prototype.GetResourceTemplate=function(){var n={parameters:{vnetName:{type:"string"},vnetId:{type:"string"},location:{type:"string"},locationId:{type:"string"},subnetName:{type:"string"},VNetResourceGroupName:{type:"string"}},resources:[]},t=this.dataModel()&&this.dataModel().vnet();return!t.subnetAddressSpace()||(n.parameters.subnetAddress={type:"string"}),t.existingVNETId()?t.existingVNETId()&&t.existingVNETId().toLowerCase().indexOf("microsoft.network")>-1?t.subnetAddressSpace()?(n.resources.push(this._getNewSubnetExistingVNETV2()),n.resources.push(this._getASEResource(!0,!0,!0))):n.resources.push(this._getASEResource(!1,!1,!0)):t.subnetAddressSpace()?(n.resources.push(this._getNewSubnetExistingVNETV1()),n.resources.push(this._getASEResource(!0,!1,!1))):n.resources.push(this._getASEResource(!1,!1,!1)):(n.parameters.vnetAddress={type:"string"},n.resources.push(this._getNewVnetResourcesV2()),
n.resources.push(this._getASEResource(!0,!1,!0))),n.parameters.subnetRouteTableName={type:"string"},n.parameters.subnetNSGName={type:"string"},n.resources.push(this._getUdrResources()),n.resources.push(this._getNSGResources()),n},t.prototype.CloseAnyBlades=function(){this.vnetSelector.selectable.isSelected(!1)},t.prototype.shouldResetDefaults=function(){return!0},t.prototype._getDefaultVNET=function(n){var i=+n.split("/")[1],r=n.split("/")[0],t=this.form.nameTextbox.value(),f=!t?"vnet":t+"-vnet";return{name:u.observable(f),subnetName:u.observable(c.VirtualNetworks.DefaultSubnetName),addressSpace:u.observable(n),subnetAddressSpace:u.observable("{0}/{1}".format(r,i+1)),existingVNETId:u.observable(""),location:u.observable(o.isFairfax()?c.ArmHelper.locationsMap[c.ArmHelper.defaultAseLocationFairfax]:c.ArmHelper.locationsMap[c.ArmHelper.defaultResourceGroupLoc]),ILBon:u.observable(!1),Subdomain:u.observable(""),IPAddresses:u.observable(1),isASEv2:u.observable(!this._ASEv1),locationFull:null}}
,t.prototype._getASEResource=function(n,t,i){var r={name:"[parameters('name')]",type:"Microsoft.Web/hostingEnvironments",location:"[parameters('location')]",properties:{name:"[parameters('name')]",location:"[parameters('location')]"}},u,f;return this._entitlementASE&&(r.type="Microsoft.Web/managedHostingEnvironments"),u="Microsoft.ClassicNetwork/virtualNetworks",i&&(u="Microsoft.Network/virtualNetworks"),r.properties.VirtualNetwork={Id:"[parameters('vnetId')]",type:u,Subnet:"[parameters('subnetName')]"},f=this.dataModel()&&this.dataModel().vnet(),f.ILBon&&f.ILBon()?(r.properties.dnsSuffix=f.Subdomain(),r.properties.internalLoadBalancingMode=3):this._ASEv1&&(r.properties.ipSslAddressCount=f.IPAddresses()),n&&(r.dependsOn=t?["[concat('"+u+"/', parameters('vnetName'), '/subnets/', parameters('subnetName'))]"]:["[concat('"+u+"/', parameters('vnetName'))]"]),r},t.prototype._getNewSubnetExistingVNETV2=function(){return{type:"Microsoft.Network/virtualNetworks/subnets",apiVersion:"2016-06-01",
name:"[concat(parameters('vnetName'), '/', parameters('subnetName'))]",dependsOn:["[concat('Microsoft.Network/networkSecurityGroups/', parameters('subnetNSGName'))]","[concat('Microsoft.Network/routeTables/', parameters('subnetRouteTableName'))]",],properties:{addressPrefix:"[parameters('subnetAddress')]",networkSecurityGroup:{id:"[resourceId('Microsoft.Network/networkSecurityGroups', parameters('subnetNSGName'))]"},routeTable:{id:"[resourceId('Microsoft.Network/routeTables', parameters('subnetRouteTableName'))]"}}}},t.prototype._getNewSubnetExistingVNETV1=function(){var i=this,n={type:"Microsoft.ClassicNetwork/virtualNetworks",apiVersion:"2014-06-01",name:"[parameters('vnetName')]",location:"[parameters('locationId')]",dependsOn:["[concat('Microsoft.Network/networkSecurityGroups/', parameters('subnetNSGName'))]","[concat('Microsoft.Network/routeTables/', parameters('subnetRouteTableName'))]",],properties:{addressSpace:{addressPrefixes:[]},subnets:[]}},t=this._vnetList().first((function(
n){return n.id===i.dataModel().vnet().existingVNETId()}));return n.properties.addressSpace.addressPrefixes=t.addressSpace.addressPrefixes,n.properties.subnets=JSON.parse(JSON.stringify(t.subnets)),n.properties.subnets.push({name:"[parameters('subnetName')]",addressPrefix:"[parameters('subnetAddress')]",networkSecurityGroup:{id:"[resourceId('Microsoft.Network/networkSecurityGroups', parameters('subnetNSGName'))]"},routeTable:{id:"[resourceId('Microsoft.Network/routeTables', parameters('subnetRouteTableName'))]"}}),n},t.prototype._getNewVnetResourcesV2=function(){return{apiVersion:"2016-06-01",type:"Microsoft.Network/virtualNetworks",name:"[parameters('vnetName')]",location:"[parameters('location')]",dependsOn:["[concat('Microsoft.Network/networkSecurityGroups/', parameters('subnetNSGName'))]","[concat('Microsoft.Network/routeTables/', parameters('subnetRouteTableName'))]",],properties:{addressSpace:{addressPrefixes:["[parameters('vnetAddress')]"]},subnets:[{name:"[parameters('subnetName')]",
properties:{addressPrefix:"[parameters('subnetAddress')]",networkSecurityGroup:{id:"[resourceId('Microsoft.Network/networkSecurityGroups', parameters('subnetNSGName'))]"},routeTable:{id:"[resourceId('Microsoft.Network/routeTables', parameters('subnetRouteTableName'))]"}}}]}}},t.prototype._getUdrResources=function(){var n=this.form.nameTextbox.value()?this.form.nameTextbox.value():"ASE";return t.getUdrResources(n)},t.getUdrResources=function(n){return{apiVersion:"2015-06-15",type:"Microsoft.Network/routeTables",name:"[parameters('subnetRouteTableName')]",location:"[parameters('location')]",tags:{displayName:"UDR - Subnet"},properties:{routes:[{name:n+"-route",properties:{addressPrefix:"0.0.0.0/0",nextHopType:"Internet"}}]}}},t.prototype._getNSGResources=function(){return t.getNSGResources()},t.getNSGResources=function(){return{apiVersion:"2015-06-15",type:"Microsoft.Network/networkSecurityGroups",name:"[parameters('subnetNSGName')]",location:"[parameters('location')]",tags:{displayName:
"NSG - Subnet"},properties:{securityRules:[{name:"Inbound-management",properties:{description:"Used to manage ASE from public VIP",protocol:"*",sourcePortRange:"*",destinationPortRange:"454-455",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:100,direction:"Inbound"}},{name:"ASE-internal-inbound",properties:{description:"ASE-internal-inbound",protocol:"*",sourcePortRange:"*",destinationPortRange:"*",sourceAddressPrefix:c.VirtualNetworks.DefaultSubnetAddress,destinationAddressPrefix:"*",access:"Allow",priority:110,direction:"Inbound"}},{name:"Inbound-HTTP",properties:{description:"Allow HTTP",protocol:"*",sourcePortRange:"*",destinationPortRange:"80",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:120,direction:"Inbound"}},{name:"Inbount-HTTPS",properties:{description:"Allow HTTPS",protocol:"*",sourcePortRange:"*",destinationPortRange:"443",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:130,direction:
"Inbound"}},{name:"Inbound-FTP",properties:{description:"Allow FTP over port 21",protocol:"*",sourcePortRange:"*",destinationPortRange:"21",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:140,direction:"Inbound"}},{name:"Inbound-FTPS",properties:{description:"Allow FTPS",protocol:"*",sourcePortRange:"*",destinationPortRange:"990",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:150,direction:"Inbound"}},{name:"Inbound-FTP-Data",properties:{description:"RDP",protocol:"*",sourcePortRange:"*",destinationPortRange:"10001-10020",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:160,direction:"Inbound"}},{name:"Inbound-Remote-Debugging",properties:{description:"Visual Studio remote debugging",protocol:"*",sourcePortRange:"*",destinationPortRange:"4016-4022",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:170,direction:"Inbound"}},{name:"Outbound-443",properties:{description:"Azure Storage blob",
protocol:"*",sourcePortRange:"*",destinationPortRange:"443",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:100,direction:"Outbound"}},{name:"Outbound-SMB",properties:{description:"Azure Storage queue",protocol:"*",sourcePortRange:"*",destinationPortRange:"445",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:110,direction:"Outbound"}},{name:"Outbound-DB",properties:{description:"Database",protocol:"*",sourcePortRange:"*",destinationPortRange:"1433",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:120,direction:"Outbound"}},{name:"Outbound-DB2",properties:{description:"Database 2",protocol:"*",sourcePortRange:"*",destinationPortRange:"11000-11999",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:130,direction:"Outbound"}},{name:"Outbound-DB3",properties:{description:"Database 3",protocol:"*",sourcePortRange:"*",destinationPortRange:"14000-14999",sourceAddressPrefix:"*",destinationAddressPrefix:
"*",access:"Allow",priority:140,direction:"Outbound"}},{name:"Outbound-DNS",properties:{description:"DNS",protocol:"*",sourcePortRange:"*",destinationPortRange:"53",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:150,direction:"Outbound"}},{name:"ASE-internal-outbound",properties:{description:"Azure Storage queue",protocol:"*",sourcePortRange:"*",destinationPortRange:"*",sourceAddressPrefix:"*",destinationAddressPrefix:c.VirtualNetworks.DefaultSubnetAddress,access:"Allow",priority:160,direction:"Outbound"}},{name:"Outbound-80",properties:{description:"Outbound 80",protocol:"*",sourcePortRange:"*",destinationPortRange:"80",sourceAddressPrefix:"*",destinationAddressPrefix:"*",access:"Allow",priority:170,direction:"Outbound"}},{name:"ASE-to-VNET",properties:{description:"ASE to VNET",protocol:"*",sourcePortRange:"*",destinationPortRange:"*",sourceAddressPrefix:"*",destinationAddressPrefix:c.VirtualNetworks.DefaultVnetAddress,access:"Allow",priority:180,direction:
"Outbound"}}]}}},t})(h.ResourceBase);t.VNETResource=l}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/Models/MessageDispatchModel",["require","exports","o","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i,r){"use strict";var u,f,e,o,s,h;i.defineProperty(t,"__esModule",{value:!0});u=(function(){function n(){}return n})();t.DispatchMessage=u;f=(function(n){function t(t){var i=n.call(this)||this;return i.message=r.CreateMessageTypes.AppSerivcePlanChange,i.serverFarmData=t,i}return __extends(t,n),t})(u);t.AppSerivcePlanChangeMessage=f;e=(function(n){function t(t){var i=n.call(this)||this;return i.message=r.CreateMessageTypes.AppSerivcePlanTypeChange,
i.SfType=t,i}return __extends(t,n),t})(u);t.AppSerivcePlanTypeChangeMessage=e;o=(function(n){function t(t){var i=n.call(this)||this;return i.message=r.CreateMessageTypes.DynamicASPLocationChange,i.location=t,i}return __extends(t,n),t})(u);t.DynamicASPLocationChangeMessage=o;s=(function(n){function t(t){var i=n.call(this)||this;return i.isXenon=!1,i.message=r.CreateMessageTypes.osChange,i.isLinux=t,i}return __extends(t,n),t})(u);t.UnifiedOSChangeMessage=s;h=(function(n){function t(t){var i=n.call(this)||this;return i.message=r.CreateMessageTypes.AppNameChange,i.name=t,i}return __extends(t,n),t})(u);t.AppNameChangeMessage=h}));define("WebsitesExtension/TypeScript/CreateV2/Models/OrcasMySqlModels",["require","exports","o","ko"],(function(n,t,i,r){"use strict";var u,f,e,o,s;i.defineProperty(t,"__esModule",{value:!0});u=(function(){function n(){this.administratorLogin=r.observable();this.administratorPassword=r.observable();this.isCreatingNewDatabase=r.observable();this.firstDatabase=r.observable();this.
selectedDatabaseName=r.observable()}return n})();t.MySqlServerSelectedOptionDataModel=u;f=(function(){function n(){this.skuName=r.observable();this.skuTier=r.observable();this.skuCapacity=r.observable();this.skuFamily=r.observable();this.skuSizeMB=r.observable()}return n})();t.MySqlServerSkuDataModel=f;e=(function(){function n(){}return n})();t.OrcasDatabaseCreateModel=e;o=(function(){function n(){this.administratorLogin=r.observable();this.administratorPassword=r.observable();this.firstDatabase=r.observable();this.skuData=r.observable();this.backupRetentionDays=r.observable();this.geoRedundantBackup=r.observable();this.version=r.observable()}return n})();t.MySqlServerCreationOptionDataModel=o;s=(function(){function n(){this.serverName=r.observable();this.subscription=r.observable();this.resourceGroup=r.observable();this.regionId=r.observable();this.isCreatingNewServer=r.observable();this.creatingServerOption=r.observable();this.selectedServerOption=r.observable()}return n})();t.CreateOrcasMySqlModel=
s}));define("WebsitesExtension/TypeScript/CreateV2/Models/SqlAzureCreateDataModel",["require","exports","o","ko"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});var u=(function(){function n(){this.isNewDatabase=r.observable(!1);this.isNewServer=r.observable(!1);this.databaseName=r.observable("");this.serverName=r.observable("");this.fullyQualifiedDomainName=r.observable("");this.collation=r.observable("");this.location=r.observable("");this.administratorLogin=r.observable("");this.administratorLoginPassword=r.observable("");this.subscriptionId=r.observable("");this.resourceGroupName=r.observable("");this.edition=r.observable("");this.requestedServiceObjectiveId=r.observable("");this.maxSizeBytes=r.observable("")}return n})();t.SqlAzureDataModel=u}));define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase",["require","exports","f","o","ko","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i,r,u,f){"use strict";
r.defineProperty(t,"__esModule",{value:!0});var e=i.ViewModels.Forms,o=(function(){function n(n,t,i){this.resources={};this._dataContext=i;this.form=t;this.container=n;this.partName=f.EnvPartNames.CreateWebsiteWizardPartV2;this.tCount=i.objectCache.getObjCount(this.partName,this.partName);this.antaresApiVersion=f.Asset.AntaresApiVersion;var r={children:u.observableArray([])};this.generalSection=new e.Section.ViewModel(n,r)}return n.prototype.dataModel=function(){var n=this.form.editScope();return n&&n.root},n.prototype.getNewDefault=function(){return!0},n.prototype.Validate=function(){this.generalSection.children().forEach((function(n){n.validate&&n.validate(6)}))},n.prototype.TurnOff=function(){},n.prototype.TurnOn=function(){},n.prototype.recieveDispatchMessage=function(n){for(var t in this.resources)this.resources.hasOwnProperty(t)&&this.resources[t].recieveDispatchMessage(n)},n.prototype.FinalValidation=function(){return Q({valid:!0,message:""})},n.prototype.GetObject=function(){return u.
observable()},n.prototype.SetupForm=function(){},n.prototype.GetParametersValues=function(){return{}},n.prototype.SetDefaults=function(n,t){var i=[];for(var r in this.resources)i.push(this.resources[r].SetDefaults(n,t));return Q.all(i)},n.prototype.GetResourceTemplate=function(){return{}},n.prototype.CloseAnyBlades=function(){for(var n in this.resources)this.resources[n].CloseAnyBlades&&this.resources[n].CloseAnyBlades()},n.prototype.getImportantData=function(){return{}},n})();t.ResourceBase=o}));define("WebsitesExtension/TypeScript/Utility/Utility.LocalStorage",["require","exports"],(function(){"use strict";var n;return (function(n){function t(){try{return"localStorage"in window&&window.localStorage!==null}catch(n){return!1}}n.supportsLocalStorage=t})(n||(n={})),n}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(
){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlan",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/Utility/Utility.Specs","WebsitesExtension/TypeScript/Models/GeoRegion","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/Utility/Utility.WebHostingPlan","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","WebsitesExtension/TypeScript/Utility/Utility.LocalStorage","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/Environment/RuntimeType","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/VNETResource","WebsitesExtension/TypeScript/CreateV2/Models/MessageDispatchModel"],
(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";r.defineProperty(t,"__esModule",{value:!0});var k=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f._locationsArray=u.observable(null),f._hostingEnvironmentId=null,f._premiumApp=!1,f._isLinux=!1,f._isXenon=!1,f._roomForNewASP=!0,f._usingDefaultASP=!0,f._forbiddenComputeMode=null,f._appServicePlansView=r.websitesData.webhostingPlansForSubsCacheFromArm.createView(t),f._lightHostingEnvironmentsView=f._dataContext.aseData.aseDataLightweightCache.createView(t),f._currentHostingEnvironmentView=f._dataContext.aseData.aseCache.createView(t),f._locationsView=f._dataContext.locations.DeploymentLocationQuery.createView(t,{interceptNotFound:!1}),f._locationsArmView=f._dataContext.locations.ArmLocationQuery.createView(t,{interceptNotFound:!1}),f}return __extends(t,n),t.prototype.GetObject=function(){return u.observable(null)},t.prototype.CloseAnyBlades=function(){this.appServicePlanSelector.selectable.isSelected(!1)},t.prototype.
getNewDefault=function(){var n=this.appServicePlanSelector.value();return(!n||n.SubscriptionId()===""||n.SubscriptionId()===this.form.subscriptionSelector.value().subscriptionId)&&!this._usingDefaultASP?!1:!0},t.prototype.getDeploymentLocations=function(n){var t=this,i=Q.defer();return Q.all([this._locationsArmView.fetch(n),this._locationsView.fetch(n)]).then((function(){i.resolve(t.GeofenceLocations(t._locationsView.item(),t._locationsArmView.items()))}),(function(){t._locationsArmView.fetch(n).then((function(){var n=t._locationsArmView.items().map((function(n){return{name:u.observable(n),description:u.observable(null),sortOrder:u.observable(0),displayName:u.observable(n)}})),r={locations:u.observableArray(n),hostingEnvironmentDeploymentInfos:u.observableArray([])};i.resolve(r)}),(function(){i.reject()}))})),i.promise},t.prototype.GeofenceLocations=function(n,t){var i=n.locations();for(var r in i)t.indexOf(i[r].displayName())===-1&&i.remove(i[r]);return n.locations(i),n},t.prototype.SetupForm=function(
n,t){var r=this,o;t.appServicePlan=this.GetObject();this._hostingEnvironmentId=n.HostingEnvironmentId;this._premiumApp=n.premiumApp;this._isLinux=n.isLinux;this._isXenon=n.isXenon;this._forbiddenSkus=n.forbiddenSkus||"";this._forbiddenComputeMode=n.forbiddenComputeMode;o={SubscriptionId:u.observable(""),ResourceGroup:u.observable(""),Name:u.observable(""),Id:u.observable(""),Sku:u.observable(""),Location:u.observable(""),OldPortalRedirectUrl:u.observable(""),Status:u.observable(0),HostingEnvironmentProfile:u.observable(null),HostingEnvironmentId:u.observable(""),WorkerSize:u.observable(0),WorkerSizeId:u.observable(0),WorkerTierName:u.observable(""),NumberOfWorkers:u.observable(1),NumberOfSites:u.observable(0),WebSpace:u.observable(""),IsLinux:u.observable(this._isLinux),IsXenon:u.observable(this._isXenon),Reserved:u.observable(this._isLinux)};this.appServicePlanSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,{label:u.observable(e.Wizard.Steps.WebHostingPlan.locationTitle),
infoBalloonContent:u.observable(e.Wizard.Help.webHostingPlans),displayText:u.pureComputed((function(){var n=r.appServicePlanSelector.value,t=!!n()&&!!n().Name(),i=t?n().Name():"",u="";return t&&(u=!!n().HostingEnvironmentProfile()&&!!n().HostingEnvironmentProfile().Name()?n().HostingEnvironmentProfile().Name():n().Location()),i?"{0}({1})".format(i,u):null})),defaultValue:u.observable(o)});this.appServicePlanSelector.validations.push(new i.ViewModels.RequiredValidation(""));this.appServicePlanSelector.validations.push(new i.ViewModels.CustomValidation("",function(n){var t=Q.defer();return n.Id()?Q(i.Base.Security.hasPermission(n.Id(),["./write"]).then((function(n){return n?Q({valid:!0,message:""}):Q({valid:!1,message:f.CreateValidation.appServicePlanPermissions})}))):Q({valid:!0,message:""})}));this.appServicePlanCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){return r.appServicePlanSelector.value()},supplyProviderConfig:function(){return a.logCreateStep(
r._dataContext.objectCache,"App Service Plan Blade Opened"),{subscriptions:r.form.subscriptionSelector.value().subscriptionId,filterHostingEnvironmentId:r._hostingEnvironmentId,hideLocation:!!r._hostingEnvironmentId,premium:r._premiumApp,isLinux:!!r._isLinux,isXenon:!!r._isXenon,forbiddenSkus:n.forbiddenSkus,forbiddenComputeMode:n.forbiddenComputeMode,hideCreateASP:!r._roomForNewASP}},receiveResult:function(n){var u,t;r._usingDefaultASP=!1;a.logCreateStep(r._dataContext.objectCache,"App Service Plan Blade Changed");n.Id()?a.logTelemetry("Chose Existing ASP from Step",""):a.logTelemetry("Created New ASP","");r.appServicePlanSelector.value(n);r.form.SendMessageToResources(new b.AppSerivcePlanChangeMessage(n));n.HostingEnvironmentId()?(t=p.isFairfax()?l.DNSSuffix.AppInAseSuffixFF:l.DNSSuffix.AppInASESuffix,r.form.dnsSuffix(t.format(r._getAseName(n.HostingEnvironmentId()))),r._currentHostingEnvironmentView.fetch(n.HostingEnvironmentId()).then((function(){r.form.dnsSuffix(r._currentHostingEnvironmentView.
item().DnsSuffix())})),r.form.resourceGroupDropdown.enabled&&r.form.resourceGroupDropdown.enabled(!0)):(r.form.dnsSuffix(window.fx.environment.antaresHostedSiteUriFormat.format("")),n.Sku()===l.ServerFarmSku.isolated&&(t=p.isFairfax()?l.DNSSuffix.AppInAseSuffixFF:l.DNSSuffix.AppInASESuffix,r.form.dnsSuffix(t.format(n.AseCreateData().AseName())),n.AseCreateData().VnetNew()?r.form.resourceGroupDropdown.enabled&&r.form.resourceGroupDropdown.enabled(!0):(r.form.resourceGroupDropdown.enabled&&r.form.resourceGroupDropdown.enabled(!1),u=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(n.AseCreateData().VnetId()).resourceGroup,r.dataModel().resourceGroup({value:{name:u},createNew:!1}))))},selectable:this.appServicePlanSelector.selectable});this.generalSection.children.push(this.appServicePlanSelector);this.appServicePlanSelector.selectable.selectedValue({detailBlade:"AppServicePlanPickerBladeV3",detailBladeInputs:{}});this.container.registerSelectable(this.container,"AppServicePlanChevron"+
h.Guid.newTinyGuid(),this.appServicePlanSelector.selectable,{parameterCollector:this.appServicePlanCollector})},t.prototype.GetParametersValues=function(){var f=!this.appServicePlanSelector.value().Id(),r,n=this.appServicePlanSelector.value(),u=n.HostingEnvironmentId()?n.HostingEnvironmentId():"",t=u?i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(u).resource:"";return f?(n.Sku()!==l.ServerFarmSku.isolated||u||(t=n.AseCreateData().AseName(),u=l.Asset.hostingEnvironmentUriTemplate.format(this.form.subscriptionSelector.value().subscriptionId,this.form.resourceGroupDropdown.value().value.name,t)),r={hostingPlanName:n.Name(),hostingEnvironment:t,location:n.Location(),sku:n.Sku(),workerSize:n.WorkerSize()+"",serverFarmResourceGroup:this.form.resourceGroupDropdown.value().value.name,skuCode:p.isOnPrem()?o.getOnPremWhpSkuName(n):o.getSpecCodeBySkuAndSize(n.Sku(),n.WorkerSize()+"")},this._shouldAddNsgAndUDR()&&(r.subnetRouteTableName=t+"-Route-Table",r.subnetNSGName=t+"-NSG")):r={hostingPlanName:
n.Name(),hostingEnvironment:t,location:n.Location(),serverFarmResourceGroup:n.ResourceGroup()},r},t.prototype._shouldAddNsgAndUDR=function(){var n=this.appServicePlanSelector.value();return n.AseCreateData&&n.AseCreateData()&&!!n.AseCreateData().AseName()},t.prototype._isForbiddenServerFarm=function(n){return this._forbiddenSkus.indexOf(n.Sku())>-1||this._forbiddenComputeMode===n.ComputeMode()},t.prototype.TurnOn=function(){var n=this.appServicePlanSelector.value();n.HostingEnvironmentId()?this.form.dnsSuffix(this._currentHostingEnvironmentView.item().DnsSuffix()):this.form.dnsSuffix(window.fx.environment.antaresHostedSiteUriFormat.format(""))},t.prototype.SetDefaults=function(n,t){var i=this,r=t.subscriptionId,o=h.telemetryStartTrace(this.partName,"getResourceGroups",this.tCount),u=h.telemetryStartTrace(this.partName,"getASPList",this.tCount),s=h.telemetryStartTrace(this.partName,"getLocations"),f=[this._appServicePlansView.fetch(r).then((function(){i._appServicePlansView.refresh().then(
(function(){h.telemetryCompleteTrace(u,i.tCount)}))}))],e=Q.all([this.getDeploymentLocations(r).then((function(n){i._locationsArray(n)})),this._lightHostingEnvironmentsView.fetch(r)]);return Q.all(f).then((function(){var n=null;return i._hostingEnvironmentId||i.form.resourceGroupDropdown.value()&&!i.form.resourceGroupDropdown.value().createNew&&(n=i._appServicePlansView.items().first((function(n){return n.ResourceGroup()===i.form.resourceGroupDropdown.value().value.name?!!i._isLinux==!!n.IsLinux()&&!!i._isXenon==!!n.IsXenon()&&!i._isForbiddenServerFarm(n)&&n.Sku()!==l.ServerFarmSku.dynamic:!1})),n&&a.logTelemetry("New ASP Default","sku={0};hostingEnvironment={1}".format(n.Sku&&n.Sku(),n.HostingEnvironmentId&&i._getAseName(n.HostingEnvironmentId()))),i.appServicePlanSelector.value(n)),n?void 0:e.then((function(){return i._getDefaultAppServicePlan(t).then((function(n){i.appServicePlanSelector.value(n)}))}))}))},t.prototype._getAseName=function(n){return n?i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(
n).resource:""},t.prototype._getDefaultAppServicePlan=function(){var n=this,u=Q.defer(),i=this._appServicePlansView.items().first((function(t){return t.Sku()===l.ServerFarmSku.dynamic?!1:n._hostingEnvironmentId?t.HostingEnvironmentId()===n._hostingEnvironmentId:n._premiumApp?c.isStandardSKUOrHigher(t.Sku())&&!n._isForbiddenServerFarm(t):!!n._isLinux==!!t.Reserved()&&!!n._isXenon==!!t.IsXenon()&&!n._isForbiddenServerFarm(t)})),o,v,y;if(i)i.HostingEnvironmentId()?(this.form.dnsSuffix(l.DNSSuffix.AppInASESuffix.format(this._getAseName(i.HostingEnvironmentId()))),this._hostingEnvironmentId?this._currentHostingEnvironmentView.fetch(i.HostingEnvironmentId()).then((function(){var t=null;n._currentHostingEnvironmentView.item().EnvironmentCapacities()&&(t=n._currentHostingEnvironmentView.item().EnvironmentCapacities().first((function(n){return n.AvailableCapacity()>0})));n.form.dnsSuffix(n._currentHostingEnvironmentView.item().DnsSuffix());n._roomForNewASP=n._currentHostingEnvironmentView.item().Kind(
)===l.ASEv2.kind?!0:!!t;u.resolve(i)})):(this._currentHostingEnvironmentView.fetch(i.HostingEnvironmentId()).then((function(){n.form.dnsSuffix(n._currentHostingEnvironmentView.item().DnsSuffix())})),u.resolve(i))):(this.form.dnsSuffix(window.fx.environment.antaresHostedSiteUriFormat.format("")),u.resolve(i));else{var f=s.RegionPickerObject.GetRegionsV2(this._locationsArray().locations()),r=l.ServerFarmSku.standard,e=0,t;this._isXenon?r=l.ServerFarmSku.premiumContainer:this._isLinux&&(r=l.ServerFarmSku.premiumV2,e=3);o="";this._hostingEnvironmentId&&(o=this._getAseName(this._hostingEnvironmentId));this._isLinux?t=f.first((function(n){return l.Create.supportedLinuxRegions.indexOf(n.location)>-1})):this._isXenon?t=f.first((function(n){return l.Create.supportedXenonRegions.indexOf(n.location)>-1})):(f=f.concat(s.RegionPickerObject.GetHostingEnvironmentsV2(this._locationsArray().hostingEnvironmentDeploymentInfos())),t=f.first((function(n){var t=n.hostingEnvironmentName?n.hostingEnvironmentName:"";return!o||
o.toLowerCase()===t.toLowerCase()})));t||(t=f.first());this.form.hasEnvironmentFlag(l.EnvFeature.DefaultToFree)&&(r=this._isLinux?l.ServerFarmSku.basic:this._isXenon?l.ServerFarmSku.premiumContainer:l.ServerFarmSku.free);a.logTelemetry("New ASP Default","sku={0};hostingEnvironment={1}".format(r,t.hostingEnvironmentName));t.hostingEnvironmentName?(v=this._lightHostingEnvironmentsView.items().first((function(n){return n.name()===t.hostingEnvironmentName})),y=h.telemetryStartTrace(this.partName,"GetHostingEnvironment"),this._currentHostingEnvironmentView.fetch(v.id()).then((function(){var f=n._currentHostingEnvironmentView.item().Kind(),i=null;r=n._isXenon?l.ServerFarmSku.premiumContainer:f===l.ASEv1.kind?l.ServerFarmSku.premium:l.ServerFarmSku.isolated;h.telemetryCompleteTrace(y,n.tCount);n._currentHostingEnvironmentView.item().EnvironmentCapacities()&&(i=n._currentHostingEnvironmentView.item().EnvironmentCapacities().first((function(n){return n.AvailableCapacity()>0})));e=i&&i.WorkerSize()||0;
u.resolve(n._getNewAspBody(r,t,e));n.form.dnsSuffix(n._currentHostingEnvironmentView.item().DnsSuffix())}))):(this.form.dnsSuffix(window.fx.environment.antaresHostedSiteUriFormat.format("")),u.resolve(this._getNewAspBody(r,t,e)))}return u.promise},t.prototype.GetResourceTemplate=function(){var o=!this.appServicePlanSelector.value().Id(),t=this.appServicePlanSelector.value(),i,r,f,n,e,u;return v.supportsLocalStorage()&&(i=this.form.subscriptionSelector.value().subscriptionId,r=this.form.resourceGroupDropdown.value().value.name,o?(f=l.Asset.ServerFarmResourceUriTemplate.format(i,r,this.appServicePlanSelector.value().Name()),localStorage.setItem("lastASP{0}".format(i),f)):localStorage.setItem("lastASP{0}".format(i),this.appServicePlanSelector.value().Id()),localStorage.setItem("lastWARG{0}".format(i),r)),n={parameters:{},resources:[]},e=!this.appServicePlanSelector.value().Id(),e?(n.parameters={hostingPlanName:{type:"string"},hostingEnvironment:{type:"string"},location:{type:"string"},sku:
{type:"string"},skuCode:{type:"string"},workerSize:{type:"string"},serverFarmResourceGroup:{type:"string"}},n.resources=[this._getSiteJson(!0,!0)],u="",t.Sku()!==l.ServerFarmSku.isolated||t.HostingEnvironmentId()||(n.resources.push(this._getASEResource()),t.AseCreateData().VnetNew()&&n.resources.push(this._getNewVnetResourcesV2()),this._shouldAddNsgAndUDR()&&(n.parameters.subnetRouteTableName={type:"string"},n.parameters.subnetNSGName={type:"string"},n.resources.push(w.VNETResource.getUdrResources(t.AseCreateData().AseName())),n.resources.push(w.VNETResource.getNSGResources())),n.resources.push(this._getNewSubnet()),u="Microsoft.Web/hostingenvironments/"+t.AseCreateData().AseName()),n.resources.push(this._getServerFarmJson(!0,this._getKind(),u))):(n.parameters={hostingPlanName:{type:"string"},location:{type:"string"},hostingEnvironment:{type:"string"},serverFarmResourceGroup:{type:"string"},subscriptionId:{type:"string"}},n.resources=[this._getSiteJson(!1,!0)]),n},t.prototype._getNewAspBody=
function(n,t,r){var e=u.observable(null),f;return t.hostingEnvironmentName&&this._hostingEnvironmentId&&(f=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(this._hostingEnvironmentId),e=u.observable({Id:u.observable(this._hostingEnvironmentId),Name:u.observable(f.resource),Type:u.observable(f.type)})),p.isOnPrem()?null:{SubscriptionId:u.observable(""),ResourceGroup:u.observable(""),Name:u.observable("ServicePlan"+h.Guid.newShortGuid()),Id:u.observable(""),Sku:u.observable(n),Location:u.observable(t.location),OldPortalRedirectUrl:u.observable(""),Status:u.observable(0),HostingEnvironmentProfile:e,HostingEnvironmentId:u.observable(this._hostingEnvironmentId),WorkerSize:u.observable(+r),WorkerSizeId:u.observable(+r),WorkerTierName:u.observable(""),NumberOfWorkers:u.observable(1),NumberOfSites:u.observable(0),WebSpace:u.observable(""),IsLinux:u.observable(this._isLinux),IsXenon:u.observable(this._isXenon),Reserved:u.observable(this._isLinux)}},t.prototype._getKind=function(){return this.
_isLinux?l.KindsAvailable.Linux:this._isXenon?l.KindsAvailable.xenon:null},t.prototype._getServerFarmJson=function(n,t,i){t===void 0&&(t="");var u=this.appServicePlanSelector.value(),r={apiVersion:l.Asset.ASEv2APIVersion,name:"[parameters('hostingPlanName')]",type:"Microsoft.Web/serverfarms",location:"[parameters('location')]",properties:{name:"[parameters('hostingPlanName')]",workerSizeId:"[parameters('workerSize')]",reserved:this._isLinux,numberOfWorkers:"1"},sku:{Tier:"[parameters('sku')]",Name:"[parameters('skuCode')]"}};return this._isXenon&&(delete r.properties.reserved,r.properties.isXenon=!0),!t||(r.kind=t),n?r.properties.hostingEnvironment="[parameters('hostingEnvironment')]":r.properties.hostingEnvironmentProfile={Id:"[parameters('hostingEnvironment')]"},!i||(r.dependsOn=[i]),r},t.prototype._getSiteJson=function(n,t,i){var r,u;return i===void 0&&(i=""),r={type:"Microsoft.Web/sites",name:"[parameters('name')]",location:"[parameters('location')]",properties:{serverFarmId:"[concat('/subscriptions/', parameters('subscriptionId'),'/resourcegroups/', parameters('serverFarmResourceGroup'), '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"}},
!i&&!this.form.appKind()||(u=!this.form.appKind()?"{0}".format(i):!i?this.form.appKind():"{0},{1}".format(this.form.appKind(),i),r.kind=u),t?r.properties.hostingEnvironment="[parameters('hostingEnvironment')]":r.properties.hostingEnvironmentProfile={Id:"[parameters('hostingEnvironment')]"},n&&(r.dependsOn=["[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"]),r},t.prototype.getImportantData=function(){var n=this.appServicePlanSelector.value(),t=!this.appServicePlanSelector.value().Id();return{location:n.Location(),id:n.Id(),type:l.Create.AppServicePlanResourceType,instances:!n.NumberOfWorkers?1:n.NumberOfWorkers(),sku:n.Sku(),name:n.Name(),hostingEnvironmentProfile:n.HostingEnvironmentProfile&&n.HostingEnvironmentProfile()}},t.prototype.FinalValidation=function(){var i=this.form.subscriptionSelector.value().subscriptionId,t=this.form.resourceGroupDropdown.value(),n=this.appServicePlanSelector.value(),u=!n.Id(),f=this.appServicePlanSelector.value(),e,r;return!u||f.Sku(
)===l.ServerFarmSku.isolated?Q({valid:!0,message:""}):(e=this.GetParametersValues(),r={name:n.Name(),type:l.ResourceTypes.AspResourceType,location:n.Location(),properties:{skuName:p.isOnPrem()?o.getOnPremWhpSkuName(n):o.getSpecCodeBySkuAndSize(n.Sku(),n.WorkerSize()+""),hostingEnvironment:this._getAseName(n.HostingEnvironmentId()),capacity:1,serverFarmId:l.Asset.ServerFarmResourceUriTemplate.format(i,t.value.name,n.Name()),needLinuxWorkers:this._isLinux,isXenon:this._isXenon}},t.createNew?Q(this._dataContext.resourceGroups.createResourceGroup(i,t.value.name,this.form.getResourceGroupLocation())).then((function(){return h.callValidationApi(i,t.value.name,r,{sku:n.Sku()})})):h.callValidationApi(i,t.value.name,r,{sku:n.Sku()}))},t.prototype._getASEResource=function(){var n=this.appServicePlanSelector.value(),t=!n.AseCreateData().VnetId?"":n.AseCreateData().VnetId();return n.AseCreateData().VnetNew()&&(t=l.Asset.vnetUriTemplate.format(this.form.subscriptionSelector.value().subscriptionId,this.
form.resourceGroupDropdown.value().value.name,n.AseCreateData().VnetName())),{name:n.AseCreateData().AseName(),type:"Microsoft.Web/hostingEnvironments",kind:l.ASEv2.kind,location:"[parameters('location')]",apiVersion:l.Asset.ASEv2APIVersion,dependsOn:["Microsoft.Network/virtualNetworks/"+n.AseCreateData().VnetName()+"/subnets/"+n.AseCreateData().SubnetName()],properties:{name:n.AseCreateData().AseName(),location:"[parameters('location')]",virtualNetwork:{id:t,type:"Microsoft.Network/virtualNetworks",subnet:n.AseCreateData().SubnetName()}}}},t.prototype._getNewSubnet=function(){var n=this.appServicePlanSelector.value(),t=n.AseCreateData().VnetName(),i={type:"Microsoft.Network/virtualNetworks/subnets",apiVersion:"2016-06-01",name:t+"/"+n.AseCreateData().SubnetName(),properties:{addressPrefix:n.AseCreateData().SubnetAddressSpace()}};return n.AseCreateData().VnetNew()&&(i.dependsOn=["Microsoft.Network/virtualNetworks/"+t]),i},t.prototype._getNewVnetResourcesV2=function(){var n=this.appServicePlanSelector.
value();return{apiVersion:"2016-06-01",type:"Microsoft.Network/virtualNetworks",name:n.AseCreateData().VnetName(),location:"[parameters('location')]",properties:{addressSpace:{addressPrefixes:[l.VirtualNetworks.DefaultVnetAddress]}}}},t})(y.ResourceBase);t.AppServicePlanResource=k}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanDynamic",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Data/Data.Locations",
"WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","Fx/Controls/DropDown","WebsitesExtension/TypeScript/CreateV2/Models/MessageDispatchModel","WebsitesExtension/TypeScript/Environment/Environment.Switcher"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";r.defineProperty(t,"__esModule",{value:!0});var y=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._isLinux=!1,u._dynamicASPLocationView=r.locations.DynamicAppServicePlansLocationQuery.createView(t),u._locationsArmView=u._dataContext.locations.ArmLocationQuery.createView(t),u}return __extends(t,n),t.prototype.SetupForm=function(n){var t=this;this._isLinux=!!n&&!!n.isLinux;this._isLinux&&(this._dynamicASPLocationView=this._dataContext.locations.DynamicLinuxAppServicePlansLocationQuery.createView(this.container));this.locationsDropDown=new l.ViewModel(this.container,{label:u.observable(e.Wizard.Steps.Location.title),validations:u.observableArray([new i.ViewModels.RequiredValidation(
e.Wizard.Validation.required)])});this.locationsDropDown.value.subscribe(this.container,(function(n){var i=new a.DynamicASPLocationChangeMessage(n);t.form.SendMessageToResources(i)}));this.generalSection.children.push(this.locationsDropDown)},t.prototype.SetDefaults=function(n,t){var r=this;return h.Locations.getDynamicDeploymentLocations(this._dynamicASPLocationView,this._locationsArmView,t.subscriptionId).then((function(n){i.Azure.getLocations().then((function(t){var f=n,i=f.map((function(n){var i=t[n.displayName().toLowerCase().replace(" ","")];return i||(i=n.displayName()),{value:n.displayName(),text:u.observable(i)}})),e=i.first().value;r.locationsDropDown.items(i.sortBy((function(n){return n.text()})));r.locationsDropDown.value(e)}))}))},t.prototype.GetParametersValues=function(){return v.hasFeature(this.form.features(),s.EnvFeature.ExplicitDynamicASP)?{hostingPlanName:this.form.resourceGroupDropdown.value().value.name+"Plan"+o.Guid.newTinyGuid(),hostingEnvironment:"",location:this.locationsDropDown.
value(),sku:s.ServerFarmSku.dynamic,workerSize:"0",serverFarmResourceGroup:this.form.resourceGroupDropdown.value().value.name,skuCode:s.ServerFarmSKUSpecs.dynamic_specCode}:{location:this.locationsDropDown.value()}},t.prototype.GetResourceTemplate=function(){var n={parameters:this._getParameters(),resources:[this._getSiteJson()]};return v.hasFeature(this.form.features(),s.EnvFeature.ExplicitDynamicASP)&&n.resources.push(this._getServerFarmJson()),n},t.prototype._getParameters=function(){return v.hasFeature(this.form.features(),s.EnvFeature.ExplicitDynamicASP)?{hostingPlanName:{type:"string"},hostingEnvironment:{type:"string"},location:{type:"string"},sku:{type:"string"},skuCode:{type:"string"},workerSize:{type:"string"},serverFarmResourceGroup:{type:"string"}}:{location:{type:"string"}}},t.prototype._getSiteJson=function(){var n={type:"Microsoft.Web/sites",name:"[parameters('name')]",location:this.locationsDropDown.value(),properties:{reserved:this._isLinux}};return!this.form.appKind()||
(n.kind=this._isLinux?s.KindsAvailable.DynamicLinux:this.form.appKind()),v.hasFeature(this.form.features(),s.EnvFeature.ExplicitDynamicASP)&&(n.properties={reserved:this._isLinux,serverFarmId:"[concat('/subscriptions/', parameters('subscriptionId'),'/resourcegroups/', parameters('serverFarmResourceGroup'), '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]",hostingEnvironment:"[parameters('hostingEnvironment')]"},n.dependsOn=["[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"]),n},t.prototype._getServerFarmJson=function(){return{apiVersion:s.Asset.ASEv2APIVersion,name:"[parameters('hostingPlanName')]",type:"Microsoft.Web/serverfarms",location:"[parameters('location')]",properties:{name:"[parameters('hostingPlanName')]",workerSizeId:"[parameters('workerSize')]",reserved:this._isLinux,numberOfWorkers:"1",hostingEnvironment:"[parameters('hostingEnvironment')]"},sku:{Tier:"[parameters('sku')]",Name:"[parameters('skuCode')]"}}},t.prototype.FinalValidation=
function(){var t=this.form.subscriptionSelector.value().subscriptionId,n=this.form.resourceGroupDropdown.value(),u=this.GetParametersValues(),i=o.Guid.newTinyGuid(),r={name:i,type:s.ResourceTypes.AspResourceType,location:this.locationsDropDown.value(),properties:{skuName:s.ServerFarmSKUSpecs.dynamic_specCode,serverFarmId:"/subscriptions/"+t+"/resourceGroups/"+n.value.name+"/providers/Microsoft.Web/ServerFarms/"+i}};return n.createNew?this._dataContext.resourceGroups.createResourceGroup(t,n.value.name,this.form.getResourceGroupLocation()).then((function(){return o.callValidationApi(t,n.value.name,r,{sku:f.dynamic})})):o.callValidationApi(t,n.value.name,r,{sku:f.dynamic})},t.prototype.getImportantData=function(){return{location:this.locationsDropDown.value(),type:s.Create.AppServicePlanResourceType,id:null,sku:s.ServerFarmSku.dynamic,name:s.ServerFarmSku.dynamic,hostingEnvironmentProfile:null}},t})(c.ResourceBase);t.AppServicePlanDynamic=y}));define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger",
["require","exports","a"],(function(n,t,i){"use strict";var r;return (function(n){function t(n,f){var o=JSON.parse(JSON.stringify(f)),e,s;for(e in n)s=n[e],o.hasOwnProperty(e)?s!=null&&s.constructor===Object?o[e]=t(s,o[e]):i.isArray(s)&&(o[e]=e==="resources"?u(s,o[e]):r(s,o[e])):o[e]=s;return o}function r(n,t){return n.concat(t)}function u(n,i){for(var e,u,o,f=[],r=0;r<n.length;r++)e=i.first((function(t){return t.type===n[r].type&&t.name===n[r].name})),e?f.push(t(n[r],e)):f.push(n[r]);for(u=0;u<i.length;u++)o=n.first((function(n){return n.type===i[u].type&&n.name===i[u].name})),o||f.push(i[u]);return f}n.mergeObjects=t})(r||(r={})),r}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanDynamicLinux",
["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources","Fx/Controls/DropDown","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanDynamic"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=(function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.SetupForm=function(t,r){var s=[{value:"node",text:u.observable("Javascript")},{value:"dotnet",text:u.observable(".NET")},{value:"python",text:u.observable("Python")}];this.languageDropDown=new o.ViewModel(this.container,{label:u.observable(f.runtimeStack),validations:u.observableArray([new i.ViewModels.RequiredValidation(e.Wizard.Validation.required)]),items:u.observable(s),defaultValue:u.observable("node")});this.generalSection.children.push(this.languageDropDown);
n.prototype.SetupForm.call(this,t,r)},t.prototype._getLinuxFxVersion=function(){switch(this.languageDropDown.value()){case"node":return"DOCKER|microsoft/azure-functions-node8:2.0";case"dotnet":return"DOCKER|microsoft/azure-functions-dotnet-core2.0:2.0";case"python":return"DOCKER|microsoft/azure-functions-python3.6:2.0";default:return"DOCKER|microsoft/azure-functions-runtime:2.0.0-jessie"}},t.prototype.GetLanguageTemplate=function(){return{resources:[{name:"[parameters('name')]",type:"Microsoft.Web/sites",kind:"functionapp,linux",properties:{siteConfig:{linuxFxVersion:this._getLinuxFxVersion(),appSettings:[{name:"FUNCTIONS_WORKER_RUNTIME",value:this.languageDropDown.value()}]}}}]}},t.prototype.GetResourceTemplate=function(t){var i=n.prototype.GetResourceTemplate.call(this,t);return s.mergeObjects(i,this.GetLanguageTemplate())},t})(h.AppServicePlanDynamic);t.AppServicePlanDynamicLinux=c}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&
function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/FunctionAppWithStorage",["require","exports","f","o","ko","WebsitesExtension/TypeScript/Ajax/Ajax","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","Websites/ClientResources/ConfigResources","Fx/Controls/DropDown","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/Storage/Models/StorageAccount","WebsitesExtension/TypeScript/Environment/RuntimeType"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";r.defineProperty(t,"__esModule",{value:!0});var
p=i.ViewModels.Forms,w=(function(n){function t(t,r,f){var s=n.call(this,t,r,f)||this;return s._functionsVersion=u.observable("~1"),s._hasSubscriptionWritePermission=u.observable(!0),s._storageContentGuid=c.Guid.newTinyGuid().toLowerCase(),s._DefaultNewStorageAccountName=u.observable("function"+s._storageContentGuid),s._userEditedTextbox=!1,s._storageOptionNew={text:u.observable(e.createNew),value:o.StorageSelectionOptions.new,disabled:u.observable(!1)},s._storageOptionExisting={text:u.observable(e.selectExisting),value:o.StorageSelectionOptions.existing,disabled:u.observable(!1)},s._storageOptionCustom={text:u.observable(e.StorageOption.custom),value:o.StorageSelectionOptions.custom,disabled:u.observable(!1)},s._fetchFunctionVersion=!0,r.AddRpToRegistration(o.ResourceTypes.StorageProvider),s._storageAccountCache=f.storageData.storageAccountListQuery.createView(t,{interceptNotFound:!1}),s._locationWarningInfoBox=new i.ViewModels.Controls.InfoBox.ViewModel(s.container,!1),s._locationWarningInfoBox.
text=u.observable(e.functionLocationWarning),s._locationWarningInfoBox.image=u.observable(i.Base.Images.Polychromatic.GlobeWarning()),s}return __extends(t,n),t.prototype.SetupForm=function(n){var t=this,r,f,l;n&&n.functionVersion&&(this._fetchFunctionVersion=!1,this._functionsVersion(n.functionVersion));r=u.observableArray([this._storageOptionNew,this._storageOptionExisting]);a.hasFeature(this.form.features(),o.EnvFeature.UseCustomStoragePickerBlade)&&r.push(this._storageOptionCustom);f={label:u.observable(e.storage),options:r,infoBalloonContent:u.observable(e.storageTooltip),infoBalloonLinkContent:u.observable({linkUri:o.Create.storageLinkUri,linkText:e.learnMore}),defaultValue:u.observable(o.StorageSelectionOptions.new),validations:u.observableArray([new i.ViewModels.RequiredValidation]),radioButtonStyle:!0};this.storageOptions=new p.OptionsGroup.ViewModel(this.container,f);l={emptyValueText:u.observable(""),showValidationMessagesBelowControl:!0,validations:u.observableArray([new i.ViewModels.
RequiredValidation,new i.ViewModels.MaxLengthValidation(24),new i.ViewModels.MinLengthValidation(3),new i.ViewModels.RegExMatchValidation(o.Regex.storageName,e.invalidStorageAccountName),new i.ViewModels.CustomValidation("",function(n){var i={message:e.storageAccountDupError,valid:!0},r=t._storageAccountCache.items()&&t._storageAccountCache.items.map(t.container,(function(n,t){return t.name().toLowerCase()})),u=n.toLowerCase();return r()&&r().indexOf(u)>-1&&(i.valid=!1),Q(i)})]),defaultValue:this._DefaultNewStorageAccountName};this.storageAccountTextbox=new p.TextBox.ViewModel(this.container,l);this.storageAccountTextbox.value.subscribe(this.container,(function(n){n!==t._DefaultNewStorageAccountName()&&(t._userEditedTextbox=!0)}));this._DefaultNewStorageAccountName.subscribe(this.container,(function(){t._userEditedTextbox||t.storageAccountTextbox.value(t._DefaultNewStorageAccountName())}));this.storageAccountDropdown=new h.ViewModel(this.container,{validations:u.observableArray([new i.ViewModels.
RequiredValidation]),filter:!0});this.storageSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,{label:u.observable(s.storageSelectorLabel),displayText:u.pureComputed((function(){var n=t.storageSelector.value,i=!!n()&&!!n().name();return i?n().name():""}))});this.storageSelector.validations.push(new i.ViewModels.RequiredValidation(""));this.storageCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){return t.storageSelector.value()||t.storageSelector.value(new v.StorageAccount),t.storageSelector.value()},supplyProviderConfig:function(){return{hideBlobContainer:!0}},receiveResult:function(n){t.storageSelector.value(n)},selectable:this.storageSelector.selectable});this.storageSelector.selectable.selectedValue({detailBlade:"CustomStorageContainerPicker",detailBladeInputs:{}});this.container.registerSelectable(this.container,c.Guid.newShortGuid(),this.storageSelector.selectable,{parameterCollector:this.storageCollector});this.storageAccountDropdown.
loading(!0);this.generalSection.children.push(this.storageOptions);this.generalSection.children.push(this.storageAccountTextbox);this.storageAccountDropdown.value.subscribe(this.container,(function(){t._setInfoboxVisability(t.storageOptions.value()===o.StorageSelectionOptions.existing)}));this.storageOptions.value.subscribe(this.container,(function(n){t.generalSection.children.remove(t.storageAccountTextbox);t.generalSection.children.remove(t.storageAccountDropdown);t.generalSection.children.remove(t.storageSelector);n===o.StorageSelectionOptions.new?t.generalSection.children.push(t.storageAccountTextbox):n===o.StorageSelectionOptions.existing?(t.generalSection.children.push(t.storageAccountDropdown),t._orderExistingStorageOptions(!0)):t.generalSection.children.push(t.storageSelector);t._setInfoboxVisability(t.storageOptions.value()===o.StorageSelectionOptions.existing)}))},t.prototype._setInfoboxVisability=function(n){var t,i;if(this.form.infoBoxSection.children.remove(this._locationWarningInfoBox),
n){if(t=this.form.getResourceData(o.Create.AppServicePlanResourceType),!t)return;i=t&&t.location;this.storageAccountDropdown.value()&&this.storageAccountDropdown.value().location().toLowerCase()!==i.toLowerCase()&&this.form.infoBoxSection.children.push(this._locationWarningInfoBox)}},t.prototype._orderExistingStorageOptions=function(n){var i,t,r;if(n){if(i=this.form.getResourceData(o.Create.AppServicePlanResourceType),!i)return;if(t=i&&i.location,t=t.toLowerCase().replaceAll(" ",""),r=this.storageAccountDropdown.items(),!r)return;this.storageAccountDropdown.items(r.sort((function(n,i){var r=n.text,u=i.text;return(r=r.toLowerCase().replaceAll(" ",""),u=u.toLowerCase().replaceAll(" ",""),r===u)?0:r===t?-1:u===t?1:0})))}},t.prototype.SetDefaults=function(n,t){var i=this,r;return(this._storageOptionNew.disabled(!1),this._storageOptionExisting.disabled(!1),this.storageOptions.value(o.StorageSelectionOptions.new),r=this._storageAccountCache.fetch(t.subscriptionId).then((function(){i.fillStorageAccount(
);i.storageAccountDropdown.loading(!1)}),(function(){a.hasFeature(i.form.features(),o.EnvFeature.UseCustomStoragePickerBlade)&&(i._storageOptionNew.disabled(!0),i._storageOptionExisting.disabled(!0),i.storageOptions.value(o.StorageSelectionOptions.custom))})),this._fetchFunctionVersion)?f.get("GetFunctionVersion").then((function(n){!n||(n=n.replaceAll('"',""),i._functionsVersion(n))})):Q(null)},t.prototype.recieveDispatchMessage=function(n){if(n.message===o.CreateMessageTypes.AppNameChange){var i=n,t=i.name.replaceAll("-",""),r=t.length>15?t.substring(0,15).toLowerCase():t.toLowerCase();this._DefaultNewStorageAccountName(""+r+this._storageContentGuid)}else(n.message===o.CreateMessageTypes.DynamicASPLocationChange||n.message===o.CreateMessageTypes.AppSerivcePlanChange)&&(this._setInfoboxVisability(this.storageOptions.value()===o.StorageSelectionOptions.existing),this._orderExistingStorageOptions(this.storageOptions.value()===o.StorageSelectionOptions.existing))},t.prototype.fillStorageAccount=
function(){var n=this._storageAccountCache.items().filter((function(n){if(n.properties().primaryEndpoints&&n.properties().primaryEndpoints()){if(y.isOnPrem())return!0;var t=o.Functions.functionStorageFilterToTypes.first((function(t){var r=n.properties().primaryEndpoints(),i=r[t];return!i||!i()}));if(t)return!1}return!0})).map((function(n){return{text:n.name(),value:n}})),t=n.map((function(n){return n.value.location()})).distinct(),i=t.map((function(t){return{text:t,children:n.filter((function(n){return n.value.location()===t}))}}));this.storageAccountDropdown.items(i)},t.prototype.GetResourceTemplate=function(n){var t={parameters:{storageName:{type:"string"}},resources:[]};return this.storageOptions.value()===o.StorageSelectionOptions.new&&t.resources.push(this._getStorageTemplate()),t.resources.push(this.getSiteTemplate(n)),t},t.prototype._getStorageTemplate=function(){return{apiVersion:o.Asset.StorageApiVersion,type:"Microsoft.Storage/storageAccounts",name:"[parameters('storageName')]",location:
"[parameters('location')]",properties:{accountType:"Standard_LRS"}}},t.prototype.GetParametersValues=function(){var n="";return n=this.storageOptions.value()===o.StorageSelectionOptions.new?this.storageAccountTextbox.value():this.storageOptions.value()===o.StorageSelectionOptions.existing?this.storageAccountDropdown.value().name():this.storageSelector.value().name(),{storageName:n}},t.prototype._getStorageEndpointSuffix=function(){return y.isMooncake()?",';EndpointSuffix=core.chinacloudapi.cn'":y.isBlackforest()?",';EndpointSuffix=core.cloudapi.de'":y.isFairfax()?",';EndpointSuffix=core.usgovcloudapi.net'":""},t.prototype.getSiteTemplate=function(n){var t="listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageName')), '"+o.Asset.StorageApiVersion+"').key1",r,e;this.storageOptions.value()===o.StorageSelectionOptions.existing?(r=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(this.storageAccountDropdown.value().id()),t="listKeys(resourceId('"+r.subscription+
"','"+r.resourceGroup+"','Microsoft.Storage/storageAccounts', parameters('storageName')), '"+o.Asset.StorageApiVersion+"').key1"):this.storageOptions.value()===o.StorageSelectionOptions.custom&&(t="'"+this.storageSelector.value().key()+"'");var s=this._getStorageEndpointSuffix(),u=y.isOnPrem()&&this.storageOptions.value()!==o.StorageSelectionOptions.custom?"[concat('BlobEndpoint=https://',parameters('storageName'),'."+window.fx.environment.blobEndpoint+"',';TableEndpoint=https://',parameters('storageName'),'."+window.fx.environment.tableEndpoint+"',';QueueEndpoint=https://',parameters('storageName'),'."+window.fx.environment.queueEndpoint+"',';AccountName=',parameters('storageName'),';AccountKey=',"+t+")]":"[concat('DefaultEndpointsProtocol=https;AccountName=',parameters('storageName'),';AccountKey=',"+t+this._getStorageEndpointSuffix()+")]",f=[{name:"AzureWebJobsDashboard",value:u},{name:"AzureWebJobsStorage",value:u},{name:"FUNCTIONS_EXTENSION_VERSION",value:this._functionsVersion()}];
return!y.isOnPrem()&&n.includeXMBSettings&&(f.push({name:"WEBSITE_CONTENTAZUREFILECONNECTIONSTRING",value:u}),f.push({name:"WEBSITE_CONTENTSHARE",value:"[concat(toLower(parameters('name')), '"+this._storageContentGuid+"')]"})),e={name:"[parameters('name')]",type:"Microsoft.Web/sites",properties:{clientAffinityEnabled:!1,siteConfig:{appSettings:f}}},this.storageOptions.value()===o.StorageSelectionOptions.new&&(e.dependsOn=["[resourceId('Microsoft.Storage/storageAccounts', parameters('storageName'))]"]),e},t})(l.ResourceBase);t.FunctionAppWithStorage=w}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanSwapper",["require",
"exports","f","o","a","ko","WebsitesExtension/TypeScript/Helpers/ArmHelpers","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","Fx/Controls/DropDown","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","WebsitesExtension/TypeScript/Utility/Utility.WebHostingPlan","WebsitesExtension/TypeScript/CreateV2/Models/MessageDispatchModel","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanDynamic","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlan","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/FunctionAppWithStorage","WebsitesExtension/TypeScript/ExtensionAssets/Links","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],
(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){"use strict";r.defineProperty(t,"__esModule",{value:!0});var nt=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._storageKey="storageResource",u._storageUsed=!0,u._dynamicASPLocationView=r.locations.DynamicAppServicePlansLocationQuery.createView(t),u._locationsArmView=u._dataContext.locations.ArmLocationQuery.createView(t),u}return __extends(t,n),t.prototype.SetupForm=function(n,t){var r=this,e,h,u;this._storageUsed=!n.hideMemoryDropdown;e=this.form.appKind()===b.KindsAvailable.Bots;h={linkText:o.learnMore,linkUri:d.Links.botAppLink};this.servicePlanTypeDown=new c.ViewModel(this.container,{label:f.observable(o.hostingPlan),infoBalloonContent:f.observable(o.hostingPlanTypeInfoBaloon),infoBalloonLinkContent:e?f.observable(h):f.observable(null),validations:f.observableArray([new i.ViewModels.RequiredValidation(s.Wizard.Validation.required)])});this.addDropdownItems(n,t);this._storageUsed&&(u=new k.FunctionAppWithStorage(
this.container,this.form,this._dataContext),t.storage=u.GetObject(),u.SetupForm(null,t),this.resources[this._storageKey]=u,this.generalSection.children.push(u.generalSection));this.servicePlanTypeDown.value.subscribe(this.container,(function(n){var t=r.generalSection.children();t.remove(r.resources[b.ServerFarmTypes.dynamic].generalSection);t.remove(r.resources[b.ServerFarmTypes.classic].generalSection);t.splice(1,0,r.resources[n].generalSection);r.generalSection.children(t);r.generalSection.children.valueHasMutated();r.form.SendMessageToResources(new y.AppSerivcePlanTypeChangeMessage(n))}));l.hasFeature(this.form.features(),b.EnvFeature.UseDesignatedSKUs)||(e||l.hasFeature(this.form.features(),b.EnvFeature.DynamicUnavailable)?this.servicePlanTypeDown.value(b.ServerFarmTypes.classic):this.servicePlanTypeDown.value(b.ServerFarmTypes.dynamic))},t.prototype.addDropdownItems=function(n,t){var i=[],r,u;l.hasFeature(this.form.features(),b.EnvFeature.UseDesignatedSKUs)||l.hasFeature(this.form.features(
),b.EnvFeature.DynamicUnavailable)||i.push({text:f.observable(o.dynamicPlan),value:b.ServerFarmTypes.dynamic});i.push({text:f.observable(o.classic),value:b.ServerFarmTypes.classic});this.servicePlanTypeDown.items(i);n.classicPlanAvailable&&!l.hasFeature(this.form.features(),b.EnvFeature.DynamicUnavailable)&&this.generalSection.children.push(this.servicePlanTypeDown);r=new w.AppServicePlanResource(this.container,this.form,this._dataContext);r.SetupForm({HostingEnvironmentId:n.HostingEnvironmentId,premiumApp:!!n&&!!n.premiumApp,isLinux:!!n&&!!n.isLinux,forbiddenSkus:n&&n.forbiddenSkus,forbiddenComputeMode:n&&n.forbiddenComputeMode},t);this.resources[b.ServerFarmTypes.classic]=r;u=new p.AppServicePlanDynamic(this.container,this.form,this._dataContext);u.SetupForm(null,t);this.resources[b.ServerFarmTypes.dynamic]=u},t.prototype.SetDefaults=function(n,t){var i=this,r=[];for(var u in this.resources)r.push(this.resources[u].SetDefaults(n,t));return this._storageUsed&&r.push(this.resources[this.
_storageKey].SetDefaults(n,t)),l.hasFeature(this.form.features(),b.EnvFeature.UseDesignatedSKUs)&&r.push(e.callArm("/subscriptions/{0}/providers/Microsoft.Web/metadata".format(t.subscriptionId)).then((function(n){var t=n.first((function(n){return n.skuCode===b.ServerFarmSKUSpecs.dynamic_specCode}));t?(i.addConsumptionPlanOption(),i.servicePlanTypeDown.value(b.ServerFarmTypes.dynamic)):(i.removeConsumptionPlanOption(),i.servicePlanTypeDown.value(b.ServerFarmTypes.classic))}))),Q.all(r)},t.prototype.addConsumptionPlanOption=function(){for(var i=-1,n=this.servicePlanTypeDown.items(),t=0;t<n.length;++t)if(n[t].value===b.ServerFarmTypes.dynamic){i=t;break}i>=0||(n.splice(0,0,{text:f.observable(o.dynamicPlan),value:b.ServerFarmTypes.dynamic}),this.servicePlanTypeDown.items(n))},t.prototype.removeConsumptionPlanOption=function(){for(var i=-1,n=this.servicePlanTypeDown.items(),t=0;t<n.length;++t)if(n[t].value===b.ServerFarmTypes.dynamic){i=t;break}i>=0&&(n.splice(i,1),this.servicePlanTypeDown.items(
n))},t.prototype.GetParametersValues=function(){h.logTelemetry("Create ASP With Swapper","PlanType="+this.servicePlanTypeDown.value());var t=this.servicePlanTypeDown.value(),i=this.resources[t].GetParametersValues(),n={};return this._storageUsed&&(n=this.resources[this._storageKey].GetParametersValues()),a.mergeObjects(i,n)},t.prototype.GetResourceTemplate=function(){var r=this.servicePlanTypeDown.value(),e=this.resources[r].GetResourceTemplate(null),u=r===b.ServerFarmTypes.dynamic,f={},n,t,i;return this._storageUsed&&(f=this.resources[this._storageKey].GetResourceTemplate({includeXMBSettings:u})),n=a.mergeObjects(e,f),u||(t=this.form.getResourceData(b.Create.AppServicePlanResourceType),i=t&&t.sku,i!==null&&v.isBasicSKUOrHigher(i)&&(n=a.mergeObjects(n,this.getSiteAlwaysOn()))),n},t.prototype.getSiteAlwaysOn=function(){return{parameters:{},resources:[{type:"Microsoft.Web/sites",name:"[parameters('name')]",properties:{siteConfig:{alwaysOn:!0}}}]}},t.prototype.getImportantData=function(){
var n=this.servicePlanTypeDown.value();return this.resources[n].getImportantData()},t.prototype.FinalValidation=function(){var n=this.servicePlanTypeDown.value();return this.resources[n].FinalValidation()},t})(g.ResourceBase);t.AppServicePlanSwapper=nt}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LinuxResource",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/CustomContainer/CustomContainerModels","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","Fx/Controls/DropDown"],
(function(n,t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f.linuxInfo=u.observable(null),f._imageNameParam="dockerRegistryImageName",f._serverUrlParam="dockerRegistryUrl",f._usernameParam="dockerRegistryUsername",f._passwordParam="dockerRegistryPassword",f._runCommandParam="dockerRegistryRunCommand",f.linuxInfo({containerInfo:u.observable(new e.ContainerInfo)}),f.linuxInfo().containerInfo().containerSource(e.ContainerSource.builtin),f.linuxInfo().containerInfo().runtimeStack(o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node4_5_0),f}return __extends(t,n),t.prototype.GetObject=function(){return this.linuxInfo},t.prototype.CloseAnyBlades=function(){this.containerSelector&&this.containerSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(){var n=o.AvailableStackLabels.NodeJs,t=o.AvailableStackLabels.Php,e=o.AvailableStacks.JavaDisplayName,s=o.AvailableStacks.JavaSEDisplayName,
r=o.AvailableStackLabels.DotNetCore,c=o.AvailableStackLabels.Ruby,l=[{text:o.AvailableStackLabels.NodeJs,children:[{text:n+" "+o.LinuxStackVersions.Node4_4_7,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node4_4_7},{text:n+" "+o.LinuxStackVersions.Node4_5_0,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node4_5_0},{text:n+" "+o.LinuxStackVersions.Node6_2_2,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node6_2_2},{text:n+" "+o.LinuxStackVersions.Node6_6_0,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node6_6_0},{text:n+" "+o.LinuxStackVersions.Node6_9_3,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node6_9_3},{text:n+" "+o.LinuxStackVersions.Node6_10,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node6_10},{text:n+" "+o.LinuxStackVersions.Node6_11,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node6_11},{text:n+" "+o.LinuxStackVersions.Node8_0,value:o.AvailableStacks.NodeStackName+
"_"+o.LinuxStackVersions.Node8_0},{text:n+" "+o.LinuxStackVersions.Node8_1,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node8_1},{text:n+" "+o.LinuxStackVersions.Node8_2,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node8_2},{text:n+" "+o.LinuxStackVersions.Node8_8,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node8_8},{text:n+" "+o.LinuxStackVersions.Node8_9,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node8_9},{text:n+" "+o.LinuxStackVersions.Node9_4,value:o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node9_4}]},{text:o.AvailableStackLabels.Php,children:[{text:t+" "+o.LinuxStackVersions.Php5_6_21,value:o.AvailableStacks.PhpStackName+"_"+o.LinuxStackVersions.Php5_6_21},{text:t+" "+o.LinuxStackVersions.Php7_0_6,value:o.AvailableStacks.PhpStackName+"_"+o.LinuxStackVersions.Php7_0_6},{text:t+" "+o.LinuxStackVersions.Php7_2,value:o.AvailableStacks.PhpStackName+"_"+o.LinuxStackVersions.Php7_2}]},{text:o.AvailableStackLabels.
Java,children:[{text:s+" "+o.LinuxStackVersions.Jre8,value:o.AvailableStacks.JavaSERuntimeName+"_"+o.LinuxStackVersions.Jre8_runtime},{text:e+" "+o.LinuxStackVersions.Tomcat8_5,value:o.AvailableStacks.JavaRuntimeName+"_"+o.LinuxStackVersions.Tomcat8_5_runtime},{text:e+" "+o.LinuxStackVersions.Tomcat9_0,value:o.AvailableStacks.JavaRuntimeName+"_"+o.LinuxStackVersions.Tomcat9_0_runtime}]},{text:o.AvailableStackLabels.DotNetCore,children:[{text:r+" "+o.LinuxStackVersions.DotNetCore_1_0,value:o.AvailableStacks.DotNetCoreName+"_"+o.LinuxStackVersions.DotNetCore_1_0},{text:r+" "+o.LinuxStackVersions.DotNetCore_1_1,value:o.AvailableStacks.DotNetCoreName+"_"+o.LinuxStackVersions.DotNetCore_1_1},{text:r+" "+o.LinuxStackVersions.DotNetCore_2_0,value:o.AvailableStacks.DotNetCoreName+"_"+o.LinuxStackVersions.DotNetCore_2_0}]},{text:o.AvailableStackLabels.Ruby,children:[{text:c+" "+o.LinuxStackVersions.Ruby_2_3,value:o.AvailableStacks.RubyStackName+"_"+o.LinuxStackVersions.Ruby_2_3}]}];this._stacksDropDown=
new h.ViewModel(this.container,{label:u.observable(f.runtimeStack),defaultValue:u.observable(o.AvailableStacks.PhpStackName+"_"+o.LinuxStackVersions.Php7_0_6),validations:u.observableArray([new i.ViewModels.RequiredValidation(f.required)])});this._stacksDropDown.items(l.sortBy((function(n){return n.text})));this.generalSection.children.push(this._stacksDropDown)},t.prototype.GetParametersValues=function(){var n,i,t,r;return n=this._stacksDropDown.value(),n&&(t=n.split("_"),this._stack=t[0],i=t[1]),r={},{linuxFxVersion:this._stack+"|"+i}},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[]};return n.parameters={linuxFxVersion:{type:"string"}},n.resources=[this._getSiteJsonForLinuxFxVersion()],n},t.prototype._getSiteJsonForLinuxFxVersion=function(){return{type:"Microsoft.Web/sites",name:"[parameters('name')]",properties:{siteConfig:{linuxFxVersion:"[parameters('linuxFxVersion')]"}}}},t})(s.ResourceBase);t.LinuxResource=c}));__extends=this&&this.__extends||(function(){
var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LinuxResourceBYOC",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/CustomContainer/CustomContainerModels","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f.linuxInfo=u.observable(null),f._byoc=!0,f._serverUrlParam="dockerRegistryUrl",f._usernameParam=
"dockerRegistryUsername",f._passwordParam="dockerRegistryPassword",f._runCommandParam="dockerRegistryRunCommand",f._isFunction=!1,f.linuxInfo({containerInfo:u.observable(new e.ContainerInfo)}),f}return __extends(t,n),t.prototype.GetObject=function(){return this.linuxInfo},t.prototype.CloseAnyBlades=function(){this.containerSelector&&this.containerSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(n){var t=this,r;this._byoc=n.isLinuxBYOC;this._isFunction=!!n.isFunction;n.galleryContainer?(r=new e.ContainerInfo,r.imageName(n.galleryContainer),r.isPublicDockerHubRepo(!0),r.containerSource(e.ContainerSource.dockerHub),this.linuxInfo().containerInfo(r)):(this._byoc?this.linuxInfo().containerInfo().containerSource(e.ContainerSource.dockerHub):(this.linuxInfo().containerInfo().containerSource(e.ContainerSource.builtin),this.linuxInfo().containerInfo().runtimeStack(o.AvailableStacks.NodeStackName+"_"+o.LinuxStackVersions.Node6_11)),this.containerSelector=new i.ViewModels.Forms.
Selector.ViewModel(this.container,{label:u.observable(f.Docker.configureContainer),displayText:u.pureComputed((function(){var n;if(t.linuxInfo()&&t.linuxInfo().containerInfo()){if(n=t.linuxInfo().containerInfo(),n.imageName())return n.imageName();if(n.runtimeStack()){var i=n.runtimeStack().split("_"),r=i[0],u=i[1];return r+" "+u}if(n.linuxFxVersion())return f.complete}return null})),defaultValue:u.observable(1),validations:u.observableArray([new i.ViewModels.RequiredValidation,new i.ViewModels.CustomValidation("",function(){var n=t.linuxInfo().containerInfo(),i={valid:n.imageName&&n.imageName()||n.runtimeStack&&n.runtimeStack()||n.linuxFxVersion&&n.linuxFxVersion(),message:f.validationRequired};return Q(i)})])}),this.containerCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){return t.linuxInfo().containerInfo()},supplyProviderConfig:function(){return{hideBuiltIn:t._byoc,disableMultiContainer:t._isFunction,subId:t.form.subscriptionSelector.value().
subscriptionId}},receiveResult:function(n){t.linuxInfo().containerInfo(n);t.containerSelector.triggerValidation()},selectable:this.containerSelector.selectable}),this.containerSelector.selectable.selectedValue({detailBlade:s.BladeNames.customContainerBlade,detailBladeInputs:{}}),this.container.registerSelectable(this.container,"containerSelector",this.containerSelector.selectable,{parameterCollector:this.containerCollector}),this.generalSection.children.push(this.containerSelector))},t.prototype.GetParametersValues=function(){var i,u,r,t,n;if(this.linuxInfo().containerInfo().containerSource()!==e.ContainerSource.builtin?this._stack=o.AvailableStacks.CustomContainerName:i=this.linuxInfo().containerInfo().runtimeStack(),i&&(r=i.split("_"),this._stack=r[0],u=r[1]),t={},this.linuxInfo().containerInfo().containerSource()!==e.ContainerSource.builtin&&(this._stack=o.AvailableStacks.CustomContainerName),this._stack===o.AvailableStacks.NodeStackName||this._stack===o.AvailableStacks.PhpStackName||
this._stack===o.AvailableStacks.RubyStackName||this._stack===o.AvailableStacks.DotNetCoreName)t.linuxFxVersion=this._stack+"|"+u;else if(this._stack===o.AvailableStacks.CustomContainerName)n=this.linuxInfo().containerInfo(),n.serverUrl()&&(t[this._serverUrlParam]=n.serverUrl()),n.username()&&(t[this._usernameParam]=n.username()),n.password()&&(t[this._passwordParam]=n.password()),n.appCommandLine()&&(t[this._runCommandParam]=n.appCommandLine());else throw Error("Unrecognized stack: "+this._stack);return t},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[]};if(this._stack===o.AvailableStacks.NodeStackName||this._stack===o.AvailableStacks.RubyStackName||this._stack===o.AvailableStacks.PhpStackName||this._stack===o.AvailableStacks.DotNetCoreName)n.parameters={linuxFxVersion:{type:"string"}},n.resources=[this._getSiteJsonForLinuxFxVersion()];else if(this._stack===o.AvailableStacks.CustomContainerName)this._buildTemplateForCustomContainer(n);else throw Error("Unrecognized stack: "+
this._stack);return n},t.prototype._getSiteJsonForLinuxFxVersion=function(){return{type:"Microsoft.Web/sites",name:"[parameters('name')]",properties:{siteConfig:{linuxFxVersion:"[parameters('linuxFxVersion')]"}}}},t.prototype._buildTemplateForCustomContainer=function(n){var t=this.linuxInfo().containerInfo(),i={},r=[],u;t.serverUrl()&&(i[this._serverUrlParam]={type:"string"},r.push({name:o.Docker.serverUrlSetting,value:"[parameters('"+this._serverUrlParam+"')]"}));t.username()&&(i[this._usernameParam]={type:"string"},r.push({name:o.Docker.usernameSetting,value:"[parameters('"+this._usernameParam+"')]"}));t.password()&&(i[this._passwordParam]={type:"string"},r.push({name:o.Docker.passwordSetting,value:"[parameters('"+this._passwordParam+"')]"}));t.appCommandLine()&&(i[this._runCommandParam]={type:"string"});n.parameters=i;u=t.linuxFxVersion&&t.linuxFxVersion()?t.linuxFxVersion():o.LinuxStackVersions.LinuxFxVersion.format(o.Docker.docker,t.imageName());n.resources=[{type:"Microsoft.Web/sites",
name:"[parameters('name')]",properties:{siteConfig:{appSettings:r,appCommandLine:t.appCommandLine()?t.appCommandLine():"",linuxFxVersion:u}}}]},t})(h.ResourceBase);t.LinuxResourceBYOC=c}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanWithLinux",["require","exports","o","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlan","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LinuxResourceBYOC",
"WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LinuxResource"],(function(n,t,i,r,u,f,e,o){"use strict";i.defineProperty(t,"__esModule",{value:!0});var s=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u.aspKey="asp",u.linuxSetup="linuxsetup",u}return __extends(t,n),t.prototype.SetupForm=function(n,t){var f=new r.AppServicePlanResource(this.container,this.form,this._dataContext),i,u;f.SetupForm({HostingEnvironmentId:n.HostingEnvironmentId,premiumApp:!!n&&!!n.premiumApp,isLinux:!0,forbiddenSkus:n&&n.forbiddenSkus,forbiddenComputeMode:n&&n.forbiddenComputeMode},t);this.resources[this.aspKey]=f;this.generalSection.children.push(f.generalSection);n.isLinuxBYOC||n.isLinux?(i=new e.LinuxResourceBYOC(this.container,this.form,this._dataContext),t.linuxInfo=i.GetObject(),i.SetupForm(n,t),this.resources[this.linuxSetup]=i,this.generalSection.children.push(i.generalSection)):(u=new o.LinuxResource(this.container,this.form,this._dataContext),t.linuxInfo=
u.GetObject(),u.SetupForm(n,t),this.resources[this.linuxSetup]=u,this.generalSection.children.push(u.generalSection))},t.prototype.TurnOn=function(){this.form.dnsSuffix(window.fx.environment.antaresHostedSiteUriFormat.format(""))},t.prototype.GetParametersValues=function(){var n=this.resources[this.aspKey].GetParametersValues(),t=this.resources[this.linuxSetup].GetParametersValues();return f.mergeObjects(n,t)},t.prototype.GetResourceTemplate=function(n){var t=this.resources[this.aspKey].GetResourceTemplate(n),i=this.resources[this.linuxSetup].GetResourceTemplate(n);return f.mergeObjects(t,i)},t.prototype.getImportantData=function(){var n=this.resources[this.aspKey].getImportantData(),t=this.resources[this.linuxSetup].getImportantData();return f.mergeObjects(n,t)},t.prototype.FinalValidation=function(){return this.resources[this.aspKey].FinalValidation()},t})(u.ResourceBase);t.AppServicePlanWithLinux=s}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[
]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LinuxFunction",["require","exports","f","o","ko","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanWithLinux","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/FunctionAppWithStorage","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","Websites/ClientResources/GeneralResources","Fx/Controls/DropDown","Websites/ClientResources/CreateResources"],(function(
n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";r.defineProperty(t,"__esModule",{value:!0});var y=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._handleStorageField=!0,u}return __extends(t,n),t.prototype.SetupForm=function(t,r){var y,c,f;n.prototype.SetupForm.call(this,t,r);this._handleStorageField=!h.forFeature(s.FeatureFlags.DynamicLinuxFunction);y=[{value:"nodejs",text:u.observable("Javascript")},{value:"dotnet",text:u.observable(".NET")}];h.forFeature(s.FeatureFlags.pythonFunctions)&&y.push({value:"python",text:u.observable("Python")});this.languageDropDown=new a.ViewModel(this.container,{label:u.observable(l.runtimeStack),validations:u.observableArray([new i.ViewModels.RequiredValidation(v.Wizard.Validation.required)]),items:u.observable(y),defaultValue:u.observable("nodejs")});this.generalSection.children.push(this.languageDropDown);c=new e.AppServicePlanWithLinux(this.container,this.form,this._dataContext);c.SetupForm({HostingEnvironmentId:t.HostingEnvironmentId,
premiumApp:!!t&&!!t.premiumApp,isLinux:t.isLinux,forbiddenSkus:t&&t.forbiddenSkus,isLinuxBYOC:!0,galleryContainer:"microsoft/azure-functions-runtime:2.0.0-jessie",isFunction:!0},r);this.resources.plan=c;this.generalSection.children.push(c.generalSection);this._handleStorageField&&(f=new o.FunctionAppWithStorage(this.container,this.form,this._dataContext),r.storage=f.GetObject(),f.SetupForm({functionVersion:"beta"},r),this.resources.storage=f,this.generalSection.children.push(f.generalSection))},t.prototype.GetParametersValues=function(){var n=this.resources.plan.GetParametersValues(),t;return this._handleStorageField?(t=this.resources.storage.GetParametersValues(),c.mergeObjects(n,t)):n},t.prototype.GetResourceTemplate=function(n){var t=this.resources.plan.GetResourceTemplate(n),i,r;return this._handleStorageField?(i=this.resources.storage.GetResourceTemplate({includeXMBSettings:!1}),r=c.mergeObjects(t,i),c.mergeObjects(r,this.GetLanguageTemplate())):c.mergeObjects(t,this.GetLanguageTemplate(
))},t.prototype._getLinuxFxVersion=function(){switch(this.languageDropDown.value()){case"node":return"DOCKER|microsoft/azure-functions-node8:2.0";case"dotnet":return"DOCKER|microsoft/azure-functions-dotnet-core2.0:2.0";case"python":return"DOCKER|microsoft/azure-functions-python3.6:2.0";default:return"DOCKER|microsoft/azure-functions-runtime:2.0.0-jessie"}},t.prototype.getImportantData=function(){return this.resources.plan.getImportantData()},t.prototype.FinalValidation=function(){return this.resources.plan.FinalValidation()},t.prototype.GetLanguageTemplate=function(){return{resources:[{name:"[parameters('name')]",type:"Microsoft.Web/sites",kind:"functionapp,linux",properties:{siteConfig:{alwaysOn:!0,linuxFxVersion:this._getLinuxFxVersion(),appSettings:[{name:"FUNCTIONS_WORKER_RUNTIME",value:this.languageDropDown.value()}]}}}]}},t})(f.ResourceBase);t.LinuxFunction=y}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=
t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanSwapperLinux",["require","exports","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanSwapper","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LinuxFunction","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanDynamicLinux"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";i.defineProperty(t,"__esModule",{value:!0});var c=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.
SetupForm=function(t,i){n.prototype.SetupForm.call(this,t,i)},t.prototype.addDropdownItems=function(n,t){var i=[],o,c;f.hasFeature(this.form.features(),e.EnvFeature.UseDesignatedSKUs)||f.hasFeature(this.form.features(),e.EnvFeature.DynamicUnavailable)||i.push({text:r.observable(u.dynamicPlan),value:e.ServerFarmTypes.dynamic});i.push({text:r.observable(u.classic),value:e.ServerFarmTypes.classic});this.servicePlanTypeDown.items(i);n.classicPlanAvailable&&!f.hasFeature(this.form.features(),e.EnvFeature.DynamicUnavailable)&&this.generalSection.children.push(this.servicePlanTypeDown);o=new s.LinuxFunction(this.container,this.form,this._dataContext);o.SetupForm({HostingEnvironmentId:n.HostingEnvironmentId,premiumApp:!!n&&!!n.premiumApp,isLinux:!!n&&!!n.isLinux,forbiddenSkus:n&&n.forbiddenSkus,forbiddenComputeMode:n&&n.forbiddenComputeMode},t);this.resources[e.ServerFarmTypes.classic]=o;c=new h.AppServicePlanDynamicLinux(this.container,this.form,this._dataContext);c.SetupForm({isLinux:!0},t);
this.resources[e.ServerFarmTypes.dynamic]=c},t.prototype.GetResourceTemplate=function(t){return n.prototype.GetResourceTemplate.call(this,t)},t})(o.AppServicePlanSwapper);t.AppServicePlanSwapperLinux=c}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/XenonResource",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/CustomContainer/CustomContainerModels","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],(function(n,
t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f.xenonInfo=u.observable(null),f._byoc=!0,f._serverUrlParam="dockerRegistryUrl",f._usernameParam="dockerRegistryUsername",f._passwordParam="dockerRegistryPassword",f._runCommandParam="dockerRegistryRunCommand",f.xenonInfo({containerInfo:u.observable(new e.ContainerInfo)}),f}return __extends(t,n),t.prototype.GetObject=function(){return this.xenonInfo},t.prototype.CloseAnyBlades=function(){this.containerSelector&&this.containerSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(n){var t=this,r;this._byoc=n.isXenonBYOC;n.galleryContainer?(r=new e.ContainerInfo,r.imageName(n.galleryContainer),r.isPublicDockerHubRepo(!0),r.containerSource(e.ContainerSource.dockerHub),this.xenonInfo().containerInfo(r)):(this._byoc?this.xenonInfo().containerInfo().containerSource(e.ContainerSource.dockerHub):(this.xenonInfo().containerInfo().containerSource(
e.ContainerSource.builtin),this.xenonInfo().containerInfo().runtimeStack(o.AvailableStacks.DotNetCoreName+"_"+o.XenonStackVersion.DotNetCore_1_0)),this.containerSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,{label:u.observable(f.Docker.configureContainer),displayText:u.pureComputed((function(){var n;if(t.xenonInfo()&&t.xenonInfo().containerInfo()){if(n=t.xenonInfo().containerInfo(),n.imageName())return n.imageName();if(n.runtimeStack()){var i=n.runtimeStack().split("_"),r=i[0],u=i[1];return r+" "+u}}return null})),defaultValue:u.observable(1),validations:u.observableArray([new i.ViewModels.RequiredValidation,new i.ViewModels.CustomValidation("",function(){var n=t.xenonInfo().containerInfo(),i={valid:n.imageName&&n.imageName()||n.runtimeStack&&n.runtimeStack(),message:f.validationRequired};return Q(i)})])}),this.containerCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){return t.xenonInfo().containerInfo()},supplyProviderConfig:
function(){return{hideBuiltIn:t._byoc,isXenon:!0,subId:t.form.subscriptionSelector.value().subscriptionId}},receiveResult:function(n){t.xenonInfo().containerInfo(n);t.containerSelector.triggerValidation()},selectable:this.containerSelector.selectable}),this.containerSelector.selectable.selectedValue({detailBlade:s.BladeNames.customContainerBlade,detailBladeInputs:{}}),this.container.registerSelectable(this.container,"xenonContainerSelector",this.containerSelector.selectable,{parameterCollector:this.containerCollector}),this.generalSection.children.push(this.containerSelector))},t.prototype.GetParametersValues=function(){var i,u,r,t,n;if(this.xenonInfo().containerInfo().containerSource()!==e.ContainerSource.builtin?this._stack=o.AvailableStacks.CustomContainerName:i=this.xenonInfo().containerInfo().runtimeStack(),i&&(r=i.split("_"),this._stack=r[0],u=r[1]),t={},this.xenonInfo().containerInfo().containerSource()!==e.ContainerSource.builtin&&(this._stack=o.AvailableStacks.CustomContainerName),
this._stack===o.AvailableStacks.NodeStackName||this._stack===o.AvailableStacks.PhpStackName||this._stack===o.AvailableStacks.RubyStackName||this._stack===o.AvailableStacks.DotNetCoreName)t.windowsFxVersion=this._stack+"|"+u;else if(this._stack===o.AvailableStacks.CustomContainerName)n=this.xenonInfo().containerInfo(),n.serverUrl()&&(t[this._serverUrlParam]=n.serverUrl()),n.username()&&(t[this._usernameParam]=n.username()),n.password()&&(t[this._passwordParam]=n.password()),n.appCommandLine()&&(t[this._runCommandParam]=n.appCommandLine());else throw Error("Unrecognized stack: "+this._stack);return t},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[]};if(this._stack===o.AvailableStacks.NodeStackName||this._stack===o.AvailableStacks.RubyStackName||this._stack===o.AvailableStacks.PhpStackName||this._stack===o.AvailableStacks.DotNetCoreName)n.parameters={windowsFxVersion:{type:"string"}},n.resources=[this._getSiteJsonForXenonFxVersion()];else if(this._stack===o.AvailableStacks.
CustomContainerName)this._buildTemplateForCustomContainer(n);else throw Error("Unrecognized stack: "+this._stack);return n},t.prototype._getSiteJsonForXenonFxVersion=function(){return{type:"Microsoft.Web/sites",name:"[parameters('name')]",properties:{siteConfig:{windowsFxVersion:"[parameters('windowsFxVersion')]"}}}},t.prototype._buildTemplateForCustomContainer=function(n){var t=this.xenonInfo().containerInfo(),i={},r=[];t.serverUrl()&&(i[this._serverUrlParam]={type:"string"},r.push({name:o.Docker.serverUrlSetting,value:"[parameters('"+this._serverUrlParam+"')]"}));t.username()&&(i[this._usernameParam]={type:"string"},r.push({name:o.Docker.usernameSetting,value:"[parameters('"+this._usernameParam+"')]"}));t.password()&&(i[this._passwordParam]={type:"string"},r.push({name:o.Docker.passwordSetting,value:"[parameters('"+this._passwordParam+"')]"}));t.appCommandLine()&&(i[this._runCommandParam]={type:"string"});n.parameters=i;n.resources=[{type:"Microsoft.Web/sites",name:"[parameters('name')]",
properties:{siteConfig:{appSettings:r,appCommandLine:t.appCommandLine()?t.appCommandLine():"",windowsFxVersion:o.XenonStackVersion.WindowsFxVersion.format(o.Docker.docker,t.imageName())}}}]},t})(h.ResourceBase);t.XenonResource=c}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanWithXenon",["require","exports","o","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlan","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/XenonResource"],
(function(n,t,i,r,u,f,e){"use strict";i.defineProperty(t,"__esModule",{value:!0});var o=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u.aspKey="asp",u.xenonSetup="xenonSetup",u}return __extends(t,n),t.prototype.SetupForm=function(n,t){var u=new r.AppServicePlanResource(this.container,this.form,this._dataContext),i;u.SetupForm({HostingEnvironmentId:n.HostingEnvironmentId,premiumApp:!!n&&!!n.premiumApp,isLinux:!1,isXenon:!0,forbiddenSkus:n&&n.forbiddenSkus,forbiddenComputeMode:n&&n.forbiddenComputeMode},t);this.resources[this.aspKey]=u;this.generalSection.children.push(u.generalSection);i=new e.XenonResource(this.container,this.form,this._dataContext);t.linuxInfo=i.GetObject();i.SetupForm(n,t);this.resources[this.xenonSetup]=i;this.generalSection.children.push(i.generalSection)},t.prototype.GetParametersValues=function(){var n=this.resources[this.aspKey].GetParametersValues(),t=this.resources[this.xenonSetup].GetParametersValues();return f.mergeObjects(n,t)},t.prototype.
GetResourceTemplate=function(n){var t=this.resources[this.aspKey].GetResourceTemplate(n),i=this.resources[this.xenonSetup].GetResourceTemplate(n);return f.mergeObjects(t,i)},t.prototype.getImportantData=function(){var n=this.resources[this.aspKey].getImportantData(),t=this.resources[this.xenonSetup].getImportantData();return f.mergeObjects(n,t)},t.prototype.FinalValidation=function(){return this.resources[this.aspKey].FinalValidation()},t})(u.ResourceBase);t.AppServicePlanWithXenon=o}));define("WebsitesExtension/TypeScript/CreateV2/Utilities",["require","exports","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i){"use strict";var r;return (function(n){function t(t){!n.bladeReference||n.bladeReference.title(t)}function r(){!n.bladeReference||n.bladeReference.setUnauthorized()}function u(){var r=window.navigator.userAgent,t=window.navigator.platform,n=null;return["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)!==-1?n=i.OSNames.macos:["iPhone","iPad","iPod"].indexOf(
t)!==-1?n=i.OSNames.ios:["Win32","Win64","Windows","WinCE"].indexOf(t)!==-1?n=i.OSNames.windows:/Android/.test(r)?n=i.OSNames.android:!n&&/Linux/.test(t)&&(n=i.OSNames.linux),n}n.bladeReference=null;n.setBladeTitle=t;n.setBladeUnauthorized=r;n.getUserOS=u})(r||(r={})),r}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanUnifiedOS",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlan",
"WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanWithLinux","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanWithXenon","WebsitesExtension/TypeScript/CreateV2/Models/MessageDispatchModel","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/CreateV2/Utilities"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";r.defineProperty(t,"__esModule",{value:!0});var w=i.ViewModels.Forms,b=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u.selectedPlanType="",u.linuxCreateEnabled=!0,u.isFunction=!1,u.linuxVal="linux",u.windowsVal="windows",u.xenonVal="xenon",u.dockerVal="docker",u}return __extends(t,n),t.prototype.SetupForm=function(n,t){var r=this,s;this.servicePlanTypeDown=new w.OptionsGroup.ViewModel(this.container,{label:u.observable("OS"),validations:u.observableArray(
[new i.ViewModels.RequiredValidation(e.Wizard.Validation.required)]),labelPosition:u.observable(w.LabelPosition.Left)});n.isXenonBYOC||this.servicePlanTypeDown.options.push({text:u.observable(f.windows),value:this.windowsVal});this.linuxCreateEnabled=this.linuxEnabled(n);this.linuxCreateEnabled&&this.form.notHasEnvironmentFlag(o.EnvFeature.DisableLinuxCreates)&&(this.servicePlanTypeDown.options.push({text:n.appKind===o.KindsAvailable.Functions?u.observable(f.functionsLinux):u.observable(f.linux),value:this.linuxVal}),n.isXenonBYOC||this.servicePlanTypeDown.options.push({text:u.observable(f.QS.Lang.docker),value:this.dockerVal}));n.isXenonBYOC&&this.servicePlanTypeDown.options.push({text:u.observable(f.windowsContainer),value:this.windowsVal});this.generalSection.children.push(this.servicePlanTypeDown);this.resources[this.windowsVal]=this.getWindowsResource(n,t);this.resources[this.linuxVal]=this.getLinuxResource(n,t);this.resources[this.xenonVal]=this.getXenonResource(n,t);n.isXenonBYOC||
(this.resources[this.dockerVal]=this.getDockerResource(n,t));this.servicePlanTypeDown.value.subscribe(this.container,(function(t){n.isXenonBYOC&&t==r.windowsVal&&(t=r.xenonVal);r.updateResource(t)}));s=p.getUserOS();(n.isXenonBYOC||s!==o.OSNames.windows)&&this.linuxCreateEnabled?this.servicePlanTypeDown.value(this.linuxVal):this.servicePlanTypeDown.value(this.windowsVal)},t.prototype.updateResource=function(n){this.CloseAnyBlades();this.generalSection.children.remove(this.resources[this.windowsVal].generalSection);this.generalSection.children.remove(this.resources[this.linuxVal].generalSection);this.generalSection.children.remove(this.resources[this.xenonVal].generalSection);this.resources[this.dockerVal]&&this.generalSection.children.remove(this.resources[this.dockerVal].generalSection);this.generalSection.children.push(this.resources[n].generalSection);this.selectedPlanType=n;this.resources[n].TurnOn();this.sendMessageToResources(n)},t.prototype.linuxEnabled=function(n){return!y.hasFeature(
this.form.features(),o.EnvFeature.DisableLinux)&&this.form.notHasEnvironmentFlag(o.EnvFeature.DisableLinuxCreates)||n.isLinuxBYOC},t.prototype.sendMessageToResources=function(n){var t=new v.UnifiedOSChangeMessage(n===this.linuxVal||n===this.dockerVal);t.isXenon=n===this.xenonVal;this.form.SendMessageToResources(t)},t.prototype.getLinuxResource=function(n,t){var i=new l.AppServicePlanWithLinux(this.container,this.form,this._dataContext);return i.SetupForm(n,t),i},t.prototype.getDockerResource=function(n,t){var i=new l.AppServicePlanWithLinux(this.container,this.form,this._dataContext);return i.SetupForm({isLinuxBYOC:!0,isFunction:this.isFunction},t),i},t.prototype.getXenonResource=function(n,t){var i=new a.AppServicePlanWithXenon(this.container,this.form,this._dataContext);return i.SetupForm(n,t),i},t.prototype.getWindowsResource=function(n,t){var i=new h.AppServicePlanResource(this.container,this.form,this._dataContext);return i.SetupForm({HostingEnvironmentId:n.HostingEnvironmentId,premiumApp:
!!n&&!!n.premiumApp,isLinux:!1,forbiddenSkus:n&&n.forbiddenSkus,forbiddenComputeMode:n&&n.forbiddenComputeMode},t),i},t.prototype.SetDefaults=function(n,t){var f=this.servicePlanTypeDown.value(),r=[],u,i;for(u in this.resources)r.push(this.resources[u].SetDefaults(n,t));return i=this.servicePlanTypeDown,this.linuxCreateEnabled&&this.form.notHasEnvironmentFlag(o.EnvFeature.DisableLinuxCreates)?this.generalSection.children.indexOf(i)===-1&&this.generalSection.children.push(this.servicePlanTypeDown):(i.value(this.windowsVal),this.generalSection.children.remove(i)),Q.all(r)},t.prototype.GetParametersValues=function(){return s.logTelemetry("Create ASP With Swapper","PlanType="+this.selectedPlanType),this.resources[this.selectedPlanType].GetParametersValues()},t.prototype.GetResourceTemplate=function(){return this.resources[this.selectedPlanType].GetResourceTemplate(null)},t.prototype.getImportantData=function(){return this.resources[this.selectedPlanType].getImportantData()},t.prototype.FinalValidation=
function(){return this.resources[this.selectedPlanType].FinalValidation()},t})(c.ResourceBase);t.AppServicePlanUnifiedOS=b}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanUnifiedOSFunctions",["require","exports","o","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanUnifiedOS","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanSwapper","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LinuxFunction","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Utility/Utility.Website",
"WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanSwapperLinux"],(function(n,t,i,r,u,f,e,o,s){"use strict";i.defineProperty(t,"__esModule",{value:!0});var h=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u.isFunction=!0,u}return __extends(t,n),t.prototype.SetupForm=function(t,i){n.prototype.SetupForm.call(this,t,i)},t.prototype.getLinuxResource=function(n,t){var i;return o.forFeature(e.FeatureFlags.DynamicLinuxFunction)?(i=new s.AppServicePlanSwapperLinux(this.container,this.form,this._dataContext),i.SetupForm(n,t),i):(i=new f.LinuxFunction(this.container,this.form,this._dataContext),i.SetupForm(n,t),i)},t.prototype.sendMessageToResources=function(){},t.prototype.getWindowsResource=function(n,t){var i=new u.AppServicePlanSwapper(this.container,this.form,this._dataContext);return i.SetupForm(n,t),i},t.prototype.GetResourceTemplate=function(){var n=this.servicePlanTypeDown.value();return this.resources[n].GetResourceTemplate(null)}
,t})(r.AppServicePlanUnifiedOS);t.AppServicePlanUnifiedOSFunctions=h}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppSettings",["require","exports","f","o","ko","$","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/Environment/RuntimeType"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";r.defineProperty(t,"__esModule",{value:!0});var l=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f.msDeploySettings=
u.observable(null),f._formCompleted=u.observable(!1),f._appSettingValues=u.observable(null),f._mysqlDB=!1,f._sqlDB=!1,f}return __extends(t,n),t.prototype.GetObject=function(){return this.msDeploySettings},t.prototype.CloseAnyBlades=function(){this.appSettingsSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(n){var t=this,r=n.msDeploySettings;this._mysqlDB=!!n.mysql;this._sqlDB=!!n.sql;this.msDeploySettings(r);this.appSettingsSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,this.form,"appSettings",{label:u.observable(o.Wizard.Steps.AppSettings.title),displayText:u.pureComputed((function(){var n=t._anySettingIsRequired()?o.requiredFieldShow:o.optionalFieldShow;return t._formCompleted()?o.completedFieldShow:n}))});this.appSettingsSelector.validations.push(new i.ViewModels.CustomValidation("",function(n){return Q(t._validateAppSetting(n))}));this.appSettingsCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){return s.logCreateStep(
t._dataContext.objectCache,"App Settings Blade Opened","Required={0}".format(t._anySettingIsRequired())),t.msDeploySettings},supplyProviderConfig:function(){return null},receiveResult:function(n){s.logCreateStep(t._dataContext.objectCache,"App Settings Blade Closed");t._formCompleted(!0);t._appSettingValues(n);t.appSettingsSelector.triggerValidation()},selectable:this.appSettingsSelector.selectable});r.parameters&&(this.generalSection.children.push(this.appSettingsSelector),this.appSettingsSelector.selectable.selectedValue({detailBlade:"WebAppSettingsBlade",detailBladeInputs:{}}),this.container.registerSelectable(this.container,"AppSettingsChevron",this.appSettingsSelector.selectable,{parameterCollector:this.appSettingsCollector}))},t.prototype._validateAppSetting=function(){var t=f.Deferred(),n=!0,i,r;return this._anySettingIsRequired()&&!this._formCompleted()&&(n=!1),this._sqlDB&&(r=this.dataModel().database()&&this.dataModel().database().administratorLogin(),this._getSQLUsernameValue(
)===r&&(n=!1,i=e.sqlUsernameError)),this.appSettingsSelector.validate(0),t.resolve({valid:n,message:i}),t.promise()},t.prototype._anySettingIsRequired=function(){var t=!1,i,n;for(i in this.msDeploySettings().parameters)n=this.msDeploySettings().parameters[i],n.constraints&&n.constraints.required&&(n.type==="password"||!n.defaultValue)&&(t=!0);return t},t.prototype._getSQLUsernameValue=function(){var n,i,t;for(n in this.msDeploySettings().parameters)if(i=this.msDeploySettings().parameters[n],i.nonAdminUsername&&(t=this._appSettingValues(),t[n]&&t[n]()))return t[n]();return""},t.prototype.GetParametersValues=function(){return{}},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[{name:"[parameters('name')]",type:"Microsoft.Web/sites",resources:[this._getMsDeployJson()]}]};return this.msDeploySettings().appSettingsToSet&&n.resources[0].resources.push(this._getAppConfigSettings()),n},t.prototype._getAppConfigSettings=function(){var n={apiVersion:this.antaresApiVersion,
type:"config",name:"web",dependsOn:["[concat('Microsoft.Web/sites/', parameters('name'))]","[concat('Microsoft.Web/Sites/', parameters('name'), '/Extensions/MSDeploy')]"],properties:{}};for(var t in this.msDeploySettings().appSettingsToSet)n.properties[t]=this.msDeploySettings().appSettingsToSet[t];return n},t.prototype._getMsDeployJson=function(){var n={apiVersion:this.antaresApiVersion,name:"MSDeploy",type:"Extensions",dependsOn:["[concat('Microsoft.Web/Sites/', parameters('name'))]"],properties:{packageUri:this.msDeploySettings().msDeployPackage,dbType:"None",connectionString:"",setParameters:{}}},i,u,f,t,r,e;if(this.dataModel().database&&this.dataModel().database()&&(c.isOnPrem()?this.dataModel().database().settingsHint()==="sql"?(n.properties.dbType="Sql",n.properties.connectionString="[concat('Data Source=tcp:', parameters('DBServer'), ',1433;Initial Catalog=', parameters('databaseName'), ';User Id=', parameters('databaseUsername'), ';Password=', parameters('databasePassword'), ';')]"):
this.dataModel().database().settingsHint()==="mysql"&&(n.properties.dbType="MySQL",n.properties.connectionString="[concat('Server=', parameters('DBServer'), ';Database=', parameters('databaseName'), ';Uid=', parameters('databaseUsername'), ';Pwd=', parameters('databasePassword'), ';')]"):this._sqlDB&&(n.properties.dbType="SQL",this.dataModel().database().isNewDatabase()&&n.dependsOn.push("[concat('Microsoft.Sql/servers/', parameters('serverName'),'/databases/', parameters('databaseName'))]"),n.properties.connectionString=this.dataModel().database().isNewServer()?"[concat('Data Source=tcp:', reference(concat('Microsoft.Sql/servers/', parameters('serverName'))).fullyQualifiedDomainName, ',1433;Initial Catalog=', parameters('databaseName'), ';User Id=', parameters('administratorLogin'), '@', parameters('serverName'), ';Password=', parameters('administratorLoginPassword'), ';')]":"[concat('Data Source=tcp:', parameters('DBServer'), ',1433;Initial Catalog=', parameters('databaseName'), ';User Id=', parameters('administratorLogin'), '@', parameters('serverName'), ';Password=', parameters('administratorLoginPassword'), ';')]")),
i=this._appSettingValues(),i)for(u in i)n.properties.setParameters[u.charAt(0).toUpperCase()+u.slice(1)]=i[u]();else{i=this.msDeploySettings().parameters;for(f in i)n.properties.setParameters[f.charAt(0).toUpperCase()+f.slice(1)]=i[f].defaultValue}for(t in this.msDeploySettings().hiddenParameters)r=this.msDeploySettings().hiddenParameters[t],r.type==="db"?this.dataModel().database&&this.dataModel().database()&&(e=this.dataModel().database(),this._sqlDB?n.properties.setParameters[t.charAt(0).toUpperCase()+t.slice(1)]=this.dataModel().database().isNewServer()?r.newSQLValue:r.oldSqlDBValue:this._mysqlDB&&(n.properties.setParameters[t.charAt(0).toUpperCase()+t.slice(1)]=e.newDB()?r.newMySQLDBValue:r.oldDBValue)):n.properties.setParameters[t.charAt(0).toUpperCase()+t.slice(1)]=r.value;return n},t})(h.ResourceBase);t.AppSettings=l}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)
t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/BotAppKind",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var h=i.ViewModels.Forms,c=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._kind=e.ServerFarmTypes.classic,u}return __extends(t,n),t.prototype.SetupForm=function(n){this._botAppVersionOptions=new h.OptionsGroup.ViewModel(this.container,{label:u.observable(f.botAppVersion),validations:u.observableArray([new i.ViewModels.RequiredValidation(o.Wizard.Validation.required)]),
labelPosition:u.observable(h.LabelPosition.Left)});this._botAppVersionOptions.options([{text:u.observable("V1"),value:1},{text:u.observable("V2"),value:2}]);this._botAppVersionOptions.value(1);n.enableBotsV2&&this.generalSection.children.push(this._botAppVersionOptions)},t.prototype.recieveDispatchMessage=function(n){if(n.message===e.CreateMessageTypes.AppSerivcePlanTypeChange){var t=n;this._kind=t.SfType}},t.prototype.GetResourceTemplate=function(){var n=this._botAppVersionOptions.value()==2?e.KindsAvailable.Botsv2:e.KindsAvailable.Bots,t=this._kind===e.ServerFarmTypes.dynamic?e.KindsAvailable.Functions+","+n:e.KindsAvailable.WebApp+","+n;return{parameters:{},resources:[{name:"[parameters('name')]",type:"Microsoft.Web/sites",kind:t}]}},t})(s.ResourceBase);t.BotAppKind=c}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i)
{function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/CloneSettings",["require","exports","f","o","ko","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","Websites/ClientResources/GeneralResources"],(function(n,t,i,r,u,f,e,o){"use strict";r.defineProperty(t,"__esModule",{value:!0});var s=i.ViewModels.Forms,h=(function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.GetObject=function(){return u.observable({cloneSourceControl:u.observable(!0),cloneCustomHostNames:u.observable(!1),cloneAppSettings:u.observable(!0),cloneConnectionStrings:u.observable(!0)})},t.prototype.SetupForm=function(n){var t=this;this._sourceSite=n;this.cloneSettingsSelector=new s.Selector.ViewModel(this.container,{label:u.observable(o.CloneSettings.
title)});this.cloneSettingsCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){return t.dataModel().cloningInfo()},receiveResult:function(n){t.dataModel().cloningInfo(n)},selectable:this.cloneSettingsSelector.selectable});this.generalSection.children.push(this.cloneSettingsSelector);this.cloneSettingsSelector.selectable.selectedValue({detailBlade:f.BladeNames.cloneSettings,detailBladeInputs:{}});this.container.registerSelectable(this.container,"cloneSettingsChevron",this.cloneSettingsSelector.selectable,{parameterCollector:this.cloneSettingsCollector})},t.prototype.GetParametersValues=function(){return{}},t.prototype.GetResourceTemplate=function(){var n=this._getSiteTemplate();return this.dataModel().cloningInfo().cloneAppSettings()?delete n.resources[0].properties.cloningInfo.appSettingsOverrides:n.resources[0].properties.cloningInfo.appSettingsOverrides={},n},t.prototype._getSiteTemplate=function(){return{resources:[{name:"[parameters('name')]",
type:"Microsoft.Web/sites",properties:{cloningInfo:{SourceWebAppId:this._sourceSite,CloneSourceControl:this.dataModel().cloningInfo().cloneSourceControl(),CloneCustomHostNames:this.dataModel().cloningInfo().cloneCustomHostNames()}}}]}},t})(e.ResourceBase);t.CloneSettings=h}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/GithubDeployment",["require","exports","f","o","a","ko","$","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],
(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";r.defineProperty(t,"__esModule",{value:!0});var l=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u.appSettings=f.observable(null),u._formCompleted=f.observable(!1),u._appSettingValues=f.observable(null),u}return __extends(t,n),t.prototype.GetObject=function(){return this.appSettings},t.prototype.CloseAnyBlades=function(){this.appSettingsSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(n){var t=this;this.appSettings(n);this.appSettingsSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,{label:f.observable(o.Wizard.Steps.AppSettings.title),displayText:f.pureComputed((function(){var n=t._anySettingIsRequired()?o.requiredFieldShow:o.optionalFieldShow;return t._formCompleted()?o.completedFieldShow:n}))});this.appSettingsSelector.validations.push(new i.ViewModels.CustomValidation("",function(n){return Q(t._validateAppSetting(n))}));this.appSettingsCollector=new i.ViewModels.ParameterCollector(this.
container,{supplyInitialData:function(){return h.logCreateStep(t._dataContext.objectCache,"App Settings Blade Opened","Required={0}".format(t._anySettingIsRequired())),t.appSettings},supplyProviderConfig:function(){return null},receiveResult:function(n){h.logCreateStep(t._dataContext.objectCache,"App Settings Blade Closed");t._formCompleted(!0);t._appSettingValues(n);t.appSettingsSelector.triggerValidation()},selectable:this.appSettingsSelector.selectable});n.parameters&&(this.generalSection.children.push(this.appSettingsSelector),this.appSettingsSelector.selectable.selectedValue({detailBlade:"WebAppSettingsBlade",detailBladeInputs:{}}),this.container.registerSelectable(this.container,"GithubChevron",this.appSettingsSelector.selectable,{parameterCollector:this.appSettingsCollector}))},t.prototype._validateAppSetting=function(){var n=e.Deferred(),t=!0,i;return this._anySettingIsRequired()&&!this._formCompleted()&&(t=!1),n.resolve({valid:t,message:i}),n.promise()},t.prototype._anySettingIsRequired=
function(){var t=!1,i,n;for(i in this.appSettings().parameters)n=this.appSettings().parameters[i],n.constraints&&n.constraints.required&&(n.type==="password"||!n.defaultValue)&&(t=!0);return t},t.prototype.GetParametersValues=function(){return{}},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[{name:"[parameters('name')]",type:"Microsoft.Web/sites",properties:{siteConfig:{appSettings:this._getAppSettings()}},resources:[this._getSourceControlsJson()]}]};return this.appSettings().appSettingsToSet&&this._getAppConfigSettings(n.resources[0].properties),n},t.prototype._getAppConfigSettings=function(n){for(var t in this.appSettings().appSettingsToSet)n.siteConfig[t]=this.appSettings().appSettingsToSet[t]},t.prototype._getAppSettings=function(){var t=[],n=this._appSettingValues(),i,r;if(n)for(i in n)t.push({name:i,value:n[i]()});else{n=this.appSettings().parameters;for(r in n)t.push({name:r,value:n[r].defaultValue})}return t},t.prototype._getSourceControlsJson=function(
){return{apiVersion:s.Asset.AntaresApiVersion,name:"web",type:"sourcecontrols",dependsOn:["[resourceId('Microsoft.Web/Sites', parameters('name'))]"],properties:{RepoUrl:this.appSettings().gitHubDeployment.repoUrl,branch:this.appSettings().gitHubDeployment.branch,IsManualIntegration:!0}}},t})(c.ResourceBase);t.GithubDeployment=l}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LocalMySqlResource",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],
(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var h=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._autoscaleObjectsView=r.componentsData.AutoscaleQuery.createView(t),u}return __extends(t,n),t.prototype.SetupForm=function(){var n=new i.ViewModels.Controls.InfoBox.LinkViewModel(this.container,{image:u.observable(i.Base.Images.Polychromatic.Info()),text:u.observable(f.localMySqlWarning),clickableLink:u.observable(new i.ViewModels.ClickableLink(u.observable(o.LocalMySQL.mySqlInfoURL)))}),t={htmlTemplate:u.observable("<div data-bind='pcControl: box'><\/div>"),label:u.observable(null),innerViewModel:{box:n},labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top)};this._localMySqlInfobox=new i.ViewModels.Forms.CustomHtml.ViewModel(this.container,t)},t.prototype.SetDefaults=function(n,t){if(this.form.notHasEnvironmentFlag(o.EnvFeature.DisableCreateComponents))return this._autoscaleObjectsView.fetch(t.subscriptionId)},t.prototype.
TurnOff=function(){this.form.infoBoxSection.children.remove(this._localMySqlInfobox)},t.prototype.TurnOn=function(){this.form.infoBoxSection.children.indexOf(this._localMySqlInfobox)===-1&&this.form.infoBoxSection.children.push(this._localMySqlInfobox)},t.prototype.GetResourceTemplate=function(){return{parameters:{},resources:[this._getSiteJson()]}},t.prototype.FinalValidation=function(){var n=this.form.getResourceData(o.Create.AppServicePlanResourceType),t,i;return n?!this.form.notHasEnvironmentFlag(o.EnvFeature.FreeOnly)||!this.form.notHasEnvironmentFlag(o.EnvFeature.DisableCreateComponents)?Q({valid:!0,message:""}):n.id?(t=this._autoscaleObjectsView.items().first((function(t){return t.properties&&t.properties().targetResourceUri&&t.properties().targetResourceUri()===n.id})),i=!!t&&!!t.properties&&!!t.properties().enabled&&t.properties().enabled(),i)?Q({valid:!1,message:f.CreateValidation.autoScaleEnabledLocalMysql}):!!n.instances&&n.instances>1?Q({valid:!1,message:f.CreateValidation.multiInstanceLocalMysql}):
Q({valid:!0,message:""}):Q({valid:!0,message:""}):(e.logError("App service plan validated in LocalMySQL but no app service plan exist"),Q({valid:!0,message:""}))},t.prototype._getSiteJson=function(){return{name:"[parameters('name')]",type:"Microsoft.Web/sites",properties:{name:"[parameters('name')]",siteConfig:{localMySqlEnabled:!0}}}},t})(s.ResourceBase);t.LocalMySqlResource=h}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/MySqlResource",["require","exports","f","o","ko","$","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],
(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var h=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f.SqlDbData=u.observable(null),f}return __extends(t,n),t.prototype.GetObject=function(){return this.SqlDbData},t.prototype.CloseAnyBlades=function(){this.SqlDbSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(){var n=this;this.SqlDbSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,this.form,"database",{label:u.observable(e.databaseLabel),displayText:u.pureComputed((function(){return!!n.dataModel()&&!!n.dataModel().database()&&!!n.dataModel().database().database()&&!!n.dataModel().database().database().name()?n.dataModel().database().database().name():e.databaseRequired}))});this.SqlDbSelector.validations.push(new i.ViewModels.CustomValidation("",function(t){return Q(n._validateSQLDbConfirmValue(t))}));this.SqlDbSelector.validations.push(new i.ViewModels.RequiredValidation(""));this.SqlDbCollector=new
i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){if(!n.dataModel||!n.dataModel()||!n.dataModel().database||!n.dataModel().database())return{};var t={id:n.dataModel().database().database().id(),name:n.dataModel().database().database().name(),location:n.dataModel().database().database().location(),edition:n.dataModel().database().database().edition(),collation:n.dataModel().database().database().collation(),maxSizeBytes:n.dataModel().database().database().maxSizeBytes()};return{username:n.dataModel().database().username(),password:n.dataModel().database().password(),serverName:n.dataModel().database().serverName(),database:t}},supplyProviderConfig:function(){return{subscriptionId:n.form.subscriptionSelector.value().subscriptionId,dbType:o.DatabaseTypes.mySql}},receiveResult:function(t){n.dataModel().database({settingsHint:u.observable("mysql"),newDB:u.observable(!1),username:u.observable(t.username),password:u.observable(t.password),serverName:u.observable(t.serverName),
serverFullyQualifiedDomainName:u.observable(t.serverName),database:u.observable({id:u.observable(t.database.id),name:u.observable(t.database.name),location:u.observable(t.database.location),edition:u.observable(t.database.edition),collation:u.observable(t.database.collation),maxSizeBytes:u.observable(t.database.maxSizeBytes)})})},selectable:this.SqlDbSelector.selectable});this.generalSection.children.push(this.SqlDbSelector);this.container.registerSelectable(this.container,"MySqlDBChevron",this.SqlDbSelector.selectable,{parameterCollector:this.SqlDbCollector})},t.prototype._validateSQLDbConfirmValue=function(){var n=f.Deferred(),t=!0,i;return t=!this.dataModel()||!this.dataModel().database()||!this.dataModel().database().database()||!this.dataModel().database().database().name()?!1:!0,n.resolve({valid:t,message:i}),n.promise()},t.prototype.SetDefaults=function(n){return n.database({settingsHint:u.observable("mysql"),username:u.observable(null),password:u.observable(null),serverName:u.observable(
null),serverFullyQualifiedDomainName:u.observable(null),database:u.observable({id:u.observable(null),name:u.observable(null),location:u.observable(null),edition:u.observable(null),collation:u.observable(null),maxSizeBytes:u.observable(0)})}),this.SqlDbSelector.selectable.selectedValue({detailBlade:"DatabaseInput",detailBladeInputs:{}}),Q.resolve(null)},t.prototype.GetParametersValues=function(){return{databaseName:this.dataModel().database().database().name().split("/").last(),DBServer:this.dataModel().database().serverFullyQualifiedDomainName(),databaseUsername:this.dataModel().database().username(),databasePassword:this.dataModel().database().password(),dbSubscriptionId:this.dataModel().subscription().subscriptionId,dbResourceGroup:i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(this.dataModel().database().database().id()).resourceGroup}},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[]};return n.parameters={databaseName:{type:"string"},DBServer:
{type:"string"},databaseUsername:{type:"string"},databasePassword:{type:"securestring"},dbSubscriptionId:{type:"string"},dbResourceGroup:{type:"string"}},n.resources=[this._getSiteResource()],n},t.prototype._getSiteResource=function(){return{name:"[parameters('name')]",type:"Microsoft.Web/sites",tags:{"[concat('hidden-link:/subscriptions/', parameters('dbSubscriptionId'), '/resourcegroups/', parameters('dbResourceGroup'), '/providers/Microsoft.Sql/databases/', parameters('databaseName'))]":"empty"},properties:{siteConfig:{connectionStrings:[{name:"defaultConnection",ConnectionString:"[concat('Server=', parameters('DBServer'), ';Database=', parameters('databaseName'), ';Uid=', parameters('databaseUsername'), ';Pwd=', parameters('databasePassword'), ';')]",type:"MySQL"}]}}}},t})(s.ResourceBase);t.MySqlDB=h}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&
(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/OrcasBaseResource",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/CreateV2/Models/OrcasMySqlModels","Fx/Controls/DropDown"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u._hasMsDeploy=!1,u.DBBladeName="CreateMySqlServerFromWebAppBlade",u.ResourceName=e.ResourceTypes.OrcasDB,u.ChevronId="OrcasMySqlDBChevron",u.ConnectionStringType=e.DatabaseTypes.mySql,u.MySqlLocationLabel=f.microsoftmysqllocation,u.MySqlLocationInfo=f.microsoftmysqllocationinfo,
u.DNSSuffix=e.DatabaseDNS.MySqlOrcas,u.serverString="Data Source",u._locationsArmView=u._dataContext.locations.OrcasLocationQuery.createView(t,{interceptNotFound:!1}),u}return __extends(t,n),t.prototype.GetObject=function(){return u.observable()},t.prototype.CloseAnyBlades=function(){this.OrcasDbSelector.selectable.isSelected(!1)},t.prototype.OrcasDbData=function(){return this.OrcasDbSelector.value()},t.prototype.SetupForm=function(n){var t=this,r;this._hasMsDeploy=!!n.msDeploySettings;this.OrcasDbSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,{label:u.observable(f.databaseLabel),displayText:u.pureComputed((function(){return!t.OrcasDbData()?f.databaseRequired:t.OrcasDbData().serverName()})),validations:u.observableArray([new i.ViewModels.RequiredValidation])});this.OrcasDbCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){var n=t.form.getResourceData(e.Create.AppServicePlanResourceType);n=n&&n.location;var r=!!n&&t._locationsArmView.
items().map((function(n){return n.toLowerCase().replaceAll(" ","")})).indexOf(n.toLowerCase().replaceAll(" ",""))>-1,u=t.dataModel().name(),i=new s.CreateOrcasMySqlModel;return i.serverName(u),i.subscription(t.form.subscriptionSelector.value().subscriptionId),i.resourceGroup(t.form.resourceGroupDropdown.value().createNew?"":t.form.resourceGroupDropdown.value().value.name),i.regionId(r?n:"West US"),i},receiveResult:function(n){var i=t.form.getResourceData(e.Create.AppServicePlanResourceType);i=i&&i.location;i!==n.regionId()&&n.regionId("");t.OrcasDbSelector.value(n);t.generalSection.children.remove(t._locationPicker);t._locationsArmView.items().indexOf(t.OrcasDbData().regionId())===-1&&t.OrcasDbData().isCreatingNewServer()&&t.generalSection.children.push(t._locationPicker)},supplyProviderConfig:function(){},selectable:this.OrcasDbSelector.selectable});r={items:u.observableArray([]),label:u.observable(this.MySqlLocationLabel),infoBalloonContent:u.observable(this.MySqlLocationInfo),validations:
u.observableArray([new i.ViewModels.RequiredValidation("")])};this._locationPicker=new h.ViewModel(this.container,{items:u.observableArray([]),label:u.observable(this.MySqlLocationLabel),infoBalloonContent:u.observable(this.MySqlLocationInfo),validations:u.observableArray([new i.ViewModels.RequiredValidation("")])});this.OrcasDbSelector.selectable.selectedValue({detailBlade:this.DBBladeName,extension:"SqlAzureExtension",detailBladeInputs:{}});this.form.resourceGroupDropdown.value.subscribe(this.container,(function(){t.OrcasDbData()&&!t.OrcasDbData().isCreatingNewServer()&&(t.OrcasDbSelector.value(null),t.generalSection.children.remove(t._locationPicker))}));this.generalSection.children.push(this.OrcasDbSelector);this.container.registerSelectable(this.container,this.ChevronId,this.OrcasDbSelector.selectable,{parameterCollector:this.OrcasDbCollector})},t.prototype.recieveDispatchMessage=function(n){if(n.message===e.CreateMessageTypes.AppSerivcePlanChange){var t=n;this.OrcasDbData()&&this.OrcasDbData(
).isCreatingNewServer()&&(this.generalSection.children.remove(this._locationPicker),this.OrcasDbData().regionId(t.serverFarmData.Location()),this._locationsArmView.items().indexOf(this.OrcasDbData().regionId())===-1&&this.OrcasDbData().isCreatingNewServer()&&this.generalSection.children.push(this._locationPicker))}},t.prototype.SetDefaults=function(n,t){var i=this;return this._locationsArmView.fetch(t.subscriptionId).then((function(){i._locationPicker.items(i._locationsArmView.items().map((function(n){return{text:u.observable(n),value:n}})))}))},t.prototype.GetParametersValues=function(){return this.OrcasDbData().isCreatingNewServer()?this._getNewServerParameterValues():this.OrcasDbData().selectedServerOption().isCreatingNewDatabase()?this._getNewDatabaseExistingServerParameterValues():this._getExistingDatabaseParameterValues()},t.prototype.getDatabaseValues=function(){return{DATABASE_HOST:"[concat(parameters('serverName') ,'"+this.DNSSuffix+"')]",DATABASE_NAME:"[parameters('databaseName')]",
DATABASE_PASSWORD:"[parameters('administratorLoginPassword')]",DATABASE_USERNAME:"[concat(parameters('administratorLogin'),'@',parameters('serverName'))]"}},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[]};return this.OrcasDbData().isCreatingNewServer()?(n.parameters=this._getNewServerParameterTypes(),n.resources.push(this._getNewServerResource())):this.OrcasDbData().selectedServerOption().isCreatingNewDatabase()?(n.parameters=this._getNewDatabaseExistingServerParameterTypes(),n.resources.push(this._getNewDatabaseExistingServerResource())):n.parameters=this._getExistingDatabaseParameterTypes(),n.resources.push(this._getSiteObject()),n},t.prototype._getNewServerLocationProperty=function(){return this._locationsArmView.items().indexOf(this.OrcasDbData().regionId())===-1?this._locationPicker.value():this.OrcasDbData().regionId()},t.prototype._getNewServerParameterValues=function(){return{databaseName:this.OrcasDbData().creatingServerOption().firstDatabase().databaseName,
administratorLogin:this.OrcasDbData().creatingServerOption().administratorLogin(),administratorLoginPassword:this.OrcasDbData().creatingServerOption().administratorPassword(),mysqLocation:this._getNewServerLocationProperty(),serverName:this.OrcasDbData().serverName(),skuCapacity:this.OrcasDbData().creatingServerOption().skuData().skuCapacity(),skuFamily:this.OrcasDbData().creatingServerOption().skuData().skuFamily(),skuName:this.OrcasDbData().creatingServerOption().skuData().skuName(),skuSizeMB:this.OrcasDbData().creatingServerOption().skuData().skuSizeMB(),skuTier:this.OrcasDbData().creatingServerOption().skuData().skuTier(),storageMB:this.OrcasDbData().creatingServerOption().skuData().skuSizeMB(),backupRetentionDays:this.OrcasDbData().creatingServerOption().backupRetentionDays(),geoRedundantBackup:this.OrcasDbData().creatingServerOption().geoRedundantBackup(),version:this.OrcasDbData().creatingServerOption().version(),collation:this.OrcasDbData().creatingServerOption().firstDatabase(
).collation,charset:this.OrcasDbData().creatingServerOption().firstDatabase().characterSet}},t.prototype._getNewDatabaseExistingServerParameterValues=function(){return{databaseName:this.OrcasDbData().selectedServerOption().firstDatabase().databaseName,administratorLogin:this.OrcasDbData().selectedServerOption().administratorLogin(),administratorLoginPassword:this.OrcasDbData().selectedServerOption().administratorPassword(),mysqLocation:this.OrcasDbData().regionId(),serverName:this.OrcasDbData().serverName(),collation:this.OrcasDbData().selectedServerOption().firstDatabase().collation,charset:this.OrcasDbData().selectedServerOption().firstDatabase().characterSet}},t.prototype._getExistingDatabaseParameterValues=function(){return{databaseName:this.OrcasDbData().selectedServerOption().selectedDatabaseName(),administratorLogin:this.OrcasDbData().selectedServerOption().administratorLogin(),administratorLoginPassword:this.OrcasDbData().selectedServerOption().administratorPassword(),serverName:
this.OrcasDbData().serverName()}},t.prototype._getNewServerParameterTypes=function(){return{databaseName:{type:"string"},administratorLogin:{type:"string"},administratorLoginPassword:{type:"securestring"},mysqLocation:{type:"string"},serverName:{type:"string"},skuCapacity:{type:"int"},skuFamily:{type:"string"},storageMB:{type:"int"},backupRetentionDays:{type:"int"},geoRedundantBackup:{type:"string"},skuName:{type:"string"},skuSizeMB:{type:"int"},skuTier:{type:"string"},version:{type:"string"},charset:{type:"string"},collation:{type:"string"}}},t.prototype._getNewDatabaseExistingServerParameterTypes=function(){return{databaseName:{type:"string"},administratorLogin:{type:"string"},administratorLoginPassword:{type:"securestring"},mysqLocation:{type:"string"},serverName:{type:"string"},charset:{type:"string"},collation:{type:"string"}}},t.prototype._getExistingDatabaseParameterTypes=function(){return{databaseName:{type:"string"},administratorLogin:{type:"string"},administratorLoginPassword:
{type:"securestring"},serverName:{type:"string"}}},t.prototype._getNewDatabaseExistingServerResource=function(){return{name:"[concat(parameters('serverName'),'/',parameters('databaseName'))]",type:this.ResourceName+"/servers/databases",apiVersion:"2017-12-01-preview",properties:{charset:"[parameters('charset')]",collation:"[parameters('collation')]"}}},t.prototype._getNewServerResource=function(){return{name:"[parameters('serverName')]",type:this.ResourceName+"/servers",apiVersion:"2017-12-01-preview",location:"[parameters('mysqLocation')]",properties:{version:"[parameters('version')]",administratorLogin:"[parameters('administratorLogin')]",administratorLoginPassword:"[parameters('administratorLoginPassword')]",storageProfile:{storageMB:"[parameters('skuSizeMB')]",backupRetentionDays:"[parameters('backupRetentionDays')]",geoRedundantBackup:"[parameters('geoRedundantBackup')]"},sslEnforcement:"Disabled"},sku:{name:"[parameters('skuName')]",tier:"[parameters('skuTier')]",capacity:"[parameters('skuCapacity')]",
size:"[parameters('skuSizeMB')]",family:"[parameters('skuFamily')]"},resources:[{name:"AllowAll",type:"firewallrules",apiVersion:"2017-12-01-preview",properties:{startIpAddress:"0.0.0.0",endIpAddress:"255.255.255.255"},location:"[parameters('mysqLocation')]",dependsOn:["[concat('"+this.ResourceName+"/servers/', parameters('serverName'), '/databases/' , parameters('databaseName'))]","[concat('"+this.ResourceName+"/servers/', parameters('serverName'))]"]},{name:"[parameters('databaseName')]",type:"databases",apiVersion:"2017-12-01-preview",properties:{charset:"[parameters('charset')]",collation:"[parameters('collation')]"},dependsOn:["[concat('"+this.ResourceName+"/servers/', parameters('serverName'))]"]}]}},t.prototype._getSiteObject=function(){var i=this.OrcasDbData(),n=[],t;return this._hasMsDeploy&&n.push("[concat('Microsoft.Web/Sites/', parameters('name'), '/Extensions/MSDeploy')]"),t="[concat('Database=', parameters('databaseName'), ';"+this.serverString+"=', parameters('serverName') ,'"+
this.DNSSuffix+";User Id=',parameters('administratorLogin'),'@',parameters('serverName') ,';Password=',parameters('administratorLoginPassword'))]",{name:"[parameters('name')]",type:"Microsoft.Web/sites",dependsOn:n,properties:{siteConfig:{connectionStrings:[{name:"defaultConnection",ConnectionString:t,type:this.ConnectionStringType}]}}}},t})(o.ResourceBase);t.OrcasBaseResource=c}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/OrcasPostgresResource",["require","exports","o","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/OrcasBaseResource"],
(function(n,t,i,r,u,f){"use strict";i.defineProperty(t,"__esModule",{value:!0});var e=(function(n){function t(t,i,f){var e=n.call(this,t,i,f)||this;return e.DBBladeName="CreatePostgreSqlServerFromWebAppBlade",e.ChevronId="OrcasPostgresDBChevron",e.ResourceName=u.ResourceTypes.OrcasPostgre,e.ConnectionStringType=u.DatabaseTypes.PostgreSQL,e.MySqlLocationLabel=r.microsoftpostgrelocation,e.MySqlLocationInfo=r.microsoftpostgrelocationinfo,e.DNSSuffix=u.DatabaseDNS.Postgre,e.serverString="Server",e}return __extends(t,n),t})(f.OrcasBaseResource);t.OrcasPostgresResource=e}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/MySqlSwapper",[
"require","exports","f","o","ko","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LocalMySqlResource","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/OrcasBaseResource","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/OrcasPostgresResource","Fx/Controls/DropDown"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";r.defineProperty(t,"__esModule",{value:!0});var y=(function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.SetupForm=function(n){var t=this;this._props=n;this._dbTypes=n.mySqlTypes;this._infoBalloonContent=u.observable("");this.mySqlTypeDown=new v.ViewModel(this.container,
{label:u.observable(f.databaseProvider),infoBalloonContent:this._infoBalloonContent,validations:u.observableArray([new i.ViewModels.RequiredValidation(e.Wizard.Validation.required)])});this.mySqlTypeDown.items([]);this.mySqlTypeDown.value.subscribe(this.container,(function(n){t.generalSection.children.removeAll();for(var i in t.resources)t.resources.hasOwnProperty(i)&&t.resources[i].TurnOff();n!==null&&(t.generalSection.children.push(t.resources[n].generalSection),t.resources[n].TurnOn())}))},t.prototype.SetDefaults=function(n,t){var v=[],i="",r=[],e,s,c,y,p;this._dbTypes.indexOf(o.MySqlProviders.local)>-1&&(r.splice(0,0,{text:u.observable(f.localMySql),value:o.MySqlProviders.local}),this.resources[o.MySqlProviders.local]||(i="<li>"+f.dbSwapperChooserlocal+"<\/li>"+i,e=new h.LocalMySqlResource(this.container,this.form,this._dataContext),e.SetupForm(this._props,n),this.resources[o.MySqlProviders.local]=e));this._dbTypes.indexOf(o.MySqlProviders.orcas)>-1&&this.form.notHasEnvironmentFlag(o.
EnvFeature.FreeOnly)?(r.splice(0,0,{text:u.observable(f.microsoftmysql),value:o.MySqlProviders.orcas}),this.resources[o.MySqlProviders.orcas]||(i="<li>"+f.dbSwapperChooserorcas+"<\/li>"+i,s=new l.OrcasBaseResource(this.container,this.form,this._dataContext),s.SetupForm(this._props,n),this.resources[o.MySqlProviders.orcas]=s)):this._dbTypes.remove(o.MySqlProviders.orcas);this._dbTypes.indexOf(o.MySqlProviders.postgre)>-1&&this.form.notHasEnvironmentFlag(o.EnvFeature.FreeOnly)?(r.splice(0,0,{text:u.observable(f.microsoftmpostgre),value:o.MySqlProviders.postgre}),this.resources[o.MySqlProviders.postgre]||(c=new a.OrcasPostgresResource(this.container,this.form,this._dataContext),c.SetupForm(this._props,n),this.resources[o.MySqlProviders.postgre]=c)):this._dbTypes.remove(o.MySqlProviders.postgre);this.mySqlTypeDown.items(r);this._dbTypes.length>1?this.form.dropDownSection.children.indexOf(this.mySqlTypeDown)===-1&&(this.form.dropDownSection.children.push(this.mySqlTypeDown),y=r.first().value,
this.mySqlTypeDown.value(y)):this.mySqlTypeDown.value(this._dbTypes.first());this._infoBalloonContent("<ul>"+i+"<\/ul>");for(p in this.resources)v.push(this.resources[p].SetDefaults(n,t));return Q.all(v)},t.prototype.GetParametersValues=function(){var n=this.mySqlTypeDown.value();return this.resources[n].GetParametersValues()},t.prototype.FinalValidation=function(){var n=this.mySqlTypeDown.value();return this.resources[n].FinalValidation()},t.prototype.GetResourceTemplate=function(){var n=this.mySqlTypeDown.value();return s.logTelemetry("Database Created With Swapper","DatabaseType="+n),this.resources[n].GetResourceTemplate(null)},t})(c.ResourceBase);t.MySqlSwapper=y}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new
r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/OrcasLinux",["require","exports","o","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/MySqlSwapper"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.SetupForm=function(t,i){n.prototype.SetupForm.call(this,t,i);this.dbhost=t.dbsettings.DATABASE_HOST;this.dbname=t.dbsettings.DATABASE_NAME;this.dbpassword=t.dbsettings.DATABASE_PASSWORD;this.dbusername=t.dbsettings.DATABASE_USERNAME},t.prototype.GetResourceTemplate=function(t){var i=n.prototype.GetResourceTemplate.call(this,t);return r.mergeObjects(this.getLinuxAppResourceTemplate(),i)},t.prototype.getLinuxAppResourceTemplate=function(){var e=this.mySqlTypeDown.value(),t=this.resources[e],
i=this.dbname,r=this.dbhost,u=this.dbpassword,f=this.dbusername,n;return!t.getDatabaseValues||(n=t.getDatabaseValues(),r=n.DATABASE_HOST,u=n.DATABASE_PASSWORD,f=n.DATABASE_USERNAME,i=n.DATABASE_NAME),{resources:[{name:"[parameters('name')]",type:"Microsoft.Web/sites",properties:{siteConfig:{appSettings:[{name:"DATABASE_HOST",value:r},{name:"DATABASE_NAME",value:i},{name:"DATABASE_PASSWORD",value:u},{name:"DATABASE_USERNAME",value:f}]}}}]}},t})(u.MySqlSwapper);t.OrcasLinux=f}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/SiteResource",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","Websites/ClientResources/CreateResources",
"WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/Common/Validation/SiteValidators","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/CreateV2/Models/MessageDispatchModel","Fx/Controls/DropDown"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";r.defineProperty(t,"__esModule",{value:!0});var p=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f._hiddenAppConfigSettings=u.observable(null),f._hiddenVirtualApplicationSettings=u.observable(null),f._excludeInsightsComponent=!1,f._hideAI=!1,f._cachedComponentsView=r.componentsData.ComponentsQuery.createView(t),f._componentsLocationView=r.componentsData.ComponentsLocationsQuery.createView(t),f}return __extends(
t,n),t.prototype.SetupForm=function(n){var t=this,o=n.isFunctionApp,h=new c.SiteNameValidator,r;n.hiddenAppConfigSettings&&this._hiddenAppConfigSettings(n.hiddenAppConfigSettings);n.virtualApplications&&this._hiddenVirtualApplicationSettings(n.virtualApplications);this._excludeInsightsComponent=n.excludeComponents||n.isLinux||a.hasFeature(this.form.features(),s.EnvFeature.DisableApplicationInsights);this._hideAI=this._excludeInsightsComponent;r=new i.ViewModels.Forms.TextBox.ViewModel(this.container,this.form,"name",{showValidationMessagesBelowControl:!0,label:u.observable(e.Wizard.Steps.Website.title),emptyValueText:u.observable(e.webAppName),validations:u.observableArray([new i.ViewModels.RequiredValidation(f.websiteNameRequired),new i.ViewModels.CustomValidation("",function(n){return h.validate({value:n,subscriptionId:t.form.subscriptionSelector.value().subscriptionId,dnsSuffix:t.form.dnsSuffix()})})])});r.delayValidationTimeout(500);r.value.subscribe(this.container,(function(n){t.form.
SendMessageToResources(new v.AppNameChangeMessage(n))}));r.valueUpdateTrigger=4;this.form.nameSection.children.push(r);this._locationPicker=new y.ViewModel(this.container,{items:u.observableArray([]),label:u.observable(f.appInsightsLocation),infoBalloonContent:u.observable(f.appInsightsLocationInfo),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),validations:u.observableArray([new i.ViewModels.RequiredValidation("")])});this.form.notHasEnvironmentFlag(s.EnvFeature.DisableCreateComponents)?this._excludeInsightsComponent||(this._appInsightsToggle=new i.ViewModels.Forms.OptionsGroup.ViewModel(this.container,{label:u.observable(f.appInsights),infoBalloonContent:u.observable(f.appInsightsInfoBaloon),options:u.observableArray([{text:u.observable(f.on),value:!0},{text:u.observable(f.off),value:!1},]),defaultValue:u.observable(o),sizeToContent:!0,labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Left)}),this._appInsightsToggle.value.subscribe(this.container,(function(n)
{t._excludeInsightsComponent=!n;n?t.form.bottomSection.children.push(t._locationPicker):t.form.bottomSection.children.remove(t._locationPicker)})),this._excludeInsightsComponent=!o,this.form.bottomSection.children.push(this._appInsightsToggle),o&&this.form.bottomSection.children.push(this._locationPicker)):(this._excludeInsightsComponent=!0,this._hideAI=!0)},t.prototype.FinalValidation=function(){var i=this.form.subscriptionSelector.value().subscriptionId,n=this.form.resourceGroupDropdown.value(),t=this.form.getResourceData(s.Create.AppServicePlanResourceType),u,r;return!t||!t.id?Q({valid:!0,message:""}):(u=this.GetParametersValues(),r={name:u.name,type:s.ResourceTypes.AppResourceType,location:t.location,properties:{serverFarmId:t.id}},n.createNew?Q(this._dataContext.resourceGroups.createResourceGroup(i,n.value.name,this.form.getResourceGroupLocation())).then((function(){return o.callValidationApi(i,n.value.name,r)})):o.callValidationApi(i,n.value.name,r))},t.prototype.SetDefaults=function(
n,t){var i=this,r=null,f=null;return a.hasFeature(this.form.features(),s.EnvFeature.DisableCreateComponents)?(this.form.bottomSection.children.remove(this._appInsightsToggle),this.form.RemoveRpFromRegistration(s.ResourceTypes.InsightsProvider),this._hideAI=!0):(this.form.AddRpToRegistration(s.ResourceTypes.InsightsProvider),r=this._cachedComponentsView.fetch(t.subscriptionId),f=this._componentsLocationView.fetch(t.subscriptionId).then((function(){var n;if(i._locationPicker.items(i._componentsLocationView.items().map((function(n){return{text:u.observable(n),value:n}}))),i._locationPicker.items().length){var r=i._componentsLocationView.items()[0],t=i.form.getResourceData(s.Create.AppServicePlanResourceType).location,f=i._componentsLocationView.items();t?(n=f.first((function(n){return n.toLowerCase()===t.toLowerCase()})),n&&i._locationPicker.value(n)):i._locationPicker.value(r)}})),this._hideAI=!1),Q.all([r,f])},t.prototype.recieveDispatchMessage=function(n){var t;if((n.message===s.CreateMessageTypes.
AppSerivcePlanChange||n.message===s.CreateMessageTypes.DynamicASPLocationChange)&&!this._hideAI){var r=this.form.getResourceData(s.Create.AppServicePlanResourceType).location,u=this._componentsLocationView.items(),i=u.first((function(n){return n.toLowerCase()===r.toLowerCase()}));i&&this._locationPicker.value(i)}n.message===s.CreateMessageTypes.osChange&&(t=n,t.isLinux||t.isXenon?this._appInsightsToggle&&(this._appInsightsToggle.value(!1),this.form.bottomSection.children.remove(this._appInsightsToggle)):this._hideAI||this.form.bottomSection.children.push(this._appInsightsToggle))},t.prototype.GetParametersValues=function(){return{name:this.dataModel().name()}},t.prototype.GetResourceTemplate=function(){var r=this.dataModel().name(),u=this._cachedComponentsView.items().first((function(n){return n.name().toLowerCase()===r.toLowerCase()})),n={parameters:{name:{type:"string"}},resources:[]},t=this._getSiteJson(),i;return this._excludeInsightsComponent||(i=!u?"parameters('name')":"concat(parameters('name'), '-"+
o.Guid.newTinyGuid()+"')",n.resources.push(this._getComponentsJson(i)),t=l.mergeObjects(t,this._getSiteSettingsForComponents(i))),n.resources.push(t),n},t.prototype._getSiteSettingsForComponents=function(n){return{name:"[parameters('name')]",type:"Microsoft.Web/sites",dependsOn:["[resourceId('microsoft.insights/components/', "+n+")]"],properties:{siteConfig:{appSettings:[{name:"APPINSIGHTS_INSTRUMENTATIONKEY",value:"[reference(resourceId('microsoft.insights/components/', "+n+"), '2015-05-01').InstrumentationKey]"}]}}}},t.prototype._getSiteJson=function(){var n={apiVersion:this.antaresApiVersion,name:"[parameters('name')]",type:"Microsoft.Web/sites",properties:{name:"[parameters('name')]"}};return!this._hiddenAppConfigSettings()||!this._hiddenVirtualApplicationSettings()?this._hiddenAppConfigSettings()?n.properties.siteConfig={appSettings:this._hiddenAppConfigSettings()}:!this._hiddenVirtualApplicationSettings()||(n.properties.siteConfig={virtualApplications:this._hiddenVirtualApplicationSettings(
)}):n.properties.siteConfig={appSettings:this._hiddenAppConfigSettings(),virtualApplications:this._hiddenVirtualApplicationSettings()},n},t.prototype._getComponentsJson=function(n){return{apiVersion:"2015-05-01",name:"["+n+"]",type:"microsoft.insights/components",location:this._locationPicker.value(),tags:{"[concat('hidden-link:', resourceGroup().id, '/providers/Microsoft.Web/sites/', parameters('name'))]":"Resource"},properties:{ApplicationId:"[parameters('name')]",Request_Source:"IbizaWebAppExtensionCreate"}}},t})(h.ResourceBase);t.SiteResource=p}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/SqlResource",["require","exports",
"f","o","ko","$","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase","WebsitesExtension/TypeScript/CreateV2/Models/SqlAzureCreateDataModel"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f._existingDBResourceId=u.observable(""),f.hasMsDeploy=!1,i.AddRpToRegistration(o.ResourceTypes.SQLProvider),f._fqdnPromise=r.sqlData.sqlAccountFqdn.createView(t),f}return __extends(t,n),t.prototype.CloseAnyBlades=function(){this.sqlSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(n){var t=this;this.hasMsDeploy=!!n.msDeploySettings;this.sqlSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,this.form,"database",{label:u.observable(e.websiteAddResourceSQLAzure),displayText:u.pureComputed((function(){return!t.sqlSelector.value(
)?"":t.sqlSelector.value().databaseName()}))});this.sqlSelector.validations.push(new i.ViewModels.RequiredValidation(""));this.sqlSelector.validations.push(new i.ViewModels.CustomValidation("",function(n){return Q(t._validateDBConfirmPass(n))}));this.sqlCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){var n=new h.SqlAzureDataModel;return n.subscriptionId(t.form.subscriptionSelector.value().subscriptionId),n.resourceGroupName(t.form.resourceGroupDropdown.value().value.name),n},supplyProviderConfig:function(){return{}},receiveResult:function(n){console.log(n);t.sqlSelector.value(n)},selectable:this.sqlSelector.selectable});this.sqlSelector.value.subscribe(this.container,(function(n){t.form.ValidateAll();!n||!n.isNewServer||n.isNewServer()?(t.generalSection.children.remove(t.passwordTextbox),t.generalSection.children.remove(t.usernameTextbox)):(t.generalSection.children.indexOf(t.usernameTextbox)===-1&&t.generalSection.children.push(t.usernameTextbox),
t.generalSection.children.indexOf(t.passwordTextbox)===-1&&t.generalSection.children.push(t.passwordTextbox),t._fqdnPromise.fetch({subscriptionId:n.subscriptionId(),resourceGroup:n.resourceGroupName(),serverName:n.serverName()}).then((function(){t.sqlSelector.validate(1)})))}));this.sqlSelector.selectable.selectedValue({detailBlade:"SelectDatabaseV3Blade",extension:"SqlAzureExtension",detailBladeInputs:{}});this.container.registerSelectable(this.container,"SqlAzureChevron",this.sqlSelector.selectable,{parameterCollector:this.sqlCollector});this.usernameTextbox=new i.ViewModels.Forms.TextBox.ViewModel(this.container,this.form,"database.administratorLogin",{label:u.observable(e.sqlAdminUsername),validations:u.observableArray([new i.ViewModels.CustomValidation("",function(){var n=Q.defer(),i;return t.form.ValidateAll(),n.resolve({valid:!0,message:i}),n.promise})])});this.passwordTextbox=new i.ViewModels.Forms.PasswordBox.ViewModel(this.container,this.form,"database.administratorLoginPassword",
{label:u.observable(e.sqlAdminPassword),validations:u.observableArray([new i.ViewModels.CustomValidation("",function(n){var i=Q.defer(),r=!0,u,f=t.sqlSelector.value();return f.isNewServer()||(r=!!n),i.resolve({valid:r,message:u}),i.promise})])});this.generalSection.children.push(this.sqlSelector)},t.prototype._validateDBConfirmPass=function(){var n=f.Deferred(),t=!0,i,r=this.sqlSelector.value();return r.isNewServer()||this._fqdnPromise.loading()&&(t=!1),n.resolve({valid:t,message:i}),n.promise()},t.prototype.GetParametersValues=function(){var n=this.sqlSelector.value();return n.isNewServer()?{serverName:n.serverName(),administratorLogin:n.administratorLogin(),administratorLoginPassword:n.administratorLoginPassword(),databaseUsername:n.administratorLogin(),databasePassword:n.administratorLoginPassword(),databaseName:n.databaseName(),edition:n.edition(),collation:n.collation(),maxSizeBytes:n.maxSizeBytes(),requestedServiceObjectiveId:n.requestedServiceObjectiveId(),serverLocation:n.location(
)}:n.isNewDatabase()?{serverName:n.serverName(),DBServer:this._fqdnPromise.item(),databaseName:n.databaseName(),edition:n.edition(),collation:n.collation(),maxSizeBytes:n.maxSizeBytes(),requestedServiceObjectiveId:n.requestedServiceObjectiveId(),serverLocation:n.location(),administratorLogin:n.administratorLogin(),administratorLoginPassword:n.administratorLoginPassword(),databaseUsername:n.administratorLogin(),databasePassword:n.administratorLoginPassword()}:{serverName:n.serverName(),databaseName:n.databaseName(),DBServer:this._fqdnPromise.item(),administratorLogin:n.administratorLogin(),administratorLoginPassword:n.administratorLoginPassword(),databaseUsername:n.administratorLogin(),databasePassword:n.administratorLoginPassword()}},t.prototype.GetResourceTemplate=function(){var t=this.sqlSelector.value(),n={parameters:{serverName:{type:"string"},administratorLogin:{type:"string"},administratorLoginPassword:{type:"securestring"},databaseUsername:{type:"string"},databasePassword:{type:
"securestring"},databaseName:{type:"string"}},resources:[]};return(t.isNewServer()||t.isNewDatabase())&&(n.parameters.edition={type:"string"},n.parameters.collation={type:"string"},n.parameters.maxSizeBytes={type:"string"},n.parameters.requestedServiceObjectiveId={type:"string"},n.parameters.serverLocation={type:"string"}),t.isNewServer()?(n.resources.push(this._getServerResource()),n.resources.push(this._getSiteObject("reference('Microsoft.SQL/servers/"+t.serverName()+"').fullyQualifiedDomainName",!0))):t.isNewDatabase()?(n.parameters.DBServer={type:"string"},n.resources.push(this._getDatabaseObject()),n.resources.push(this._getSiteObject("'"+this._fqdnPromise.item()+"'",!1))):(n.parameters.DBServer={type:"string"},n.resources.push(this._getSiteObject("'"+this._fqdnPromise.item()+"'",!1))),n},t.prototype._getServerResource=function(){return{name:"[parameters('serverName')]",type:"Microsoft.Sql/servers",location:"[parameters('serverLocation')]",apiVersion:"2014-04-01-preview",properties:
{administratorLogin:"[parameters('administratorLogin')]",administratorLoginPassword:"[parameters('administratorLoginPassword')]",version:"12.0"},resources:[{name:"[parameters('databaseName')]",type:"databases",location:"[parameters('serverLocation')]",apiVersion:"2014-04-01-preview",dependsOn:["[concat('Microsoft.Sql/servers/', parameters('serverName'))]"],properties:{edition:"[parameters('edition')]",collation:"[parameters('collation')]",maxSizeBytes:"[parameters('maxSizeBytes')]",requestedServiceObjectiveId:"[parameters('requestedServiceObjectiveId')]"}},{apiVersion:"2014-04-01-preview",dependsOn:["[concat('Microsoft.Sql/servers/', parameters('serverName'))]"],location:"[parameters('serverLocation')]",name:"AllowAllWindowsAzureIps",properties:{endIpAddress:"0.0.0.0",startIpAddress:"0.0.0.0"},type:"firewallrules"}]}},t.prototype._getDatabaseObject=function(){return{name:"[concat(parameters('serverName'),'/',parameters('databaseName'))]",type:"Microsoft.Sql/servers/databases",location:
"[parameters('serverLocation')]",apiVersion:"2014-04-01-preview",properties:{edition:"[parameters('edition')]",collation:"[parameters('collation')]",maxSizeBytes:"[parameters('maxSizeBytes')]",requestedServiceObjectiveId:"[parameters('requestedServiceObjectiveId')]"}}},t.prototype._getSiteObject=function(n,t){var i=this.sqlSelector.value(),r=["[resourceId('Microsoft.Web/Sites', parameters('name'))]"];t&&r.push("[concat('Microsoft.Sql/servers/', parameters('serverName'), '/databases/', parameters('databaseName'))]");this.hasMsDeploy&&r.push("[concat('Microsoft.Web/Sites/', parameters('name'), '/Extensions/MSDeploy')]");var u=t?i.administratorLogin():this.usernameTextbox.value(),e=t?i.administratorLoginPassword():this.passwordTextbox.value(),f="[concat('Data Source=tcp:' , "+n+" , ',1433;Initial Catalog="+i.databaseName()+";User Id="+u+"@',"+n+",';Password=',parameters('administratorLoginPassword'),';')]";return{name:"[parameters('name')]",type:"Microsoft.Web/sites",properties:{siteConfig:
{connectionStrings:[{name:"defaultConnection",ConnectionString:f,type:"SQLAzure"}]}}}},t})(s.ResourceBase);t.SqlResource=c}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/SqlServerResource",["require","exports","f","o","ko","$","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/ResourceBase"],(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var h=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f._connectionStringName="defaultConnection",f.SqlDbData=
u.observable(null),f}return __extends(t,n),t.prototype.GetObject=function(){return this.SqlDbData},t.prototype.CloseAnyBlades=function(){this.SqlDbSelector.selectable.isSelected(!1)},t.prototype.SetupForm=function(n){var t=this;n.defaultConnection&&(this._connectionStringName=n.defaultConnection);this.SqlDbSelector=new i.ViewModels.Forms.Selector.ViewModel(this.container,this.form,"database",{label:u.observable(e.databaseLabel),displayText:u.pureComputed((function(){return!!t.dataModel()&&!!t.dataModel().database()&&!!t.dataModel().database().database()&&!!t.dataModel().database().database().name()?t.dataModel().database().database().name():e.databaseRequired}))});this.SqlDbSelector.validations.push(new i.ViewModels.CustomValidation("",function(n){return Q(t._validateDatabaseName(n))}));this.SqlDbSelector.validations.push(new i.ViewModels.RequiredValidation(""));this.SqlDbCollector=new i.ViewModels.ParameterCollector(this.container,{supplyInitialData:function(){if(!t.dataModel||!t.dataModel(
)||!t.dataModel().database||!t.dataModel().database())return{};var n={id:t.dataModel().database().database().id(),name:t.dataModel().database().database().name(),location:t.dataModel().database().database().location(),edition:t.dataModel().database().database().edition(),collation:t.dataModel().database().database().collation(),maxSizeBytes:t.dataModel().database().database().maxSizeBytes()};return{username:t.dataModel().database().username(),password:t.dataModel().database().password(),serverName:t.dataModel().database().serverName(),database:n}},supplyProviderConfig:function(){return{subscriptionId:t.form.subscriptionSelector.value().subscriptionId,dbType:o.DatabaseTypes.sqlAzure}},receiveResult:function(n){t.dataModel().database({settingsHint:u.observable("sql"),username:u.observable(n.username),password:u.observable(n.password),serverName:u.observable(n.serverName),serverFullyQualifiedDomainName:u.observable(n.serverName),database:u.observable({id:u.observable(n.database.id),name:u.
observable(n.database.name),location:u.observable(n.database.location),edition:u.observable(n.database.edition),collation:u.observable(n.database.collation),maxSizeBytes:u.observable(n.database.maxSizeBytes)})})},selectable:this.SqlDbSelector.selectable});this.generalSection.children.push(this.SqlDbSelector);this.container.registerSelectable(this.container,"SqlDBChevron",this.SqlDbSelector.selectable,{parameterCollector:this.SqlDbCollector})},t.prototype._validateDatabaseName=function(){var n=f.Deferred(),t=!0,i;return t=!this.dataModel()||!this.dataModel().database()||!this.dataModel().database().database()||!this.dataModel().database().database().name()?!1:!0,n.resolve({valid:t,message:i}),n.promise()},t.prototype.SetDefaults=function(n){return n.database({settingsHint:u.observable("sql"),username:u.observable(null),password:u.observable(null),serverName:u.observable(null),serverFullyQualifiedDomainName:u.observable(null),database:u.observable({id:u.observable(null),name:u.observable(
null),location:u.observable(null),edition:u.observable(null),collation:u.observable(null),maxSizeBytes:u.observable(0)})}),this.SqlDbSelector.selectable.selectedValue({detailBlade:"DatabaseInput",detailBladeInputs:{}}),Q.resolve(null)},t.prototype.GetParametersValues=function(){return{databaseName:this.dataModel().database().database().name().split("/").last(),DBServer:this.dataModel().database().serverFullyQualifiedDomainName(),databaseUsername:this.dataModel().database().username(),databasePassword:this.dataModel().database().password(),dbSubscriptionId:this.dataModel().subscription().subscriptionId,dbResourceGroup:i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(this.dataModel().database().database().id()).resourceGroup}},t.prototype.GetResourceTemplate=function(){var n={parameters:{},resources:[]};return n.parameters={databaseName:{type:"string"},DBServer:{type:"string"},databaseUsername:{type:"string"},databasePassword:{type:"securestring"},dbSubscriptionId:{type:"string"},
dbResourceGroup:{type:"string"}},n.resources=[this._getSiteResource()],n},t.prototype._getSiteResource=function(){var n={name:"[parameters('name')]",type:"Microsoft.Web/sites",tags:{"[concat('hidden-link:/subscriptions/', parameters('dbSubscriptionId'), '/resourcegroups/', parameters('dbResourceGroup'), '/providers/Microsoft.Sql/databases/', parameters('databaseName'))]":"empty"},resources:[{apiVersion:this.antaresApiVersion,name:"connectionstrings",type:"config",dependsOn:["[resourceId('Microsoft.Web/Sites', parameters('name'))]"],properties:{}}]};return n.resources[0].properties[this._connectionStringName]={value:"[concat('Data Source=tcp:', parameters('DBServer'), ',1433;Initial Catalog=', parameters('databaseName'), ';User Id=', parameters('databaseUsername'), ';Password=', parameters('databasePassword'), ';')]",type:"SQLServer"},this.dataModel().appSettings&&n.resources[0].dependsOn.push("[concat('Microsoft.Web/Sites/', parameters('name'), '/Extensions/MSDeploy')]"),n},t})(s.ResourceBase);
t.SqlServerDB=h}));define("WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentUtilities",["require","exports","f","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/CreateV2/Utilities","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlan","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanUnifiedOS","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanDynamic","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanSwapper","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppSettings","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/GithubDeployment","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/SiteResource","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/MySqlSwapper",
"WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/LocalMySqlResource","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/CloneSettings","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/SqlServerResource","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/MySqlResource","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/SqlResource","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ASEResource","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/VNETResource","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ScaleResource","WebsitesExtension/TypeScript/Environment/RuntimeType","WebsitesExtension/TypeScript/AppServiceEnvironment/CreateV2/CreateResources/ApiManagementAccount","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/BotAppKind",
"WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/OrcasLinux","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanWithLinux","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Resources/AppServicePlanUnifiedOSFunctions"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot){"use strict";var st;return (function(n){function t(n,t,r,d,g){var it=[],st=[],kt,ti,ht,ct,lt,at,dt,vt,yt,pt,wt,bt,gt;g.siteSource&&i.Base.Security.hasPermission(g.siteSource,[rt.AssetTypes.Website.Permissions.action,rt.AssetTypes.Website.Permissions.publishProfileAction,rt.AssetTypes.Website.Permissions.appSettingsAction,rt.AssetTypes.Website.Permissions.slotConfigNamesAction]).then((function(n){n||f.setBladeUnauthorized()}));var nt=null,ni=t.appKind()===u.KindsAvailable.Functions,ri=ni||g&&g.dynamicPlanAvailable,ii=t.appKind()===u.KindsAvailable.Bots;return ni&&(g.excludeComponents=!1),g.isFunctionApp=ni,t.appKind()===
u.KindsAvailable.Functions?(nt=new ot.AppServicePlanUnifiedOSFunctions(n,t,r),nt.SetupForm(g,d),st.push(nt.generalSection),it.push(nt)):g&&g.dynamicPlanAvailable?(t.appKind().indexOf(u.KindsAvailable.Bots)>-1&&(g.hideMemoryDropdown=!0),g.classicPlanAvailable?(nt=new h.AppServicePlanSwapper(n,t,r),nt.SetupForm(g,d),st.push(nt.generalSection),it.push(nt)):(nt=new s.AppServicePlanDynamic(n,t,r),nt.SetupForm(g,d),st.push(nt.generalSection),it.push(nt))):g&&!g.isXenonBYOC&&(g.isLinux||g.isLinuxBYOC)?(kt=new et.AppServicePlanWithLinux(n,t,r),kt.SetupForm(g,d),st.push(kt.generalSection),it.push(kt)):g&&(g.isUnifiedOS||g.isXenonBYOC)?(nt=new o.AppServicePlanUnifiedOS(n,t,r),nt.SetupForm(g,d),st.push(nt.generalSection),it.push(nt)):(nt=new e.AppServicePlanResource(n,t,r),nt.SetupForm(g,d),st.push(nt.generalSection),it.push(nt)),ti=new a.SiteResource(n,t,r),ti.SetupForm(g,d),it.push(ti),g&&g.sql&&(tt.isOnPrem()?(ht=new w.SqlServerDB(n,t,r),d.database=ht.GetObject(),ht.SetupForm(g,d),st.push(ht.generalSection),
it.push(ht)):(ct=new k.SqlResource(n,t,r),d.database=ct.GetObject(),ct.SetupForm(g,d),st.push(ct.generalSection),it.push(ct))),g&&g.mysql?tt.isOnPrem()?(lt=new b.MySqlDB(n,t,r),d.database=lt.GetObject(),lt.SetupForm(null,d),st.push(lt.generalSection),it.push(lt)):g.localmysql&&(g.mySqlTypes=[u.MySqlProviders.local],at=new v.MySqlSwapper(n,t,r),d.database=at.GetObject(),at.SetupForm(g,d),st.push(at.generalSection),it.push(at)):g&&g.localmysql?(dt=new y.LocalMySqlResource(n,t,r),dt.SetupForm(g,d),st.push(dt.generalSection),it.push(dt)):g&&g.mySqlTypes&&(g.dbsettings?(vt=new ft.OrcasLinux(n,t,r),d.database=vt.GetObject(),vt.SetupForm(g,d),st.push(vt.generalSection),it.push(vt)):(yt=new v.MySqlSwapper(n,t,r),d.database=yt.GetObject(),yt.SetupForm(g,d),st.push(yt.generalSection),it.push(yt))),g&&g.msDeploySettings&&(pt=new c.AppSettings(n,t,r),d.appSettings=pt.GetObject(),pt.SetupForm(g,d),st.push(pt.generalSection),it.push(pt)),g&&g.gitHubDeployment&&(wt=new l.GithubDeployment(n,t,r),d.githubSettings=
wt.GetObject(),wt.SetupForm(g,d),st.push(wt.generalSection),it.push(wt)),g&&g.siteSource&&(bt=new p.CloneSettings(n,t,r),d.cloningInfo=bt.GetObject(),bt.SetupForm(g.siteSource,d),st.push(bt.generalSection),it.push(bt)),ii&&(gt=new ut.BotAppKind(n,t,r),gt.SetupForm(g,d),st.push(gt.generalSection),it.push(gt)),t.generalSection.children(st),it}function st(n,t,i,r,u){var f=[],s=new d.AseResource(n,t,i),e,o,h;return s.SetupForm(u),f.push(s),e=new g.VNETResource(n,t,i),r.vnet=e.GetObject(),e.SetupForm(u),f.push(e),u.entitlement?!u.createApiManagementAccount||(h=new it.ApiManagementAccount(n,t,i),f.push(h)):(o=new nt.ScaleResource(n,t,i),r.scale=o.GetObject(),o.SetupForm(null),f.push(o)),f}function ht(n){return n===void 0&&(n="UnknownWebSite"),{v:{provisioningConfig:{v:{provisioningEnabled:{v:!0},dontDiscardJourney:{v:!1},startboardProvisioningInfo:{v:{provisioningPart:{v:{name:{v:"AzureResourceManagerProvisioningPart"},extension:{v:"HubsExtension"}}},startboardPart:{v:{name:{v:"SingleWebsitePart"},
extension:{v:"WebsitesExtension"}}},startboardPartKeyId:{v:"id"}}},galleryCreateOptions:{v:{galleryItem:{v:{id:{v:"Microsoft."+n+".1.0.1"},itemDisplayName:{v:r.app},publisherDisplayName:{v:"Microsoft"},version:{v:"1.0.1"},categoryIds:{v:[{v:"azure"},{v:"web"},{v:"showInVS"},{v:"free"},{v:"createv2"}]},metadata:{v:{}},launchingContext:{v:{galleryItemId:{v:"Microsoft."+n},source:{v:[{v:"Add ASE Command"}]}}}}},launchingContext:{v:{galleryItemId:{v:"Microsoft."+n},source:{v:[{v:"Add ASE Command"}]}}},subscriptionId:{v:""},subscriptionDisplayName:{v:""},deploymentName:{v:"WebAppASE"}}}}}},"#fxSerialized#":!0}}n.SetupResources=t;n.SetupASEResources=st;n.defaultGalleryOption=ht})(st||(st={})),st}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=
i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ViewModels/CreateBladeViewModel",["require","exports","f","o","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/CreateV2/Utilities"],(function(n,t,i,r,u,f){"use strict";r.defineProperty(t,"__esModule",{value:!0});var e=(function(n){function t(t){var r=n.call(this)||this;return r._container=t,r.title(u.website),r.subtitle(u.createSubtitle),r.icon(i.Base.Images.Polychromatic.Website()),f.bladeReference=r,r}return __extends(t,n),t.prototype.setUnauthorized=function(){this._container.unauthorized()},t})(i.ViewModels.Blade);t.CreateBladeViewModel=e}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ViewModels/CreatePartViewModel",
["require","exports","f","o","ko","WebsitesExtension/TypeScript/Helpers/ArmHelpers","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentUtilities","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/CreateV2/ResourceDeploymentUtilties/Utilties/DeploymentObjectMerger","WebsitesExtension/TypeScript/CreateV2/Utilities","WebsitesExtension/TypeScript/Utility/Utility.Website","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/Models/WebsiteResourceId","Fx/Controls/SubscriptionDropDown"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";r.defineProperty(t,"__esModule",{value:!0});var g=i.Azure.ResourceManager,d=i.ViewModels.Forms,
nt=i.Azure.ResourceGroups,tt=(function(n){function t(t,r,f){var e=n.call(this,t)||this;return e.features=u.observableArray([]),e._resources=[],e.dnsSuffix=u.observable(),e.appKind=u.observable(null),e._invalidSubs=[],e._registeredSubs=[],e._formReady=!1,e._rgReady=!1,e.initLoading=u.observable(!0),e.isLoading=u.observable(!0),e._passProvisioningDataBack=!1,e._involvedResourceProviders=u.observable([o.ResourceTypes.WebProvider]),e.resourceGroupDefaultName=u.observable(""),e._userEditedRG=!1,e._previousRGValue="",e._subscriptionId=u.observable(""),e.features=u.observableArray(l.getFeaturesNoSub(o.EnvPartNames.CreateWebsiteWizardPartV2)),e._locationsQuery=f.locations.ArmLocationQuery.createView(t),e._galleryItem=u.observable(),e._partName=o.EnvPartNames.CreateWebsiteWizardPartV2,e._tCount=f.objectCache.incObjCount(e._partName,e._partName),h.resetTelemetry(h.sourceAppCreateV2,f.objectCache),h.logCreateStep(f.objectCache,"CreateOpened"),e._container=t,e._dataContext=f,e.dnsSuffix(window.fx.environment.
antaresHostedSiteUriFormat.format("")),e.actionBar=new i.ViewModels.ActionBars.CreateActionBar.ViewModel(t),e.valid.subscribe(t,e.actionBar.valid),e.parameterProvider=new i.ViewModels.ParameterProvider(t,{mapIncomingDataForEditScopeAsync:e._mapIncomingDataForEditScope.bind(e),mapOutgoingDataForCollector:function(n){return e._passProvisioningDataBack?e._getProvisioningData(n):n}}),e.editScope=e.parameterProvider.editScope,e.armProvisioner=new g.Provisioner(t,r,{supplyTemplateDeploymentOptions:e._supplyProvisioningPromise.bind(e),actionBar:e.actionBar,parameterProvider:e.parameterProvider,createFeatures:32}),e._initializeFormBase(t,r),e}return __extends(t,n),t.prototype.ValidateAll=function(){for(var n=0;n<this._resources.length;n++)this._resources[n].Validate()},r.defineProperty(t.prototype,"_dataModel",{get:function(){var n=this.editScope();return n&&n.root},enumerable:!0,configurable:!0}),t.prototype.getResourceData=function(n){var t=this._resources.first((function(t){return t.getImportantData(
)&&t.getImportantData().type===n}));return t&&t.getImportantData()},t.prototype.getResourceGroupLocation=function(){var n=this.getResourceData(o.Create.AppServicePlanResourceType),t=n&&n.location,i=t&&this._locationsQuery.items().first((function(n){return n.toLowerCase().replace(" ","")===t.toLowerCase().replace(" ","")}));return i!=null?i:this.defaultResourceGroupLocation},t.prototype._initializeFormBase=function(n){var t=this,r=u.observableArray([new i.ViewModels.RequiredValidation(s.Wizard.Validation.required)]),f;l.hasFeature(this.features(),o.EnvFeature.EnsureSubscriptionRegistered)&&r.push(new i.ViewModels.CustomValidation("",function(n){var i=t._invalidSubs.first((function(t){return t===n}));return i?Q({valid:!1,message:e.CreateValidation.subCantRegisterWithRP.format(n)}):Q({valid:!0,message:""})}));this.subscriptionSelector=k.create(n,{initialSubscriptionId:u.observableArray(),validations:r,resourceProviders:this._involvedResourceProviders,filterByGalleryItem:this._galleryItem});this.
subscriptionSelector.value.subscribe(this._container,(function(){var n=t.subscriptionSelector.value();n&&n.subscriptionId&&t._subscriptionId(n.subscriptionId)}));f={options:u.observableArray([]),form:this,accessor:this.createEditScopeAccessor((function(n){return n.resourceGroup})),label:u.observable(s.Wizard.Steps.ResourceGroup.title),subscriptionIdObservable:u.pureComputed((function(){return t._subscriptionId()})),validations:u.observableArray([new i.ViewModels.RequiredValidation(s.resourceGroupRequired)])};this.resourceGroupDropdown=new nt.DropDown(n,f);this._setupFlowCheck();var h={children:u.observableArray([])},c={children:u.observableArray([])},a={children:u.observableArray([this.subscriptionSelector,this.resourceGroupDropdown.control])};this.resourceGroupDropdown.value.subscribe(this._container,(function(n){n.createNew&&n.value.name!==t.resourceGroupDefaultName()&&n.value.name!==t._previousRGValue&&(t._userEditedRG=!0);t._previousRGValue=n.value.name}));this.resourceGroupDefaultName.subscribe(
this._container,(function(n){t._userEditedRG||t.resourceGroupDropdown.value().createNew&&t.resourceGroupDropdown.value({createNew:!0,value:{name:n,location:t.defaultResourceGroupLocation}})}));this.generalSection=new d.Section.ViewModel(n,h);this.bottomSection=new d.Section.ViewModel(n,c);this.nameSection=new d.Section.ViewModel(n,{children:u.observableArray([])});this.dropDownSection=new d.Section.ViewModel(n,a);this.infoBoxSection=new d.Section.ViewModel(n,{children:u.observableArray([])});this.sections.push(this.nameSection);this.sections.push(this.dropDownSection);this.sections.push(this.generalSection);this.sections.push(this.bottomSection);this.sections.push(this.infoBoxSection)},t.prototype.notHasEnvironmentFlag=function(n){return!l.hasFeature(this.features(),n)},t.prototype.hasEnvironmentFlag=function(n){return l.hasFeature(this.features(),n)},t.prototype._setupFlowCheck=function(){var n=this;this.resourceGroupDropdown.value.subscribe(this._container,(function(){n._formReady||n._registerSubAndResetResourcesPromises(
).then((function(){n.isLoading(!1);n._formReady?h.logCreateStep(n._dataContext.objectCache,"Resource Group Changed","subscriptionId={0};ResourceGroup={1}".format(n.subscriptionSelector.value().subscriptionId,n.resourceGroupDropdown.value().value.name)):(h.logCreateStep(n._dataContext.objectCache,"Form Ready","subscriptionId="+n.subscriptionSelector.value().subscriptionId+";ResourceGroup="+n.resourceGroupDropdown.value().value.name+";deploymentName="+n._deploymentName),n._formReady=!0)}))}));this.subscriptionSelector.value.subscribe(this._container,(function(){n._formReady&&(n.isLoading(!0),h.logCreateStep(n._dataContext.objectCache,"Subscription Changed","subscriptionId={0}".format(n.subscriptionSelector.value().subscriptionId)),n._registerSubAndResetResourcesPromises().then((function(){n.isLoading(!1)})))}));this.notHasEnvironmentFlag(o.EnvFeature.DisableCreateValidation)&&(this.actionBar.groupValidation={validate:function(){var i=[],t;if(!n.resourceGroupDropdown.value()||!n.resourceGroupDropdown.
value().value||!n.resourceGroupDropdown.value().value.name)return Q({valid:!1,message:p.resourceGroupNameMissing});for(t=0;t<n._resources.length;t++)i.push(n._resources[t].FinalValidation());return Q.all(i).then((function(n){var t=n.first((function(n){return n.valid===!1}));return t||{valid:!0,message:""}}))}})},t.prototype._registerSubAndResetResourcesPromises=function(){var n=this,t,i;return l.hasFeature(this.features(),o.EnvFeature.EnsureSubscriptionRegistered)?(t=this._invalidSubs.first((function(t){return t===n.subscriptionSelector.value().uniqueDisplayName})),t)?Q():(i=this._registeredSubs.first((function(t){return t===n.subscriptionSelector.value().uniqueDisplayName})),i)?this._resetResourcesPromises():this._registerSub(this.subscriptionSelector.value().subscriptionId).then((function(){return n._resetResourcesPromises()})).catch((function(){return n._invalidSubs.push(n.subscriptionSelector.value().uniqueDisplayName),n.subscriptionSelector.triggerValidation(),Q(null)})):this._resetResourcesPromises(
)},t.prototype.SendMessageToResources=function(n){this._resources.forEach((function(t){t.recieveDispatchMessage(n)}));this.recieveMessageDispatch(n)},t.prototype.recieveMessageDispatch=function(n){if(n.message===o.CreateMessageTypes.AppNameChange){var t=n;this.resourceGroupDefaultName(t.name)}},t.prototype._resetResourcesPromises=function(){var t=this,i=[this._locationsQuery.fetch(this.subscriptionSelector.value().subscriptionId).then((function(){t.defaultResourceGroupLocation=t._locationsQuery.items()[0]}))],n;for(this.features.replaceAll(l.getFeaturesSubProvided(o.EnvPartNames.CreateWebsiteWizardPartV2,this.subscriptionSelector.value())),n=0;n<this._resources.length;n++)this._resources[n].getNewDefault()&&i.push(this._resources[n].SetDefaults(this._dataModel,this.subscriptionSelector.value())),this._resources[n].CloseAnyBlades();return Q.all(i)},t.prototype._registerSub=function(n,t,i,r){var u=this;return t===void 0&&(t=5e3),i===void 0&&(i=12),r===void 0&&(r=1),Q(f.callArmJhr("/subscriptions/{0}/providers/Microsoft.Web/register".
format(n),"POST")).then((function(f){return AntUx.StringEx.equals(f.registrationState,"registered",AntUx.StringComparison.IgnoreCase)?!0:r>=i?!1:Q.delay(t).then((function(){return u._registerSub(n,t,i,r+1)}))}))},t.prototype.AddRpToRegistration=function(n){var t=this._involvedResourceProviders();t.push(n);this._involvedResourceProviders(t)},t.prototype.RemoveRpFromRegistration=function(n){var t=this._involvedResourceProviders();i.remove(t,n);this._involvedResourceProviders(t)},t.prototype._mapIncomingDataForEditScope=function(n){var t=this.armProvisioner.armProvisioningConfig&&this.armProvisioner.armProvisioningConfig.galleryCreateOptions,i,r,f;return y.forFeature(o.Create.linuxFeatureflag)&&(n.isUnifiedOS=!0),this._passProvisioningDataBack=!!n&&n.passProvisioningData,n.isLinuxBYOC&&(n.isXenonBYOC=!0),i={name:u.observable(""),subscription:u.observable(""),resourceGroup:u.observable()},this.appKind(n&&n.appKind&&n.appKind.replaceAll(";",",")),r=Q.defer(),this._resources=c.SetupResources(this.
_container,this,this._dataContext,i,n),t&&(this._deploymentName=t.deploymentName+w.Guid.newShortGuid(),h.logTelemetry("Create Opened From Gallery","context={0}".format(JSON.stringify(t.launchingContext))),this._galleryItem(t.galleryItem),!!n&&n.hideSubscription&&(this.dropDownSection.children.remove(this.subscriptionSelector),f=b.WebsiteResourceId.fromCsmResourceId(n.siteSource),this._subscriptionId(f.SubscriptionId)),!!n&&n.hideResourceGroup&&this.generalSection.children.remove(this.resourceGroupDropdown.control),v.setBladeTitle(t.galleryItem.itemDisplayName),this.initLoading(!1),r.resolve(i)),r.promise},t.prototype._supplyProvisioningPromise=function(n,t){var r=this._getProvisioningData(n,t),i=Q.defer();return r?i.resolve(r):i.reject(),i.promise},t.prototype._getProvisioningData=function(n,t){var s,f,r,c,e;t===void 0&&(t=0);t===0?h.logCreateStep(this._dataContext.objectCache,"Create button clicked","deploymentName="+this._deploymentName):t===1&&h.logTelemetry("Template Viewed In Automation",
"");s=this.armProvisioner.armProvisioningConfig&&this.armProvisioner.armProvisioningConfig.galleryCreateOptions;s||(s=this.parameterProvider.configFromCollector());var l,i=this.subscriptionSelector.value().subscriptionId,v=this.resourceGroupDropdown.value().value.name,y=this.getResourceGroupLocation(),p="/subscriptions/{0}/resourcegroups/{1}/providers/Microsoft.Web/sites/{2}".format(i,v,this._dataModel.name()),u;for(u={subscriptionId:i},f={$schema:"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",contentVersion:"1.0.0.0",parameters:{subscriptionId:{type:"string"}},resources:[]},r=0;r<this._resources.length;r++)u=a.mergeObjects(u,this._resources[r].GetParametersValues()),f=a.mergeObjects(f,this._resources[r].GetResourceTemplate(null));return l={subscriptionId:i,resourceGroupName:v,resourceGroupLocation:y,parameters:u,deploymentName:this._deploymentName,resourceProviders:[],resourceId:p,templateJson:f},c=this._dataModel.name(),e=this.getResourceData(
o.Create.AppServicePlanResourceType).name?this.getResourceData(o.Create.AppServicePlanResourceType).name:o.ServerFarmSku.dynamic,t===0&&(e===o.ServerFarmSku.dynamic?h.logCreateStep(this._dataContext.objectCache,"Create Complete","subscription={0};sitename={1};asp={2};deploymentName={3}".format(i,c,e,this._deploymentName)):h.logCreateStep(this._dataContext.objectCache,"Create Complete","subscription={0};sitename={1};asp={2};aspSku={3};newASP={4};inHostingEnvrionment={5};deploymentName={6}".format(i,c,e,this.getResourceData(o.Create.AppServicePlanResourceType).sku,!!this.getResourceData(o.Create.AppServicePlanResourceType).Id,this.getResourceData(o.Create.AppServicePlanResourceType).hostingEnvironmentProfile,this._deploymentName))),l},t})(d.Form.ViewModel);t.CreatePartViewModel=tt}))