var __extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/SlotSettingsBladeViewModel",["require","exports","f","o","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources"],(function(n,t,i,r,u){"use strict";r.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(){var t=n.call(this)||this;return t.title(u.slotSettingsBladeTitle),t}return __extends(t,n),t.prototype.onInputsSet=function(){return null},t})(i.ViewModels.Blade);t.SlotSettingsBladeViewModel=f}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/SlotSettingsPartViewModel",["require","exports","f","o","ko","$","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources","Core/TypeScript/TFS.Core","ReleaseManagement/TypeScript/Utilities/ArmUtils"],(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=i.ViewModels.Controls.InfoBox.ViewModel,l=i.Base.Images,h=i.Base.Diagnostics.Telemetry,a=(function(n){function t(t,r,f){var o=n.call(this,t)||this;return o._optionLoading={text:u.observable(e.loadingText),value:null},o._optionNoDataFound={text:u.observable(e.noSlotsFound),value:null},o.featureLimits={standard:5,premium:20,dynamic:3},o._dataContext=f,o._container=t,o.generalSection=new i.ViewModels.Forms.Section.ViewModel(o._container),o._armData=null,o.isSlotSupported=u.observable(!0),o.useSlots=u.observable(!1),o.errorInSlots=u.observable(!1),o.slotSelectionError=u.observable(""),o.deployToSlot=u.observable(e.deploytoSlotsText),o._slotsListData=u.observableArray([]),o.parameterProvider=new i.ViewModels.ParameterProvider(t,{mapIncomingDataForEditScopeAsync:function(n){return o.mapIncomingDataForEditScopeAsync(n)},mapOutgoingDataForCollector:function(n){return o._returnSlotConfiguration(n)}}),o.editScope=o.parameterProvider.editScope,o._initializeForm(),o._dataContext.appServiceArmManager.clearCachedSlots(),o.isFormValid=u.pureComputed((function(){return o.generalSection.valid()})),o}return __extends(t,n),t.prototype.onInputsSet=function(){return null},t.prototype._initializeForm=function(){var n=this,t,r,f,o,s;this.createadditionalEnvironmentTitle=u.observable(e.createStagingEnvironmentTitle);this.informationDetails=u.observable(e.informationDetailsForNoSlotSupport);this.noSlotsupportInfoBox=new c(this._container,!1);this.noSlotsupportInfoBox.image=u.observable(l.Polychromatic.Info());this.noSlotsupportInfoBox.text=u.observable(e.noSlotSupportInfoBoxText);this.deployToProdText=u.observable(e.deployToProdText);this.deployToProdSubText=u.observable(e.deployToProdSubText);t=[{text:u.observable(e.yesText),value:!0},{text:u.observable(e.noText),value:!1}];this.createDeploymentSlotOptionsGroup=new i.ViewModels.Forms.OptionsGroup.ViewModel(this._container,this,"useSlot",{label:u.observable(""),options:u.observableArray(t.slice())});r={label:u.observable(e.createNewSlotText),options:u.observableArray([{text:u.observable(e.createNew),value:!0},{text:u.observable(e.useExisting),value:!1}]),validations:u.observableArray([new i.ViewModels.RequiredValidation]),radioButtonStyle:!0};this.createOrSelectControl=new i.ViewModels.Forms.OptionsGroup.ViewModel(this._container,this,"createSlot",r);this.createControl=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"createSlotName",{validations:u.observableArray([new i.ViewModels.RequiredValidation(e.validationRequired),new i.ViewModels.CustomValidation("",function(t){return n._validateSlotNameIsUniqueWithinSite(t)}),new i.ViewModels.MaxLengthValidation(60,e.websiteNameMaxLength),new i.ViewModels.CustomValidation("",this._validateEntityName)])});this.createControl.delayValidationTimeout(500);this.createControl.valueUpdateTrigger=4;f={validations:u.observableArray([new i.ViewModels.RequiredValidation,new i.ViewModels.CustomValidation("",function(t){return!t?Q({valid:!0,message:""}):n._validateScmType(t)})])};this.selectControl=new i.ViewModels.Obsolete.Forms.DropDown.ViewModel(this._container,this,"selectSlotName",f);o=[this.createDeploymentSlotOptionsGroup,this.createOrSelectControl];s=[this.createDeploymentSlotOptionsGroup];this.createDeploymentSlotOptionsGroup.value.subscribe(this._container,(function(t){h.trace({source:"SlotSettingsPartViewModel",action:"CreateDeploymentSlotOption-"+t});t?(n._setupSlotsDropDown(n._optionLoading),n._dataContext.appServiceArmManager.beginGetSlotList().then((function(t){n._processSlotsList(t)})),n.useSlots(!0),n.generalSection.children(o),n._slotConfigurationLayout()):(n.useSlots(!1),n.generalSection.children(s))}));this._slotsListData.subscribe(this._container,(function(t){t&&n._updateSlotsDropDown(t)}));this.generalSection.children([]);this.sections.push(this.generalSection);this._dataContext.appServiceArmManager.fetchAppServiceResourceData().then((function(){var i=n._dataContext.appServiceArmManager.appServiceResourceData(),t;i.properties&&i.properties.sku&&(t=i.properties.sku.toLowerCase(),t==="free"||t==="basic"||t==="shared"?(h.trace({source:"SlotSettingsPartViewModel",action:"NoSlotSupported-"+t}),n.isSlotSupported=u.observable(!1),n.useSlots=u.observable(!1),n.generalSection.children([])):(n.isSlotSupported=u.observable(!0),n.informationDetails=u.observable(e.informationDetailsWithSlotSupport),n.generalSection.children([n.createDeploymentSlotOptionsGroup])))}))},t.prototype._validateScmType=function(n){var i=Q.defer(),t={valid:!0,message:""},r=s.AppServiceArmApiUtilities.getAppServiceBaseUri(this._dataContext.appServiceArmManager.appServiceResourceData().id,this._dataContext.appServiceArmManager.appServiceResourceData().isSlot),u=s.AppServiceArmApiUtilities.getAppServiceNameDetails(this._dataContext.appServiceArmManager.appServiceResourceData().name),f=o.StringUtils.format("{0}/{1}/slots/{2}",r,u.appServiceBaseName,n);return s.AppServiceArmApiUtilities.beginGetScmType(this._dataContext,f).then((function(n){var r=n.toLowerCase();r==""||r=="none"||(t.valid=!1,t.message=r=="vstsrm"?e.resourceConfiguredWithContinuousDeliveryMessage:e.resourceConfiguredWithDeploymentOptionsMessage);i.resolve(t)}),(function(){i.resolve(t)})),i.promise},t.prototype._processSlotsList=function(n){var t,i,f;if(n&&n.value){var r=n.value,e=r?r.length:0,u=[];for(t=0;t<e;t++)i=r[t].name,i&&(f=i.substr(i.indexOf("/")+1),u.push(f));this._slotsListData(u)}},t.prototype.mapIncomingDataForEditScopeAsync=function(n){var t=f.Deferred(),i={selectSlotName:n&&n.selectSlotName?n.selectSlotName:u.observable(""),createSlot:n&&n.createSlot?n.createSlot:u.observable(!1),createSlotName:n&&n.createSlotName?n.createSlotName:u.observable("staging"),useSlot:n&&n.useSlot?n.useSlot:u.observable(!1)};return this._slotConfiguration=i,t.resolve(i),t.promise()},t.prototype._slotConfigurationLayout=function(){var n=this,t=[this.createDeploymentSlotOptionsGroup,this.createOrSelectControl,this.createControl],i=[this.createDeploymentSlotOptionsGroup,this.createOrSelectControl,this.selectControl];this.createOrSelectControl.value.subscribe(this._container,(function(r){n.generalSection.children(r?t:i)})).callback(this.createOrSelectControl.value())},t.prototype._returnSlotConfiguration=function(n){var t;return n&&n.useSlot&&n.useSlot()&&n.selectSlotName&&n.selectSlotName()&&(t=n.selectSlotName(),n.selectSlotName(t)),n},t.prototype._updateSlotsDropDown=function(n){for(var o=n.length,e=this._dataContext.appServiceArmManager.appServiceResourceData().name,s=this._dataContext.appServiceArmManager.appServiceResourceData().isSlot?e.substr(e.indexOf("/")+1):null,t=[],r,f=this._slotConfiguration&&this._slotConfiguration.selectSlotName?this._slotConfiguration.selectSlotName():null,i=0;i<o;i++)n[i]!==s&&(t.push({text:u.observable(n[i]),value:n[i]}),f&&n[i]===f&&(r=f));if(t.length===0){this._setupSlotsDropDown(this._optionNoDataFound);h.trace({source:"SlotSettingsPartViewModel",action:"NoSlotsFound"});return}!r&&t.length>0&&(r=t[0].value);t.sort(this._sortSlotByValue);this.selectControl.options(t);this.selectControl.value(r)},t.prototype._sortSlotByValue=function(n,t){return n.value>t.value?1:n.value<t.value?-1:0},t.prototype._validateSlotNameIsUniqueWithinSite=function(n){var r=this,i=Q.defer(),t={valid:!0,message:""};if(n){if(n.toLocaleLowerCase()==="production")return t.valid=!1,t.message=e.websiteSlotNameNotAvailable.format(n),Q(t);this._dataContext.appServiceArmManager.beginGetSlotList().then((function(u){var h=r._dataContext.appServiceArmManager.appServiceResourceData().properties.sku.toLocaleLowerCase(),f,c,o,s,l;if(u&&u.value&&u.value.length+1>=r.featureLimits[h]&&i.resolve({valid:!1,message:e.maxSlotsExceeded.format(h)}),u&&u.value)for(f=u.value,c=f?f.length:0,o=0;o<c;o++)if(s=f[o].name,s&&(l=s.substr(s.indexOf("/")+1),l.toLocaleLowerCase()===n.toLocaleLowerCase())){t.valid=!1;t.message=e.websiteSlotNameNotAvailable.format(n);break}i.resolve(t)}),(function(){i.resolve(t)}))}else i.resolve(t);return i.promise},t.prototype._validateEntityName=function(n){var t={valid:!0,message:""},i=n.match(/[^\u00BF-\u1FFF\u2C00-\uD7FF\a-zA-Z0-9-]/);return i&&(t.valid=!1,t.message=e.entityNameRegexValidation.format(i[0])),Q(t)},t.prototype._setupSlotsDropDown=function(n){this.selectControl.options([]);var t=[];t.push(n);this.selectControl.options(t);this.selectControl.value(n.value);this.selectControl.clearValidation()},t})(i.ViewModels.Forms.Form.ViewModel);t.SlotSettingsPartViewModel=a}));
define("_generated/Blades/SlotSettingsBlade",["require","exports","_generated/Blades/VersionControl.css","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/SlotSettingsBladeViewModel","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ChooseSourceActionBar","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/SlotSettingsPartViewModel"],(function(n,t,i){"use strict";var r;return (function(n){n.blade={name:"SlotSettingsBlade",viewModelName:"ReleaseManagement$SlotSettingsBladeViewModel",lenses:[{name:"SlotSettingsLens",partInstances:[{name:"SlotSettingsPart",inline:{styleSheets:[{file:"Blades/VersionControl.css",content:i}],viewModel:"ReleaseManagement$SlotSettingsPartViewModel",partKind:0,inputs:[],bindings:[],details:[],initialSize:9,supportedSizes:[9],htmlTemplateInline:{file:"SlotSettings.html",content:'<div data-bind="html: createadditionalEnvironmentTitle"><\/div> <div data-bind=\'html: informationDetails\'><\/div> <br/> <div class="msportalfx-form" data-bind="formElement: generalSection, visible: isSlotSupported"><\/div> <div data-bind="visible: !isSlotSupported()"> <div data-bind="pcControl:noSlotsupportInfoBox"><\/div> <\/div> <!--<div data-bind="html: deployToProdText, visible: !isSlotSupported() || !useSlots()"><\/div>--> <div data-bind=\'text: deployToProdSubText, visible: isSlotSupported() && !useSlots()\'><\/div> <div data-bind="html: slotSelectionError, visible: errorInSlots"><\/div> <div data-bind="text: deployToSlot, visible: useSlots"><\/div> '}},parameterProvider:!0}]}],width:0,locked:!0,actionBar:{name:"genericActionBar",actionBarKind:6,viewModel:"ReleaseManagement$ChooseSourceActionBar",bindings:[{property:"valid",valuesFrom:[{referenceType:0,property:"content.isFormValid",part:"SlotSettingsPart"}]}]},attributes:0}})(r||(r={})),r}))