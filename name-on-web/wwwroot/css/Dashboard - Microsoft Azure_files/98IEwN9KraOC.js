define("HubsExtension/ArmHelpers/ArmBulkCommand",["require","exports","f","i","HubsExtension/Browse/BrowseClientStrings","HubsExtension/ArmHelpers/ArmApisStartup"],(function(n,t,i,r,u,f){"use strict";var e;return (function(t){function vt(n,t,r){if(w(n)&&r.httpStatusCode===400){var u=r.content&&r.content.code,f=nt.some((function(n){return i.localeCompareIgnoreCase(n,u)===0}));if(f||t<2)return!0}return!1}function yt(n,t,i){return s[i.httpStatusCode]||l[i.httpStatusCode]||vt(n,t,i)}function pt(n){return s[n]||p[n]}function w(n){return n.toLowerCase()==="microsoft.resources/resources"}function wt(n,t,i){var r=n.toLowerCase(),u=new ht.InternalClientNotification({title:e.notificationTitle.format(e.executing,r,i),description:g.format(e.notificationDescStatus.format(0,0,0)),descriptionAsHtml:!0,status:o.InProgress,percentComplete:0,timestamp:new Date});return u.publish(),{notification:u,commandName:r,total:i,succeeded:0,failed:0,canceled:0,errorDetails:[]}}function bt(n,t,r){var u=n.notification;u.title=e.notificationTitle.format(t===o.InProgress?e.executing:e.executed,n.commandName,n.total);u.status=t;u.descriptionAsHtml=!0;t===o.Success&&(n.total===n.failed?u.status=o.Error:n.failed>0&&(u.status=o.Warning));u.toastDuration=t===o.InProgress?3:0;var h=r||e.notificationDescStatus.format(n.succeeded,n.failed,n.canceled),f=g.format(h),s=n.errorDetails;s.length&&(f+=lt,s.forEach((function(n){f+=at.format(i.ensurePrefix(n.resourceId,"/"),n.name,n.message)})));u.description=f;u.publish()}function it(n,t,i,r){r.failed++;var u=e.defaultErrorMessage.format(n.label,t.httpStatusCode);t.content&&(u=t.content.message||u);r.errorDetails.push({name:i.name,resourceId:i.resourceId,message:u});h.error("BulkCommand execution returned http error code {0} for Resource Id = {1}, Resource Type = {2}".format(t.httpStatusCode,i.resourceId,i.resourceType))}function b(n,t){var i=+t.headers[y]*1e3||0;return Math.max(n,i)}function rt(n,t){var r=t.headers[v],i;return n&&n.asyncOperation&&n.asyncOperation.pollingHeaderOverride&&(i=t.headers[n.asyncOperation.pollingHeaderOverride]),i||r}function ut(n,t){var i={};return i[v]=t.getResponseHeader(v),i[y]=t.getResponseHeader(y),n&&n.asyncOperation&&n.asyncOperation.pollingHeaderOverride&&(i[n.asyncOperation.pollingHeaderOverride]=t.getResponseHeader(n.asyncOperation.pollingHeaderOverride)),i}function ft(n){return Q.reject({message:e.commandConfigurationError.format(n),status:400})}function kt(n,t,i){for(var r=[],e=i?"{0}.{1}.poll".format(t,i):"{0}.BulkCmd.poll".format(t),u;n.length>0;)u=n.splice(0,f.maxBatchCallCount),r.push(f.callBatch(u,!1,a(e)));return Q.all(r).then((function(n){return n.reduce((function(n,t){return n.concat(t)}),[])}))}function et(n,u,f,s,l){var a=u.map((function(n){return n.uri}));return kt(a,f,n.id).then((function(a){var y=[],w=t.DefaultRetryAfter,v=!1,p;return a.forEach((function(t,f){var o=u[f],k=n.armCommandDefinitions[o.resourceType]||n.armCommandDefinitions["*"],d=!1,l,a,g,p;w=b(w,t);switch(t.httpStatusCode){case 204:case 200:if(l=t.content,l&&l.status)switch(l.status.toLowerCase()){case c.Succeeded:s.succeeded++;v=!0;d=!0;break;case c.Failed:s.failed++;v=!0;a=e.notificationError;l.error&&(a=r.Azure.parseArmErrorToMessage(l.error)||a);s.errorDetails.push({name:o.name,resourceId:o.resourceId,message:a});break;case c.Canceled:s.canceled++;v=!0;break;case c.InProgress:y.push(u[f]);break;default:h.warning("BulkCommand poll response content returned unexpected status value = {0}. Resource Id = {1}, Resource Type = {2}".format(l.status,o.resourceId,o.resourceType))}else s.succeeded++,d=!0,v=!0;d&&k.isDeleteOperation&&i.UI.AssetManager.notifyResourceDeleted(o.resourceId);break;case 202:g=rt(k,t);g&&(u[f].uri=g);y.push(u[f]);break;case 404:if(k.isDeleteOperation){s.succeeded++;v=!0;i.UI.AssetManager.notifyResourceDeleted(o.resourceId);break}default:if(pt(t.httpStatusCode)){y.push(u[f]);break}s.failed++;v=!0;p=e.defaultErrorMessage.format(n.label,t.httpStatusCode);t.content&&(p=r.Azure.parseArmErrorToMessage(t.content)||p);s.errorDetails.push({name:o.name,resourceId:o.resourceId,message:p});h.error("BulkCommand poll response returned http error code {0} for Resource Id = {1}, Resource Type = {2}".format(t.httpStatusCode,o.resourceId,o.resourceType))}})),y.length&&--l?(v&&t.notifyCommandProgressWrapper(s,o.InProgress),Q.delay(w).then((function(){return et(n,y,f,s,l)}))):(y.length&&!l?(p=e.notificationDescStatus.format(s.succeeded,s.failed,s.canceled),p=e.notificationStatusDetails.format(p,e.notificationTimedout.format(t.DefaultRetryAfter/125)),t.notifyCommandProgressWrapper(s,o.Warning,p)):t.notifyCommandProgressWrapper(s,o.Success),Q([]))}))}function dt(n,t,i){var u=[],e=n.id?"{0}.{1}.execute".format(i,n.id):"{0}.BulkCmd.execute".format(i);return t.forEach((function(t){var s=d,o,r=n.armCommandDefinitions[t.resourceType]||n.armCommandDefinitions["*"];r?(o=r.type||"POST",r.uri?(s=r.uri.replace(d,t.resourceId),u.push(f.callRaw({armApiOrUri:s,httpMethod:o,dataType:"json",telemetry:a(e),noBatch:!0}))):w(i)?u.push(f.resourceApi(t.resourceId).then((function(n){return f.callRaw({armApiOrUri:n,httpMethod:o,dataType:"json",telemetry:a(e),noBatch:!0})}))):(h.error("BulkCommand's ArmCommandDefinition is missing the required uri property for Resource Id = {0}, Resource Type = {1}".format(t.resourceId,t.resourceType)),u.push(ft(t.resourceId)))):(h.error("BulkCommand's ArmCommandDefinition is missing for Resource Id = {0}, Resource Type = {1}".format(t.resourceId,t.resourceType)),u.push(ft(t.resourceId)))})),Q.allSettled(u).then((function(i){return i.map((function(i,u){var o=n.armCommandDefinitions[t[u].resourceType]||n.armCommandDefinitions["*"],f,e;return i.state===ct?(f=i.reason.jqXHR,f?{content:r.Azure.buildSimplifiedError(f),headers:ut(o,f),httpStatusCode:f.status}:{content:i.reason,headers:null,httpStatusCode:i.reason.status}):(e=i.value,{content:e.content,headers:ut(o,e.jqXHR),httpStatusCode:e.jqXHR.status})}))}))}function ot(n,r,u,f,e,o){return dt(n,u,r).then((function(s){var l=t.DefaultRetryAfter,a=o.retryAfter,c=[],v=[];if(s.forEach((function(t,s){var y=u[s],w=n.armCommandDefinitions[y.resourceType]||n.armCommandDefinitions["*"],p;switch(t.httpStatusCode){case 204:case 200:f.succeeded++;w.isDeleteOperation&&i.UI.AssetManager.notifyResourceDeleted(y.resourceId);break;case 202:p=rt(w,t);p?e.push({uri:p,name:y.name,resourceId:y.resourceId,resourceType:y.resourceType}):h.error("BulkCommand operation returned accepted http status code but poll uri was not found, Resource Id = {0}, Resource Type = {1}".format(y.resourceId,y.resourceType));l=b(l,t);break;default:if(yt(r,o.retryCount,t)){a=b(a,t);c.push(y);v.push(t);break}it(n,t,y,f)}})),c.length){if(o.prevRetryRequestCount>c.length||o.retryCount++<o.maxRetryCount)return o.prevRetryRequestCount=c.length,Q.delay(a).then((function(){return ot(n,r,c,f,e,o)}));c.forEach((function(t,i){it(n,s[i],t,f)}))}return Q(l)}))}function gt(n,i,r){var u=t.createAndPublishBulkNotificationWrapper(n.label,i,r.length),f=[],s={prevRetryRequestCount:r.length,maxRetryCount:3,retryCount:0,retryAfter:t.DefaultRetryAfter},h;return w(i)&&(h=r.some((function(n){return tt[n.resourceType]})),h&&(s.maxRetryCount=10,s.retryAfter=t.HighLatencyRetryAfter)),ot(n,i,r,u,f,s).then((function(r){return f.length?Q.delay(r).then((function(){return et(n,f,i,u,480)})):(t.notifyCommandProgressWrapper(u,o.Success),Q())})).catch((function(n){var i=e.notificationDescStatus.format(u.succeeded,u.failed,u.canceled);i=e.notificationStatusDetails.format(i,e.notificationError);t.notifyCommandProgressWrapper(u,o.Error,i);throw n;}))}var k=i.Base,st=k.Diagnostics,ht=r.Hubs.Notifications,o=i.Hubs.Notifications.NotificationStatus,h=st.createLog(n),a=f.makeResourceManagerTelemetry,ct=k.Promises.PromiseStates.rejected,e=u.BulkCommand,v="Location",y="Retry-After",d="{resourceid}",g="<div>{0}<\/div>",lt="<div style='padding-top: 4px'>{0}<\/div>".format(e.errorDetails),at="<div class='ext-hubs-bulkcommand-notification-errordetails' style='padding-top: 4px'><a href='#resource{0}' style='text-decoration: underline'>{1}<\/a><span>: {2}<\/span><\/div>",s,l,nt,p,tt,c;t.createAndPublishBulkNotificationWrapper=wt;t.notifyCommandProgressWrapper=bt;t.DefaultRetryAfter=15e3;t.HighLatencyRetryAfter=3e4;s={};s[500]=s[502]=s[503]=s[504]=!0;l={};l[429]=l[409]=!0;nt=["PublicIPAddressCannotBeDeleted","InUseNetworkSecurityGroupCannotBeDeleted","NicInUse","InUseSubnetCannotBeDeleted","StorageAccountOperationFailed",];p={};p[429]=!0;tt=i.convertArrayToMap(["microsoft.compute/virtualmachines","microsoft.classiccompute/virtualmachines",],(function(n){return n}),(function(){return!0}));c={Succeeded:"succeeded",InProgress:"inprogress",Failed:"failed",Canceled:"canceled"};t.execute=gt})(e||(e={})),e}));
define("HubsExtension/BrowseGrid2/BulkDeleteBlade/BulkDeleteBladeModel",["require","exports"],(function(){"use strict";var n;return (function(n){n.MaxBatchDeleteResources=100})(n||(n={})),n}));
define("HubsExtension/BrowseGrid2/BulkDeleteBlade/BulkDeleteBlade",["require","exports","f","i","o","ko","Fx/Composition/TemplateBlade","Fx/Controls/Button","Fx/Controls/HotSpot","Fx/Controls/TextBox","Fx/Controls/Validations","FxInternal/Controls/Grid2/GridB","FxInternal/Data/ArrayListNavigator","HubsExtension/ArmHelpers/ArmBulkCommand","HubsExtension/Browse/BrowseClientStrings","HubsExtension/BrowseGrid2/BulkDeleteBlade/BulkDeleteBladeModel"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function g(n,t){n(t===1?w.deletingSingular:w.deletingPlural.format(t))}var b;u.defineProperty(t,"__esModule",{value:!0});var nt=i.Base,k=nt.Images,tt=i.ViewModels,it=tt.Controls,rt=r.ViewModels.Controls.Lists,d=it.InfoBox.ViewModel,ut="<div class='ext-res-field'><span class='msportalfx-gridcolumn-assetsvg-icon' aria-hidden='true' data-bind='image:value.item.icon, attr:{title:value.item.assetType}'><\/span><span class='msportalfx-gridcolumn-assetsvg-text'><span class='ext-res-field-name' data-bind='text:value.item.name'><\/span><span class='ext-res-field-type' data-bind='text: \"(\" + value.item.assetType + \")\"'><\/span><\/span><\/div><div class='ext-commandhotspot' data-bind='pcControl:value.delete'><div class='ext-commandimage' data-bind='image:MsPortalFx.Base.Images.Discard()'><\/div><\/div>",w=y.BulkCommand;b=(function(){function n(){}return n.prototype.onInitialize=function(){var r=this,u=this.context,n=u.container,t=u.parameters,i;return(this.title=w.deleteResources,this.subtitle=f.observable(),this.resourcesTitle=w.selectedResources,this.confirmationTitle=t.commandDefinition.confirmationTitle,this._resourceInfos=f.observableArray(t.resources),this.errorInfoBox=f.observable(null),this.deleteButton=o.create(n,{text:w.delete,disabled:!0,onClick:function(){v.execute(t.commandDefinition,t.resourceType,r._resourceInfos());n.closeCurrentBlade()}}),this.cancelButton=o.create(n,{text:w.cancel,onClick:function(){n.closeCurrentBlade()}}),i=t.resourceInfoCount,g(this.subtitle,i),i<1||i>p.MaxBatchDeleteResources)?(this.errorInfoBox(new d(n,null,!1,{image:f.observable(k.StatusBadge.Critical()),text:f.observable(w.deleteMaxResources.format(p.MaxBatchDeleteResources))})),Q()):(this.warningInfoBox=new d(n,null,!1,{image:f.observable(k.StatusBadge.Warning()),text:f.observable(t.commandDefinition.confirmationMessage)}),this.confirmTextBox=h.create(n,{label:w.deleteConfirmLabel,placeHolderText:w.deleteConfirmPlaceholder,infoBalloonContent:w.deleteConfirmInfo,suppressDirtyBehavior:!0,validations:[new c.LocaleAwareCaseInsensitiveComparison(w.deleteConfirmationText,w.deleteConfirmInfo),]}),this._initializeGrid(),f.reactor(n,(function(){r.deleteButton.disabled(!(r.context.form.validationState()===2))})),Q())},n.prototype._initializeGrid=function(){var i=this,n=this.context.container,t;this.resourcesGrid=new l.ViewModel(n,{dataNavigator:new a(n,{sourceItems:this._resourceInfos,getId:function(n){return n.resourceId},getModel:function(r){return t&&t.dispose(),t=n.createChildLifetime(),r.map((function(n){var r={resource:{item:n}};return r.resource.delete=new s.ViewModel(t,{onClick:function(){i._resourceInfos.remove((function(t){return t.resourceId===n.resourceId}));g(i.subtitle,i._resourceInfos().length)}}),r}))}}),showHeader:!1,columns:f.observableArray([{id:"resource",format:new rt.Grid2.Formatters.HtmlTemplate({template:ut})},])});this.resourcesGrid.dataNavigator.items.subscribeAndRun(n,(function(n){if(n.length===1){var t=n[0].data().resource.delete;t&&t.disabled(!0)}}))},n})();b=__decorate([e.Decorator({htmlTemplate:"BulkDeleteBlade.html",styleSheets:["BulkDeleteBlade.css"]}),e.LegacyFeatures.Decorator({width:2})],b);t.BulkDeleteBlade=b}));
define("HubsExtension/_generated/adapters/blade/BulkDeleteBladeAdapter",["require","exports","o","Fx/Composition/ViewModelAdapters","HubsExtension/BrowseGrid2/BulkDeleteBlade/BulkDeleteBlade"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t,i,r){return n.call(this,t,i,r,u.BulkDeleteBlade)||this}return __extends(t,n),t})(r.ViewModelAdapter);t.BulkDeleteBladeAdapter=f}));
define("HubsExtension/_generated/Blades/BulkDeleteBlade.css",["require","exports"],(function(){"use strict";return".ext-bulkdelete-container{margin-left:25px;width:400px}.ext-section-message{font-size:14px;padding-bottom:10px}.ext-section-message h2{font-size:110%}.ext-section-confirm{padding-top:15px 0 15px 0}.ext-section-title{margin-top:24px;font-size:14pt}.ext-section-grid2{padding:0;overflow:auto}.ext-deletebutton,.ext-cancelbutton{width:94px;margin-right:5px}.ext-res-field{padding:4px 6px;vertical-align:middle;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;display:inline-block;width:320px}.ext-res-field-name,.ext-res-field-type{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ext-res-field-name{flex:0 10000 auto;min-width:32px}.ext-res-field-type{flex:0 1 auto;margin-left:.4em}.ext-commandhotspot{display:inline-block;width:20px;padding:2px 6px;margin:0;vertical-align:middle}.ext-commandhotspot[aria-disabled=true] .ext-commandimage{opacity:.1}.ext-commandimage{padding:0;margin:2px;width:16px;height:16px}.ext-top-padding{padding-top:25px}.ext-bottom-padding{padding-bottom:25px}"}));
define("HubsExtension/_generated/Blades/BulkDeleteBlade",["require","exports","o","HubsExtension/_generated/Blades/BulkDeleteBlade.css","HubsExtension/_generated/adapters/blade/BulkDeleteBladeAdapter"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});t.blade={name:"BulkDeleteBlade",entryPoint:{module:"HubsExtension/_generated/adapters/blade/BulkDeleteBladeAdapter","export":"BulkDeleteBladeAdapter"},inputs:["resources","commandDefinition","resourceType","resourceInfoCount"],viewModelName:"BrowseGrid2$BulkDeleteBladeAdapter",lenses:[],width:2,pinnable:!1,style:8,toolbar:{source:{valuesFrom:[{referenceType:0,property:"content.commandBar"}]}},templateBlade:{partSize:9,htmlTemplateInline:{file:"BulkDeleteBlade.html",content:'<div class="msportalfx-docking ext-bulkdelete-container"> <div class="msportalfx-docking-body"> <!-- ko if: errorInfoBox --> <div data-bind="pcControl: errorInfoBox"><\/div> <!-- /ko --> <!-- ko ifnot: errorInfoBox --> <div class="ext-section-message"> <h2 data-bind=\'text: confirmationTitle\'><\/h2> <div data-bind="pcControl: warningInfoBox"><\/div> <\/div> <div class="ext-section-confirm msportalfx-form" data-bind=\'pcControl: confirmTextBox\' class=\'ext-confirmText\'><\/div> <div class="ext-section-title" data-bind="text: resourcesTitle"><\/div> <div class="ext-section-grid2" data-bind="pcControl: resourcesGrid"><\/div> <!-- /ko --> <\/div> <div class=\'msportalfx-docking-footer ext-top-padding ext-bottom-padding\'> <div data-bind=\'pcControl: deleteButton\' class=\'ext-deletebutton\'><\/div> <div data-bind=\'pcControl: cancelButton\' class=\'ext-cancelbutton\'><\/div> <\/div> <\/div>'},styleSheets:[{file:"Blades/BulkDeleteBlade.css",content:r}],isV2:!0},attributes:1}}))