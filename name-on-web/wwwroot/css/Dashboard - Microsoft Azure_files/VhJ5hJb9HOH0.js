var __extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ChooseImageBladeViewModel",["require","exports","f","o","ko","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources"],(function(n,t,i,r,u,f){"use strict";r.defineProperty(t,"__esModule",{value:!0});var e=(function(n){function t(t,i,r){var e=n.call(this)||this;return e.title(f.chooseImageViewModelTitle),e._dataContext=r,e._dataContext.chooseImageBladeState(null),e._dataContext.chooseImageBladeStateMessage(""),u.reactor(t,(function(){var n=e._dataContext.chooseImageBladeState(),t=e._dataContext.chooseImageBladeStateMessage();e.contentState(n);e.contentStateDisplayText(t)})),e}return __extends(t,n),t.prototype.onInputsSet=function(){return null},t})(i.ViewModels.Blade);t.ChooseImageBladeViewModel=e}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ChooseImagePartViewModel",["require","exports","f","o","ko","$","ReleaseManagement/TypeScript/Utilities/LinuxRuntimeStackUtility","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources","ReleaseManagement/TypeScript/Models/ContinuousIntegrationModel","ReleaseManagement/TypeScript/Utilities/UIValidations"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=i.ViewModels.Controls.InfoBox,l=i.Base.Images,a=(function(n){function t(t,r,f){var e=n.call(this,t)||this;return e.containerRegistryTitle=u.observable(),e.containerRegistryText=u.observable(),e.builtinImageSource=u.observable(!1),e._isLoading=u.observable(!1),e._dataContext=f,e._container=t,e.parameterProvider=new i.ViewModels.ParameterProvider(t,{mapIncomingDataForEditScopeAsync:function(n){return e.mapIncomingDataForEditScopeAsync(n)},mapOutgoingDataForCollector:function(n){return n}}),e.editScope=e.parameterProvider.editScope,e._initializeForm(),e.isFormValid=u.pureComputed((function(){return!e._isLoading()&&e.generalSection.valid()})),e}return __extends(t,n),t.prototype.onInputsSet=function(){return Q()},t.prototype._initializeForm=function(){var n=this,t,r,f,h;this.containerRegistryTitle(o.containerRegistryTitle);this.containerRegistryText(o.containerRegistryText);this.registryTypeTextBox=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"imageConfiguration.registryType",{label:u.observable(o.registryTypeTextBoxLabel),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),readonly:!0});this.usernameTextBox=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"imageConfiguration.username",{label:u.observable(o.usernameTextboxLabel),infoBalloonContent:u.observable(o.usernameOfRegistry),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),validations:u.observableArray([new i.ViewModels.RequiredValidation])});this.passwordTextBox=new i.ViewModels.Forms.PasswordBox.ViewModel(this._container,this,"imageConfiguration.password",{label:u.observable(o.passwordTextboxLabel),infoBalloonContent:u.observable(o.passwordOfRegistry),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),validations:u.observableArray([new i.ViewModels.RequiredValidation])});this.imagetagTextBox=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"imageConfiguration.imageTags",{label:u.observable(o.imagetagTextBoxLabel),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),readonly:!0});this.startupCommandTextBox=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"imageConfiguration.startupCommand",{label:u.observable(o.startupCommandTextBoxLabel),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),infoBalloonContent:u.observable(o.startupFileHelpTextForConatiners),validations:u.observableArray([])});this.serverUrlTextBox=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"imageConfiguration.serverUrl",{label:u.observable(o.serverUrlTextBoxLabel),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),readonly:!0});this.dockerFilePathTextBox=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"imageConfiguration.dockerFilePath",{label:u.observable(o.dockerFilePathTextBoxLabel),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),infoBalloonContent:u.observable(o.dockerFilePathTextBoxInfoLabel),validations:u.observableArray([new i.ViewModels.RequiredValidation(o.dockerFilePathTextBoxValidationText)])});t={label:u.observable(o.webApplicationFrameworkLabel),infoBalloonContent:u.observable(o.buildInfoText),options:u.observableArray([{text:u.observable(".NET Core"),value:s.WebAppFramework.AspNetCore},{text:u.observable("Node.js"),value:s.WebAppFramework.Node}]),validations:u.observableArray([new i.ViewModels.RequiredValidation(o.chooseImageFrameworkValidationText)])};t.options.push({text:u.observable("PHP"),value:s.WebAppFramework.PHP});t.options.push({text:u.observable("Ruby"),value:s.WebAppFramework.Ruby});this.builtinImageFrameworkDropDown=new i.ViewModels.Obsolete.Forms.DropDown.ViewModel(this._container,this,"imageConfiguration.webAppFramework",t);this.builtinImageFrameworkDropDown.value.subscribe(this._container,(function(t){n.updateOnChangeOfFramework(t);e.LinuxRuntimeStackUtility.fetchRuntimeStackVersions(n._dataContext).then((function(){n._setValuesOfFrameworkDropDownForBuiltinImages(t);n._setBladeState(0,"");n._isLoading(!1)})).catch((function(){n._setBladeState(3,o.failedToFetchRuntimeStackVersions)}))}));r={label:u.observable(o.chooseImageBladeVersionDropDownLabel),infoBalloonContent:u.observable(o.versionDropDownInfoText),options:u.observableArray([]),validations:u.observableArray([new i.ViewModels.RequiredValidation(o.chooseImageVersionValidationText)])};this.versionDropDown=new i.ViewModels.Obsolete.Forms.DropDown.ViewModel(this._container,this,"imageConfiguration.frameworkVersion",r);f={label:u.observable(o.taskRunnerLabel),options:u.observableArray([{text:u.observable("Gulp"),value:s.TaskRunner.Gulp},{text:u.observable("Grunt"),value:s.TaskRunner.Grunt},{text:u.observable("None"),value:s.TaskRunner.None}])};this.nodeTaskRunnerDropDown=new i.ViewModels.Obsolete.Forms.DropDown.ViewModel(this._container,this,"imageConfiguration.nodeTaskRunner",f);this.workingDirectoryControl=new i.ViewModels.Forms.TextBox.ViewModel(this._container,this,"imageConfiguration.workingDirectory",{label:u.observable(o.workingDirectoryLabel),labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Top),infoBalloonContent:u.observable(o.workingDirectoryHelpText)});this.registryTypeTextBox.disabled(!0);this.imagetagTextBox.disabled(!0);this.serverUrlTextBox.disabled(!0);this.registryTypeTextBox.value.subscribe(this._container,(function(t){return n._updateRegistryType(t)}));h={style:u.observable(3),children:u.observableArray([])};this.frameworkNotSupportedInfoBox=new c.LinkViewModel(this._container,{image:u.observable(l.Polychromatic.Info()),text:u.observable(o.notSupportedFrameworkInfoBoxContent),clickableLink:u.observable(i.ViewModels.Part.createClickableLinkViewModel(u.observable("https://go.microsoft.com/fwlink/?linkid=834361")))});this.builtinInfoBox=new c.LinkViewModel(this._container,{image:u.observable(l.Polychromatic.Info()),text:u.observable(o.builtinInfoBoxLabel),clickableLink:u.observable(i.ViewModels.Part.createClickableLinkViewModel(u.observable("https://go.microsoft.com/fwlink/?linkid=834361")))});this.generalSection=new i.ViewModels.Forms.Section.ViewModel(this._container,h);this.sections.push(this.generalSection)},t.prototype.mapIncomingDataForEditScopeAsync=function(n){var t=this,r=f.Deferred(),e,h;return n&&n.imageConfiguration?(e={registryType:n.imageConfiguration.registryType?n.imageConfiguration.registryType:u.observable(null),serverUrl:n.imageConfiguration.serverUrl?n.imageConfiguration.serverUrl:u.observable(null),username:n.imageConfiguration.username?n.imageConfiguration.username:u.observable(null),password:n.imageConfiguration.password?n.imageConfiguration.password:u.observable(null),imageTags:n.imageConfiguration.imageTags?n.imageConfiguration.imageTags:u.observable(null),startupCommand:n.imageConfiguration.startupCommand?n.imageConfiguration.startupCommand:u.observable(null),webAppFramework:n.imageConfiguration.webAppFramework?n.imageConfiguration.webAppFramework:u.observable(s.WebAppFramework.AspNetCore),frameworkVersion:n.imageConfiguration.frameworkVersion?n.imageConfiguration.frameworkVersion:u.observable(null),nodeTaskRunner:n.imageConfiguration.nodeTaskRunner?n.imageConfiguration.nodeTaskRunner:u.observable("None"),dockerFilePath:n.imageConfiguration.dockerFilePath?n.imageConfiguration.dockerFilePath:u.observable(o.dockerFilePathTextBoxDefaultValue),workingDirectory:n.imageConfiguration.workingDirectory?n.imageConfiguration.workingDirectory:u.observable("")},e.registryType()==o.builtinRegistryType&&this.builtinImageSource(!0),h={imageConfiguration:e},r.resolve(h)):(this._isLoading(!0),this._setBladeState(5,o.chooseImageCollectingInfoStateMessage),this._getImageConfiguration().then((function(n){n.registryType()!=s.ImageSource.Builtin&&(t._setBladeState(0,""),t._isLoading(!1));var i={imageConfiguration:n};r.resolve(i)})).catch((function(){t._setBladeState(3,o.chooseImageFailedToCollectInfoStateMessage);i.Base.Diagnostics.Log.writeEntry(2,"ReleaseManagementArea","Error fetching image config data")}))),r.promise()},t.prototype._getImageConfiguration=function(){var n=this;return Q.all([this._dataContext.appServiceArmManager.beginGetAppSettings(),this._dataContext.appServiceArmManager.beginGetAppServiceSiteConfig(),e.LinuxRuntimeStackUtility.fetchRuntimeStackVersions(this._dataContext)]).spread((function(t,i){var f=s.WebAppFramework.AspNetCore,l="",h="",c,r,a;if(i.properties.linuxFxVersion){c=i.properties.linuxFxVersion.split("|");l=i.properties.linuxFxVersion;switch(c[0].toLowerCase()){case"docker":h=c[1];break;case"dotnetcore":f=s.WebAppFramework.AspNetCore;break;case"node":f=s.WebAppFramework.Node;break;case"php":f=s.WebAppFramework.PHP;break;case"ruby":f=s.WebAppFramework.Ruby;break;default:f="Not Supported"}}return r={registryType:u.observable(""),imageTags:u.observable(h),serverUrl:u.observable(t.properties.DOCKER_REGISTRY_SERVER_URL||""),username:u.observable(t.properties.DOCKER_REGISTRY_SERVER_USERNAME||""),password:u.observable(t.properties.DOCKER_REGISTRY_SERVER_PASSWORD||""),startupCommand:u.observable(i.properties.appCommandLine||""),dockerFilePath:u.observable(o.dockerFilePathTextBoxDefaultValue),webAppFramework:u.observable(f),frameworkVersion:u.observable(JSON.stringify(e.LinuxRuntimeStackUtility.getRuntimeStackVersion(l))),nodeTaskRunner:u.observable("None"),workingDirectory:u.observable("")},t.properties.DOCKER_REGISTRY_SERVER_URL?r.registryType(o.privateRegistryType):h?t.properties.DOCKER_REGISTRY_SERVER_USERNAME&&t.properties.DOCKER_REGISTRY_SERVER_PASSWORD?r.registryType(o.privateDockerHub):r.registryType(o.publicDockerHub):(n.builtinImageSource(!0),r.registryType(o.builtinRegistryType),a=r.startupCommand(),r.startupCommand(a)),r}))},t.prototype._updateRegistryType=function(n){n==o.privateRegistryType?(this.usernameTextBox.disabled(!0),this.usernameTextBox.validations([]),this.startupCommandTextBox.validations([]),this.generalSection.children([this.registryTypeTextBox,this.serverUrlTextBox,this.imagetagTextBox,this.usernameTextBox,this.startupCommandTextBox,this.dockerFilePathTextBox])):n==o.publicDockerHub?(this.usernameTextBox.disabled(!1),this.startupCommandTextBox.validations([]),this.generalSection.children([this.registryTypeTextBox,this.imagetagTextBox,this.usernameTextBox,this.passwordTextBox,this.startupCommandTextBox,this.dockerFilePathTextBox])):n==o.privateDockerHub&&(this.usernameTextBox.disabled(!0),this.usernameTextBox.validations([]),this.startupCommandTextBox.validations([]),this.generalSection.children([this.registryTypeTextBox,this.imagetagTextBox,this.usernameTextBox,this.startupCommandTextBox,this.dockerFilePathTextBox]))},t.prototype._setValuesOfFrameworkDropDownForBuiltinImages=function(n){this.registryTypeTextBox.value()==s.ImageSource.Builtin&&(this._updateVersionDropdownOptions(n),this.shouldSetDefaultValueOfVersion()&&this.versionDropDown.value(JSON.stringify(e.LinuxRuntimeStackUtility.getDefaultVersionForFramework(n))))},t.prototype.updateOnChangeOfFramework=function(n){if(this.registryTypeTextBox.value()==s.ImageSource.Builtin)switch(n){case s.WebAppFramework.AspNetCore:this.startupCommandTextBox.validations([new i.ViewModels.RequiredValidation,new i.ViewModels.CustomValidation("",function(n){return h.BuiltinImageValidations.validateStartupFileForDotNetCore(n)})]);this.startupCommandTextBox.infoBalloonContent(o.startupFileBuiltinImagesForDotNetCore);this.generalSection.children([this.builtinImageFrameworkDropDown,this.versionDropDown,this.startupCommandTextBox]);break;case s.WebAppFramework.Node:this.startupCommandTextBox.validations([new i.ViewModels.CustomValidation("",function(n){return h.BuiltinImageValidations.validateStartupFileForNode(n)})]);this.startupCommandTextBox.infoBalloonContent(o.startupFileHelpTextForBuiltinImageForNode);this.generalSection.children([this.builtinImageFrameworkDropDown,this.versionDropDown,this.nodeTaskRunnerDropDown,this.startupCommandTextBox,this.workingDirectoryControl]);break;case s.WebAppFramework.PHP:this.generalSection.children([this.builtinImageFrameworkDropDown,this.versionDropDown,this.workingDirectoryControl]);break;case s.WebAppFramework.Ruby:this.startupCommandTextBox.validations([]);this.startupCommandTextBox.infoBalloonContent("");this.generalSection.children([this.builtinImageFrameworkDropDown,this.versionDropDown,this.startupCommandTextBox,this.workingDirectoryControl]);break;default:this.generalSection.children([this.builtinImageFrameworkDropDown,this.frameworkNotSupportedInfoBox]);this.generalSection.valid(!1)}},t.prototype._updateVersionDropdownOptions=function(n){var i,t;for(this.versionDropDown.options([]),i=e.LinuxRuntimeStackUtility.getVersionsForFramework(n),t=0;t<i.length;t++)this.versionDropDown.options.push({text:u.observable(i[t].properties.displayVersion),value:JSON.stringify(i[t])})},t.prototype.shouldSetDefaultValueOfVersion=function(){for(var n in this.versionDropDown.options())if(this.versionDropDown.options()[n].value===this.versionDropDown.value())return!1;return!0},t.prototype._setBladeState=function(n,t){this._dataContext.chooseImageBladeState(n);this._dataContext.chooseImageBladeStateMessage(t)},t})(i.ViewModels.Forms.Form.ViewModel);t.ChooseImagePartViewModel=a}));
define("_generated/Blades/ImageSourceBlade",["require","exports","_generated/Blades/VersionControl.css","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ChooseImageBladeViewModel","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ChooseSourceActionBar","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ChooseImagePartViewModel"],(function(n,t,i){"use strict";var r;return (function(n){n.blade={name:"ImageSourceBlade",viewModelName:"ReleaseManagement$ChooseImageBladeViewModel",lenses:[{name:"ChooseImageLens",partInstances:[{name:"ChooseImagePart",inline:{styleSheets:[{file:"Blades/VersionControl.css",content:i}],viewModel:"ReleaseManagement$ChooseImagePartViewModel",partKind:0,inputs:[],bindings:[],details:[],initialSize:9,supportedSizes:[9],htmlTemplateInline:{file:"ChooseImage.html",content:'<div class="msportalfx-form msportalfx-form-full"> <!-- ko if: builtinImageSource() != 1 --> <strong data-bind="text:containerRegistryTitle" style="font-size:medium;"><\/strong> <p data-bind="text:containerRegistryText" style="font-size:small;"><\/p> <!-- /ko --> <div data-bind="formElement: generalSection"> <\/div> <\/div>'}},parameterProvider:!0}]}],width:0,locked:!0,actionBar:{name:"genericActionBar",actionBarKind:6,viewModel:"ReleaseManagement$ChooseSourceActionBar",bindings:[{property:"valid",valuesFrom:[{referenceType:0,property:"content.isFormValid",part:"ChooseImagePart"}]}]},attributes:0}})(r||(r={})),r}))