define("B2B/ViewModels/AllowlistPolicyBlade",["require","exports","f","o","ko","B2B/B2BResources","B2B/Constants","Fx/Controls/OptionsGroup","Fx/Composition/TemplateBlade","Fx/Controls/TextBox","Fx/Controls/EditableGrid","Fx/Controls/Validations","Fx/Controls/RadioButtons","Permissions/Permission","Shared/Notification"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";r.defineProperty(t,"__esModule",{value:!0});var p={allowAll:"allowAll",allowList:"allowList",denyList:"denyList"},w=(function(){function n(){this.title=f.allowDenyListBladeTitle;this.subtitle="";this.showGrid=u.observable(!1);this.errorMode=u.observable(!1);this._usersCanAddExternalUsers=u.observable(!1);this._limitedAccessCanAddExternalUsers=u.observable(!1);this._restrictDirectoryAccess=u.observable(!1);this._allowInvitations=u.observable(!1);this._initialLoadComplete=u.observable(!1);this._isClean=u.observable(!0);this._isValid=u.observable(!0);this._domainListEdited=u.observable(!1);this._currentAllowDenyState=p.allowAll;this._template="<h3 data-bind='text: item' class='ext-directories-user-text-title'><\/h3>";this._templateWithSpacing="<div class='ext-directories-user-settings-spacing'><\/div>"+this._template}return n.prototype.onInitialize=function(){var n=this,r=this.context,t=r.container,e=r.model,h=[{objectType:v.TargetObjectType.DirectorySetting,actionType:v.ActionType.Read},{objectType:v.TargetObjectType.DirectorySetting,actionType:v.ActionType.Update}],c=v.Permission.CheckMultiplePermissions(h,t),o,s;return this._getB2BPolicyView=e.getB2BPolicy.createView(t),this._getB2BDirectoryPropertiesView=e.getB2BDirectoryPropertiesEntityCache.createView(t),this._initializeUserSettings(),this._initializeEditableGrid(),this._initializeRadioButtons(),o=this._getOrRefreshB2bPolicy(),s=this._getB2BDirectoryPropertiesView.fetch({}).then((function(){n.restrictDirectoryAccessOptionsGroup.value(n._getB2BDirectoryPropertiesView.item().restrictDirectoryAccess());n._restrictDirectoryAccess(n._getB2BDirectoryPropertiesView.item().restrictDirectoryAccess());n.allowInvitationsOptionsGroup.value(n._getB2BDirectoryPropertiesView.item().allowInvitations());n._allowInvitations(n._getB2BDirectoryPropertiesView.item().allowInvitations());n.usersCanAddExternalUsersOptionsGroup.value(n._getB2BDirectoryPropertiesView.item().usersCanAddExternalUsers());n._usersCanAddExternalUsers(n._getB2BDirectoryPropertiesView.item().usersCanAddExternalUsers());n.limitedAccessCanAddExternalUsersOptionsGroup.value(n._getB2BDirectoryPropertiesView.item().limitedAccessCanAddExternalUsers());n._limitedAccessCanAddExternalUsers(n._getB2BDirectoryPropertiesView.item().limitedAccessCanAddExternalUsers())})),this._populateCommandBar(),this._initializeSubscribers(),this.failedLoadInfoBox=new i.ViewModels.Controls.InfoBox.ViewModel(t,!1),this.failedLoadInfoBox.image=u.observable(i.Base.Images.Polychromatic.ErrorIcon()),this.failedLoadInfoBox.text=u.observable(f.allowlistErrorInfoBoxText),Q.all([o,s,c]).then((function(r){var o=r[2],u,e,f;if(!i.isNullOrUndefined(o))for(u=0,e=o;u<e.length;u++){f=e[u];switch(f.actionType){case v.ActionType.Read:f.hasAccess||t.unauthorized();break;case v.ActionType.Update:f.hasAccess&&n._enableControls()}}})).catch((function(){n.errorMode(!0);var t=new y.Notification;t.PublishOnError(f.allowlistBladeLoadFailed,f.allowlistBladeLoadFailed)}))},n.prototype._initializeUserSettings=function(){var n=this.context.container,t=[{text:f.yes,value:!0},{text:f.no,value:!1}],s={disabled:!0,label:f.allowInvitationsOptionsGroupTitle,infoBalloonContent:f.allowInvitationsOptionsHelpText,items:t},r,u,e;this.allowInvitationsOptionsGroup=o.create(n,s);r={disabled:!0,label:f.membersCanInviteGuestsCommandTitle,infoBalloonContent:f.usersCanAddGuestsHelpText,items:t};this.usersCanAddExternalUsersOptionsGroup=o.create(n,r);u={disabled:!0,label:f.guestsCanInviteGuestsCommandTitle,labelPosition:i.ViewModels.Forms.LabelPosition.Left,infoBalloonContent:f.limitedAccessCanAddGuestsHelpText,items:t};this.limitedAccessCanAddExternalUsersOptionsGroup=o.create(n,u);e={disabled:!0,label:f.restrictDirectoryAccessCommandTitle,labelPosition:i.ViewModels.Forms.LabelPosition.Left,infoBalloonContent:f.restrictDirectoryAccessHelpText,items:t};this.restrictDirectoryAccessOptionsGroup=o.create(n,e)},n.prototype._initializeRadioButtons=function(){var n=this.context.container,r={htmlTemplate:u.observable(this._templateWithSpacing),innerViewModel:{item:f.allowListRadioButtonLabel},labelPosition:u.observable(i.ViewModels.Forms.LabelPosition.Left)},t;this.radioButtonLabel=new i.ViewModels.Forms.CustomHtml.ViewModel(n,r);t={disabled:!0,label:"",cssClass:u.observable("ext-companyrelationships-allowlistpolicyblade-radiobuttons"),items:[{text:f.allowListRadioButtonAllowAll,value:p.allowAll},{text:f.allowListRadioButtonDenyList,value:p.denyList},{text:f.allowListRadioButtonAllowList,value:p.allowList}],singleItemPerLine:!0};this.allowDenyRadioButtons=a.create(n,t)},n.prototype._initializeSubscribers=function(){var n=this,t=this.context.container;u.reactor(t,(function(){n._updateDomainsOnPolicySwitch();n._updateDirtyState()}))},n.prototype._updateDomainsOnPolicySwitch=function(){var i=this.context.container,n,t;this.allowDenyRadioButtons.value()!==this._currentAllowDenyState&&(this.editableGridViewModel.items().length>0?(n=this._onDialogClosed.bind(this),t={buttons:4,content:f.allowListDialogBoxContent,onClosed:n,telemetryName:"Delete existing domains from allowlist or denylist",title:""},i.openDialog(t)):(this._currentAllowDenyState=this.allowDenyRadioButtons.value(),this._allowDenyStateChanged()))},n.prototype._onDialogClosed=function(n){n.button===6?(this._currentAllowDenyState=this.allowDenyRadioButtons.value(),this._allowDenyStateChanged()):this.allowDenyRadioButtons.value(this._currentAllowDenyState)},n.prototype._allowDenyStateChanged=function(){this.editableGridViewModel.items([]);this._domainListEdited(!0);this._initialLoadComplete()&&this.allowDenyRadioButtons.dirty(!0);this._currentAllowDenyState===p.allowAll?(this.showGrid(!1),this._isValid(!0)):(this.showGrid(!0),this._isValid(!1))},n.prototype._enableControls=function(){this.allowInvitationsOptionsGroup.disabled(!1);this.restrictDirectoryAccessOptionsGroup.disabled(!1);this.limitedAccessCanAddExternalUsersOptionsGroup.disabled(!1);this.usersCanAddExternalUsersOptionsGroup.disabled(!1);this.allowDenyRadioButtons.disabled(!1);this.editableGridViewModel.disabled(!1)},n.prototype._discardOptionsGroups=function(){this.allowInvitationsOptionsGroup.value(this._allowInvitations());this.restrictDirectoryAccessOptionsGroup.value(this._restrictDirectoryAccess());this.usersCanAddExternalUsersOptionsGroup.value(this._usersCanAddExternalUsers());this.limitedAccessCanAddExternalUsersOptionsGroup.value(this._limitedAccessCanAddExternalUsers());this.allowDenyRadioButtons.dirty(!1);this.editableGridViewModel.dirty(!1)},n.prototype._updateDirtyState=function(){if(this._initialLoadComplete()){var n=!0;this.allowInvitationsOptionsGroup.value()===this._allowInvitations()?this.allowInvitationsOptionsGroup.dirty(!1):(this.allowInvitationsOptionsGroup.dirty(!0),n=!1);this.limitedAccessCanAddExternalUsersOptionsGroup.value()===this._limitedAccessCanAddExternalUsers()?this.limitedAccessCanAddExternalUsersOptionsGroup.dirty(!1):(this.limitedAccessCanAddExternalUsersOptionsGroup.dirty(!0),n=!1);this.restrictDirectoryAccessOptionsGroup.value()===this._restrictDirectoryAccess()?this.restrictDirectoryAccessOptionsGroup.dirty(!1):(this.restrictDirectoryAccessOptionsGroup.dirty(!0),n=!1);this.usersCanAddExternalUsersOptionsGroup.value()===this._usersCanAddExternalUsers()?this.usersCanAddExternalUsersOptionsGroup.dirty(!1):(this.usersCanAddExternalUsersOptionsGroup.dirty(!0),n=!1);this._domainListEdited()&&(n=!1);this._isClean(n)}},n.prototype._getOrRefreshB2bPolicy=function(){var n=this;return this._getB2BPolicyView.fetch({}).then((function(){var t=n._getB2BPolicyView.item();t?(n._populateEditableGrid(n._getB2BPolicyView.item().targetedDomains().slice()),n._getB2BPolicyView.item().hasListEntries()?n._getB2BPolicyView.item().isAllowlist()?(n._currentAllowDenyState=p.allowList,n.showGrid(!0)):(n._currentAllowDenyState=p.denyList,n.showGrid(!0)):(n._currentAllowDenyState=p.allowAll,n.showGrid(!1)),n._isClean(!0)):(n._currentAllowDenyState=p.allowAll,n.showGrid(!1));n.allowDenyRadioButtons.value(n._currentAllowDenyState);n._domainListEdited(!1);n._initialLoadComplete(!0)}))},n.prototype._populateEditableGrid=function(n){for(var f,i=[],t=0,r=n;t<r.length;t++)f=r[t],i.push({domainName:u.observable(f)});this.editableGridViewModel.items(i)},n.prototype._cleanUxState=function(n,t,i){this._currentAllowDenyState=n?p.allowList:t.length>0?p.denyList:p.allowAll;this.allowDenyRadioButtons.value(this._currentAllowDenyState);this.allowDenyRadioButtons.dirty(!1);this._domainListEdited(!1);this.editableGridViewModel.dirty(!1);this._allowInvitations(i.allowInvitations());this._limitedAccessCanAddExternalUsers(i.limitedAccessCanAddExternalUsers());this._restrictDirectoryAccess(i.restrictDirectoryAccess());this._usersCanAddExternalUsers(i.usersCanAddExternalUsers())},n.prototype._save=function(){for(var o,n=this,r=this.context.model,t=[],i=0,e=this.editableGridViewModel.items();i<e.length;i++)o=e[i],t.push(o.domainName());this._getB2BPolicyView.refresh().then((function(){var i=null;i=n._getB2BPolicyView.item()!==null?{targetedDomains:u.observableArray(t),isAllowlist:u.observable(!1),hasListEntries:n._getB2BPolicyView.item().hasListEntries,adminConsentedForUsersIntoTenantIds:n._getB2BPolicyView.item().adminConsentedForUsersIntoTenantIds,noAADConsentForUsersFromTenantsIds:n._getB2BPolicyView.item().noAADConsentForUsersFromTenantsIds}:{targetedDomains:u.observableArray(t),isAllowlist:u.observable(!1),hasListEntries:u.observable(!0),adminConsentedForUsersIntoTenantIds:u.observableArray([]),noAADConsentForUsersFromTenantsIds:u.observableArray([])};n.allowDenyRadioButtons.value()===p.allowList&&i.isAllowlist(!0);var s=r.setB2BPolicy(i),o={allowInvitations:u.observable(n.allowInvitationsOptionsGroup.value()),limitedAccessCanAddExternalUsers:u.observable(n.limitedAccessCanAddExternalUsersOptionsGroup.value()),restrictDirectoryAccess:u.observable(n.restrictDirectoryAccessOptionsGroup.value()),usersCanAddExternalUsers:u.observable(n.usersCanAddExternalUsersOptionsGroup.value())},h=r.setB2BDirectoryProperties(o),e=new y.Notification;e.PublishInProgress(f.allowlistSaveInProgressNotification,f.allowlistSaveInProgressNotification);Q.all([s,h]).then((function(){n._cleanUxState(i.isAllowlist(),i.targetedDomains(),o);e.PublishOnSuccess(f.allowlistSaveSuccessfulNotification,f.allowlistSaveSuccessfulNotification)})).catch((function(){n._isClean(!1);e.PublishOnError(f.allowlistSaveFailedNotification,f.allowlistSaveFailedNotification)}))}));this._isClean(!0)},n.prototype._populateCommandBar=function(){var n=this,e=this.context.container,r=new i.ViewModels.Toolbars.CommandButton,t,o;r.label(f.saveButtonLabel);r.icon(i.Base.Images.Save());r.disabled=u.computed(e,(function(){return n._isClean()||!n._isValid()}));r.command={canExecute:u.observable(!0),execute:function(){return Q(n.context.form.triggerValidation().then((function(t){if(t&&!n._isClean()&&n._isValid())return n._save(),null})))}};t=new i.ViewModels.Toolbars.CommandButton;t.label(f.discardButtonLabel);t.icon(i.Base.Images.Discard());t.disabled=u.computed(e,(function(){return n._isClean()}));t.command={canExecute:u.observable(!0),execute:function(){return n._discardOptionsGroups(),n._getOrRefreshB2bPolicy(),n._isClean(!0),n._domainListEdited(!1),null}};o=new i.ViewModels.Toolbars.Toolbar(e);o.setItems([r,t]);e.commandBar=o},n.prototype._initializeEditableGrid=function(){var n=this,t=this.context.container;this.editableGridViewModel=c.create(t,{disabled:!0,ariaLabel:"A list of domains to be targeted by this policy",items:[],columns:[{id:"domainName",header:f.domainsListLabel,defineCell:function(n,t){return t.domainName},createCellEditor:function(t,r){return h.create(t,{value:r.domainName,validations:[new i.ViewModels.CustomValidation(null,function(t){return Q(n._validateDomainName(t))}),new l.Required(f.allowListValidationsRequired)],placeHolderText:f.allowListTextBoxPlaceholderText})}}],addition:{createItem:function(){return n._isValid(!0),{domainName:u.observable()}},canAddRow:function(){return!0},onAddRow:function(){n._domainListEdited(!0)}},deletion:{canDeleteRows:function(){return!0},onDeleteRows:function(){n._domainListEdited(!0)}},selection:{selectionMode:1},toolbar:{}})},n.prototype._validateDomainName=function(n){var i,t,r,u;if(n!=null){if(!e.domainUrlRegex.test(n))return{valid:!1,message:f.domainValidationsInvalid};for(i=!1,t=0,r=this.editableGridViewModel.items();t<r.length;t++)if(u=r[t],u.domainName()===n){if(i)return{valid:!1,message:f.allowListValidationsNoDuplicates};i=!0}}return{valid:!0,message:""}},n})();w=__decorate([s.Decorator({htmlTemplate:"../Templates/AllowlistPolicyTemplate.html",styleSheets:["../Styles/CompanyRelationshipsStyles.css"],isPinnable:!1})],w);t.AllowlistPolicyBlade=w}));
define("_generated/adapters/blade/AllowlistPolicyBladeAdapter",["require","exports","o","Fx/Composition/ViewModelAdapters","B2B/ViewModels/AllowlistPolicyBlade"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t,i,r){return n.call(this,t,i,r,u.AllowlistPolicyBlade)||this}return __extends(t,n),t})(r.ViewModelAdapter);t.AllowlistPolicyBladeAdapter=f}));
define("_generated/Blades/AllowlistPolicyBlade",["require","exports","_generated/Blades/UsersAreaStyles.css","_generated/Blades/UserProvisioning.css","_generated/Blades/Upsell.css","_generated/Blades/SupportRequestProblemDetailsAreaStyles.css","_generated/Blades/SpotlightStyles.css","_generated/Blades/SingleSignOn.css","_generated/Blades/SharedAreaStyles.css","_generated/Blades/Settings.css","_generated/Blades/SelectorAndGridStyles.css","_generated/Blades/PoliciesAreaStyles.css","_generated/Blades/PasswordResetAreaStyles.css","_generated/Blades/NotificationsAreaStyles.css","_generated/Blades/MultifactorAuthentication.css","_generated/Blades/MdmApps.css","_generated/Blades/ManagedApps.css","_generated/Blades/LoginTenantBranding.css","_generated/Blades/Licenses.css","_generated/Blades/GroupsAreaStyles.css","_generated/Blades/EnterpriseApps.css","_generated/Blades/Domains.css","_generated/Blades/DirectoriesAreaStyles.css","_generated/Blades/DevicesAreaStyles.css","_generated/Blades/CustomAppAddButtonParts.css","_generated/Blades/CompanyRelationshipsStyles.css","_generated/Blades/ClassicPolicies.css","_generated/Blades/AppList.css","_generated/Blades/ApplicationsStyles.css","_generated/Blades/ApplicationProxy.css","_generated/adapters/blade/AllowlistPolicyBladeAdapter"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st){"use strict";var ht;return (function(n){n.blade={name:"AllowlistPolicyBlade",viewModelName:"B2B$AllowlistPolicyBladeAdapter",lenses:[],pinnable:!1,initialDisplayState:2,style:8,toolbar:{source:{valuesFrom:[{referenceType:0,property:"content.commandBar"}]}},templateBlade:{htmlTemplate:null,partSize:9,htmlTemplateInline:{file:"AllowlistPolicyTemplate.html",content:'<div class="msportalfx-docking"> <div class="msportalfx-docking-body msportalfx-padding"> <!-- ko if: !errorMode()--> <div class="msportalfx-form"> <div data-bind="pcControl: restrictDirectoryAccessOptionsGroup"><\/div> <div data-bind="pcControl: allowInvitationsOptionsGroup"><\/div> <div data-bind="pcControl: usersCanAddExternalUsersOptionsGroup"><\/div> <div data-bind="pcControl: limitedAccessCanAddExternalUsersOptionsGroup"><\/div> <div data-bind="pcControl: radioButtonLabel"><\/div> <\/div> <div class="ext-companyrelationships-allowlistpolicyblade"> <div data-bind="pcControl: allowDenyRadioButtons"><\/div> <\/div> <div class="msportalfx-form"> <!-- ko if: showGrid()--> <div data-bind="pcControl: editableGridViewModel"><\/div> <!-- /ko--> <\/div> <!-- /ko--> <!-- ko if: errorMode()--> <div class="msportalfx-form"> <div data-bind="pcControl: failedLoadInfoBox"><\/div> <\/div> <!-- /ko--> <\/div> <\/div>'},styleSheets:[{file:"Blades/ApplicationProxy.css",content:st},{file:"Blades/EnterpriseApps.css",content:g},{file:"Blades/EnterpriseApps.css",content:g},{file:"Blades/AppList.css",content:et},{file:"Blades/CustomAppAddButtonParts.css",content:rt},{file:"Blades/ManagedApps.css",content:w},{file:"Blades/MdmApps.css",content:p},{file:"Blades/Settings.css",content:h},{file:"Blades/SingleSignOn.css",content:o},{file:"Blades/SharedAreaStyles.css",content:s},{file:"Blades/DevicesAreaStyles.css",content:it},{file:"Blades/DirectoriesAreaStyles.css",content:tt},{file:"Blades/Domains.css",content:nt},{file:"Blades/SharedAreaStyles.css",content:s},{file:"Blades/GroupsAreaStyles.css",content:d},{file:"Blades/Licenses.css",content:k},{file:"Blades/LoginTenantBranding.css",content:b},{file:"Blades/MultifactorAuthentication.css",content:y},{file:"Blades/NotificationsAreaStyles.css",content:v},{file:"Blades/PasswordResetAreaStyles.css",content:a},{file:"Blades/SelectorAndGridStyles.css",content:c},{file:"Blades/SelectorAndGridStyles.css",content:c},{file:"Blades/ClassicPolicies.css",content:ft},{file:"Blades/PoliciesAreaStyles.css",content:l},{file:"Blades/Upsell.css",content:u},{file:"Blades/ApplicationsStyles.css",content:ot},{file:"Blades/SharedAreaStyles.css",content:s},{file:"Blades/SpotlightStyles.css",content:e},{file:"Blades/SupportRequestProblemDetailsAreaStyles.css",content:f},{file:"Blades/SharedAreaStyles.css",content:s},{file:"Blades/UserProvisioning.css",content:r},{file:"Blades/SharedAreaStyles.css",content:s},{file:"Blades/UsersAreaStyles.css",content:i},{file:"Blades/CompanyRelationshipsStyles.css",content:ut}],isV2:!0},attributes:1}})(ht||(ht={})),ht}))