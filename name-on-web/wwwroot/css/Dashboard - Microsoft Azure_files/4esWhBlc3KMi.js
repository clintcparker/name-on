var __extends;define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/FragmentDefinition",["require","exports","o"],(function(n,t,i){"use strict";var r,u;i.defineProperty(t,"__esModule",{value:!0});r=(function(){function n(){}return n})();r.replace="replace";r.arrayPush="arraypush";t.FragmentParameterAction=r;u=(function(){function n(){}return n})();u.powershell="powershell";t.FragmentParameterEscape=u}));define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Models/FragmentModels",["require","exports","o"],(function(n,t,i){"use strict";var r,u;i.defineProperty(t,"__esModule",{value:!0});r=(function(){function n(){}return n})();r.replace="replace";r.arrayPush="arraypush";t.FragmentParameterAction=r;u=(function(){function n(){}return n})();u.powershell="powershell";t.FragmentParameterEscape=u}));define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/Fragment",["require","exports","o","a","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Models/FragmentModels","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/FragmentDefinition"],
(function(n,t,i,r,u,f){"use strict";return (function(){function n(n){var t=this,r,u;this.dependsOnIgnore={};this._parametersAdded={};this._computedCalculated={};this._conditionsAdded={};this._fragment=JSON.parse(n);this._fragment.computeds&&this._fragment.computeds.forEach((function(n){t._computedCalculated[n.paths[0]]=undefined}));r=[];for(u in this._fragment.parameters)r.push(u);this.parameters={};r.forEach((function(n){i.defineProperty(t.parameters,n,{get:function(){return t._getParameterValue(n)},set:function(i){t._addParameter(n,i)}})}))}return n.prototype.getResource=function(){var t=this;for(var n in this._fragment.parameters)if(this._fragment.parameters[n].required&&this._parametersAdded[n]===undefined)throw new Error("Required parameter {0} was missing".format(n));return this._fragment.resource.resources&&this._fragment.resource.resources.length&&this._fragment.resource.resources.forEach((function(n){n.dependsOn||(n.dependsOn=[]);var i=t.getDependsOnId();n.dependsOn.indexOf(i)===-1&&
n.dependsOn.push(i)})),this._fragment.computeds&&this._fragment.computeds.forEach((function(n){if(n.required&&t._computedCalculated[n.paths[0]]===undefined)throw new Error("A required computed was not calculated");})),this._fragment.resource},n.prototype._getParameterValue=function(n){return this._parametersAdded[n]},n.prototype._addParameter=function(n,t){var i=this;if(this._parametersAdded[n]=t,!this._fragment.parameters[n])throw new Error("The parameter named {0} does not exist".format(n));if(this._fragment.parameters[n].condition&&this._conditionsAdded[this._fragment.parameters[n].condition.name]!==this._fragment.parameters[n].condition.value)throw new Error("Can't add parameter named {0} until the conditional named {1} is set to {2}".format(n,this._fragment.parameters[n].condition.name,this._fragment.parameters[n].condition.value));this._fragment.parameters[n].paths.forEach((function(r){var u=i._fragment.parameters[n].action?i._fragment.parameters[n].action:f.FragmentParameterAction.replace,
e=i._fragment.parameters[n].escape;i._setValueOnPath(r.split("."),i._fragment.resource,t,u,e)}));this._calculateComputeds()},n.prototype.setConditional=function(n,t){if(!this._fragment.conditionals)throw new Error("No conditionals for this fragment");if(!this._fragment.conditionals[n])throw new Error("No conditional named {0} for this fragment".format(n));if(!this._fragment.conditionals[n][t])throw new Error("No conditionals value of {0} for condition {1}".format(t,n));var i=this._fragment.conditionals[n][t];this._setValueOnPath(i.path.split("."),this._fragment.resource,i.resource,f.FragmentParameterAction.replace);this._conditionsAdded[n]=t},n.prototype.getDependsOnId=function(){var n=this._fragment.resource.type.split("/"),r=this._fragment.resource.name.split("/"),i,t;if(n.length!==r.length+1)throw new Error("Fragment type and name are malformed: Type: '{0}', Name: '{1}'".format(this._fragment.resource.type,this._fragment.resource.name));if(n.length<2)throw new Error("Fragment type is malformed. '{0}'".
format(this._fragment.resource.type));for(i="{0}/{1}/{2}".format(n[0],n[1],r[0]),t=2;t<n.length;t++)i=i+"/{0}/{1}".format(n[t],r[t-1]);return i},n.prototype.getResourceId=function(n,t){var i=this.getDependsOnId();return n&&t?"/subscriptions/{0}/resourcegroups/{1}/providers/{2}".format(n,t,i):"[concat(resourceGroup().id, '/providers/{0}')]".format(i)},n.prototype.dependsOn=function(n){this.addDependsOn(n.getDependsOnId())},n.prototype.addRelatedTag=function(n){this.addTag("hidden-related:{0}".format(n),"Resource")},n.prototype.addLinkTag=function(n){this.addTag("hidden-link:{0}".format(n),"Resource")},n.prototype.addTag=function(n,t){this._fragment.resource.tags||(this._fragment.resource.tags={});this._fragment.resource.tags[n]=t},n.prototype.getReferenceTag=function(n,t){var r=this.getDependsOnId(),i="reference('{0}')";return t&&(i=i+"."+t),n&&(i="["+i+"]"),i.format(r)},n.prototype._calculateComputeds=function(){var n=this;this._fragment.computeds&&this._fragment.computeds.forEach((function(
t){var i;if(t.required&&t.condition&&n._conditionsAdded[t.condition.name]!==t.condition.value)throw new Error("A computed value is required, and requires that condition {0} be set to value {1}".format(t.condition.name,t.condition.value));if(!t.condition||n._conditionsAdded[t.condition.name]===t.condition.value){var e=t.template.match(/{[^{|^}]+}/g).map((function(n){return n.substring(1,n.length-1)})),r=!0,u={};e.forEach((function(t){var i,f;if(n._parametersAdded[t]){if(i=n.parameters[t],typeof i!="string")throw new Error("A computed required parameter {0}, which was not a string".format(t));f=n._fragment.parameters[t].escape;i=n._escapeIfNecessary(i,f);u[t]=i}else r=!1}));r&&(i=t.template.format(u),t.paths.forEach((function(t){n._setValueOnPath(t.split("."),n._fragment.resource,i,f.FragmentParameterAction.replace)})),n._computedCalculated[t.paths[0]]=i)}}))},n.prototype.addDependsOn=function(n,t){this._fragment.resource.dependsOn||(this._fragment.resource.dependsOn=[]);this._fragment.resource.
dependsOn.indexOf(n)===-1&&(t&&(this.dependsOnIgnore[n]=!0),this._fragment.resource.dependsOn.push(n))},n.prototype._setValueOnPath=function(n,t,i,f,e){for(var s,c,o,a,h,l=0;l<n.length-1;l++)s=n[l],s.match(/[0-9]+(?=\])/g)?(c=s.match(/[0-9]+(?=\])/g),a=".*(?=",c.forEach((function(){a+="\\[[0-9]\\]"})),a+=")",o=s.match(a)[0],t=t[o],c.forEach((function(n){if(r.isArray(t)){var i=parseInt(n,10);if(i>=t.length)throw new Error("Out of range. Tried to access index {0} on an array of length {1}".format(i,t.length));t=t[parseInt(n,10)]}else throw new Error("Tried to index an array that is not an array.");}))):(t[s]||(t[s]={}),t=t[s]);if(i=this._escapeIfNecessary(i,e),n[n.length-1].match(/[0-9]+(?=\])/g)){if(c=n[n.length-1].match(/[0-9]+(?=\])/g),o=n[n.length-1].match(/.*(?=\[)/)[0],c.length>1)throw new Error("The final path can only contain 1 array index");if(h=parseInt(c[0],10),!r.isArray(t[o]))throw new Error("Tried to index an array that is not an array");if(h>=t[o].length)throw new Error("Out of range. Tried to access index {0} on an array of length {1}".
format(h,t[o].length));AntUx.StringEx.equals(f,u.FragmentParameterAction.replace,AntUx.StringComparison.IgnoreCase)?t[o][h]=i:AntUx.StringEx.equals(f,u.FragmentParameterAction.arrayPush,AntUx.StringComparison.IgnoreCase)&&(r.isArray(t[o][h])||(t[o][h]=[]),t[o][h].push(i))}else AntUx.StringEx.equals(f,u.FragmentParameterAction.replace,AntUx.StringComparison.IgnoreCase)?t[n[n.length-1]]=i:AntUx.StringEx.equals(f,u.FragmentParameterAction.arrayPush,AntUx.StringComparison.IgnoreCase)&&(r.isArray(t[n[n.length-1]])||(t[n[n.length-1]]=[]),t[n[n.length-1]].push(i))},n.prototype._escapeIfNecessary=function(n,t){return typeof n=="string"&&AntUx.StringEx.equals(t,u.FragmentParameterEscape.powershell,AntUx.StringComparison.IgnoreCase)&&(n=n.replace(/`/g,"``"),n=n.replace(/"/g,'`"'),n=n.replace(/'/g,"`'")),n},n})()}));define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/TemplateFactory",["require","exports"],(function(){"use strict";return (function(){function n(){this._resources=[];this._template=
{$schema:"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",contentVersion:"1.0.0.0",parameters:{},resources:[]}}return n.prototype.addFragment=function(n){this._resources.push(n)},n.prototype.addResource=function(n){this._template.resources.push(n)},n.prototype.addParameter=function(n,t){if(this._template.parameters[n])throw new Error("Parameter {0} is already added".format(n));this._template.parameters[n]=t},n.prototype.addOutput=function(n,t,i){this._template.outputs||(this._template.outputs={});this._template.outputs[n]={type:t,value:i}},n.prototype.generateTemplate=function(){var t=this,n={};return this._resources.forEach((function(i){n[i.getDependsOnId()]=!0;t._template.resources.push(i.getResource());for(var r in i.dependsOnIgnore)n[r]=!0})),this._template.resources.forEach((function(t){t.dependsOn&&t.dependsOn.forEach((function(i){if(!n[i])throw new Error("{0}/{1} depends on {2}, but it was not present in the template".format(t.type,t.name,i));
}))})),JSON.stringify(this._template)},n})()}));define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Models/NetworkParameters",["require","exports","ko"],(function(n,t,i){"use strict";return (function(){function n(){this.vnetResourceId=i.observable("");this.vnetName=i.observable("");this.vnetAddressSpace=i.observable("");this.vnetPrimaryDns=i.observable("");this.vnetSecondaryDns=i.observable("");this.vnetSubnetName=i.observable("");this.vnetSubnetAddress=i.observable("")}return n})()}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Models/VirtualNetworkPickerModel",["require","exports","f","o","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Models/NetworkParameters"],
(function(n,t,i,r,u){"use strict";return (function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.Network=new u,t}return __extends(t,n),t})(i.Services.Gallery.GalleryDataModel)}));define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/IPv4Address",["require","exports","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Polyfills/ArgumentError","Websites/ClientResources/ExtensionCoreResources"],(function(n,t,i,r){"use strict";return (function(){function n(n){if(!n)throw new i(r.Network.Validation.nonNullAddress);this.address=n.split(".").map((function(t){if(t&&t.length>1&&t[0]==="0"||!t.match(/^\d+$/))throw new i(r.Network.Validation.malformedAddress.format(n));return parseInt(t,10)}));this._validateIpValue();this._calculateByteValues()}return n.prototype.toString=function(){return n.bytesToAddressString(this.subnetBytes)},n.prototype.equals=function(n){return this.subnetBytes===n.subnetBytes},n.prototype.isIpInRange=function(n,t){return n.subnetBytes<=
this.subnetBytes&&this.subnetBytes<t.subnetBytes},n.bytesToAddressString=function(n){return"{0}.{1}.{2}.{3}".format((n&4278190080)>>>24,(n&16711680)>>>16,(n&65280)>>>8,(n&255)>>>0)},n.prototype._validateIpValue=function(){if(this.address.length!==4)throw new i(r.Network.Validation.malformedAddress.format(this.address.join(".")));this._validateOctet(0);this._validateOctet(1);this._validateOctet(2);this._validateOctet(3)},n.prototype._validateOctet=function(n){if(isNaN(this.address[n])||this.address[n]<(n===0?1:0)||this.address[n]>255)throw new i(r.Network.Validation.octet.format(n+1,this.address[n],n===0?1:0,255));},n.prototype._calculateByteValues=function(){this.subnetBytes=(this.address[0]<<24>>>0|this.address[1]<<16>>>0|this.address[2]<<8>>>0|this.address[3]<<0>>>0)>>>0},n.GetNumberOfHostIpsInBlock=function(n){var t=32-n;return Math.pow(2,t)},n})()}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(
n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/IPv4Subnet",["require","exports","o","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/IPv4Address","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Polyfills/ArgumentError","Websites/ClientResources/ExtensionCoreResources"],(function(n,t,i,r,u,f){"use strict";return (function(n){function t(t){var r=this,o=0,e,i;if(!t)throw new u(f.Network.Validation.nonNullSubnet);if(e=t.split("/"),e.length===1)o=32;else if(e.length>2)throw new u(f.Network.Validation.malformedSubnet.format(t));else{if(i=e[1],i&&i.length>1&&i[0]==="0"||!i.match(/^\d+$/))throw new u(f.Network.Validation.malformedSubnet.format(t));o=parseInt(i,10)}return r=n.call(this,e[0])||this,r.prefix=o,r._validatePrefix(),r._calculateSubnetByteValues(),r}return __extends(
t,n),t.prototype.toString=function(){return"{0}/{1}".format(n.prototype.toString.call(this),this.prefix)},t.prototype.toAddressString=function(){return n.prototype.toString.call(this)},t.prototype.isOtherSubnetContained=function(n){return this.prefix<=n.prefix&&(this.subnetNetMaskBytes&n.subnetBroadcastAddressBytes)>>>0===this.subnetMaskBytes},t.prototype.doesSubnetOverlap=function(n){return this.isOtherSubnetContained(n)||n.isOtherSubnetContained(this)},t.prototype.getFirstAddressInRange=function(n){return r.bytesToAddressString(((this.subnetBytes&this.subnetNetMaskBytes)>>>0)+(n?n:0))},t.prototype.getLastAddressInRange=function(n){return r.bytesToAddressString(this.subnetBroadcastAddressBytes-(n?n:0))},t.prototype.doesContainIp=function(n){var i=new t(n.toString());return this.isOtherSubnetContained(i)},t.prototype.getSubnetRange=function(n,t){return"{0} - {1}".format(this.getFirstAddressInRange(n),this.getLastAddressInRange(t))},t.prototype.getUsableIpAddressCount=function(n,t){return n=
n?n:0,t=t?t:0,this.subnetBroadcastAddressBytes-((this.subnetBytes&this.subnetNetMaskBytes)>>>0)-n-t+1},t.prototype.getChildSubnet=function(n,i){var s=this._getUsablePrefix(n,!0),e,r,u,f,o;if(i&&i.length){if(e=0,i.forEach((function(n){e+=n.getUsableIpAddressCount()})),this.getUsableIpAddressCount()-e<Math.pow(2,32-n))return null;for(i.sort((function(n,t){return n.subnetBytes<t.subnetBytes?-1:1})),r=new t(this.getFirstAddressInRange()+"/"+s),u=!0;u;)for(u=!1,f=0;f<i.length;f++)if(o=i[f],r.doesSubnetOverlap(o)){r=o.getNextSubnet(n);u=!0;break}return this.isOtherSubnetContained(r)?r:null}return new t(this.getFirstAddressInRange()+"/"+s)},t.prototype.getIpAddress=function(n){var t=n?n:0;if(this.getUsableIpAddressCount()<t)throw new u("offset","The requested IP Address is not in this subnet");return r.bytesToAddressString(this.subnetBytes+t)},t.prototype.getNextSubnet=function(n){var i=this._getUsablePrefix(n,!1),u,f;return i<this.prefix?(f=new t(this.toAddressString()+"/"+i),u=r.bytesToAddressString(
f.subnetBroadcastAddressBytes+1)):u=r.bytesToAddressString(this.subnetBroadcastAddressBytes+1),new t(u+"/"+i)},t.prototype.findContainingAddressSpace=function(n){var r,i,f;if(!n||n.length===undefined)throw new u("addressSpaces","The list of address spaces must be an array");for(typeof n[0]=="string"&&(n=n.map((function(n){return new t(n)}))),r=n,i=0;i<r.length;i++)if(f=r[i],f.isOtherSubnetContained(this))return f;return null},t.prototype._getUsablePrefix=function(n,t){var i=this.prefix;if(n){if(typeof n=="string"&&(n=parseInt(n,10)),t&&n<this.prefix)throw new u("prefix","The supplied prefix was smaller than the parent. It must be greater than or equal to the parent");i=n}return i},t.findSubnetGap=function(n,i,e){var c,a,o,k,l,h,y,b,v;if(!n)throw new u("existingSubnets","existingSubnets must not be null");if(i<1||i>32)throw new u("desiredPrefix",f.Network.Validation.prefix);if(n.length===0)return new t("10.0.0.0/"+i.toString());for(c=typeof n[0]=="string"?n.map((function(n){return new t(n)})
):n,c.sort((function(n,t){return n.subnetBroadcastAddressBytes<t.subnetBroadcastAddressBytes?-1:1})),a=[],o=0;o<c.length;o++)if(k=a.first((function(n){return n===o})),!k)for(l=0;l<c.length;l++)o!==l&&c[o].isOtherSubnetContained(c[l])&&a.push(l);if(h=c.filter((function(n,t){var i=a.first((function(n){return n===t}));return i===null})),y=new t("10.0.0.0/"+i),y.subnetBroadcastAddressBytes<h[0].subnetBytes)return y;var s,p=new t("10.0.0.0/8"),w=new t("172.16.0.0/12"),d=new t("192.168.0.0/16");for(o=0;o<h.length;o++)if(b=h[o].prefix>i?new t(h[o].toAddressString()+"/"+i.toString()):h[o],v=o+1<h.length?h[o+1]:null,v===null||v.subnetBytes-b.subnetBroadcastAddressBytes>=Math.pow(2,32-i))if(s=new t(r.bytesToAddressString(b.subnetBroadcastAddressBytes+1)+"/"+i),e){if(p.isOtherSubnetContained(s)||w.isOtherSubnetContained(s)||d.isOtherSubnetContained(s))return s;if(v===null){if(s.subnetBroadcastAddressBytes<p.subnetBytes)return i>=8?new t("10.0.0.0/"+i):null;if(s.subnetBytes>p.subnetBroadcastAddressBytes&&
s.subnetBroadcastAddressBytes<w.subnetBytes)return i>=12?new t("172.16.0.0/"+i):null;if(s.subnetBytes>w.subnetBroadcastAddressBytes&&s.subnetBroadcastAddressBytes<d.subnetBytes)return i>=16?new t("192.168.0.0/"+i):null}}else return s},t.prototype._validatePrefix=function(){if(this.prefix<1||this.prefix>32)throw new u("Prefix",f.Network.Validation.prefix);},t.prototype._calculateSubnetByteValues=function(){this.subnetNetMaskBytes=4294967295<<32-this.prefix>>>0;this.subnetMaskBytes=(this.subnetNetMaskBytes&this.subnetBytes)>>>0;this.subnetBroadcastAddressBytes=((this.subnetNetMaskBytes^4294967295)>>>0|this.subnetBytes)>>>0},t})(r)}));define("WebsitesExtension/TypeScript/Networking/Models/NewVirtualNetworkTemplate",["require","exports","o"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});var r=(function(){function n(){}return n.prototype.getTemplate=function(){return JSON.stringify({$schema:"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
contentVersion:"1.0.0.0",parameters:{newNetworkName:{type:"string"},newNetworkLocation:{type:"string"},vnetAddressSpace:{type:"string"},defaultSubnetName:{type:"string"},defaultSubnetAddressSpace:{type:"string"},gatewayAddressSpace:{type:"string"},pointToSiteAddressSpace:{type:"string"}},variables:{legacyVnetName:"[concat('Group ', resourceGroup().name, ' ', parameters('newNetworkName'))]",virtualNetworkGatewayName:"[concat(parameters('newNetworkName'), '-gateway')]",ipName:"[concat(parameters('newNetworkName'), '-ip')]",gatewayIpConfigName:"[concat(parameters('newNetworkName'), '-gatewayipconfig')]"},resources:[{apiVersion:"2015-06-15",location:"[parameters('newNetworkLocation')]",name:"[parameters('newNetworkName')]",properties:{addressSpace:{addressPrefixes:["[parameters('vnetAddressSpace')]"]},subnets:[{name:"[parameters('defaultSubnetName')]",properties:{addressPrefix:"[parameters('defaultSubnetAddressSpace')]",ipConfigurations:[]}},{name:"GatewaySubnet",properties:{addressPrefix:
"[parameters('gatewayAddressSpace')]",ipConfigurations:[]}}]},type:"Microsoft.Network/virtualNetworks"},{apiVersion:"2015-06-15",dependsOn:["[concat('Microsoft.Network/virtualNetworks/', parameters('newNetworkName'))]"],name:"[variables('ipName')]",type:"Microsoft.Network/publicIPAddresses",location:"[parameters('newNetworkLocation')]",properties:{publicIPAllocationMethod:"Dynamic"}},{apiVersion:"2015-06-15",dependsOn:["[concat('Microsoft.Network/publicIPAddresses/', variables('ipName'))]"],location:"[parameters('newNetworkLocation')]",type:"Microsoft.Network/virtualNetworkGateways",name:"[variables('virtualNetworkGatewayName')]",properties:{ipConfigurations:[{name:"[variables('gatewayIpConfigName')]",id:"[resourceId('Microsoft.Network/virtualNetworkGateways/virtualNetworkGatewayIpConfigurations', variables('virtualNetworkGatewayName'), variables('gatewayIpConfigName'))]",properties:{privateIPAllocationMethod:"Dynamic",subnet:{id:"[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('newNetworkName'), 'GatewaySubnet')]"},
publicIPAddress:{id:"[resourceId('Microsoft.Network/publicIPAddresses', variables('ipName'))]"}}}],gatewayType:"Vpn",vpnType:"RouteBased",enableBgp:!1,sku:{name:"Basic",tier:"Basic",capacity:0},vpnClientConfiguration:{vpnClientAddressPool:{addressPrefixes:["[parameters('pointToSiteAddressSpace')]"]}}}}]})},n})();t.NewVirtualNetworkTemplate=r}));define("WebsitesExtension/TypeScript/VPNNetwork/Constants",["require","exports"],(function(){"use strict";var n;return (function(n){var t=(function(){function n(){}return n})();t.ControllerMethods={SyncCerts:"VPNNetworkSyncCerts",Disconnect:"VPNNetworkDisconnect",SetupVPN:"SetupVPNNetwork"};t.NotificationSources={SyncCerts:"VPNNetworkSyncCerts",Disconnect:"VPNNetworkDisconnect",SetupVPN:"VPNNetworkSetup"};n.Constants=t})(n||(n={})),n}));define("WebsitesExtension/TypeScript/VPNNetwork/Models/VirtualNetworkCertificateFragment",["require","exports","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/Fragment"],(function(n,t,i){"use strict";var r;return (function(
n){function t(){return new i(JSON.stringify({parameters:{virtualNetworkName:{paths:[],required:!0},thumbprint:{paths:[],required:!0},apiVersion:{paths:["apiVersion"],required:!0},data:{paths:["properties.data"],required:!0}},resource:{type:"Microsoft.ClassicNetwork/virtualNetworks/gateways/clientRootCertificates"},computeds:[{paths:["name"],template:"[concat('{virtualNetworkName}/primary/', {thumbprint})]",required:!0}]}))}n.getVirtualNetworkCertificateFrament=t})(r||(r={})),r}));define("WebsitesExtension/TypeScript/VPNNetwork/Models/VirtualNetworkFragment",["require","exports","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/Fragment"],(function(n,t,i){"use strict";var r;return (function(n){function t(){return new i(JSON.stringify({parameters:{resourceName:{paths:["name"],required:!0},resourceLocation:{paths:["location"],required:!0},apiVersion:{paths:["apiVersion"],required:!0},addressSpaces:{paths:["properties.addressSpace.addressPrefixes"],required:!0,action:"arraypush"},subnets:
{paths:["properties.subnets"],required:!0,action:"arraypush"},dnsServers:{paths:["properties.dhcpOptions.dnsServers"],required:!1,action:"arraypush"},vpnClientAddressSpace:{paths:["properties.vpnClientAddressSpace.addressPrefixes"],required:!1,action:"arraypush"}},resource:{type:"Microsoft.ClassicNetwork/virtualNetworks"}}))}n.GatewaySubnetName="GatewaySubnet";n.getVirtualNetworkFragment=t})(r||(r={})),r}));define("WebsitesExtension/TypeScript/VPNNetwork/Models/VirtualNetworkGatewayFragment",["require","exports","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/Fragment"],(function(n,t,i){"use strict";var r;return (function(n){function t(){return new i(JSON.stringify({parameters:{virtualNetworkName:{paths:[],required:!0},apiVersion:{paths:["apiVersion"],required:!0},routingType:{paths:["properties.routingType"],required:!0}},resource:{type:"Microsoft.ClassicNetwork/virtualNetworks/gateways"},computeds:[{paths:["name"],template:"{virtualNetworkName}/primary",required:!0}]}))}n.staticRoutingType=
"StaticRouting";n.dynamicRoutingType="DynamicRouting";n.getVirtualNetworkGatewayFrament=t})(r||(r={})),r}));define("WebsitesExtension/TypeScript/VPNNetwork/Models/WebsiteVPNGatewayFragment",["require","exports","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/Fragment"],(function(n,t,i){"use strict";var r;return (function(n){function t(){return new i(JSON.stringify({parameters:{websiteName:{paths:[],required:!0},vnetGuid:{paths:["properties.vnetName"],required:!0},apiVersion:{paths:["apiVersion"],required:!0},packageUri:{paths:["properties.vpnPackageUri"],required:!0}},resource:{type:"Microsoft.Web/serverfarms/virtualNetworkConnections/gateways"},computeds:[{paths:["name"],template:"{websiteName}/{vnetGuid}/primary",required:!0}]}))}function r(){return new i(JSON.stringify({parameters:{websiteName:{paths:[],required:!0},vnetGuid:{paths:["properties.vnetName"],required:!0},apiVersion:{paths:["apiVersion"],required:!0},packageUri:{paths:["properties.vpnPackageUri"],required:!0}},resource:
{type:"Microsoft.Web/sites/virtualNetworkConnections/gateways"},computeds:[{paths:["name"],template:"{websiteName}/{vnetGuid}/primary",required:!0}]}))}function u(){return new i(JSON.stringify({parameters:{websiteName:{paths:[],required:!0},slotName:{paths:[],required:!0},vnetGuid:{paths:["properties.vnetName"],required:!0},apiVersion:{paths:["apiVersion"],required:!0},packageUri:{paths:["properties.vpnPackageUri"],required:!0}},resource:{type:"Microsoft.Web/sites/slots/virtualNetworkConnections/gateways"},computeds:[{paths:["name"],template:"{websiteName}/{slotName}/{vnetGuid}/primary",required:!0}]}))}n.getServerFarmVPNGatewayFragment=t;n.getWebsiteVPNGatewayFragment=r;n.getWebsiteSlotVPNGatewayFragment=u})(r||(r={})),r}));define("WebsitesExtension/TypeScript/VPNNetwork/Utilities/Operations",["require","exports","f","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Utility/Utility.Slots","WebsitesExtension/TypeScript/VPNNetwork/Constants",
"WebsitesExtension/TypeScript/VPNNetwork/Models/VirtualNetworkCertificateFragment","WebsitesExtension/TypeScript/VPNNetwork/Models/WebsiteVPNGatewayFragment","WebsitesExtension/TypeScript/VPNNetwork/Models/VirtualNetworkGatewayFragment","WebsitesExtension/TypeScript/VPNNetwork/Models/VirtualNetworkFragment","WebsitesExtension/TypeScript/Ajax/Ajax","WebsitesExtension/TypeScript/Helpers/NotificationHelper","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/CSM/TemplateFactory","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/IPv4Subnet","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Data/Polling","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Models/PollStatus","WebsitesExtension/TypeScript/Networking/Models/NewVirtualNetworkTemplate"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";var k;return (function(n){function d(n,t){return AntUx.StringEx.equals(n,"Default-Networking",AntUx.StringComparison.IgnoreCase)?t:"Group {0} {1}".format(n,t)}function nt(
n,i,r,u,f){var o=new b.NewVirtualNetworkTemplate,s={subscriptionId:n,resourceGroupName:i,webAppName:r,template:JSON.parse(o.getTemplate()),newNetworkName:f.name(),newNetworkLocation:u,vnetAddressSpace:f.addressSpace(),defaultSubnetName:f.subnetName(),defaultSubnetAddressSpace:f.subnetAddressSpace(),gatewayAddressSpace:f.gatewaySubnetAddressSpace(),pointToSiteAddressSpace:f.pointToSiteAddressSpace()},e=l.post("CreateNewV2VirtualNetwork",s).then((function(n){return g(n)})),h=new a.NotificationSettings(t.createNewVirtualNetworkSuccessTitle,t.createNewVirtualNetworkSuccessText.format(f.name()),t.createNewVirtualNetworkFailedTitle,t.createNewVirtualNetworkFailedText.format(f.name()),t.createNewVirtualNetworkInProgressTitle,t.createNewVirtualNetworkInProgressText.format(f.name()));return a.trackOperationState(h,e),e}function tt(n,r,e){return i.Services.Rpc.invokeCallback(u.VirtualNetworks.VnetClassicExtensionName,"GetNewNetworkLocation",n.SubscriptionId,r).then((function(i){var u=new v,r=c.getVirtualNetworkFragment(
),ft,w,b,p,k,rt,st;r.parameters.resourceName=e.Network.vnetName();r.parameters.resourceLocation=i;r.parameters.apiVersion="2014-06-01";r.parameters.addressSpaces=e.Network.vnetAddressSpace();var nt=new y(e.Network.vnetAddressSpace()),ut=nt.getChildSubnet(nt.prefix+3>29?29:nt.prefix+3),ht=ut.getNextSubnet(29);r.parameters.subnets={name:"Subnet-1",addressPrefix:ut.toString()};r.parameters.subnets={name:c.GatewaySubnetName,addressPrefix:ht.toString()};ft=y.findSubnetGap([nt],24,!0);r.parameters.vpnClientAddressSpace=ft.toString();e.Network.vnetPrimaryDns()&&(r.parameters.dnsServers=e.Network.vnetPrimaryDns());e.Network.vnetSecondaryDns()&&(r.parameters.dnsServers=e.Network.vnetSecondaryDns());w=h.getVirtualNetworkGatewayFrament();w.parameters.routingType=h.dynamicRoutingType;w.parameters.virtualNetworkName=e.Network.vnetName();w.parameters.apiVersion="2014-06-01";b=o.getVirtualNetworkCertificateFrament();b.parameters.virtualNetworkName=e.Network.vnetName();b.parameters.thumbprint="parameters('certThumbprint')";
b.parameters.apiVersion="2014-06-01";b.parameters.data="[parameters('certData')]";var tt=f.parseWebsiteName(n.Name),it=d(n.ResourceGroup,e.Network.vnetName()),et="[listPackage(resourceId('Microsoft.ClassicNetwork/virtualNetworks/gateways/clientRootCertificates', '{0}', 'primary', parameters('certThumbprint')), '{1}').packageUri]".format(e.Network.vnetName(),"2014-06-01"),ot="[concat('Microsoft.ClassicNetwork/virtualNetworks/{0}/gateways/primary/clientRootCertificates/', parameters('certThumbprint'))]".format(e.Network.vnetName());return tt.SlotName?(p=s.getWebsiteSlotVPNGatewayFragment(),p.parameters.websiteName=tt.ProductionSiteName,p.parameters.slotName=tt.SlotName,p.parameters.vnetGuid=it,p.parameters.apiVersion="2014-06-01",p.parameters.packageUri=et,p.addDependsOn(ot,!0),u.addFragment(p)):(k=s.getWebsiteVPNGatewayFragment(),k.parameters.websiteName=n.Name,k.parameters.vnetGuid=it,k.parameters.apiVersion="2014-06-01",k.parameters.packageUri=et,k.addDependsOn(ot,!0),u.addFragment(k)),
u.addParameter("certThumbprint",{type:"string"}),u.addParameter("certData",{type:"string"}),w.dependsOn(r),b.dependsOn(w),u.addFragment(r),u.addFragment(w),u.addFragment(b),rt=l.post("SetupVPNNetworkWithNewNetwork",{SubscriptionId:n.SubscriptionId,ResourceGroup:n.ResourceGroup,Name:n.Name,VirtualNetworkResourceId:"/subscriptions/{0}/resourcegroups/{1}/providers/Microsoft.ClassicNetwork/virtualNetworks/{2}".format(n.SubscriptionId,n.ResourceGroup,e.Network.vnetName()),VnetGuid:it,MainSetupTemplate:JSON.parse(u.generateTemplate())}).then((function(n){return g(n)})),st=new a.NotificationSettings(t.createNewVirtualNetworkSuccessTitle,t.createNewVirtualNetworkSuccessText.format(e.Network.vnetName()),t.createNewVirtualNetworkFailedTitle,t.createNewVirtualNetworkFailedText.format(e.Network.vnetName()),t.createNewVirtualNetworkInProgressTitle,t.createNewVirtualNetworkInProgressText.format(e.Network.vnetName())),a.trackOperationState(st,rt),rt}))}function g(n){return p.setPolling((function(){return l.
post("GetDeploymentStatus",{ResourceUri:n})}),(function(t){return k[n]?(k[n]=!1,{status:w.CompleteFailure,response:t,error:r.Networking.pollingAborted}):AntUx.StringEx.equals(t.ProvisioningState,"Succeeded",AntUx.StringComparison.IgnoreCase)?{status:w.CompleteSuccess,response:t}:AntUx.StringEx.equals(t.ProvisioningState,"Failed",AntUx.StringComparison.IgnoreCase)?{status:w.CompleteFailure,response:t,error:t.LatestOperationMessage.error.message}:{status:w.NotComplete}}),1e4)}function it(n){k[n]=!0}function rt(n,r){var e=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(r.Network.vnetResourceId()),c=o.getVirtualNetworkCertificateFrament(),y=new v,p=new v,u,h,k,nt;c.parameters.virtualNetworkName=e.resource;c.parameters.thumbprint="parameters('certThumbprint')";c.parameters.apiVersion="2014-06-01";c.parameters.data="[parameters('certData')]";y.addFragment(c);y.addParameter("certData",{type:"string"});y.addParameter("certThumbprint",{type:"string"});var w=f.parseWebsiteName(n.Name),b=
d(e.resourceGroup,e.resource),g="[listPackage(resourceId('{0}', 'Microsoft.ClassicNetwork/virtualNetworks/gateways/clientRootCertificates', '{1}', 'primary', parameters('certThumbprint')), '{2}').packageUri]".format(e.resourceGroup,e.resource,"2014-06-01");return w.SlotName?(u=s.getWebsiteSlotVPNGatewayFragment(),u.parameters.websiteName=w.ProductionSiteName,u.parameters.slotName=w.SlotName,u.parameters.vnetGuid=b,u.parameters.apiVersion="2014-06-01",u.parameters.packageUri=g,p.addFragment(u)):(h=s.getWebsiteVPNGatewayFragment(),h.parameters.websiteName=n.Name,h.parameters.vnetGuid=b,h.parameters.apiVersion="2014-06-01",h.parameters.packageUri=g,p.addFragment(h)),p.addParameter("certThumbprint",{type:"string"}),k=l.post("SetupVPNNetworkWithExistingNetwork",{SubscriptionId:n.SubscriptionId,ResourceGroup:n.ResourceGroup,Name:n.Name,VirtualNetworkResourceId:r.Network.vnetResourceId(),VnetGuid:b,MainSetupTemplate:JSON.parse(p.generateTemplate()),PrerequisitResourceGroup:e.resourceGroup,PrerequisitSetupTemplate:
JSON.parse(y.generateTemplate())}),nt=new a.NotificationSettings(t.addExistingVirtualNetworkSuccessTitle,t.addExistingVirtualNetworkSuccessText.format(r.Network.vnetName(),n.Name),t.addExistingVirtualNetworkFailedTitle,t.addExistingVirtualNetworkFailedText.format(r.Network.vnetName(),n.Name),t.addExistingVirtualNetworkInProgressTitle,t.addExistingVirtualNetworkInProgressText.format(r.Network.vnetName(),n.Name)),a.trackOperationState(nt,k),k}function ut(n,r){var o=l.post(e.Constants.ControllerMethods.Disconnect,{VpnConnectorId:n,VnetResourceId:r}),s=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(n),h=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(r),u=s.resources[0],f=h.resource,c=new a.NotificationSettings(t.disconnectingVirtualNetworkSuccessTitle,t.disconnectingVirtualNetworkSuccessText.format(f,u),t.disconnectingVirtualNetworkFailedTitle,t.disconnectingVirtualNetworkFailedText.format(f,u),t.disconnectingVirtualNetworkInProgressTitle,t.disconnectingVirtualNetworkInProgressText.
format(f,u));return a.trackOperationState(c,o),o}function ft(n,i){var r=l.post("SyncVirtualNetworkRoutes",{WebAppVnetUri:n,NetworkingVnetUri:i}),u=new a.NotificationSettings(t.routesSyncSuccessTitle,t.routesSyncSuccessText,t.routesSyncFailureTitle,t.routesSyncFailureText,t.routesSyncInProgressTitle,t.routesSyncInProgressText);return a.trackOperationState(u,r),r}function et(n,i,r,u,f){var o=l.post("AddExistingV2VirtualNetworkToSite",{WebAppResourceId:i,VnetResourceId:r,VnetGatewayResourceId:u,VnetLocation:f}),e=r.split("/").last(),s=new a.NotificationSettings(t.addExistingVirtualNetworkSuccessTitle,t.addExistingVirtualNetworkSuccessText.format(e,n.Name),t.addExistingVirtualNetworkFailedTitle,t.addExistingVirtualNetworkFailedText.format(e,n.Name),t.addExistingVirtualNetworkInProgressTitle,t.addExistingVirtualNetworkInProgressText.format(e,n.Name));return a.trackOperationState(s,o),o}function ot(n,r,u){var h=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(n),c=i.ViewModels.Services.
ResourceTypes.parseResourceDescriptor(r),nt=h.resources[0],tt=h.resources.length===3?h.resources[1]:"",b=c.resource,y=o.getVirtualNetworkCertificateFrament(),k=new v,p,f,w,g;return y.parameters.virtualNetworkName=u.VnetName(),y.parameters.thumbprint="'{0}'".format(u.CertThumbprint()),y.parameters.apiVersion="2014-06-01",y.parameters.data=u.CertBlob(),k.addFragment(y),p=new v,f=s.getServerFarmVPNGatewayFragment(),f.parameters.websiteName=nt,f.parameters.vnetGuid=d(c.resourceGroup,b),f.parameters.apiVersion="2014-06-01",f.parameters.packageUri="[listPackage(resourceId('{0}', 'Microsoft.ClassicNetwork/virtualNetworks/gateways/clientRootCertificates', '{1}', 'primary', '{2}'), '{3}').packageUri]".format(c.resourceGroup,b,u.CertThumbprint(),"2014-06-01"),p.addFragment(f),w=l.post(e.Constants.ControllerMethods.SyncCerts,{VNetTemplate:JSON.parse(k.generateTemplate()),VNetSubscriptionId:c.subscription,VNetResourceGroup:c.resourceGroup,SiteTemplate:JSON.parse(p.generateTemplate()),SiteSubscriptionId:
h.subscription,SiteResourceGroup:h.resourceGroup}),g=new a.NotificationSettings(t.syncVirtualNetworkCertificatesSuccessTitle,t.syncVirtualNetworkCertificatesSuccessText,t.syncVirtualNetworkCertificatesFailedTitle,t.syncVirtualNetworkCertificatesFailedText,t.syncVirtualNetworkCertificatesInProgressTitle,t.syncVirtualNetworkCertificatesInProgressText),a.trackOperationState(g,w),w}function st(n,i){var r=l.post("SyncV2NetworkData",{VpnConnectorId:n,VnetResourceId:i}),u=new a.NotificationSettings(t.syncVirtualNetworkCertificatesSuccessTitle,t.syncVirtualNetworkCertificatesSuccessText,t.syncVirtualNetworkCertificatesFailedTitle,t.syncVirtualNetworkCertificatesFailedText,t.syncVirtualNetworkCertificatesInProgressTitle,t.syncVirtualNetworkCertificatesInProgressText);return a.trackOperationState(u,r),r}function ht(n,i){var r=l.post("SyncV2NetworkCertificates",{VpnConnectorId:n,VnetResourceId:i}),u=new a.NotificationSettings(t.syncVirtualNetworkDataSuccessTitle,t.syncVirtualNetworkDataSuccessText,
t.syncVirtualNetworkDataFailedTitle,t.syncVirtualNetworkDataFailedText,t.syncVirtualNetworkDataInProgressTitle,t.syncVirtualNetworkDataInProgressText);return a.trackOperationState(u,r),r}var t=r.Network,k={};n.newV2VirtualNetwork=nt;n.setupVPNNetworkWithNewNetwork=tt;n.pollVpnDeploymentStatus=g;n.disposePollingVpnDeploymentStatus=it;n.setupVPNNetworkWithExistingNetwork=rt;n.disconnectVPNNetwork=ut;n.syncRoutes=ft;n.setupWebAppWithExistingV2Vnet=et;n.syncCertificates=ot;n.syncV2Certificates=st;n.syncV2NetworkData=ht})(k||(k={})),k}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/Networking/ViewModels/NetworkSummaryBlade",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources",
"WebsitesExtension/TypeScript/Shared/SharedArea","WebsitesExtension/TypeScript/Models/WebsiteResourceId","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/_generated/Svg","WebsitesExtension/TypeScript/Networking/ViewModels/NetworkSummaryLauncherPart","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","WebsitesExtension/TypeScript/VPNNetwork/VPNNetworkArea","WebsitesExtension/TypeScript/VPNNetwork/Utilities/Operations","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/Models/WebHostingPlanResourceId","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Models/VirtualNetworkPickerModel","WebsitesExtension/TypeScript/Utility/Utility.DynamicBladeSelection","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/VPNNetwork/Models/VPNNetwork","WebsitesExtension/TypeScript/ViewModels/Parts/ScaleUpProvisioner"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){"use strict";
var nt;return (function(n){var r=f.Network,t=(function(){function n(){}return n})(),nt,tt;t.Loading="Loading";t.NoVnet="NoVnet";t.VnetFound="VnetFound";t.NeedUpgrade="NeedUpgrade";t.Provisioning="Provisioning";n.VnetState=t;nt=(function(n){function t(){var t=n.call(this)||this;return t.title(r.title),t.icon(h.Content.Images.appServiceConnectivity),t}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=o.WebsiteResourceId.fromCsmResourceId(n.resourceUri);return this.subtitle(t.Name),null},t})(i.ViewModels.Blade);n.NetworkSummaryBlade=nt;tt=(function(){function n(n,o,s){var l=this;this.resourceUri=u.observable("");this.WebsiteId=u.observable(null);this.vpnIcon=u.observable(i.Base.Images.Polychromatic.VirtualNetwork());this.learnMore=u.observable(r.learnMore);this.dataModel=new c.NetworkSummaryDataModel;this.vnetBladeSelectable=new i.ViewModels.Selectable;this.vnetConfigureSelectable=new i.ViewModels.Selectable;this.vnetLabel=u.observable(r.vnetLabel);this.vnetDesc=u.observable(r.vnetDesc);
this.vnetSetup=u.observable(r.vnetSetup);this.vnetConfigure=u.observable(r.vnetConfigure);this.vnetUpsellMessage=u.observable(r.vnetUpsellLong);this.vnetUpsellLinkMessage=u.observable(r.vnetUpsellLinkMessage);this.vnetState=u.observable(t.Loading);this.showVNet=u.observable(!1);this.showHybrid=u.observable(!1);this.showIpRestrictions=u.observable(!1);this.hybridIcon=u.observable(h.Content.Images.hybridConnectionService);this.hybridLabel=u.observable(r.hybridConnectionsLabel);this.hybridDesc=u.observable(r.hybridDesc);this.hybridConfigure=u.observable(r.hybridConfigure);this.hybridConfigureSelectable=new i.ViewModels.Selectable;this.cdnIcon=u.observable(i.Base.Images.Polychromatic.Cdn());this.cdnLabel=u.observable(r.cdnConnectionsLabel);this.cdnDesc=u.observable(r.cdnDesc);this.cdnConfigure=u.observable(r.cdnConfigure);this.cdnConfigureSelectable=new i.ViewModels.Selectable;this.ipRestrictionsIcon=u.observable(i.Base.Images.Canceled({palette:3}));this.ipRestrictionsLabel=u.observable(f.
IpRestrictions.title);this.ipRestrictionsDesc=u.observable(f.IpRestrictions.desc);this.ipRestrictionsConfigure=u.observable(f.IpRestrictions.configure);this.ipRestrictionsConfigureSelectable=new i.ViewModels.Selectable;this.triggeredSelectable=new i.ViewModels.Selectable;this._vnetCertOutOfSync=u.observable(!1);this._container=n;this._container.selectable=i.ViewModels.Part.createSelectableViewModel(o);this._siteView=e.DataContext.instance.websitesData.websiteCache.createView(n);this._serverFarmView=s.websitesData.webHostingPlanCache.createView(n);this._aseEntityView=s.aseData.aseCache.createView(n);this._vpnGatewayStatusView=a.DataContext.instance.VPNNetworkData.VPNNetworkGatewayStatusCache.createView(n,{interceptNotFound:!1});this._virtualNetworkEntityCache=a.DataContext.instance.VPNNetworkData.VirtualNetworkEntityCache.createView(n,{interceptNotFound:!1});this._vpnNetworkEntityCache=a.DataContext.instance.VPNNetworkData.VPNNetworkEntityCache.createView(n,{interceptNotFound:!1});this.
_virtualNetworkGatewayEntityCache=a.DataContext.instance.VPNNetworkData.VirtualNetworkGatewayEntityCache.createView(n,{interceptNotFound:!1});this._virtualNetworkGatewayV2EntityCache=a.DataContext.instance.VPNNetworkData.VirtualNetworkGatewayV2EntityCache.createView(n,{interceptNotFound:!1});this._scaleUpProvisioner=new g.ScaleUpProvisioner(this._serverFarmView,this._aseEntityView);this._initializeControls();this.triggeredSelectable.isSelected(!1);this.triggeredSelectable.isSelected.subscribe(n,(function(n){l._container.selectable.isSelected(n)}));o&&o.inTest||(this.vnetShowSelectable=u.pureComputed((function(){return l.vnetState()!==t.Loading&&l.vnetState()!==t.Provisioning})),u.reactor(n,(function(){var n=l._vpnGatewayStatusView.item();c.NetworkSummaryLauncherPart.updateVPNInfo(l.dataModel,l._siteView.item(),n,l._vnetCertOutOfSync());n&&n.VnetResourceId&&n.VnetResourceId()&&n.VnetName&&n.VnetName()&&l.vnetBladeSelectable.selectedValue(b.getVnetBlade(n.VnetResourceId()));l._updateVnetLinks(
n);l._configureCDNLink()})))}return n.prototype._updateVnetLinks=function(n){this.dataModel.showUpsell()?this.vnetState(t.NeedUpgrade):n&&n.Id()&&n.VnetResourceId()&&this.vnetState()!==t.VnetFound?(this.vnetState(t.VnetFound),this.vnetConfigureSelectable.selectedValue({detailBlade:l.BladeNames.virtualNetworkSiteSettingsBlade,detailBladeInputs:{resourceUri:n.Id(),vnetResourceUri:n.VnetResourceId(),parentResourceName:this.WebsiteId().Name}})):n&&!n.Id()&&this.vnetState()!==t.NoVnet&&this.vnetState()!==t.Provisioning&&(this.vnetState(t.NoVnet),this.vnetConfigureSelectable.isSelected(!1))},n.prototype._configureCDNLink=function(){this._siteView.item()&&this.cdnConfigureSelectable.selectedValue({extension:"Microsoft_Azure_Cdn",detailBlade:"CdnIntegrationBlade",detailBladeInputs:{resourceId:this.resourceUri(),location:this._siteView.item().Location(),originHostname:this._siteView.item().DefaultHostName()}})},n.prototype.onInputsSet=function(i){var u=this;this.resourceUri(i.resourceUri);this.WebsiteId(
o.WebsiteResourceId.fromCsmResourceId(i.resourceUri));this._container.assetName(this.WebsiteId().Name);this.hybridConfigureSelectable.selectedValue({detailBlade:l.BladeNames.hybridConnectionsNew,detailBladeInputs:{resourceUri:this.resourceUri()}});this.ipRestrictionsConfigureSelectable.selectedValue({detailBlade:l.BladeNames.ipRestrictionsBlade,detailBladeInputs:{resourceUri:this.resourceUri()}});var h=s.EnvPartNames.NetworkSummaryBladePart,f=e.DataContext.instance.objectCache.incObjCount(i.resourceId,h),c=y.telemetryStartTrace(h,"getSite",f);return Q.all([this._siteView.fetch(this.WebsiteId()),this._checkWebAppPermissions()]).then((function(){return u._scaleUpProvisioner.fetch(u._siteView.item().ServerFarmId(),u._siteView.item().HostingEnvironmentId())})).then((function(){var e,o,i;y.telemetryCompleteTrace(c,f);u._container.assetName(u._siteView.item().Name());k.getFeaturesForSite(u._siteView.item(),s.EnvPartNames.NetworkSummaryBladePart,u._siteView.item().SubscriptionId(),u._serverFarmView.
item(),null).then((function(n){u.showVNet(!k.hasFeature(n,s.EnvFeature.DisableVNetIntegration));u.showHybrid(!k.hasFeature(n,s.EnvFeature.DisableHybridConnection));u.showIpRestrictions(!k.hasFeature(n,s.EnvFeature.DisableIpRestrictions))}));e=y.telemetryStartTrace(h,"getVpnDefaultAddress",f);y.telemetryCompleteTrace(e,f);o=y.telemetryStartTrace(h,"getVpnStatus",f);u._defaultAddress="10.0.0.0/8";i={SubscriptionId:u.WebsiteId().SubscriptionId,ResourceGroup:u.WebsiteId().ResourceGroup,Name:u.WebsiteId().Name,GetGatewayStatus:!0};Q(u._vpnGatewayStatusView.fetch(i)).then((function(){return y.telemetryCompleteTrace(o,f),Q(n.isCertOutOfSync(u._vpnGatewayStatusView.item(),u._virtualNetworkEntityCache,u._vpnNetworkEntityCache,u._virtualNetworkGatewayV2EntityCache))})).then((function(n){u._vnetCertOutOfSync(n)})).catch((function(n){i.GetGatewayStatus=!1;console.log(n);n._errorData&&n._errorData.status===404&&(u.vnetState(t.NoVnet),u.dataModel.vnetMessage(r.notConfigured));u._vpnGatewayStatusView.fetch(
i)}));var v=y.telemetryStartTrace(h,"getHybrid",f),l=y.telemetryStartTrace(h,"getServerFarm",f),a=p.WebHostingPlanResourceId.fromWebsite(u._siteView.item());u._serverFarmView.fetch(a).then((function(){y.telemetryCompleteTrace(l,f)}))}))},n.prototype._initializeControls=function(){var n=this;this.pricingTierSelectable=new i.ViewModels.Selectable;this.pricingTierSelectable.isSelected.subscribe(this._container,(function(t){t&&n._container.openBlade(n._scaleUpProvisioner.getScaleUpBladeReference(null,(function(){n._siteView.refresh();n._serverFarmView.refresh()})));setTimeout((function(){n.pricingTierSelectable.isSelected(!1)}))}));this.vnetCollector=new i.ViewModels.ParameterCollector(this._container,{supplyProviderConfig:function(){return{subscriptionId:n.WebsiteId().SubscriptionId}},receiveResult:function(i){var u,f,r,e,o;i&&i.mode&&i.vnetType&&i.network&&i.mode==="existing"&&(i.vnetType==="Classic"&&(u=new w,u.Network.vnetResourceId(i.network.id),f=v.setupVPNNetworkWithExistingNetwork(n.WebsiteId(
),u),n.vnetState(t.Provisioning),f.then((function(){n._vpnGatewayStatusView.refresh()}))),i.vnetType==="V2"&&(r=i.network,e=v.setupWebAppWithExistingV2Vnet(n.WebsiteId(),n.resourceUri(),r.Id(),r.VnetGatewayUri(),r.Location()),n.vnetState(t.Provisioning),e.then((function(){n._vpnGatewayStatusView.refresh()}))));i&&!i.mode&&(o=i,v.newV2VirtualNetwork(n.WebsiteId().SubscriptionId,n.WebsiteId().ResourceGroup,n.WebsiteId().Name,n._siteView.item().Location(),o))},selectable:this.triggeredSelectable})},n.isCertOutOfSync=function(n,t,i,r){return n&&n.GatewayStatus()?Q.all([t.fetch(n.VnetResourceId()),i.fetch(n.Id())]).then((function(){var f=t.item(),u=i.item();return!f||!u?Q(!1):y.isClassicVnet(n.VnetResourceId())?Q(u.CertsInSync()===d.CertSyncStatus.NotInSync):Q(r.fetch(f.VnetGatewayUri())).then((function(){var n=r.item(),t=!1;return n&&n.VpnClientConfiguration()&&n.VpnClientConfiguration().VpnClientRootCertificates()&&n.VpnClientConfiguration().VpnClientRootCertificates().forEach((function(n){n.Properties(
).PublicCertData()===u.CertBlob()&&(t=!0)})),Q(!t)}))})):Q(!1)},n.prototype._checkWebAppPermissions=function(){var n=this;return i.Base.Security.hasPermission(this.resourceUri(),[l.AssetTypes.Website.Permissions.action,l.AssetTypes.Website.Permissions.writeWebsiteVPN]).then((function(t){t||n._container.noDataMessage(f.noAccessText)}))},n})();n.NetworkSummaryBladePart=tt})(nt||(nt={})),nt}))