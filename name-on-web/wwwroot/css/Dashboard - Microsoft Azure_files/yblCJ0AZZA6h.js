define("HubsExtension/Gallery/DataContexts/GalleryDataContext",["require","exports"],(function(){"use strict";var n;return (function(n){var t=(function(){function n(){}return n})();n.GalleryDataContext=t})(n||(n={})),n}));
define("HubsExtension/Gallery/ViewModels/Parts/ProvisionerPartVM",["require","exports","f","i","o","ko","HubsExtension/Gallery/GalleryClientStrings","HubsExtension/HubsCommon","HubsExtension/Gallery/DataContexts/GalleryDataContext"],(function(n,t,i,r,u,f,e,o,s){"use strict";var h;return (function(n){var v=i.Base,d=v.Diagnostics,y=v.Images,p=y.StatusBadge,g=i.Services.Gallery,w=g.Constants,h=i.ViewModels,nt=r.ViewModels,b=h.ParameterCollection.Internal,c=h.Services.ResourceTypes,l=e.ProvisionerPart,tt="uiDefinition",it="resourceId",k="id",rt=w.GalleryParametersKey,t=w.GalleryOptionsKey,ut=(function(){function n(){this.dirty=f.observable(!1)}return n})(),a=(function(n){function r(t,r){var e=n.call(this,t,r)||this,o,s;return e.provisioningStarted=f.observable(!1),e.subscriptionId=f.observable(),e.resourceGroupName=f.observable(),e.deploymentName=f.observable(),e.deploymentResponse=f.observable(),e.galleryParameters=f.observable(),e.galleryOptions=f.observable(),e.statusUnknown=f.observable(!1),e._initialized=!1,e._provisioner=null,e._container=null,e._galleryItemDisplayName=f.observable(""),e._assetPartId=null,e._assetPartKeyId=null,e._assetPartName=null,e._assetExtensionName=null,e._resourceId=null,e._previousCommit=null,e._options=null,e._hasInitialState=!1,e._editScopeView=null,o=e._ltm,e._hasInitialState=r&&u.keys(r).length>0,r&&r.content&&(e.provisioningStarted(!!r.content.provisioningStarted),e.galleryOptions(r.content.galleryOptions),e.deploymentResponse(r.content.deploymentResponse),e.deploymentResponse()&&(e.deploymentResponse().timestamp=new Date(e.deploymentResponse().timestamp),e.beginExecuteCommand(!0)),e.galleryParameters(r.content.galleryParameters),e.errorMessage(r.content.errorMessage),t.selectable.selectedValue(r.content.selectable&&r.content.selectable.selectedValue)),f.reactor(o,(function(){var n=e._galleryItemDisplayName(),t=e.errorMessage(),i=e.statusUnknown();t?e.title(l.resourceCreationFailedLabel.format(n)):i?e.title(l.resourceCreationStatusUnknownLabel.format(n)):e.title(l.resourceCreationInProgressLabel.format(n))})),f.reactor(o,(function(){var n=e.errorMessage(),t=e.statusUnknown();n?e.icon(p.Error()):t?e.icon(p.Warning()):e.icon(y.Gear())})),e._container=t,e.provisioningEntity={enableProvisioning:f.observable(!0),privatePcPrBI:new b.ProvisioningEntityBindingInternals},e._provisioner=new b.Provisioner(e.provisioningEntity),t.registerForDispose(e._provisioner),s=i.Data.EditScopeCache.createNew({supplyNewData:function(){return new ut}}),e._editScopeView=s.createView(t),e}return __extends(r,n),u.defineProperty(r.prototype,"assetPartKeyId",{get:function(){return this._assetPartKeyId},enumerable:!0,configurable:!0}),u.defineProperty(r.prototype,"assetPartName",{get:function(){return this._assetPartName},enumerable:!0,configurable:!0}),u.defineProperty(r.prototype,"assetExtensionName",{get:function(){return this._assetExtensionName},enumerable:!0,configurable:!0}),r.prototype.onInputsSet=function(n){var r,u,f,e,i;if(!n.provisioningOptions)return this._initializeProvisioner(this.galleryOptions(),this.galleryParameters()),this._reestablishPolling(),this._updateDisplayName(),null;if(!n.provisioningOptions.dynamicBladeSelection&&!(n.provisioningOptions.originalData&&n.provisioningOptions.data&&n.provisioningOptions.options))throw new Error("Invalid provisioningOptions specified. It should contain either dynamicSelection or a combination of data and options.");if(n.provisioningOptions.dynamicBladeSelection&&n.provisioningOptions.originalData&&n.provisioningOptions.data&&n.provisioningOptions.options)throw new Error("Invalid provisioningOptions specified. Both dynamicSelection and a combination data and options were specified. You should pass only one.");return n.provisioningOptions.originalData&&n.provisioningOptions.data&&n.provisioningOptions.options&&(this._initialized||(this._options=n.provisioningOptions.options,this.galleryOptions(n.provisioningOptions.options[t]),this._updateDisplayName(),r=this._options[t].uiDefinition.markup.reference,u=nt.getBladeSelection(r.bladeExtension,r.bladeName,{"collectorBindingInternals-inputs":{inputParameters:n.provisioningOptions.originalData.outputParameters,inputMetadata:{},options:{enableProvisioning:!0,galleryOptions:n.provisioningOptions.options[t]}},"collectorBindingInternals-errors":{},stepInput:{status:0,allowToggleProvisioningLocation:!0,masterIsProvisioningPart:!0}}),this.provisioningStarted()&&this._initializeProvisioner(n.provisioningOptions.options[t],this.galleryParameters()),this._container.selectable.selectedValue(u),this._initialized=!0),!this.provisioningStarted())?this._executeProvisioning(n.provisioningOptions):(n.provisioningOptions.dynamicBladeSelection&&(this._initialized||(f=n.provisioningOptions.dynamicBladeSelection.detailBladeInputs["collectorBindingInternals-inputs"],this._options=f.options,this.galleryOptions(this._options&&this._options.galleryOptions),this._updateDisplayName(),e=h.getBladeSelection(n.provisioningOptions.dynamicBladeSelection.extension,n.provisioningOptions.dynamicBladeSelection.detailBlade,{"collectorBindingInternals-inputs":n.provisioningOptions.dynamicBladeSelection.detailBladeInputs["collectorBindingInternals-inputs"],"collectorBindingInternals-errors":n.provisioningOptions.dynamicBladeSelection.detailBladeInputs["collectorBindingInternals-errors"],stepInput:{status:0,allowToggleProvisioningLocation:!0,masterIsProvisioningPart:!0}}),this.provisioningStarted()&&this._initializeProvisioner(this._options[t],this.galleryParameters()),this._container.selectable.selectedValue(e),this._initialized=!0),this.provisioningStarted()||this._hasInitialState||this._container.selectable.isSelected(!0)),(this.statusUnknown()||this.errorMessage())&&this._setBladeSelectionToDeploymentDetailsBlade(),this._updateDisplayName(),n.fromProviderBindingInternals&&(i=n.fromProviderBindingInternals.commit,i&&i!==this._previousCommit))?(this._makePartPermanent(),this._previousCommit=i,this._executeProvisioning({data:n.fromProviderBindingInternals.outputs,options:this._options})):this._editScopeView.fetchForNewData(n.editScopeId)},r.prototype._updateDisplayName=function(){var n=this.galleryOptions();this._galleryItemDisplayName(n&&n.galleryItem&&n.galleryItem.itemDisplayName)},r.prototype._reestablishPolling=function(){var n=Q.defer();this._container.operations.add(n.promise,{blockUi:!0});this.provisioningEntity.privatePcPrBI.provisioningStarted({galleryParameters:this.galleryParameters(),configurationOptions:this.galleryOptions(),deploymentResponse:this.deploymentResponse()});this._setupProvisioningCompletedSubscription(n)},r.prototype._setBladeSelectionToDeploymentDetailsBlade=function(){var n,t=this.subscriptionId()&&this.resourceGroupName()&&!this.statusUnknown()&&this.deploymentResponse();t&&(n=h.getBladeSelection(o.extensionName,o.deploymentDetailsBlade,{id:c.buildDeploymentId(this.subscriptionId(),this.resourceGroupName(),this.deploymentName())}));this._container.isSelectable(t);this._container.selectable.selectedValue(n)},r.prototype._setBladeSelectionToResourceGroupEvents=function(){var n;this.subscriptionId()&&this.resourceGroupName()&&(n=h.getBladeSelection(o.extensionName,o.resourceGroupEventsBlade,{id:c.buildResourceGroupIdFromSubscriptionAndResourceGroupName(this.subscriptionId(),this.resourceGroupName())}));this._container.selectable.selectedValue(n)},r.prototype._makePartPermanent=function(){this._editScopeView.editScope().root.dirty(!0);this._editScopeView.editScope().revertAll()},r.prototype._setGalleryParameters=function(n){if(!n)throw new Error("InputParameters galleryParameters are missing.");this.subscriptionId(n.subscriptionId);this.resourceGroupName(n.resourceGroupName);this.deploymentName(n.deploymentName);var t=n[it];t&&(this._resourceId=t,d.Log.writeEntry(1,"HubsExtension.Gallery.ProvisionerPartVM","'resourceId' on galleryParameters will be deprecated. Use 'primaryResourceId' instead."));n.primaryResourceId&&(this._resourceId=n.primaryResourceId)},r.prototype._executeProvisioning=function(n){var i=this,u,r,f;return this.provisioningStarted(!0),this.beginExecuteCommand(!0),u=n.data.outputParameters[rt],this._initializeProvisioner(n.options[t],u),this.galleryParameters(u),this.provisioningEntity.privatePcPrBI.provisioningAttempted({galleryParameters:u,configurationOptions:n.options[t]}),r=Q.defer(),f=this._provisioner.executeProvisioning(n.data,n.options),this._container.operations.add(r.promise,{blockUi:!0}),f.then((function(){i.deploymentResponse(i._provisioner.deploymentResponse);i._setupProvisioningCompletedSubscription(r)}),(function(){i.errorMessage("Unable to start provisioning.");i._setBladeSelectionToResourceGroupEvents();r.resolve()})),r.promise},r.prototype._setupProvisioningCompletedSubscription=function(n){var t=this;this.provisioningEntity.privatePcPrBI.provisioningCompleted.fxOnce(this._container,(function(i){i.succeeded?(n.resolve(),t._mutatePart()):(i.statusUnavailable||i.pollingFailed?t.statusUnknown(!0):t.errorMessage(i.errorMessage),t._setBladeSelectionToDeploymentDetailsBlade(),n.resolve())}))},r.prototype._initializeProvisioner=function(n,t){var r=n&&n[tt],i=((r||{}).markup||{}).reference||{};this._setGalleryParameters(t);this._resourceId&&i.partName&&i.partExtension?(this._assetPartKeyId=i.partKeyId,this._assetPartName=i.partName,this._assetExtensionName=i.partExtension,this._assetPartId=this._resourceId):(this._assetPartKeyId=k,this._assetPartName=o.resourceGroupPartName,this._assetExtensionName=o.extensionName,this._assetPartId=c.buildResourceGroupIdFromSubscriptionAndResourceGroupName(this.subscriptionId(),this.resourceGroupName()));this._assetPartKeyId===undefined&&(this._assetPartKeyId=k)},r.prototype._mutatePart=function(){var n={},t;n[this._assetPartKeyId]=this._assetPartId;t={partName:this._assetPartName,extensionName:this._assetExtensionName,containerModel:n};this._container.mutate(t)},r})(h.ProvisioningPart.ContentViewModel);a=__decorate([i.Composition.ProxyCompatibilityMode,__metadata("design:paramtypes",[u,u,s.GalleryDataContext])],a);n.ProvisionerPartVM=a})(h||(h={})),h}));
define("HubsExtension/_generated/Parts/ProvisionerPart",["require","exports","o","HubsExtension/Gallery/ViewModels/Parts/ProvisionerPartVM"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});t.part={viewModel:"Gallery$ProvisionerPartVM",entryPoint:{module:"HubsExtension/Gallery/ViewModels/Parts/ProvisionerPartVM","export":"ProvisionerPartVM"},partKind:17,canUseOldInputVersions:!1,inputs:["provisioningOptions"],bindings:[{property:"provisioningOptions",valuesFrom:[{referenceType:1,property:"provisioningOptions"}]}],details:[{invocationInputArguments:[{valuesFrom:[{referenceType:0,property:"container.selectable"}]}],outputArguments:[{property:"stepOutput",valuesFrom:[{referenceType:1,property:"stepOutput"}]},{property:"fromProviderBindingInternals.outputs",valuesFrom:[{referenceType:1,property:"collectorBindingInternals-outputs"}]},{property:"fromProviderBindingInternals.commit",valuesFrom:[{referenceType:1,property:"collectorBindingInternals-commit"}]}]}],initialSize:2,editScopeType:"PDLEditScope",viewStateProperties:["content.provisioningStarted","content.galleryOptions","content.galleryParameters","content.deploymentResponse","content.errorMessage"],styleSheets:[],name:"ProvisionerPart"}}))