var __extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/ContinuousDeployment/ViewModels/ContinuousDeploymentListBlade",["require","exports","f","o","Websites/ClientResources/ContinuousDeploymentResources"],(function(n,t,i,r,u){"use strict";var f;return (function(n){var t=(function(n){function t(){var t=n.call(this)||this;return t.title(u.DeploymentListBlade.title),t}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(n.ResourceId);return this.subtitle(t.resource),null},t})(i.ViewModels.Blade);n.ContinuousDeploymentListBlade=t})(f||(f={})),f}));define("WebsitesExtension/TypeScript/ContinuousDeployment/ViewModels/ContinuousDeploymentListPart",
["require","exports","f","ko","$","WebsitesExtension/TypeScript/ContinuousDeployment/Models/ScmDeployment","WebsitesExtension/TypeScript/Models/WebsiteResourceId","WebsitesExtension/TypeScript/ContinuousDeployment/Models/Resources/WebsiteResource","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","Websites/ClientResources/ContinuousDeploymentResources","WebsitesExtension/TypeScript/ContinuousDeployment/Models/ProviderType"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";var l;return (function(n){var t=(function(){function n(n,t,f){var e=this;this.openDeploymentDetailsBlade=r.observable();this.isVstsRm=r.observable(!1);this._deploymentList=r.observableArray([]);this._container=n;this._scmInfoEntityView=f.websitesData.scmInfoCache.createView(this._container);this.infoBox=new i.ViewModels.Controls.InfoBox.ViewModel(n,this);this.infoBox.text=r.observable(h.Vsts.setupInfo);this.infoBox.image=r.observable(i.Base.Images.Polychromatic.Info());this._setupGrid();this.openDeploymentDetailsBlade.
subscribe(n,(function(n){if(!n){var t=e.deploymentGrid.rowMetadata;t&&t()&&u.each(t(),(function(n,t){t.selected()&&t.selected(!1)}))}}))}return n.prototype.onInputsSet=function(t){var i=this,s;return t&&AntUx.StringEx.equals(this._resourceId,t.ResourceId)?null:(this._resourceId=t.ResourceId,s=e.WebsiteResourceId.fromCsmResourceId(this._resourceId),this._resource=new o.WebsiteResource(s,this._container),this._scmInfoEntityView.fetch(s).then((function(){i.isVstsRm(!1);i._scmInfoEntityView.item().ScmType()===c.ProviderType.VSTSRM?i.isVstsRm(!0):i._scmInfoEntityView.item().ScmType()===c.ProviderType.None?i.deploymentGrid.noRowsMessage(h.notConfigured):i.deploymentGrid.noRowsMessage(h.loadingMessage)})),this._resource.listDeployments().subscribe(this._container,(function(n){if(i.deploymentGrid.noRowsMessage(h.noDeploymentsFound),n&&n.length!==0){var t=[];i._resource.listDeployments()().forEach((function(n){var e=n.end_time()?new Date(n.end_time()):new Date,o=f.getUIDeploymentStatus(n);t.push(u.extend(
!0,{end_time_str:r.observable(e.toString("t")),group_key:r.observable(new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()),status_display_name:r.observable(f.getStatusDisplayName(o)),icon_status:r.observable(i.getIconByStatus(o)),commandGroup:"RedeployCommand"},n))}));i._deploymentList(t)}else i._deploymentList([])})),this._resource.initDeploymentsQuery().then((function(){i._resource.listDeployments()().length===0&&setTimeout((function(){i._fastRefresh(1)}),n.RefreshTimeout)})))},n.prototype._fastRefresh=function(t){var i=this;this._resource.listDeployments()().length===0&&t<n.RefreshMaxRetries&&this._resource.refreshDeployments().then((function(){setTimeout((function(){i._fastRefresh(t+1)}),n.RefreshTimeout)}))},n.prototype._setupGrid=function(){var n=this;this.deploymentGrid=new i.ViewModels.Controls.Lists.Grid.ViewModel(this._container,this._deploymentList,i.ViewModels.Controls.Lists.Grid.Extensions.Groupable|i.ViewModels.Controls.Lists.Grid.Extensions.SelectableRow|i.ViewModels.Controls.
Lists.Grid.Extensions.RightClickableRow,{selectableRow:{selectionMode:1,itemMatchesSelection:function(n,t){return AntUx.StringEx.equals(n.id(),t.id(),AntUx.StringComparison.IgnoreCase)},createSelection:function(n){return n}},groupable:{groupKey:r.observable("group_key"),sortOrder:r.observable(2),sortFunction:i.ViewModels.Controls.Lists.Grid.SortFunction.DateTime,headerFormat:i.ViewModels.Controls.Lists.Grid.Format.CustomDate,headerFormatOptions:{dateFormat:"ddd MM/dd"}}});this.deploymentGrid.showHeader=!1;this.deploymentGrid.noRowsMessage=r.observable(h.loadingMessage);this.deploymentGrid.columns([{itemKey:"icon_status",name:r.observable("Status"),format:i.ViewModels.Controls.Lists.Grid.Format.HtmlBindings,formatOptions:{htmlBindingsTemplate:"<div data-bind='image:value' style='width: 20px; height: 20px;'><\/div>",htmlBindingsType:i.ViewModels.Controls.Lists.Grid.HtmlBindingsType.Default},width:r.observable("20px")},{itemKey:"id",format:i.ViewModels.Controls.Lists.Grid.Format.HtmlBindings,
formatOptions:{htmlBindingsTemplate:"<div style='width:350px; vertical-align: top;' class='msportalfx-display-inlineblock'>   <p data-bind='text: settings.item.message' class='msportalfx-text-ellipsis' style='margin: 0;'><\/p>   <p data-bind='text: settings.item.deployer' style='margin: 0;'><\/p>   <p data-bind='text: settings.item.status_display_name' style='margin: 0;'><\/p><\/div><div data-bind='text: settings.item.end_time_str' class='msportalfx-display-inlineblock' style='vertical-align: top;' ><\/div>"},width:r.observable("110px")}]);this.deploymentGrid.selectableData.selectedItems.subscribe(this._container,(function(t){t&&t.length&&(t[0].status()===f.ScmDeploymentStatus.Active||t[0].status()===f.ScmDeploymentStatus.Failed||t[0].status()===f.ScmDeploymentStatus.InActive||t[0].status()===f.ScmDeploymentStatus.Success)&&n.openDeploymentDetailsBlade({detailBlade:s.BladeNames.continuousDeploymentDetailsBlade,detailBladeInputs:{DeploymentId:t[0].id(),ResourceId:n._resourceId}})}))},n.prototype.
getIconByStatus=function(n){switch(n){case f.ScmDeploymentStatus.Success:case f.ScmDeploymentStatus.Active:return i.Base.Images.Check();case f.ScmDeploymentStatus.InActive:return i.Base.Images.Inactive();case f.ScmDeploymentStatus.Building:return i.Base.Images.Loading.Spinner();case f.ScmDeploymentStatus.Deploying:return i.Base.Images.Loading.Spinner();case f.ScmDeploymentStatus.Pending:return i.Base.Images.Loading.Spinner();default:return i.Base.Images.StatusBadge.Error()}},n})();t.RefreshTimeout=1e4;t.RefreshMaxRetries=12;n.ContinuousDeploymentListPart=t})(l||(l={})),l}));define("WebsitesExtension/TypeScript/_generated/Blades/ContinuousDeploymentListBlade",["require","exports","WebsitesExtension/TypeScript/_generated/Blades/PropertyRowControl.css","WebsitesExtension/TypeScript/_generated/Blades/ButtonControl.css","WebsitesExtension/TypeScript/_generated/Blades/QuickLinks.css","WebsitesExtension/TypeScript/_generated/Blades/SingleSiteExtensionPartStyle.css","WebsitesExtension/TypeScript/_generated/Blades/QuickStartPartStyle.css",
"WebsitesExtension/TypeScript/_generated/Blades/LogStreamPartStyle.css","WebsitesExtension/TypeScript/_generated/Blades/BrowseNoticeStyle.css","WebsitesExtension/TypeScript/_generated/Blades/Networking.css","WebsitesExtension/TypeScript/_generated/Blades/cpListStyles.css","WebsitesExtension/TypeScript/_generated/Blades/Push.css","WebsitesExtension/TypeScript/_generated/Blades/ApiHubStyles.css","WebsitesExtension/TypeScript/_generated/Blades/StepsControl.css","WebsitesExtension/TypeScript/_generated/Blades/PostItNoteControl.css","WebsitesExtension/TypeScript/_generated/Blades/RowControl.css","WebsitesExtension/TypeScript/_generated/Blades/MobileStyles.css","WebsitesExtension/TypeScript/ContinuousDeployment/ViewModels/ContinuousDeploymentListBlade","WebsitesExtension/TypeScript/ContinuousDeployment/ViewModels/ContinuousDeploymentListPart"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";var b;return (function(n){n.blade={name:"ContinuousDeploymentListBlade",inputs:["id","ResourceId"],
templateKeyInputs:["id"],viewModelName:"ContinuousDeploymentListBlade",lenses:[{name:"Deployment",partInstances:[{name:"ContinuousDeploymentListPart",inline:{styleSheets:[{file:"Blades/MobileStyles.css",content:w},{file:"Blades/RowControl.css",content:p},{file:"Blades/PostItNoteControl.css",content:y},{file:"Blades/StepsControl.css",content:v},{file:"Blades/ApiHubStyles.css",content:a},{file:"Blades/Push.css",content:l},{file:"Blades/StepsControl.css",content:v},{file:"Blades/cpListStyles.css",content:c},{file:"Blades/cpListStyles.css",content:c},{file:"Blades/Networking.css",content:h},{file:"Blades/Networking.css",content:h},{file:"Blades/BrowseNoticeStyle.css",content:s},{file:"Blades/LogStreamPartStyle.css",content:o},{file:"Blades/QuickStartPartStyle.css",content:e},{file:"Blades/SingleSiteExtensionPartStyle.css",content:f},{file:"Blades/QuickLinks.css",content:u},{file:"Blades/ButtonControl.css",content:r},{file:"Blades/PropertyRowControl.css",content:i}],viewModel:"ContinuousDeploymentListPart",
partKind:0,inputs:["ResourceId"],bindings:[{property:"ResourceId",valuesFrom:[{referenceType:1,property:"ResourceId"}]}],details:[{invocationInputArguments:[{valuesFrom:[{referenceType:0,property:"content.openDeploymentDetailsBlade"}]}]}],initialSize:7,supportedSizes:[7],htmlTemplateInline:{file:"ContinuousDeploymentListPart.html",content:'<div data-bind="pcControl: infoBox, visible: isVstsRm()"><\/div> <div data-bind="pcGrid: deploymentGrid, visible: !isVstsRm()"><\/div>'}}}]}],commandGroupReference:{name:"SCMDeploymentsCommandGroupWithPerformanceTest",commands:[{name:"ConfigurePerformanceTest",bindings:[{property:"ResourceId",valuesFrom:[{referenceType:1,property:"ResourceId"}]}]}]},viewModelInputs:[{property:"ResourceId",valuesFrom:[{referenceType:1,property:"ResourceId"}]},{property:"id",valuesFrom:[{referenceType:1,property:"id"}]}],locked:!0,assetIdInputProperty:"id",pinnedPart:"ContinuousDeploymentInfo",pinnable:!0,attributes:0}})(b||(b={})),b}))