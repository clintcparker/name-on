var __extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/ViewModels/Commands/DisconnectScmCommandViewModel",["require","exports","f","o","ko","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/Operations/Operations.Scm","WebsitesExtension/TypeScript/ContinuousDeployment/Models/ProviderType","WebsitesExtension/TypeScript/Models/WebsiteResourceId","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/Utility/Utility.Urls","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";r.defineProperty(t,"__esModule",{value:!0});"use strict";var a=(function(n){function t(t,r,f){var e=n.call(
this)||this;return e.icon(i.Base.Images.Disconnect()),e._resourceId=u.observable(),e._baseSiteResourceId=u.observable(),e._dataContext=f,e._websiteDataView=f.websitesData.websiteCache.createView(t),e._scmInfoEntityView=f.websitesData.scmInfoCache.createView(t),e._appSettingsView=f.websiteDataConfig.appSettingsCache.createView(t),e._slotConfigNamesView=f.websiteDataConfig.slotConfigNamesCache.createView(t),e.enabled=u.pureComputed((function(){return e._websiteDataView.item()!==null&&e._scmInfoEntityView.item()!==null&&e._scmInfoEntityView.item().ScmType()!==o.ProviderType.None&&e._scmInfoEntityView.item().ScmType()!==o.ProviderType.VSTSRM})),e}return __extends(t,n),t.prototype.execute=function(){var n=new i.ViewModels.Dialogs.MessageBox(f.DisconnectScm.title,f.DisconnectScm.confirmationMessage,4);this.dialog(n)},t.prototype.dialogClick=function(n){var t=this;n===6&&e.DisconnectSCM(this._websiteDataView.item(),this._scmInfoEntityView.item().ScmType()).then((function(){var e,n,r,o,i,f,s,c;t.
_scmInfoEntityView.refresh();e=t._appSettingsView.item().properties();n=h.deleteAppSetting(e,l.LoadTesting.performanceVersionKey);n=h.deleteAppSetting(n,l.LoadTesting.performanceTestConfigKey);r=t._appSettingsView.item();r.properties=u.observable(n);o=t._slotConfigNamesView.item().properties();i=h.deleteSlotConfigNameAppSettings(o,l.LoadTesting.performanceTestConfigKey);i=h.deleteSlotConfigNameAppSettings(i,l.LoadTesting.performanceVersionKey);f=t._slotConfigNamesView.item();f.properties=u.observable(i);s=t._dataContext.websiteDataConfig.updateAppSettings(t._resourceId(),r);c=t._dataContext.websiteDataConfig.updateSlotConfigNames(t._baseSiteResourceId(),f);Q.all([s,c])}))},t.prototype.onInputsSet=function(n){var t=null,r,u,f;return t=n.id.Name?n.id:s.WebsiteResourceId.fromCsmResourceId(n.id),this._resourceId(s.WebsiteResourceId.toCsmResourceId(t)),r=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(this._resourceId()),this._baseSiteResourceId(c.getWebsiteCsmId(r.subscription,r.
resourceGroup,r.resources[0])),u=this._appSettingsView.fetch(this._resourceId()),f=this._slotConfigNamesView.fetch(this._baseSiteResourceId()),Q.all([this._websiteDataView.fetch(t),this._scmInfoEntityView.fetch(t),u,f])},t})(i.ViewModels.Command);t.DisconnectScmCommandViewModel=a}))