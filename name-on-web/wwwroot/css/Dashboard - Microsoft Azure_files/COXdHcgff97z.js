var __extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("Core/TypeScript/TFS.Project.WebApi",["require","exports","o","Core/TypeScript/TFS.WebApi","Core/TypeScript/Generated/TFS.Project.Constants"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.beginGetProjects=function(n){return n===void 0&&(n=!1),this._beginRequest({area:u.CoreConstants.AreaName,locationId:u.CoreConstants.ProjectsLocationId,responseIsCollection:!0,responseType:u.TypeInfo.WebApiProject,version:"1.0-preview.1",data:{includeCapabilities:n}})},t.prototype.beginGetProject=function(n,t){return t===void 0&&(t=!1),this._beginRequest({area:u.CoreConstants.AreaName,locationId:u.CoreConstants.ProjectsLocationId,responseType:u.TypeInfo.WebApiProject,version:"1.0-preview.1",routeValues:{projectId:n},data:{includeCapabilities:t}})},t})(r.VssHttpClient);t.ProjectHttpClient=f}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("Core/TypeScript/TFS.Service",["require","exports","f","o","$","Core/TypeScript/TFS.Core.Ajax","Core/TypeScript/TFS.ObjectModel","Core/TypeScript/TFS.Diag","Core/TypeScript/TFS.Core","Core/TypeScript/TFS.Core.Utils","Core/TypeScript/Resources/TFS.Resources.Common","Core/TypeScript/TFS.Project.WebApi","Core/TypeScript/TFS.Azure.Context","Core/TypeScript/TFS.WebApi"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";var d,w,g,nt,y,p,k;r.defineProperty(t,"__esModule",{value:!0});var b=(function(n){function t(){return n.call(this)||this}return __extends(t,n),t.prototype.getApiLocation=function(n){var t=this.tfsConnection.tfsContext.getHostUrl();return t&&t[t.length-1]==="/"||(t=t+"/"),t+(n||"")},t.prototype.beginGetProjectStatus=function(n,t,i){this._ajaxJson("_api/_job/MonitorJobProgress",{jobId:n},t,i)},t.prototype.beginGetProcessTemplates=function(n,t){var u=this,i,r;o.logInfo("    Get ProcessTemplates.");i=3;r=new s.DelayedFunction(this,5e3,"retryGetProcessTemplate",function(){u._beginGetProcessTemplates((function(t){o.logInfo("    ... succeeded.");n(t)}),(function(){--i>0?(o.logInfo("    ... polling for ProcessTemplate... retry: "+i),r.reset()):t()}))});r.start()},t.prototype._beginGetProcessTemplates=function(n,t){this._ajaxJson("_api/_project/ProcessTemplates",null,(function(t){t?n(t.Templates):n(null)}),t)},t.prototype.beginCreateProject=function(n,t,i,r,u,e){var o={};o.VersionControlOption=r;f.postMSJSON(this.getApiLocation("_api/_project/CreateProject"),{projectName:n,projectDescription:null,processTemplateId:t,processTemplateTypeId:i,collectionId:null,projectData:h.stringifyMSJSON(o)},u,e)},t.prototype.beginCreateProjectNew=function(n,t,i,r,u,e,o){var s={};s.VersionControlOption=r;u.length==0?f.postMSJSON(this.getApiLocation("_api/_project/CreateProject"),{projectName:n,projectDescription:null,processTemplateId:t,processTemplateTypeId:i,collectionId:null,projectData:h.stringifyMSJSON(s)},e,o):f.postMSJSON(this.getApiLocation("_api/_project/CreateProject"),{projectName:n,projectDescription:null,processTemplateId:t,processTemplateTypeId:i,collectionId:null,ownerUpn:u,projectData:h.stringifyMSJSON(s)},e,o)},t.prototype._ajaxJson=function(n,t,i,r){f.getMSJSON(this.getApiLocation(n),t,i,r)},t.beginValidateProjectName=function(n,i){var h,a,v,y;i===void 0&&(i=null);var o=u.Deferred(),r=!0,f="";if(n=n.replace(/^\s\s*/,"").replace(/\s\s*$/,""),(n===null||n.length===0)&&(r=!1,f=c.ProjectNameErrorNull),(n.length>64||n.substring(0,1)==="_"||n.substring(0,1)===".")&&(r=!1,f=c.ProjectNameErrorInvalidLength),r)for(h=0;h<t._invalidProjectCharacters.length;h++)if(n.indexOf(t._invalidProjectCharacters[h])!==-1){r=!1;f=c.ProjectNameErrorInvalidCharacter;break}if(r)for(a=0;a<t._invalidProjectNames.length;a++)if(s.StringUtils.localeIgnoreCaseComparer(n,t._invalidProjectNames[a])===0){r=!1;f=c.ProjectNameErrorReservedKeyword;break}return r&&i?(v=e.TfsTeamProjectCollection.getConnection(i).getHttpClient(l.ProjectHttpClient),y=encodeURIComponent(n),v.beginGetProject(y,!1).done((function(){o.reject({valid:!1,message:c.ProjectNameErrorAlreadyExists})})).fail((function(){o.resolve({valid:!0,message:""})}))):o.resolve({valid:r,message:f}),o.promise()},t})(e.CollectionLevelTfsService);b._invalidProjectNames=["prn","com1","com2","com3","com4","com5","com6","com7","com8","com9","com10","lpt1","lpt2","lpt3","lpt4","lpt5","lpt6","lpt7","lpt8","lpt9","nul","con","aux",".","..","server","SignalR","DefaultCollection","Web","App_Browsers","App_code","App_Data","App_GlobalResources","App_LocalResources","App_Themes","App_WebResources","bin","web.config"];b._invalidProjectCharacters=["@","~",";","{","}","'","+","=",",","<",">","|","/","\\","?",":","&","$","*",'"',"#","[","]","%"];t.ProjectsManager=b;d=(function(){function n(){}return n.prototype.beginValidateAccountName=function(n,t,i){if(!n||!/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$|^[a-zA-Z]$/.test(n)||n.charAt(0)==="-"){t({valid:!1,message:c.AccountValidationMessage});return}this._ajaxJson("_AzureSpsAccount/ValidateAccountName",{accountName:n},t,i)},n.prototype.beginCreateCSMAccount=function(n,t,r,u,f,e){var c=this,s="DevService",o=n+"/subscriptions/"+r+"/resourcegroups/"+s+"/providers/"+t+"/account/"+u,l=o+"/subContainers/"+u+"/status/?api-version=01&operation=put",h;o=o+"?api-version=01";h=n+"/subscriptions/"+r+"/resourcegroups/"+s+"?api-version=01";i.Base.Security.getAuthorizationToken().then((function(n){var t={type:"PUT",beforeSend:function(t){t.setRequestHeader("Authorization",n.header)},data:JSON.stringify({name:s,location:"centralus"}),contentType:"application/json"};jQuery.ajax(h,t).done((function(){var t={type:"PUT",beforeSend:function(t){t.setRequestHeader("Authorization",n.header)},data:JSON.stringify({location:"centralus",properties:{operationType:"Create",AccountName:u}}),contentType:"application/json"};jQuery.ajax(o,t).done((function(t,i,r){if(r.status==202){var u=c;setTimeout((function(){u.pollforAccountCompletion(l,n.header,f,e)}),4e3)}else f(t)})).fail((function(n){e(n)}))}))}))},n.prototype.pollforAccountCompletion=function(n,t,i,r){var u=this,f={type:"GET",beforeSend:function(n){n.setRequestHeader("Authorization",t)},data:JSON.stringify({location:"centralus"}),contentType:"application/json"};jQuery.ajax(n,f).done((function(f,e,o){if(o.status==202){var s=u;setTimeout((function(){s.pollforAccountCompletion(n,t,i,r)}),4e3)}else i(f)})).fail((function(n){r(n)}))},n.prototype.beginCreateAccount=function(t,i,r,u,e){var o=n.getSpsLocation("_AzureProfile/CreateAccount");f.postMSJSON(o,{subscriptionId:t,accountName:i},u,e)},n.prototype.beginCreateAccountNew=function(t,i,r,u,e){var o=n.getSpsLocation("_AzureProfile/CreateAccount");r.length==0?f.postMSJSON(o,{subscriptionId:t,accountName:i},u,e):f.postMSJSON(o,{subscriptionId:t,accountName:i,ownerUpn:r},u,e)},n.beginWaitForAccountReady=function(t){var i=u.Deferred();return n.checkIsAccountReady(t,new Date((new Date).getTime()+12e4),i),i.promise()},n.checkIsAccountReady=function(t,i,r){var u=this;f.getMSJSON(t.getHostUrl()+"_check",{},(function(){r.resolve()}),(function(){new Date>i?r.reject(new Error("Timed out waiting for account to be ready. Account url = "+t.getHostUrl())):s.delay(u,3e3,(function(){n.checkIsAccountReady(t,i,r)}))}),{dataType:"html"})},n.getSpsLocation=function(n){var t=a.getAzureTfsContext().spsLocation;return t[t.length-1]!=="/"&&(t+="/"),n&&(t+=n),t},n.beginCreateProfile=function(t){var i=u.Deferred(),e=n.getSpsLocation("_AzureProfile/CreateProfile"),r;return t||(t=!1),r={useMsaPassthrough:t},f.postMvcJson(e,!1,{},(function(){i.resolve()}),(function(){i.resolve()}),r),i.promise()},n.beginGetAllAccountsWithSubscription=function(t,i,r){o.logInfo("Getting the service definitions");n.beingGetServiceDefinitions((function(u){n._tfsDeploymentServiceDefinitions=u.value;var f=new w(n.getSpsLocation(""));f.beginGetAllAccountsWithSubscription(y.VSOProviderNamespaceId,t).done((function(n){i(n)})).fail((function(){o.logError("Failed to subscriptionAccounts from the SPS subscription service.");r()}))}),(function(){o.logInfo("Error on getting service definitions");r()}))},n.beginGetSubscriptionAccount=function(t,i,r){o.logInfo("Getting the service definitions");n.beingGetServiceDefinitions((function(u){n._tfsDeploymentServiceDefinitions=u.value;var f=new w(n.getSpsLocation(""));f.beginGetSubscriptionAccount(y.VSOProviderNamespaceId,t).done((function(n){i(n)})).fail((function(){o.logError("SubscriptionHttpClient.beginGetSubscriptionAccount failed.");r()}))}),(function(){o.logInfo("Error on getting service definitions");r()}))},n.beginGetTfsDeploymentUrl=function(n){var t=u.Deferred(),i;return a.isPortalFeatureEnabled("VisualStudio.Services.Commerce.DisableSignalRForMonitoring")?(t.resolve(n),t.promise()):(i=this,n.accountTenantId===y.EmptyGuid?t.resolve(n):f.getMSJSON(n.serviceUrls[y.SPSGuid]+"_apis/ServiceDefinitions/LocationService2/"+y.TFSGuid,null,(function(r){r?i._tfsDeploymentServiceDefinitions.forEach((function(t){t.serviceType===r.parentServiceType&&t.identifier===r.parentIdentifier&&(n.tfsDeploymentUrl=t.locationMappings[1].location)})):o.logError("Failed to get TFS Deployment URL for account "+n.accountName);t.resolve(n)}),(function(){o.logError("Failed to get TFS Deployment URL for account "+n.accountName);t.resolve(n)})),t.promise())},n.beginGetProviderManifest=function(n,t,r){var e=u.Deferred(),o=n+"/subscriptions/"+r+"/providers/microsoft.visualstudio",f;return o=o+"?api-version="+t,f={},f.contentType="application/json",f.type="GET",f.dataType="json",f.uri=o,f.setAuthorizationHeader=!0,i.Base.Net.ajax(f).done((function(n){e.resolve(n)}),(function(){e.reject()})),e.promise()},n.prototype._ajaxJson=function(t,i,r,u,e){var o=n.getSpsLocation(t);f.getMSJSON(o,i,r,u,e)},n.beingGetServiceDefinitions=function(t,i){f.getMSJSON(n.getSpsLocation("_apis/ServiceDefinitions"),null,t,i)},n})();t.AccountManager=d;w=(function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.beginGetAllAccountsWithSubscription=function(n,t,i,r,u,f){return n===void 0&&(n=y.VSOProviderNamespaceId),t===void 0&&(t=y.EmptyGuid),i===void 0&&(i=!1),r===void 0&&(r=!1),u===void 0&&(u=!0),f===void 0&&(f=[y.SPSGuid,y.TFSGuid,y.CLTGuid,y.RMGuid,y.PEGuid]),this._beginRequest({area:y.AreaName,locationId:y.SubscriptionsLocationId,responseIsCollection:!0,responseType:k.WebApiSubscriptionAccount,routeValues:{resourceName:y.SubscriptionsResource},data:{providerNamespaceId:n,memberId:t,queryOnlyOwnerAccounts:i,inlcudeDisabledAccounts:r,includeMSAAccounts:u,serviceOwners:f}})},t.prototype.beginUnlinkAccountFromSubscription=function(n,t,i,r,u){u===void 0&&(u=y.VSOProviderNamespaceId);var f=r===y.EmptyGuid?!0:!1;return this._beginRequest({area:y.AreaName,locationId:y.SubscriptionsLocationId,httpMethod:"DELETE",routeValues:{resourceName:y.SubscriptionsResource,subscriptionId:n},queryParams:{providerNamespaceId:u,accountId:t,ownerId:i},attachMsaPassthroughHeader:f})},t.prototype.beginGetSubscriptionAccount=function(n,t){return n===void 0&&(n=y.VSOProviderNamespaceId),this._beginRequest({httpMethod:"GET",area:y.AreaName,locationId:y.SubscriptionsLocationId,responseIsCollection:!1,responseType:k.WebApiSubscriptionAccount,routeValues:{resourceName:y.SubscriptionsResource},queryParams:{providerNamespaceId:n,accountId:t}})},t})(v.VssHttpClient);t.SubscriptionHttpClient=w;g=(function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.beginConnectAccountToAADTenant=function(n,t){return this.connectAccountToAADTenant(n,t)},t.prototype.beginDisconnectAccountToAADTenant=function(n){return this.disConnectAccountToAADTenant(n)},t.prototype.beginGetServiceHostProperties=function(n){return this._beginRequest({area:p.HostPropertiesAreaName,locationId:p.HostPropertiesLocationId,httpMethod:"GET",routeValues:{resource:p.HostPropertiesResource,hostId:n},attachMsaPassthroughHeader:!1})},t.prototype.connectAccountToAADTenant=function(n,t){return this._beginRequest({area:p.AreaName,locationId:p.LocationId,httpMethod:"POST",routeValues:{resource:p.Resource,accountId:n},queryParams:{tenantId:t},attachMsaPassthroughHeader:!1})},t.prototype.disConnectAccountToAADTenant=function(n){return this._beginRequest({area:p.AreaName,locationId:p.LocationId,httpMethod:"DELETE",routeValues:{resource:p.Resource,accountId:n},attachMsaPassthroughHeader:!1})},t})(v.VssHttpClient);t.AccountTenantHttpClient=g,(function(n){n.Application="Application";n.Collection="Collection"})(nt=t.HostTypeStrings||(t.HostTypeStrings={})),(function(n){n.SubscriptionsLocationId="64485509-D692-4B70-B440-D02B3B809820";n.AreaName="commerce";n.ApiString="_apis";n.SubscriptionsResource="Subscription";n.EmptyGuid="00000000-0000-0000-0000-000000000000";n.TFSGuid="00025394-6065-48ca-87d9-7f5672854ef7";n.CLTGuid="6c404d78-ef65-4e65-8b6a-df19d6361eae";n.RMGuid="0000000d-0000-8888-8000-000000000000";n.PEGuid="0000003b-0000-8888-8000-000000000000";n.SPSGuid=n.EmptyGuid;n.VSOProviderNamespaceId="VisualStudioOnline";n.disabledNoAAD="0";n.disabledNoSub="1"})(y=t.SubscriptionConstants||(t.SubscriptionConstants={})),(function(n){n.LocationId="C58B3989-1E17-4A18-9925-67186FE66833";n.HostPropertiesLocationId="F9066D9B-BD55-4B78-A61E-2B13A980289B";n.AreaName="Account";n.HostPropertiesAreaName="HostManagement";n.ApiString="_apis";n.Resource="Tenant";n.HostPropertiesResource="ServiceHosts";n.EmptyGuid="00000000-0000-0000-0000-000000000000";n.SPSGuid=n.EmptyGuid})(p=t.AccountTenantConstants||(t.AccountTenantConstants={}));k={WebApiSubscriptionAccount:{fields:null}}}))