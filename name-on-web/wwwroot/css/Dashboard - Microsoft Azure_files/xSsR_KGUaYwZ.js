define("HubsExtension/Common/SubsCreditCheck",["require","exports","f","o","HubsExtension/Common/CommonClientStrings","MsPortalFx/Globalization","HubsExtension/HubsCommon"],(function(n,t,i,r,u,f,e){"use strict";function v(n){if(n.length&&i.getEnvironmentValue("remainingCreditEndpoint")){var t=n.filter((function(n){return!!(n.subscriptionPolicies&&n.subscriptionPolicies.quotaId)&&!!~[e.subscriptionActiveStatus,e.subscriptionEnabledStatus,e.subscriptionPastDueStatus].indexOf((n.state||"").toLowerCase())})).map((function(n){return{subscriptionId:n.subscriptionId,quotaId:n.subscriptionPolicies.quotaId}})).slice(0,100),r=i.extendArrayIntoMap({},n,(function(n){return n.subscriptionId}),(function(n){return n.displayName}));s.ajax({uri:i.getEnvironmentValue("remainingCreditEndpoint"),type:"POST",data:JSON.stringify(t),contentType:"application/json",setAuthorizationHeader:!0}).then((function(n){var t=(n||[]).filter((function(n){return!n.error}));t.length<=l&&t.forEach((function(n){var i=f.NumberFormat.create({style:"currency",currency:n.currency,currencyDisplay:"symbol"}),t=i.format(n.remaining);c.publish({title:u.subRemCreditTitle.format(t),description:u.subRemCredit.format(r[n.subscriptionId],t),status:h.Information,uri:"#asset/Microsoft_Azure_Billing/Subscription/"+n.subscriptionId})}))})).catch((function(n){(n.jqXHR||{}).status!==0&&a.error("Error checking for subscription remaining credit.",null,i.getLogFriendlyMessage(n))}))}}r.defineProperty(t,"__esModule",{value:!0});var s=i.Base.Net2,o=i.Hubs.Notifications,h=o.NotificationStatus,c=o.ClientNotification,l=3,a=i.Base.Diagnostics.createLog(n);t.checkRemainingCredit=v}))