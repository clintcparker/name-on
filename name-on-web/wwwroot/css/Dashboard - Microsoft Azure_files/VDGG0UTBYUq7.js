define("Core/TypeScript/Shared/Project/TFS.Core.Shared.Project.Services",["require","exports","o","Core/TypeScript/Shared/TFS.ServiceDefinition"],(function(n,t,i,r){"use strict";function u(){return r.Service._getService(r.ServiceType.Project)}i.defineProperty(t,"__esModule",{value:!0});t.getProjectService=u}));
define("Build/TypeScript/TFS.Build.Communication.Impl",["require","exports","f","o","ko","$","Core/TypeScript/Shared/Project/TFS.Core.Shared.Project.Services","Core/TypeScript/TFS.Azure","Core/TypeScript/TFS.Azure.Context","Core/TypeScript/TFS.Project.Data","Build/TypeScript/TFS.BuildDef.Data"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function p(n){var t=a+".setupBuildDefinition",i=Q.defer();return window.requirejs(["./Build/BuildArea"],(function(r){if(!n){l.Log.writeEntry(1,t,"Param 'data' was null. Aborting.");return}var o=new r.DataContext,f=n.Branch,u,e=null;f&&f.toLowerCase()==="default"&&(l.Log.writeEntry(0,t,"Using 'default' branch logic"),f=null);l.Log.writeEntry(0,t,"Looking for project {0} in account {1}".format(n.ProjectId,n.AccountId));h.getProjectByNameDirect(n.AccountId,n.ProjectId).done((function(r){l.Log.writeEntry(0,t,"Creating the build definition for website {0}".format(n.WebSiteName));o.beginCreateContinuousBuildDefinition(n.WebSiteSubscriptionId,n.AccountId,r.name(),null,null,n.WebSpaceName,n.WebSiteName,n.RepositoryId,f).done((function(t){var f={Result:{SubscriptionId:n.WebSiteSubscriptionId,WebsiteName:n.WebSiteName,ResourceGroup:n.ResourceGroup,Location:n.Location,CsmID:"",Options:{AccountId:n.AccountId,ProjectId:r.id(),BuildDefinitionId:t.definition.id,BuildDefinitionName:t.definition.name}}};v(r.accountId(),r.name(),null).then((function(n){f.Result.CsmID=n})).finally((function(){i.resolve(f)}));c.getBuildDefinitionsDirect(r.accountId(),r.id(),r.name()).done((function(n){for(u=0;u<n.length;u++)if(n[u].id===t.definition.id){e=n[u];break}e&&!e.queueStatus&&o.beginCreateBuildRequest(r.accountId(),e).done((function(){}))}))})).fail((function(){i.reject()}))}))})),i.promise}function w(n){var t=a+".setupCreateProject",r=Q.defer();return l.Log.writeEntry(0,t,"Calling shared project service to create project."),e.getProjectService().done((function(u){var f=o.getAccountId(n.newProjectNewAccount.accountName);u.createProject({subscriptionId:n.createOptions.subscriptionId,resourceGroupName:n.createOptions.resourceGroupName,projectId:i.newGuid(),projectName:n.newProjectNewAccount.projectName,accountName:n.newProjectNewAccount.accountName,versionControl:n.newProjectNewAccount.versionControlOption,processTemplateId:n.newProjectNewAccount.processTemplateId}).then((function(n){l.Log.writeEntry(0,t,"createProject operation succeeded.");r.resolve(n)}),(function(){l.Log.writeEntry(2,t,"createProject operation failed for data:",n);r.reject()}))})),r.promise}function b(n){var t=Q.defer(),r=Q.defer(),i=a+".createDisconnectInfo";return l.Log.writeEntry(0,i,"Creating the disconnect information object for deployment environment",n),v(n.accountId,n.projectName,"").then((function(r){l.Log.writeEntry(0,i,"Resolving the promise for the disconnect info.");t.resolve({BuildDefinitionId:n.buildDefinitionId,ProjectId:n.projectId,AccountId:n.accountId,WebsiteName:n.websiteName,SubscriptionId:n.websiteSubscriptionId,ResourceGroup:n.resourceGroup,WebsiteLocation:n.websiteLocation,WebspaceName:n.webspaceName,CsmID:r})})),t.promise}function y(n,t){var i=Q.defer();return window.requirejs(["./Build/BuildArea"],(function(r){var h=a+".createDisconnectInfo",c=new r.DataContext,v=s.getAzureTfsContext().csmConfiguration.vsoResourceProviderName+"/account/project",y=o.getAccountName(n)+"/"+t,u=!1,e="";l.Log.writeEntry(0,h,"Looking up CSM ID for account: {0} project: {1}".format(n,t));c.beginGetCsmResourcesForSubscription(o.mapAccountIdToSubscription(n),v).done((function(n){f.each(n,(function(n,t){return u=t.name===y,u?(e=t.id,!1):void 0}));i.resolve(e)})).fail((function(){i.reject()}))})),i.promise}function v(n,t,i){var r=Q.defer();return s.getAzureTfsContext().csmConfiguration.useCsm?y(n,t).then((function(n){r.resolve(n)}),(function(){r.resolve(i)})):r.resolve(i),r.promise}function k(n){var t=u.toJSON(n);return JSON.parse(t)}var l,a;r.defineProperty(t,"__esModule",{value:!0});l=i.Base.Diagnostics;a="TFS.Build.Communication.Impl";t.setupBuildDefinition=p;t.setupCreateProject=w;t.createDisconnectInfo=b;t.beginGetCsmId=y;t.getCsmIdOrDefault=v;t.sanitizeObject=k}));
define("Build/TypeScript/TFS.Build.Communication",["require","exports","f","o","Build/TypeScript/TFS.Build.Communication.Impl"],(function(n,t,i,r,u){"use strict";var f,e;r.defineProperty(t,"__esModule",{value:!0});f=i.Base.Diagnostics,(function(n){var t,r;(function(n){function e(n){return f.Log.writeEntry(0,r,"Entering setupTfsBuildDefinitionCallback"),u.setupBuildDefinition(n)}function o(n){return f.Log.writeEntry(0,r,"Entering createTeamProjectCallback"),u.setupCreateProject(n)}function s(){var n=function(n,t){f.Log.writeEntry(0,r,"Registering callback: {0}".format(n));i.Services.Rpc.registerCallback(n,t)};n(t.SetupTfsBuildDefinition,e);n(t.CreateTeamProject,o)}var r="TFS.Build.Communication.Rpc.Callbacks",t;(function(n){n.SetupTfsBuildDefinition="SetupTfsBuildDefinition";n.CreateTeamProject="CreateTeamProject"})(t||(t={}));n.register=s})(t=n.Callbacks||(n.Callbacks={})),(function(n){function h(n){var s=u.sanitizeObject(n);return f.Log.writeEntry(0,e,"Calling {0}:{1}".format(r,t.DisconnectWebSiteScm),s),o(t.DisconnectWebSiteScm,i.Services.Rpc.invokeCallback(r,t.DisconnectWebSiteScm,s))}function c(n){var s=u.sanitizeObject(n);return f.Log.writeEntry(0,e,"Calling {0}:{1}".format(r,t.CreateWebsite),s),o(t.CreateWebsite,Q(i.Services.Rpc.invokeCallback(r,t.CreateWebsite,s)).timeout(21e4))}function l(n,s,h){var c=u.sanitizeObject(h);return f.Log.writeEntry(0,e,"Calling {0}:{1}".format(r,t.CreateWebsite),n,s,c),o(t.SetupWebSiteScm,i.Services.Rpc.invokeCallback(r,t.SetupWebSiteScm,c))}function o(n,t){return t.then((function(t){return f.Log.writeEntry(0,e,"Call of {0}:{1} resolved".format(r,n)),t}),(function(){f.Log.writeEntry(2,e,"Call of {0}:{1} rejected".format(r,n))}))}var e="TFS.Build.Communication.Rpc.Websites",r="WebsitesExtension",t,s;(function(n){n.DisconnectWebSiteScm="DisconnectWebSiteScm";n.SetupWebSiteScm="SetupWebSiteScm";n.CreateWebsite="CreateWebsite"})(t||(t={})),(function(n){function t(n){return u.createDisconnectInfo(n)}n.createDisconnectInfo=t})(s=n.Helpers||(n.Helpers={}));n.disconnectWebsiteScm=h;n.createWebsite=c;n.notifyBuildDefinitionCreated=l})(r=n.Websites||(n.Websites={}))})(e=t.Rpc||(t.Rpc={}))}))