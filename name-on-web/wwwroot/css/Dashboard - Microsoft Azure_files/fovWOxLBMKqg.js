define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.Provider",["require","exports","o"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});var r=(function(){function n(n,t){if(!n.resourceId)throw new Error("No resource id was provided in resource definition, even though it's a required property.");this._ajax=t;this._resourceDef=n}return n})();t.BaseProvider=r}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.ProviderFactory",["require","exports","o"],(function(n,t,i){"use strict";function r(n){return{getProvider:function(t,i){return Q(new n(t,i))}}}function u(n){var t;return{getProvider:function(i,r){return t||(t=new n(r)),t.getProvider(i,r)}}}i.defineProperty(t,"__esModule",{value:!0});t.mapsToProvider=r;t.mapsToProviderFactory=u;var f=(function(){function n(n){this._ajax=n}return n})();t.BaseProviderFactory=f}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/Interfaces",["require","exports","o"],(function(n,t,i){"use strict";var r,u;i.defineProperty(t,"__esModule",{value:!0}),(function(n){n[n.None=0]="None";n[n.Average=1]="Average";n[n.Minimum=2]="Minimum";n[n.Maximum=3]="Maximum";n[n.Total=4]="Total"})(r=t.MetricAggregationType||(t.MetricAggregationType={})),(function(n){n[n.Count=0]="Count";n[n.Bytes=1]="Bytes";n[n.Seconds=2]="Seconds";n[n.CountPerSecond=3]="CountPerSecond";n[n.BytesPerSecond=4]="BytesPerSecond";n[n.Percent=5]="Percent";n[n.MilliSeconds=6]="MilliSeconds";n[n.ByteSeconds=7]="ByteSeconds"})(u=t.MetricUnit||(t.MetricUnit={}))}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Dummy.Provider",["require","exports","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/Interfaces","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.Provider"],(function(n,t,i,r,u){"use strict";function f(n,t){var u,i;for(t===void 0&&(t=5),u=[],i=0;i<t;i++)u.push({resourceDefinition:n,name:{value:"DummyMetric"+i,localized:"Dummy Metric "+i},defaultAggregationType:r.MetricAggregationType.Average,supportedAggregationTypes:[r.MetricAggregationType.Average,],unit:r.MetricUnit.Count});return u}function e(n,t){for(var r=[],u=t.timespan,f=u.end,e=u.start,o=e.getTime(),s=Math.round((f.getTime()-o)/50),i=0;i<50;i++)r.push({timestamp:new Date(o+s*i),value:Math.random()*1e3});return{metricDefinition:n,startTime:e,endTime:f,timeGrain:t.timegrain||"PT1H",dataPoints:r}}i.defineProperty(t,"__esModule",{value:!0});var o=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getMetricDefinitions=function(){var n=this;return Q.delay(1).then((function(){return f(n._resourceDef)})).then((function(n){return n}))},t.prototype.getMetricHistories=function(n,t){var i=[],r=[];return n.forEach((function(n){i.push(Q.delay(1).then((function(){return e(n,t)})).then((function(n){var t=n;r.push(t)})))})),Q.all(i).then((function(){return r}))},t})(u.BaseProvider);t.DummyProvider=o}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Common",["require","exports","o"],(function(n,t,i){"use strict";function r(n,t){var u=typeof t,r,i;if(u==="number")return n[t];r=t.toLowerCase();for(i in n)if(typeof i=="string"&&r===i.toLowerCase())return n[i];return undefined}i.defineProperty(t,"__esModule",{value:!0});t.getEnumValue=r}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Errors",["require","exports","o"],(function(n,t,i){"use strict";var r,u,f,e,o,s;i.defineProperty(t,"__esModule",{value:!0});r=(function(){function n(n,t){this.message=n;this.stack=(new Error).stack;this.additionalInfo=!t?{}:t}return n})();t.BaseError=r;u=(function(n){function t(t,i,r){var u=n.call(this,t,i)||this;return u.name="DataFetchError",u.errorCode=r,u}return __extends(t,n),t})(r);t.DataFetchError=u;f=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.name="NoMetricDefinitionsError",t}return __extends(t,n),t})(r);t.NoMetricDefinitionsError=f;e=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.name="NoMetricHistoriesError",t}return __extends(t,n),t})(r);t.NoMetricHistoriesError=e;o=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.name="ResourceNotFoundError",t}return __extends(t,n),t})(r);t.ResourceNotFoundError=o;s=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.name="UnauthorizedError",t}return __extends(t,n),t})(r);t.UnauthorizedError=s}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Timespan",["require","exports","o"],(function(n,t,i){"use strict";function e(n){var i=n.absolute,u=n.relative,r,t;if(i)t=i.end,r=i.start;else if(u)t=new Date,r=new Date(t.getTime()-u.durationMs);else throw new Error("Could not parse an absolute timespan because the provided timespan did not have an absolute or relative property.");return{start:r,end:t}}function r(n,t){var i=typeof n=="number"?t:t.end.getTime()-t.start.getTime(),r=typeof n=="number"?n:u(n);return i/r<=500}function o(n){var i=n.end.getTime()-n.start.getTime(),t;if(f.some((function(n){if(r(n.durationMs,i))return t=n.isoFormat,!0})),!t)throw new Error("A best fit timegrain could not be found for the duration: "+i+"ms.");return t}function u(n){var t=n.match(/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:(\d*)S)?)?/),i=0;return t&&[0,31536e6,2592e6,864e5,36e5,6e4,1e3,].forEach((function(n,r){i+=n*(parseInt(t[r])||0)})),i}function s(n){var o=n/31536e6|0,u,f,t,i,r,e;return(n%=31536e6,u=n/2592e6|0,n%=2592e6,f=n/864e5|0,n%=864e5,t=n/36e5|0,n%=36e5,i=n/6e4|0,n%=6e4,r=n/1e3|0,e="P"+(o?o+"Y":"")+(u?u+"M":"")+(f?f+"D":"")+(t|i|r?"T":"")+(t?t+"H":"")+(i?i+"M":"")+(r?r+"S":""),e==="P")?"":e}i.defineProperty(t,"__esModule",{value:!0});var f=[{isoFormat:"PT1S",durationMs:1e3},{isoFormat:"PT1M",durationMs:6e4},{isoFormat:"PT5M",durationMs:3e5},{isoFormat:"PT1H",durationMs:36e5},{isoFormat:"PT12H",durationMs:432e5},{isoFormat:"P1D",durationMs:864e5},];t.getAbsoluteTimespan=e;t.timegrainIsValidForTimespan=r;t.getBestFitNaturalTimegrain=o;t.convertIsoDurationToMs=u;t.convertMsToIsoDuration=s}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Legacy.Provider",["require","exports","f","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Common","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Errors","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Timespan","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/Interfaces","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.Provider"],(function(n,t,i,r,u,f,e,o,s){"use strict";function a(n,i){var r=i.resourceId,f=h.parseResourceDescriptor(r).subscription,e={subscriptionId:f,resourceId:r},s=c+"/insights/api/Insights/ListMetricDefinitions",l={uri:s,type:"POST",dataType:"json",headers:null,contentType:"application/json",data:JSON.stringify(e),setAuthorizationHeader:!0};return n.fetch(l).then((function(n){var r=[],f=[];return n.forEach((function(n){var e=n.sdkMetricDefinition;f.push(e);r.push({resourceDefinition:i,name:{value:e.name.value,localized:e.name.localizedValue},defaultAggregationType:u.getEnumValue(o.MetricAggregationType,n.primaryAggregation),supportedAggregationTypes:t.allMetricAggregationTypes,unit:u.getEnumValue(o.MetricUnit,n.unit),supportedTimegrains:e.metricAvailabilities.map((function(n){return n.timeGrain}))})})),{metricDefinitions:r,sdkMetricDefinitions:f}}))}function v(n,r,u){var a=r.length?h.parseResourceDescriptor(r[0].resourceDefinition.resourceId).subscription:undefined,s=[],o=[],e=u.timespan;if(r.forEach((function(n){var i=n.resourceDefinition.resourceId,t=n.sdkMetricDefinition,r=t.name.value,f={resourceId:i,metricName:r,timeGrain:l(t.metricAvailabilities,u),dimensionName:null},e={resourceId:i,metricName:r,shouldValidateMetricDefinition:!1,sdkVersion:"",sdkMetricDefinition:t};s.push(f);o.push(e)})),!o.length)throw new f.NoMetricDefinitionsError("Cannot find sdk metrics definition for resource.");var v={subscriptionId:a,startTime:e.start.toISOString(),endTime:e.end.toISOString(),isCustom:!0,filters:s,cachedMetricDefinitions:o},y=c+"/insights/api/Insights/GetMetricHistoryCollection",p={uri:y,type:"POST",dataType:"json",headers:null,contentType:"application/json",data:JSON.stringify(v),setAuthorizationHeader:!0};return n.fetch(p).then((function(n){var u=[],f=n.histories;return f.forEach((function(n){var h=n.metricName.toLowerCase(),c=n.resourceId.toLowerCase(),s=i.find(r,(function(n){return h===n.metricDefinition.name.value.toLowerCase()&&c===n.resourceDefinition.resourceId.toLowerCase()}));if(!s)throw new Error("Could not find a metric definition for the metric history returned from the server with name '"+h+"' and resource id '"+c+"'.");var f=s.metricDefinition,l=f.defaultAggregationType,a=f.unit,o=s.sdkMetricDefinition,v={metricDefinition:{resourceDefinition:f.resourceDefinition,defaultAggregationType:i.isNullOrUndefined(l)?o.primaryAggregationType:l,name:{value:o.name.value,localized:o.name.localizedValue},supportedAggregationTypes:t.allMetricAggregationTypes,supportedTimegrains:f.supportedTimegrains,unit:i.isNullOrUndefined(a)?o.unit:a,type:f.type},startTime:e.start,endTime:e.end,timeGrain:n.timeGrain,dataPoints:n.values.map((function(n){return{value:n.value,timestamp:new Date(n.timestamp)}}))};u.push(v)})),u}))}var h,c,l,y;r.defineProperty(t,"__esModule",{value:!0});h=i.ViewModels.Services.ResourceTypes;c=window.fx.environment.insightsControllerEndpoint;t.allMetricAggregationTypes=[o.MetricAggregationType.None,o.MetricAggregationType.Average,o.MetricAggregationType.Minimum,o.MetricAggregationType.Maximum,o.MetricAggregationType.Total,];l=function(n,t){var r=t.timegrain,i=t.timespan,h=(new Date).getTime()-6e4-i.start.getTime(),u,o,f,s;return r&&e.timegrainIsValidForTimespan(r,i)?u=e.convertIsoDurationToMs(r):(o=e.getBestFitNaturalTimegrain(i),u=e.convertIsoDurationToMs(o)),f=Number.MAX_VALUE,n.forEach((function(n){var o=e.convertIsoDurationToMs(n.retention),t=n.timeGrain,c=e.convertIsoDurationToMs(t),r=Math.abs(u-c);h<o&&r<f&&e.timegrainIsValidForTimespan(t,i)&&(s=t,f=r)})),s};t.fetchMetricDefinitions=a;t.fetchMetricHistories=v;y=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._sdkMetricDefinitions={},t}return __extends(t,n),t.prototype.getMetricDefinitions=function(){var n=this;return a(this._ajax,this._resourceDef).then((function(t){var i=t.sdkMetricDefinitions,r=t.metricDefinitions;if(i.forEach((function(t){n._sdkMetricDefinitions[t.name.value.toLowerCase()]=t})),!i.length)throw new f.NoMetricDefinitionsError("Cannot find sdk metrics definition for resource '"+n._resourceDef.resourceId+"'.");return r}))},t.prototype.getMetricHistories=function(n,t){var i=this,u;return!n||!n.length?Q([]):(u=r.keys(this._sdkMetricDefinitions).length?Q():this.getMetricDefinitions(),u.then((function(){var r=[];return n.forEach((function(n){var t=n.name.value,u=i._sdkMetricDefinitions[t.toLowerCase()];if(!u)throw new Error("A metric with name '"+t+"' could not be found for the resource '"+i._resourceDef.resourceId+"'.");r.push({resourceDefinition:i._resourceDef,metricDefinition:n,sdkMetricDefinition:u})})),v(i._ajax,r,t)})))},t})(s.BaseProvider);t.LegacyProvider=y}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/LegacyIEC.Provider",["require","exports","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Legacy.Provider"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});var u=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getMetricHistories=function(t,i){return n.prototype.getMetricHistories.call(this,t,i).then((function(n){return n.forEach((function(n){n.displaySettings={useIECFormat:!0}})),n}))},t})(r.LegacyProvider);t.LegacyIECProvider=u}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Mdm.Provider",["require","exports","f","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Common","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Timespan","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/Interfaces","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.Provider"],(function(n,t,i,r,u,f,e,o){"use strict";function h(n,t,i){var o,r,s,h;if(!i.length)throw new Error("Cannot build metric history filter uri: No metric definitions were provided.");return o=t.timespan,r=t.timegrain,r&&f.timegrainIsValidForTimespan(r,o)||(r=f.getBestFitNaturalTimegrain(o)),s=[],h=[],i.forEach((function(n){s.push(n.name.value);h.push(u.getEnumValue(e.MetricAggregationType,n.defaultAggregationType))})),{timegrain:r,url:n+"/providers/microsoft.Insights/metrics?api-version=2017-05-01-preview&timespan="+o.start.toISOString()+"/"+o.end.toISOString()+"&interval="+r+"&metric="+s.join()+"&aggregation="+h.join()}}r.defineProperty(t,"__esModule",{value:!0});t.allMetricAggregationTypes=[e.MetricAggregationType.None,e.MetricAggregationType.Average,e.MetricAggregationType.Minimum,e.MetricAggregationType.Maximum,e.MetricAggregationType.Total,];var s=(function(n){function r(){return n!==null&&n.apply(this,arguments)||this}return __extends(r,n),r.prototype.getMetricDefinitions=function(){var n=this,i=this._resourceDef.resourceId+"/providers/Microsoft.Insights/metricdefinitions?api-version=2017-05-01-preview";return this._ajax.fetchArmCollection(i,!1).then((function(i){return i.map((function(i){return{resourceDefinition:n._resourceDef,name:{value:i.name.value,localized:i.name.localizedValue},defaultAggregationType:u.getEnumValue(e.MetricAggregationType,i.primaryAggregationType),supportedAggregationTypes:t.allMetricAggregationTypes,unit:u.getEnumValue(e.MetricUnit,i.unit)}}))}))},r.prototype.getMetricHistories=function(n,t){var i=this;return this._getCompleteMetricDefinitions(n).then((function(n){return i._getMetricHistoriesHelper(n,t)}))},r.prototype._getCompleteMetricDefinitions=function(n){var t=this,r=n.every((function(n){return!i.isNullOrUndefined(n.defaultAggregationType)}));return r?Q(n):this.getMetricDefinitions().then((function(r){return n.map((function(n){var e=n.name.value.toLowerCase(),u=i.find(r,(function(n){return n.name.value.toLowerCase()===e})),f;if(!u)throw new Error("A metric with name '"+e+"' could not be found for the resource '"+t._resourceDef.resourceId+"'.");return f=n.type,f&&(u.type=f),u}))}))},r.prototype._getMetricHistoriesHelper=function(n,t){var i=h(this._resourceDef.resourceId,t,n);return this._ajax.fetchArmCollection(i.url,t.isBackgroundTask).then((function(r){var f=[];return r.forEach((function(r){var c=r.name.value,o,s,h;n.some((function(n){return c.toLowerCase()===n.name.value.toLowerCase()?(o=n,!0):!1}));s=r.timeseries.length>0?r.timeseries[0].data:[];h={metricDefinition:{resourceDefinition:o.resourceDefinition,defaultAggregationType:o.defaultAggregationType,name:{value:r.name.value,localized:r.name.localizedValue},supportedAggregationTypes:o.supportedAggregationTypes,unit:u.getEnumValue(e.MetricUnit,r.unit),type:o.type},startTime:t.timespan.start,endTime:t.timespan.end,timeGrain:i.timegrain,dataPoints:s.map((function(n){var t=u.getEnumValue(e.MetricAggregationType,o.defaultAggregationType).toLowerCase();return{value:n[t],timestamp:new Date(n.timeStamp)}}))};f.push(h)})),f}))},r})(o.BaseProvider);t.MdmProvider=s}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/MdmIEC.Provider",["require","exports","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Mdm.Provider"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});var u=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getMetricHistories=function(t,i){return n.prototype.getMetricHistories.call(this,t,i).then((function(n){return n.forEach((function(n){n.displaySettings={useIECFormat:!0}})),n}))},t})(r.MdmProvider);t.MdmIECProvider=u}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Sql.ProviderFactory",["require","exports","f","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Errors","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.ProviderFactory","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/LegacyIEC.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Mdm.Provider"],(function(n,t,i,r,u,f,e,o){"use strict";function v(n,t){var r=n.kind;return i.isUndefined(r)?y(n.resourceId,t).then((function(i){var r=n.resourceId+"?api-version="+i;return t.fetchArm(r,!1)})).then((function(t){var r=t&&t.kind;if(i.isUndefined(r))throw new u.DataFetchError("No 'kind' property could be fetched for the following SQL Db resource from ARM: "+n.resourceId);return r})):Q(r)}function y(n,t){if(s)return Q(s);var r=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(n);return t.fetchArm(l.format(r.subscription),!1).then((function(n){var t;if(n.resourceTypes.some((function(n){if(n.resourceType.toLowerCase()===h.toLowerCase())return t=n,!0})),!t)throw new Error("Could not fetch api-version to use from ARM for Microsoft.SQL resource type '"+h+"'.");return s=t.apiVersions[0]}))}var c;r.defineProperty(t,"__esModule",{value:!0});var h="servers/databases",l="/subscriptions/{0}/providers/Microsoft.Sql?api-version=2017-05-10",a=/.*datawarehouse.*$/,s="";c=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getProvider=function(n){var t=this;return v(n,this._ajax).then((function(r){var u=a.test(r);return u?new o.MdmProvider(n,t._ajax):i.isFeatureEnabled("usemdmforsql")?new o.MdmProvider(n,t._ajax):new e.LegacyIECProvider(n,t._ajax)}))},t})(f.BaseProviderFactory);t.SqlDatabaseProviderFactory=c}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Logger",["require","exports","f","o"],(function(n,t,i,r){"use strict";function f(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];u.verbose(n,i)}function e(n,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];u.warning(n,t,r)}function o(n,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];u.error(n,t,r)}r.defineProperty(t,"__esModule",{value:!0});var u=new i.Base.Diagnostics.Log("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider");t.log=f;t.warn=e;t.error=o}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Storage.Provider",["require","exports","f","o","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Logger","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Legacy.Provider"],(function(n,t,i,r,u,f,e,o){"use strict";function a(n,r){r=r||1e3;var u=new i.Map;return function(i){var e,o,f,s;return t.memoizationEnabled?(e=JSON.stringify(i),o=Date.now(),u.has(e)?f=u.get(e):(f={timestamp:o,promise:null},u.set(e,f)),s=f.timestamp+r>o,f.promise&&(Q.isPending(f.promise)||s&&!Q.isRejected(f.promise)))?f.promise:(f.timestamp=o,f.promise=n(i)):n(i)}}r.defineProperty(t,"__esModule",{value:!0});t.memoizationEnabled=!0;var s={},c=[],h=u.Controls.MonitorChart.StorageProvider;[{serviceType:{value:"legacyBlob",localized:h.blob},resourceIdSuffix:"/services/blob"},{serviceType:{value:"legacyFile",localized:h.file},resourceIdSuffix:"/services/file"},{serviceType:{value:"legacyQueue",localized:h.queue},resourceIdSuffix:"/services/queue"},{serviceType:{value:"legacyTable",localized:h.table},resourceIdSuffix:"/services/table"},].forEach((function(n){var t=n.serviceType.value;s[t.toLowerCase()]=n;c.push(t)}));var l="Invalid metric definition type: '{0}'. Valid types are: "+c.join(", "),v=a((function(n){return o.fetchMetricDefinitions(n.ajax,n.resourceDef)}),5e3),y=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._sdkMetricDefs={},t}return __extends(t,n),t.prototype.getMetricDefinitions=function(){return this._getMetricDefinitionsByService(c)},t.prototype.getMetricHistories=function(n,t){var i=this;return n.length?this._prepareMetricDefinitions(n).then((function(){return i._executeFetchMetricHistories(n,t)})):Q([])},t.prototype._getMetricDefinitionsByService=function(n){var t=this,r=[],u=n.map((function(n){var u=s[n.toLowerCase()],f;if(!u)throw new Error(l.format(n));return f=i.clone(t._resourceDef),f.resourceId=f.resourceId+u.resourceIdSuffix,v({ajax:t._ajax,resourceDef:f}).then((function(n){var i=n.metricDefinitions,f=n.sdkMetricDefinitions;f.forEach((function(n){t._saveSdkMetricDef(n,u.serviceType.value)}));i.forEach((function(n){n.resourceDefinition.resourceId=t._resourceDef.resourceId;n.type=u.serviceType}));r=r.concat(i)}))}));return Q.allSettled(u).then((function(){return r}))},t.prototype._executeFetchMetricHistories=function(n,t){var r=this,u=[];return n.forEach((function(n){var f=n.name.value,t=n.type.value,e=r._getSdkMetricDef(f,t),o,h;if(!e){i.Base.Diagnostics.Telemetry.trace({source:"MonitorChart",action:"StorageProviderNoSdkMetricDefinition",data:{storageAccountService:t,metricName:f,resourceId:r._resourceDef.resourceId}});return}o=s[t.toLowerCase()];h={resourceId:r._resourceDef.resourceId+o.resourceIdSuffix};u.push({resourceDefinition:h,sdkMetricDefinition:e,metricDefinition:n})})),o.fetchMetricHistories(this._ajax,u,t)},t.prototype._prepareMetricDefinitions=function(n){var i=this,u={},t;return n.forEach((function(n){var o=n.type,t,r,e;if(o){if(t=o.value,r=s[t.toLowerCase()],!r)throw new Error(l.format(t));n.type.localized=r.serviceType.localized}else f.warn("No 'type' property set on metric definition with name '"+n.name.value+"' for resource id '"+i._resourceDef.resourceId+"'. Defaulting to assuming this metric definition is for blob storage. Pass the 'type' property to suppress this warning."),n.type=s.legacyblob.serviceType;e=n.type.value;i._getSdkMetricDef(n.name.value,e)||(u[e.toLowerCase()]=!0)})),t=r.keys(u),t.length?this._getMetricDefinitionsByService(t):Q()},t.prototype._saveSdkMetricDef=function(n,t){this._sdkMetricDefs[t.toLowerCase()+n.name.value.toLowerCase()]=n},t.prototype._getSdkMetricDef=function(n,t){return this._sdkMetricDefs[t.toLowerCase()+n.toLowerCase()]},t})(e.BaseProvider);t.StorageProvider=y}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/VirtualMachine.Provider",["require","exports","o","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Logger","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Legacy.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Mdm.Provider"],(function(n,t,i,r,u,f,e,o){"use strict";i.defineProperty(t,"__esModule",{value:!0});var c=r.Controls.MonitorChart.VirtualMachineProvider,s="host",h="guest",l=c.host,a=c.guest,v=(function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._mdmProvider=new o.MdmProvider(t,i),r._legacyProvider=new e.LegacyProvider(t,i),r}return __extends(t,n),t.prototype.getMetricDefinitions=function(){var n=[this._legacyProvider.getMetricDefinitions(),this._mdmProvider.getMetricDefinitions()];return Q.all(n).then((function(n){var t=n[1].map((function(n){return n.type={localized:l,value:s},n})),i=n[0].map((function(n){return n.type={localized:a,value:h},n}));return t.concat(i)}))},t.prototype.getMetricHistories=function(n,t){var r,f,e,i,o;return!n||!n.length?Q([]):(r=[],f=[],n.forEach((function(n){var t=n.type&&n.type.value&&n.type.value.toLowerCase();t===s?(n.type.localized=l,r.push(n)):t===h?(n.type.localized=a,f.push(n)):(u.warn("No valid type property was supplied for the VM metric definition '"+n.name.value+"'. "+("Defaulting to treating this as a host metric. To suppress this message, add \"type: ['"+s+"' | '"+h+"']\" to your metric definition.")),r.push(n))})),e=[],i=[],r.length&&(o=this._mdmProvider.getMetricHistories(r,t).then((function(n){i=i.concat(n)})),e.push(o)),f.length&&(o=this._legacyProvider.getMetricHistories(f,t).then((function(n){i=i.concat(n)})),e.push(o)),Q.all(e).then((function(){return i})))},t})(f.BaseProvider);t.VirtualMachineProvider=v}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Root.ProviderFactory",["require","exports","f","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Base.ProviderFactory","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Dummy.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Legacy.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/LegacyIEC.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Mdm.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/MdmIEC.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Sql.ProviderFactory","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Storage.Provider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/VirtualMachine.Provider"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function it(n,t,i){throw new Error("[NoProviderFound] "+n+"\n  Resource: "+JSON.stringify(t)+"\n  Resource Type: "+i);}var d;r.defineProperty(t,"__esModule",{value:!0});var g=i.ViewModels.Services.ResourceTypes,p=u.mapsToProvider(f.DummyProvider),w=u.mapsToProvider(o.LegacyIECProvider),v=u.mapsToProvider(e.LegacyProvider),y=u.mapsToProvider(h.MdmIECProvider),nt=u.mapsToProvider(s.MdmProvider),b=u.mapsToProvider(l.StorageProvider),k=u.mapsToProvider(a.VirtualMachineProvider),tt={"dummy.provider/dummyresource":p,"providers.test/statefulibizaengines":p,"microsoft.classiccompute/virtualmachines":v,"microsoft.classiccompute/domainnames/slots/roles":v,"microsoft.classicstorage/storageaccounts":b,"microsoft.compute/virtualmachines":k,"microsoft.compute/virtualmachinescalesets":k,"microsoft.customerinsights/hubs":v,"microsoft.datafactory/datafactories":v,"microsoft.dbformysql/servers":y,"microsoft.dbforpostgresql/servers":y,"microsoft.documentdb/databaseaccounts":w,"microsoft.insights/components":v,"microsoft.insights/webtests":v,"microsoft.mysql/servers":y,"microsoft.sql/servers/databases":u.mapsToProviderFactory(c.SqlDatabaseProviderFactory),"microsoft.sql/servers/elasticpools":i.isFeatureEnabled("usemdmforsql")?nt:w,"microsoft.storage/storageaccounts":b};d=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getProvider=function(n){var u=n&&n.resourceId,t=g.parseResourceDescriptor(u),i=(t.provider+"/"+t.types.join("/")).toLowerCase(),r=tt[i];return r?r.getProvider(n,this._ajax).then((function(t){return t||it("RootProviderFactory resolved to a provider or factory based upon the provided resource's resource type, but that provider or factory did not return a valid MetricsProvider.",n,i),t})):Q(new s.MdmProvider(n,this._ajax))},t})(u.BaseProviderFactory);t.RootProviderFactory=d}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Config",["require","exports","i","o"],(function(n,t,i,r){"use strict";function f(){return u?Q(u):Q(i.Extension.getArmEndpointEndPoint.invoke(i.Rpc.client,i.Extension.getHubsWindowId(),null)).then((function(n){return u=n}))}r.defineProperty(t,"__esModule",{value:!0});var u;t.getArmEndpoint=f}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/AjaxHelper",["require","exports","f","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Config"],(function(n,t,i,r,u){"use strict";r.defineProperty(t,"__esModule",{value:!0});var f=i.Base.Net2,e=function(n){return Q(f.ajax(n))},o=(function(){function n(n,t){this.getArmEndpoint=n||u.getArmEndpoint;this.fetchFunction=t||e}return n.prototype.fetch=function(n){return this.fetchFunction(n)},n.prototype.fetchArm=function(n,t,i,r){var u=this;return this.getArmEndpoint().then((function(f){var e=f+n,o={uri:e,type:i||"GET",dataType:"json",contentType:"application/json",invokeApi:"api/invoke",setAuthorizationHeader:!0,isBackgroundTask:t,data:r};return u.fetch(o)}))},n.prototype.fetchArmCollection=function(n,t){var r=this,i=[];return this.fetchArm(n,t).then((function(n){return n&&(n.value&&i.push.apply(i,n.value),n.nextLink)?r.fetchArmCollection(n.nextLink,t).then((function(n){return i.push.apply(i,n),i})):i}))},n})();t.AjaxHelper=o}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestBatchers/Arm.RequestBatcher",["require","exports","o","Fx/Ajax"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});var u=["get","post","delete","head"],f=(function(){function n(n){this.armEndpoint=n.toLowerCase()}return n.prototype.canBatchRequest=function(n){return n.uri.toLowerCase().startsWith(this.armEndpoint)&&!!~u.indexOf(n.type.toLowerCase())&&!n.data},n.prototype.performBatch=function(n){return Q(r.batch(n)).then((function(n){return n.content}))},n})();t.ArmRequestBatcher=f}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestBatcher",["require","exports","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestBatchers/Arm.RequestBatcher"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});var u=(function(){function n(n){this.requestBatchers=[new r.ArmRequestBatcher(n),]}return n.prototype.performBatch=function(n){var t=null;return this.requestBatchers.some((function(i){return i.canBatchRequest(n)?(t=i,!0):!1})),t&&t.performBatch(n)},n})();t.RequestBatcher=u}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestDedupers/Arm.RequestDeduper",["require","exports","o"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});var r=(function(){function n(n){this.armEndpoint=n.toLowerCase()}return n.prototype.canDedupRequest=function(n){return n.uri.toLowerCase().indexOf(this.armEndpoint)!==-1&&n.type.toLowerCase()==="get"},n.prototype.getDedupKey=function(n){return n.uri.toLowerCase()+(n.setAuthorizationHeader||"false")},n})();t.ArmRequestDeduper=r}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestDedupers/Legacy.RequestDeduper",["require","exports","o"],(function(n,t,i){"use strict";i.defineProperty(t,"__esModule",{value:!0});var r=(function(){function n(n){this.insightsControllerEndpoint=n.toLowerCase()}return n.prototype.canDedupRequest=function(n){return n.uri.toLowerCase().indexOf(this.insightsControllerEndpoint)!==-1},n.prototype.getDedupKey=function(n){var t=typeof n.data=="object"?JSON.stringify(n.data):n.data||"";return n.uri.toLowerCase()+n.type.toLowerCase()+(n.setAuthorizationHeader||"false")+t.toLowerCase()},n})();t.LegacyRequestDeduper=r}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestDeduper",["require","exports","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestDedupers/Arm.RequestDeduper","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestDedupers/Legacy.RequestDeduper"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(){function n(n,t){this.requestDedupers=[new r.ArmRequestDeduper(n),new u.LegacyRequestDeduper(t),]}return n.prototype.getDedupKey=function(n){var t=null;return this.requestDedupers.some((function(i){return i.canDedupRequest(n)?(t=i,!0):!1})),t&&t.getDedupKey(n)},n})();t.RequestDeduper=f}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/BatchAjaxHelper",["require","exports","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/AjaxHelper","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestBatcher","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/RequestDeduper"],(function(n,t,i,r,u,f){"use strict";i.defineProperty(t,"__esModule",{value:!0});var e=window.fx.environment.insightsControllerEndpoint,o=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.dedupeKeyToPromiseMap={},t}return __extends(t,n),t.prototype.fetch=function(t){var i=this;return this.getBatchingUtilities().then((function(r){var e=r.requestBatcher,o=r.requestDeduper,u=o.getDedupKey(t),f;return u&&i.dedupeKeyToPromiseMap[u]?i.dedupeKeyToPromiseMap[u]:(f=e.performBatch(t)||n.prototype.fetch.call(i,t),u&&(f=f.then((function(n){return delete i.dedupeKeyToPromiseMap[u],n})),i.dedupeKeyToPromiseMap[u]=f),f)}))},t.prototype.getBatchingUtilities=function(){var t=this,n=this.batchingUtils;return n?Q(n):this.getArmEndpoint().then((function(n){return t.batchingUtils={requestBatcher:new u.RequestBatcher(n),requestDeduper:new f.RequestDeduper(n,e)}}))},t})(r.AjaxHelper);t.BatchAjax=o}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/MetricsProvider",["require","exports","f","o","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Ajax/BatchAjaxHelper","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Errors","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Logger","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Timespan","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/BackendProviders/Root.ProviderFactory"],(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var l="Resource definition does not have the required property 'resourceId'. Discarding this resource definition.",c=function(n,t){n=n||{};var i,r,u=n.jqXHR;if(u)i=u.status,r=u.responseText;else if(n.httpStatusCode!==undefined)i=n.httpStatusCode,r=n.content;else return n;return i===401||i===403?new f.UnauthorizedError(r,t):i===404?new f.ResourceNotFoundError(r,t):new f.DataFetchError(r,t,i)},a=function(n,t){return n.resourceDefinition.resourceId===t.resourceDefinition.resourceId&&n.name.value===t.name.value&&n.type.value===t.type.value},h=(function(){function n(n,t,i){this.resourceDefinition=n;this.rootProviderFactory=t;this.metrics=i||[]}return n.prototype.getMetricDefinitions=function(){return this.getBackendProvider().then((function(n){return n.getMetricDefinitions()}))},n.prototype.getMetricHistories=function(n){var t=this.metrics;return this.getBackendProvider().then((function(i){return i.getMetricHistories(t,n)}))},n.prototype.getBackendProvider=function(){var n=this;if(!this.resourceDefinition)throw new Error("Tried to get backend provider, but the resourceDefinition has not yet been set for this SavedBackendProvider.");return this.backendProvider?Q(this.backendProvider):this.rootProviderFactory.getProvider(this.resourceDefinition).then((function(t){return n.backendProvider=t,t}))},n})(),v=(function(){function n(n,t){var f=this,o,r,c;(this._ajax=t||new u.BatchAjax,this._providers={},this._timespan={relative:{durationMs:864e5}},this._root=new s.RootProviderFactory(this._ajax),(n||[]).length)&&(n[0].resourceDefinition?(o=n,r={},o.forEach((function(n){var i=n.resourceDefinition,t=i.resourceId;r[t]?r[t].metricDefinitions.push(n):r[t]={resourceDefinition:i,metricDefinitions:[n]}})),i.forEachKey(r,(function(n,t){f._providers[n]=new h(t.resourceDefinition,f._root,t.metricDefinitions)}))):(c=n,c.forEach((function(n){var t=n.resourceId;if(!t){e.error(l);return}f._providers[t]=new h(n,f._root)}))))}return n.prototype.getResources=function(){return i.forEachKey(this._providers,(function(n,t,i){var r=t.resourceDefinition;i[r.resourceId]=r}),{})},n.prototype.setResources=function(n){var t=this;this._providers={};n.forEach((function(n){t.addResource(n)}))},n.prototype.addResource=function(n){var t=n.resourceId;this._providers[t]||(this._providers[t]=new h(n,this._root))},n.prototype.removeResource=function(n){delete this._providers[n]},n.prototype.getMetrics=function(){return i.forEachKey(this._providers,(function(n,t,i){i.push.apply(i,t.metrics)}),[])},n.prototype.setMetrics=function(n){var t=this;i.forEachKey(this._providers,(function(n,t){t.metrics=[]}));n.forEach((function(n){t.addMetric(n)}))},n.prototype.addMetric=function(n){var i=n.resourceDefinition,r=i.resourceId,t=this._providers[r];t||(t=new h(i,this._root),this._providers[r]=t);t.metrics.push(n)},n.prototype.removeMetric=function(n){var i=n.resourceDefinition.resourceId,t=this._providers[i],r,u;if(!t){e.warn("Attemped to remove metric '"+n.name.localized+"' for resource '"+i+"', but no provider exists for this resource. \nContinuing without removing the metric.");return}u=t.metrics.some((function(t,i){return r=i,a(n,t)}));u&&t.metrics.splice(r,1)},n.prototype.setTimespan=function(n){this._timespan=n},n.prototype.getTimespan=function(){return this._timespan},n.prototype.setTimegrain=function(n){this._requestedTimegrain=n?o.convertMsToIsoDuration(n):undefined},n.prototype.getTimegrain=function(){return this._requestedTimegrain},n.prototype.clearAll=function(){var n=this;this._requestedTimegrain=undefined;this.setMetrics([]);i.forEachKey(this._providers,(function(t){n.removeResource(t)}))},n.prototype.fetchMetricDefinitions=function(){var n={},t=[];return i.forEachKey(this._providers,(function(i,r){var u=r.getMetricDefinitions().then((function(t){n[r.resourceDefinition.resourceId]=t})).catch((function(n){throw c(n,{resourceDefinition:r.resourceDefinition});}));t.push(u)})),Q.all(t).then((function(){return n}))},n.prototype.fetchMetricHistories=function(n){var r=this,t=[];return Q.all(i.forEachKey(this._providers,(function(i,u,f){f.push(u.getMetricHistories({isBackgroundTask:n,timespan:o.getAbsoluteTimespan(r._timespan),timegrain:r._requestedTimegrain}).then((function(n){t.push.apply(t,n)})).catch((function(n){throw c(n,{resourceDefinition:u.resourceDefinition});})))}),[])).then(i.wrap(t))},n})();t.MetricsProvider=v}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MonitorChart.Main",["require","exports","f","o","a","ko","Fx/Controls/MonitorChart","Fx/Pinner","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/Interfaces","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MetricsProvider/MetricsProvider","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Common","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Errors","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Logger"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function ut(n){var t=[n.cssClass];return n.disabled()&&t.push("fxc-monitorchart-toolbar-item-disabled"),t.join(" ")}function ft(n,t){if(i.isUndefined(n))return y.Count;var r=(typeof n=="string"?n:l.getEnumValue(h.MetricUnit,n)).toLowerCase(),f=t?"IEC":"",u=k[""+r+f]||k[r];return u||(v.warn("Could not find an FX unit that maps to the metric unit: '"+r+"'. Defaulting to count."),u=y.Count),u}function et(n){switch(n){case h.MetricAggregationType.Total:return{fxChartAggType:5,displayName:p.AggregationType.total};case h.MetricAggregationType.Maximum:return{fxChartAggType:3,displayName:p.AggregationType.maximum};case h.MetricAggregationType.Minimum:return{fxChartAggType:2,displayName:p.AggregationType.minimum}}return{fxChartAggType:4,displayName:p.AggregationType.average}}var b,k,tt;r.defineProperty(t,"__esModule",{value:!0});var d=i.ViewModels.Controls.Visualization,w=d.Chart,it=i.ViewModels.Controls.DockedBalloon,g=d.SimpleChart,nt=i.ViewModels.Services.ResourceTypes,y=i.UnitConversion.Unit,p=s.Controls.MonitorChart,rt=i.isFeatureEnabled("dashboardfilters");t.Template="<div class='fxc-monitorchart-chart' data-bind='css: { \"fxc-monitorchart-header-hidden\": !showHeader() }'><div class='fxc-monitorchart-header' data-bind='visible: showHeader()'><div class='fxc-monitorchart-title-container'><h3 class='fxc-monitorchart-title msportalfx-tooltip-overflow' data-bind='text: title' aria-describedby='ee456ec2ba0e47a2937aa8e3d835f377'><\/h3><div class='fxc-monitorchart-subtitle msportalfx-tooltip-overflow' data-bind='visible: subtitle(), text: subtitle' id='ee456ec2ba0e47a2937aa8e3d835f377'><\/div><\/div><div class='fxc-monitorchart-toolbar-container' data-bind='foreach: toolbarItems'><div tabindex='0' class='fxc-monitorchart-toolbar-item azc-fill-text fxs-portal-hover' data-bind='image: $data.image, attr: { title: $data.title }, click: $data.onActivate, event:{keyup: $data.onActivate}, css: $parent.getToolbarItemCss($data), visible: !$data.hidden(), clickBubble: false' role='button'><\/div><\/div><\/div><div class='fxc-monitorchart-chart-container'><div data-bind='pcControl: chart'><\/div><\/div><div class='fxc-monitorchart-overlay-container'><span class='fxc-loading-icon azc-fill-text' data-bind='visible: showLoadingIndicator, image: MsPortalFx.Base.Images.Loading.EllipsisSquare()'><\/span><div class='fxc-monitorchart-error fxs-portal-bg-txt-br' data-bind='visible: errorMessage'><\/div><div class='fxc-monitorchart-error-text msportalfx-tooltip-overflow fxs-bg-overlay-dark fxs-text-white' data-bind='visible: errorMessage, text: errorMessage'><\/div><\/div><\/div>";b=window;k={bytes:y.Bytes_SI,bytesIEC:y.Bytes,bytespersecond:y.BytesPerSecond_SI,bytespersecondIEC:y.BytesPerSecond,byteseconds:y.BytesPerSecond_SI,count:y.Count,countpersecond:y.CountPerSecond,milliseconds:y.MilliSeconds,percent:y.Percentage,seconds:y.Seconds};tt=(function(){function n(n){var t=this;this._refreshId=0;this._reloadId=0;this.state=f.observable(0);this.error=f.observable(null);this._ltm=n;this._provider=new c.MetricsProvider;this._title=f.observable(null);this._subtitle=f.observable(null);this._noDataMessage=f.observable(null);this._errorMessage=f.observable(null);this._isLoading=f.observable(!1);this._pinToolbarItem={image:i.Base.Images.Pin(),title:p.pinTitle,onActivate:function(n,r){var e=r,u,f,s;e.key&&e.key!=="Enter"||(u=t._chartDefn,f={charts:[u]},rt&&(u.timespan=undefined,f.version=1),s=new i.Composition.PartReference("MonitorChartPart",{options:f},{extensionName:"HubsExtension",initialSize:5}),o.pin([s],{notify:!0}),r.stopPropagation())},disabled:f.pureComputed((function(){return t.state()===2||!!t.error()})),hidden:f.observable(!0),cssClass:"fxc-monitorchart-toolbar-pin"};this._chart=new g.ViewModel(this._ltm,{series:f.observableArray([]),chartType:f.observable(0),yAxis:{unit:f.observable(y.Count),displaySIUnit:f.observable(!1),min:0,max:f.observable(null)},metricsRules:f.observableArray([])})}return r.defineProperty(n.prototype,"chartDefinition",{get:function(){return this._chartDefn},enumerable:!0,configurable:!0}),n.prototype.getViewModel=function(){var n=this;return{chart:this._chart,state:this.state,errorMessage:this._errorMessage,title:this._title,subtitle:this._subtitle,toolbarItems:[this._pinToolbarItem],getToolbarItemCss:ut,showLoadingIndicator:this._isLoading,showHeader:f.pureComputed((function(){return!!(n._title()||n._subtitle()||!n._pinToolbarItem.hidden())}))}},n.prototype.setAriaLabel=function(n){this._chart.ariaLabel(n)},n.prototype.update=function(n){var t=this,u=function(n,i,r){n!==2&&(i=r=null);t._errorMessage(i);t.error(r);n!==1&&t._isLoading(!1);t.state(n)},c,l,k,d,f,e,r;if(this._chartDefn=n,!n){this._provider.clearAll();this._chart.series([]);u(0);return}var o=n.metrics,tt=o.map((function(n){var t=n.resourceMetadata;return{resourceDefinition:{resourceId:t.resourceId,kind:t.kind,sku:t.sku,supplementalProperties:t.properties},name:{value:n.name,localized:undefined},defaultAggregationType:n.aggregationType,supportedAggregationTypes:undefined,unit:n.unit,type:n.type&&{value:n.type,localized:""}}})),rt=n.timespan,h;return o.some((function(n){return!!(h=n.timeGrainMs)})),this._provider.clearAll(),this._provider.setMetrics(tt),this._provider.setTimespan(n.timespan),this._provider.setTimegrain(h),this._noDataMessage(n.noDataMessage),c=i.initValue(n.title,""),this._title(c),l=i.initValue(n.subtitle,""),this._subtitle(l),k=i.initValue(n.chartType,0),d=k===1?4:0,this._chart.chartType(d),this._pinToolbarItem.hidden(!!n.disablePinning),f=function(){b.clearInterval(t._refreshId)},e=function(n){var e=!n,r,o;if(t._ltm.isDisposed()){f();return}return u(1),t._isLoading(!e),r=++t._reloadId,o=t._provider.fetchMetricHistories(e).then((function(n){var o,v,c,f,b,k;if(r===t._reloadId){var l=[],s=[],h={},a=!0,e;n.forEach((function(n){var t=n.metricDefinition.name,i=t.localized||t.value,r=h[i];h[i]=r?r+1:1}));o=!1;n.forEach((function(n){var r=n.metricDefinition,tt=r.name.value.toLowerCase(),v=r.name.localized||r.name.value,y=r.type?r.type.value.toLowerCase():undefined,b=r.resourceDefinition.resourceId.toLowerCase(),rt=r.unit,ut,f,ft,u,k,d,c,ot;n.displaySettings&&n.displaySettings.useIECFormat&&(o=!0);i.isUndefined(e)||e===rt||(a=!1);e=rt;t._chartDefn.metrics.some((function(n){var t=n.type?n.type.toLowerCase():undefined;return n.resourceMetadata.resourceId.toLowerCase()===b&&n.name.toLowerCase()===tt&&t===y?(ut=n,!0):!1}));h[v]===1?f=v:r.type?f=r.type.localized||y:(ft=nt.parseResourceDescriptor(b),f=ft.resource+" "+v);u=new g.Series;u.name=b+tt+y;u.viewOptions={displayName:f,cssClass:ut.cssClass};k=[];n.dataPoints.forEach((function(n){k.push(new w.ChartItem(n.timestamp,n.value||0))}));u.values(k);s.push(u);d=et(r.defaultAggregationType);c=new i.ViewModels.Controls.DockedBalloon.ViewModel(t._ltm);c.type=it.Type.Info;c.content(p.InfoText.metricName.format(u.viewOptions.displayName)+"\n                            "+p.InfoText.aggregationType.format(d.displayName));ot=new w.MetricRuleMetric({aggregationScope:2,aggregationType:d.fxChartAggType,aggregationSeriesName:u.name,showBarColor:!0,defaultInfoBalloon:c});l.push(ot)}));t._chart.series(s);s.length===0?(v=t._noDataMessage()||p.noMetricHistoriesError,u(2,v)):(c=a?ft(e,o):y.Count,f=t._chart.yAxis,c===y.Percentage?f.max(100):f.max(null),f.unit(c),f.displaySIUnit(o),b=new w.MetricRule({scope:0,metrics:l}),k=new w.MetricRule({scope:4,metrics:[new w.MetricRuleMetric({aggregationScope:1,aggregationType:4,showBarColor:!0}),]}),t._chart.metricsRules([b,k]),u(0))}})).catch((function(n){if(r===t._reloadId){f();t._chart.series([]);n||(n="unknown");var e,i;n instanceof a.BaseError&&n.additionalInfo.resourceDefinition&&(e=nt.parseResourceDescriptor(n.additionalInfo.resourceDefinition.resourceId).resource);switch(n.constructor){case a.NoMetricDefinitionsError:i=t._noDataMessage()||p.noMetricDefinitionsError;break;case a.NoMetricHistoriesError:i=t._noDataMessage()||p.noMetricHistoriesError;break;case a.ResourceNotFoundError:i=e?p.resourceNotFoundError.format(e):p.defaultResourceNotFoundError;break;case a.UnauthorizedError:i=s.Asset.unauthorizedDescription;break;case a.DataFetchError:i=p.genericFetchError;break;default:i=p.genericFetchError;v.error(n)}u(2,i,n)}})),o},f(),r=rt.refreshIntervalMs,r!==null&&(r=i.initValue(r,3e5),r<6e4&&(v.warn("Refresh interval "+r+"ms is less than the minimum refresh interval of 60000ms. Continuing with using the minimum refresh interval."),r=6e4),this._refreshId=b.setInterval(e,r)),e(!0)},n})();t.MonitorChartMain=tt}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/BladeReferences",["require","exports","o","Fx/Composition/Selectable"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});var u="Microsoft_Azure_Monitoring",f="MetricsBladeV2",e=(function(n){function t(t,i){return n.call(this,f,u,{onClosed:i,parameters:t},{})||this}return __extends(t,n),t})(r.PdlBladeReference);t.MetricsBladeV2Reference=e}));
define("_generated/Less/MsPortalImpl.Controls/Controls/Visualization/MonitorChart.css",["require","exports","o","module"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});window.fx.injectCss(r,'.fxc-monitorchart{position:relative;min-height:100px}.fxc-monitorchart-charts{display:-webkit-flex;display:flex;-webkit-flex-flow:row wrap;flex-flow:row wrap;height:100%;padding:5px 0;margin-left:-10px;margin-right:-10px}.fxc-monitorchart-chart-wrapper{padding:10px;position:relative;box-sizing:border-box;overflow:hidden}.fxc-monitorchart-chart{height:100%;width:100%}.fxc-monitorchart-chart-container{flex:1 1 0%}.fxc-monitorchart-overlay-container{position:absolute;left:0;top:0;height:100%;width:100%;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-direction:column;flex-direction:column;pointer-events:none}.fxc-monitorchart-overlay-preview-text{position:absolute;top:63px;font-weight:700}.fxc-monitorchart-error{position:absolute;left:0;top:0;height:100%;width:100%;opacity:.3;pointer-events:all}.fxc-monitorchart-error-text{position:relative;padding:15px 10px;width:calc(100% - 30px);box-sizing:border-box;font-size:12px;line-height:18px;text-align:center;border-width:1px;border-style:solid}.fxc-monitorchart-header{display:-webkit-flex;display:flex;-webkit-flex-flow:row nowrap;flex-flow:row nowrap;height:47px;flex:none}.fxc-monitorchart-title-container{-webkit-flex:1 1 0%;flex:1 1 0%}.fxc-monitorchart-subtitle,.fxc-monitorchart-title{margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.fxc-monitorchart-title{font-size:14px;line-height:17px;padding-bottom:1px}.fxc-monitorchart-subtitle{font-family:az_ea_font,"Segoe UI",wf_segoe-ui_semibold,"Segoe UI Semibold","Segoe WP Semibold","Segoe WP",Tahoma,Arial,sans-serif;font-weight:600;font-size:10px;line-height:10px;text-transform:uppercase;margin-top:3px}.fxc-monitorchart-toolbar-item{height:18px;width:18px;padding:5px;float:right;display:block}.fxc-monitorchart-toolbar-item-disabled{pointer-events:none;opacity:.5}.fxc-monitorchart-chart-single{height:100%;width:100%}.fxc-monitorchart-chart-single .fxc-monitorchart-chart-container{height:calc(100% + -20px)}.fxc-monitorchart-chart-single .fxc-monitorchart-header-hidden .fxc-monitorchart-chart-container{height:calc(100% + 27px)}.fxc-monitorchart-short .fxc-monitorchart-chart-single .fxc-monitorchart-chart-container{height:calc(100% + -40px)}.fxc-monitorchart-short .fxc-monitorchart-chart-single .fxc-monitorchart-header-hidden .fxc-monitorchart-chart-container{height:calc(100% + 7px)}.fxc-monitorchart-chart-multiple{height:300px;max-width:374px;min-width:374px;-webkit-flex:1 1 0%;flex:1 1 0%}.fxc-monitorchart-chart-multiple .fxc-monitorchart-chart{padding:15px;border:1px solid #d6d6d6;box-sizing:border-box;transition:box-shadow .1s}.fxc-monitorchart-chart-multiple .fxc-monitorchart-chart:hover{box-shadow:0 2px 2px rgba(50,50,50,.5)}.fxc-monitorchart-chart-multiple .fxc-monitorchart-chart-container{height:calc(100% + -15px)}.fxc-monitorchart-chart-multiple .fxc-monitorchart-header-hidden .fxc-monitorchart-chart-container{height:calc(100% + 32px)}.fxc-monitorchart-chart .azc-metrics .azc-singleSetting-data .azc-singleSetting-value{font-size:20px!important;line-height:14px!important}.fxc-monitorchart-chart .azc-metrics ul.azc-metrics-horizontal{height:33px!important}.fxc-monitorchart-chart .azc-metrics .azc-metrics-singleSetting .azc-singleSetting-caption{font-size:11px!important}.fxc-monitorchart-chart .azc-metrics .azc-balloon-text{white-space:pre-line}.fxc-monitorchart-clickable{cursor:pointer}')}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MonitorChart",["require","exports","f","o","ko","MsPortalImpl/Base/Base.EventTypes","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/UI/Compositions/UI.Composition","Viva.Controls/Util/Viva.Resize","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/MonitorChart.Main","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/BladeReferences","MsPortalImpl.Controls/Controls/Visualization/MonitorChart/Tools/Timespan","_generated/Less/MsPortalImpl.Controls/Controls/Visualization/MonitorChart.css"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function w(n,t){n[t]=(n[t]||0)+1}var b;r.defineProperty(t,"__esModule",{value:!0});var k=i.Base.Diagnostics.Telemetry,y=i.ViewModels.Services.ResourceTypes,p="fxc-monitorchart",v="fxc-monitorchart-clickable",d="<div class='fxc-monitorchart-charts' data-bind='foreach: $ctl._charts, css: { \"fxc-monitorchart-short\": $ctl._size() === 0 }'><div class='fxc-monitorchart-chart-wrapper' tabindex='0' data-bind='css: $ctl._getChartCss($data), with: $data.chart.getViewModel()'>"+c.Template+"<\/div><\/div>",g={relative:{durationMs:864e5}};b=(function(n){function t(t,r,f){var h=n.call(this,t,r,f)||this,tt=Date.now(),it=$(t).closest(".fxs-tile").data(o.CompositionInstanceDataName),rt=it&&it.locator,ft=rt?rt.toFriendlyString():"",v,b,ut,nt;return h._charts=u.observableArray([]),h._charts.extend({rateLimit:1}),h._size=u.observable(1),h.element.addClass(p).html(d),h._bindDescendants(),v=function(n){var d=i.startTimer(),v=h.options._msPortalFxCharts(),t=v.length,f;if(!t){h._charts([]);return}if(f=t-h._charts().length,f<0)h._charts.splice(t,-f);else while(f--)h._charts.push({cssClass:u.observable(""),chart:new c.MonitorChartMain(h.ltm),onClick:null});var nt=t===1?"fxc-monitorchart-chart-single":"fxc-monitorchart-chart-multiple",it=h._charts(),rt=h.options._msPortalFxTimespan()||g,s={},p=[],b=[],ut=v.map((function(n,t){var f=n.timespan||rt,r,o,u;return n.timespan=f,r=it[t],r.chart.setAriaLabel(n.ariaLabel||e.Controls.MonitorChart.defaultAriaLabel),o=i.initValue(n.cssClass,nt),r.cssClass(o),r.onClick=i.initValue(n.onClick,(function(){var n=r.chart.chartDefinition,t=new l.MetricsBladeV2Reference({openInEditMode:!1,chart:{metrics:n.metrics.map((function(n){return{name:n.name,resourceMetadata:n.resourceMetadata,timeGrainMs:n.timeGrainMs,type:n.type,unit:n.unit,aggregationType:n.aggregationType}})),chartType:n.chartType,noDataMessage:n.noDataMessage,title:n.title,subtitle:n.subtitle,timespan:n.timespan}});h.options.openBlade(t)})),u=a.getAbsoluteTimespan(f),p.push(u.end.getTime()-u.start.getTime()),b.push(n.metrics.length),n.metrics.forEach((function(n){var i=n.resourceMetadata.resourceId,t,r;y.isResourceId(i)?(t=y.parseResourceDescriptor(i),r=t.provider+"/"+t.types.join("/"),w(s,r.toLowerCase())):w(s,"undefined")})),r.chart.update(n)})),et=Date.now(),o;Q.all(ut).catch((function(n){o=n})).finally((function(){var t=r.telemetryData;if(t){var e=Date.now(),u=d(),f={resourceTypes:s,timespanMs:p,bladeOrPartName:ft,metricCount:b,chartUpdateTime:u};n&&i.extend(f,{viewModelConstructionTime:t.constructorEndTimestamp-t.constructorStartTimestamp,widgetBundleLoadTime:tt-t.constructorEndTimestamp,widgetConstructionTime:et-tt});k.trace({source:"MonitorChart",action:n?"Load":"Reload",actionModifier:o?"Fail":"Success",duration:n?e-t.constructorStartTimestamp:u,data:f})}if(o)throw o;}))},b=0,u.pureComputed((function(){return h.options._msPortalFxCharts(),h.options._msPortalFxTimespan(),b=(b+1)%255})).extend({throttle:1}).subscribe(h.ltm,(function(){v(!1)})),nt=function(n,t){i.isNullOrUndefined(t)||(ut=!0,t<=175?h._size(0):h._size(1))},s.track(h.ltm,t,nt),Q.delay(250).then((function(){ut||nt(h.element.width(),h.element.height())})),h._attachEvents(),v(!0),h}return __extends(t,n),r.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(this._cleanElement(p),n.prototype.dispose.call(this))},t.prototype._attachEvents=function(){var n=this;this.ltm.registerForDispose(this.element.setEvents([f.default.click,"."+v,function(t){n._handleChartClick(u.dataFor(t.currentTarget));t.stopPropagation()},],[f.default.keyup,"."+v,function(t){(t.which===13||t.which===32)&&(n._handleChartClick(u.dataFor(t.currentTarget)),t.stopPropagation())},]))},t.prototype._handleChartClick=function(n){n.onClick&&n.onClick()},t.prototype._getChartCss=function(n){var t=[],i=n.cssClass();return i&&t.push(i),n.onClick&&t.push(v),t.join(" ")},t})(h.Widget);t.Widget=b}))