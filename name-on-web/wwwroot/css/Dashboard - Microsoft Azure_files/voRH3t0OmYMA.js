define("B2B/B2BArea",["require","exports","f","o","ko","Shared/AjaxExtensions","B2B/Constants","CommonConstants","Shared/BaseArea","B2B/B2BResources","Shared/Notification"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";r.defineProperty(t,"__esModule",{value:!0});var l=B2B.DataModels,w=Common.DataModels,b=Directories.DataModels;t.AreaName="B2B";var a=i.Base.Resources.getAppRelativeUri("/api/B2B/b2bPolicy"),v=i.Base.Resources.getAppRelativeUri("api/Directories/B2BDirectoryProperties"),k=i.Base.Resources.getAppRelativeUri("api/B2B/socialIdentityProviders?id={0}"),y=i.Base.Resources.getAppRelativeUri("api/B2B/socialIdentityProviders"),p=i.Base.Resources.getAppRelativeUri("api/B2B/customIdentityProviders"),d=i.Base.Resources.getAppRelativeUri("api/B2B/customIdentityProviders?domain={0}"),g=i.Base.Resources.getAppRelativeUri("api/B2B/getMetadataFile"),nt=i.Base.Resources.getAppRelativeUri("api/Common/getMsGraphToken"),tt=(function(n){function r(){var r=n.call(this,t.AreaName,Directories.ErrorCodes.ErrorCodesType)||this;return r.getB2BPolicy=new i.Data.EntityCache({entityTypeName:l.B2BPolicyDataType,sourceUri:function(){return a},poll:!1,supplyData:function(n,t,i,u,e,o){return f.AuthenticatedToAdIbizaUx.trackedSupplyData(r.businessScenarios.b2B(),"GetB2BPolicyAllowDenyList","GetB2BPolicyAllowDenyList","Retrieves the b2b policy for allowed and denied domains.",n,t,i,u,e,o)}}),r.getSocialIdentityProviders=new i.Data.QueryCache({entityTypeName:l.IdentityProviderType,sourceUri:function(){return y},poll:!1,supplyData:function(n,t,i,u,e,o){return f.AuthenticatedToAdIbizaUx.trackedSupplyData(r.businessScenarios.b2B(),"getSocialIdentityProviders","getSocialIdentityProviders","Retrieves the social identity providers",n,t,i,u,e,o)}}),r.getCustomIdentityProviders=new i.Data.QueryCache({entityTypeName:l.ExternalDomainFederationType,sourceUri:function(){return p},poll:!1,supplyData:function(n,t,i,u,e,o){return f.AuthenticatedToAdIbizaUx.trackedSupplyData(r.businessScenarios.b2B(),"GetCustomIdentityProviders","GetCustomIdentityProviders","Retrieves the custom identity providers",n,t,i,u,e,o)}}),r.getB2BDirectoryPropertiesEntityCache=new i.Data.EntityCache({entityTypeName:b.B2BDirectoryPropertiesType,extendEntryLifetimes:!1,sourceUri:function(){return v},poll:!1,supplyData:function(n,t,i,u,e,o){return f.AuthenticatedToAdIbizaUx.trackedSupplyData(r.businessScenarios.b2B(),"GetB2BDirectoryProperties","GetB2BDirectoryProperties","Get the b2b-related properties of the current directory",n,t,i,u,e,o)}}),r.getToken=new i.Data.EntityCache({entityTypeName:w.MsGraphTestTokenType,sourceUri:function(){return nt},poll:!1,supplyData:function(n,t,i,u,e,o){return f.AuthenticatedToAdIbizaUx.trackedSupplyData(r.businessScenarios.gDPR(),"B2BGetToken","B2BGetToken","Retrieves MsGraph Token",n,t,i,u,e,o)}}),r}return __extends(r,n),r.prototype.setB2BPolicy=function(n){var t=this;return f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.b2B(),"SetB2BPolicy","SetB2BPolicy","Sets the b2b policy",{uri:a,type:o.httpVerbs.post,data:u.toJSON(n),contentType:o.httpContentTypes.applicationJson}).then((function(i){return t.getB2BPolicy.applyChanges((function(t,i){i.data(n)})),i}))},r.prototype.getMetadataFile=function(n){return f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.b2B(),"GetMetadataFile","GetMetadataFile","Get metadata file",{uri:g,type:o.httpVerbs.post,data:u.toJSON(n),contentType:o.httpContentTypes.applicationJson}).then((function(n){return n}))},r.prototype.createCustomIdentityProvider=function(n){var i=this,t=new c.Notification;return t.PublishInProgress(h.notificationInProgressEnterpriseIdentityProvider.format(n.externalDomainName()),h.notificationInProgressEnterpriseIdentityProvider.format(n.externalDomainName())),f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.b2B(),"CreateCustomIdentityProvider","CreateCustomIdentityProvider","Create custom identity provider",{uri:p,type:o.httpVerbs.post,data:u.toJSON(n),contentType:o.httpContentTypes.applicationJson}).then((function(n){return t.PublishOnSuccess(h.notificationSuccessEnterpriseIdentityProvider.format(n.externalDomainName),h.notificationSuccessEnterpriseIdentityProvider.format(n.externalDomainName)),i.getCustomIdentityProviders.applyChanges((function(t,i){var r=i.data().slice(),f={externalDomainName:u.observable(n.externalDomainName),federationSettings:u.observable(n.federationSettings)};r.push(f);i.data(r)})),n})).catch((function(n){t.PublishOnError(h.notificationFailureEnterpriseIdentityProvider,h.notificationFailureEnterpriseIdentityProvider);throw n;}))},r.prototype.deleteCustomIdentityProvider=function(n){var i=this,t=new c.Notification;return t.PublishInProgress(h.notificationInProgressEnterpriseIdentityDelete.format(n),h.notificationInProgressEnterpriseIdentityDelete.format(n)),f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.b2B(),"DeleteCustomIdentityProvider","DeleteCustomIdentityProvider","Delete custom identity provider",{uri:d.format(n),type:o.httpVerbs.delete,contentType:o.httpContentTypes.applicationJson}).then((function(n){return t.PublishOnSuccess(h.notificationSuccessEnterpriseIdentityDelete.format(n),h.notificationSuccessEnterpriseIdentityDelete.format(n)),i.getCustomIdentityProviders.applyChanges((function(t,i){for(var r,f=[],u=0,e=i.data();u<e.length;u++)r=e[u],r&&r.externalDomainName&&r.externalDomainName()===n||f.push(r);i.data(f)})),n})).catch((function(n){t.PublishOnError(h.notificationFailureEnterpriseIdentityDelete,h.notificationFailureEnterpriseIdentityDelete);throw n;}))},r.prototype.createGoogleIdentityProvider=function(n){var i=this,t=new c.Notification;return t.PublishInProgress(h.notificationInProgressSocialIdentityProvider,h.notificationInProgressSocialIdentityProvider),f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.b2B(),"CreateGoogleIdentityProvider","CreateGoogleIdentityProvider","Create Google identity provider",{uri:y,type:o.httpVerbs.post,data:u.toJSON(n),contentType:o.httpContentTypes.applicationJson}).then((function(r){return t.PublishOnSuccess(h.notificationSuccessSocialIdentityProvider,h.notificationSuccessSocialIdentityProvider),i.getSocialIdentityProviders.applyChanges((function(t,i){var r=i.data().slice(),f={id:u.observable(e.googleFederationId),type:u.observable(n.type()),name:u.observable(n.name()),clientId:u.observable(n.clientId()),clientSecret:u.observable(n.clientSecret())};r.push(f);i.data(r)})),r})).catch((function(n){t.PublishOnError(h.notificationFailureSocialIdentityProvider,h.notificationFailureSocialIdentityProvider);throw n;}))},r.prototype.deleteSocialIdentityProvider=function(n){var i=this,t=new c.Notification;return t.PublishInProgress(h.notificationInProgressSocialIdentityProviderDelete,h.notificationInProgressSocialIdentityProviderDelete),f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.b2B(),"DeleteSocialIdentityProvider","DeleteSocialIdentityProvider","Delete social identity provider",{uri:k.format(e.googleFederationId),type:o.httpVerbs.delete,contentType:o.httpContentTypes.applicationJson}).then((function(r){return t.PublishOnSuccess(h.notificationSuccessSocialIdentityProviderDelete,h.notificationSuccessSocialIdentityProviderDelete),i.getSocialIdentityProviders.applyChanges((function(t,i){for(var r,f=[],u=0,e=i.data();u<e.length;u++)r=e[u],r&&r.id&&r.id()===n||f.push(r);i.data(f)})),r})).catch((function(n){t.PublishOnError(h.notificationFailureSocialIdentityProviderDelete,h.notificationFailureSocialIdentityProviderDelete);throw n;}))},r.prototype.setB2BDirectoryProperties=function(n){var t=this;return f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.b2B(),"SetB2BDirectoryProperties","SetB2BDirectoryProperties","Sets the b2b directory properties",{uri:v,type:o.httpVerbs.put,data:u.toJSON(n),contentType:o.httpContentTypes.applicationJson}).then((function(i){return t.getB2BDirectoryPropertiesEntityCache.applyChanges((function(t,i){i.data(n)})),i}))},r})(s.BaseArea);t.DataContext=tt}))