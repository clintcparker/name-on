define("MsPortalImpl/Widgets/Widgets.NotificationsPane",["require","exports","f","ko","MsPortalImpl/Base/Base.EventTypes","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Telemetry","MsPortalImpl/UI/UI.ContextPane","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Interactions/Interactions.PortalReader"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";var l;return (function(n){function yt(n){return(n.additionalProperties||{}).subscriptionId&&(n.correlationIds||[]).some((function(n){return!n.toLowerCase().startsWith("clientnotification")}))}function pt(n,t){return n[0].scrollHeight>n[0].clientHeight||n.hasClass(w)||yt(t)}function l(n){n.preventDefault();n.stopPropagation()}function ht(n,t){n.forEach((function(n){return n.css("visibility",t?"visible":"hidden").attr("tabindex",t?"0":"-1")}))}function li(n,t,i){n.removeClass(rt);n.findByClassName(k).attr("tabindex","-1");ht([n.findByClassName(et),n.findByClassName(ot)],!1);(n.length===0||t.length===0)&&(t=i);t.addClass(rt);t.findByClassName(k).attr("tabindex","0").focus();var u=t.findByClassName(d);ht([t.findByClassName(et)],!0);pt(u,r.dataFor(t[0]))&&ht([t.findByClassName(ot)],!0);t.get(0).scrollIntoView(!1)}var tt=i.Base,vi=tt.Diagnostics.Telemetry,it=tt.Images,y=i.Hubs.Notifications.NotificationStatus,g=tt.Images.StatusBadge,ct=o.Action,lt=vi.trace,b=u.default.click,t=e.NotificationMenu,at=t.collapse,vt=t.dismissNotification,nt=t.seeMore,wt="aria-label",bt="title",rt="fxs-portal-selected",kt="fxs-portal-background",dt="fxs-portal-svg",gt="fxs-trim-hover",ut=".fxs-topbar-notifications",p="fxs-notificationspane",ft="fxs-notificationmenu-notification-wrapper",k="fxs-notificationmenu-notification-title-text",ni="fxs-notificationmenu-notification-title-subtitle",d="fxs-notificationmenu-notification-description",ti="fxs-notificationmenu-notification-details",ii="fxs-notificationmenu-notificationclick",yi=".fxs-notificationmenu-notification-details",et="fxs-notificationmenu-notification-dismissIcon",pi=".fxs-notificationmenu-notification-dismissIcon",ot="fxs-notificationmenu-notification-expandIcon",st=".fxs-notificationmenu-notification-expandIcon",w="fxs-notificationmenu-notification-expandedDescription",ri="fxs-notificationmenu-notification-iconVerticalTransform",ui=y.Information,fi=y.Warning,ei=y.Error,oi=y.Success,si=y.InProgress,hi,ci,ai,a,v;n.iconMap=(a={},a[ui]=g.Info(),a[fi]=g.Warning(),a[ei]=g.Error(),a[si]=it.Loading.EllipsisSquare(),a[oi]=g.Success(),a);hi=(v={},v[ui]=t.info,v[fi]=t.warning,v[ei]=t.error,v[si]=t.progress,v[oi]=t.success,v);ci="<div class='"+p+"'>"+("<div class='"+p+"-header'>")+('<h2 id="notifications-title-id" class=\''+p+"-title fxs-contextpane-title'>"+i.encodeHtml(t.title)+"<\/h2>")+"<div class='fxs-notificationspane-dismisscontainer' data-bind=\"style : { visibility : data.hasNotifications() ? '' : 'hidden' }\">"+('<span aria-hidden="true" id="notifications-dismisstitle-id" class="fxs-notificationspane-dismiss">'+i.encodeHtml(t.dismiss)+"<\/span>")+'<ul class="fxs-notificationspane-dismisslist" data-bind="foreach: data.dismissOptions"><li class="fxs-notificationspane-dismissitem"><a href="#" data-bind="text: name, css: { \'fxs-notificationspane-dismissitemdisabled\': !isEnabled() }" aria-describedby="notifications-dismisstitle-id" role="button"><\/a><\/li><\/ul><\/div><\/div>'+("<div class='"+p+"-top'>")+"<!-- ko ifnot: data.hasNotifications -->"+('<div class="nodata-content" title="'+i.encodeAttribute(t.noNewNotifications)+'">'+i.encodeHtml(t.noNewNotifications)+"<\/div>")+"<!-- /ko --><!-- ko if: data.hasNotifications -->"+('<ul tabindex="0" aria-labelledby="notifications-title-id" class="'+p+'-list" data-bind="foreach: data.notifications">')+'<li tabindex="-1" class="fxs-notificationmenu-notification-li fxs-portal-border">'+('<div class="'+ft+'">')+'<div class="fxs-notificationmenu-notification"><div class="fxs-notificationmenu-notification-title"><div class="fxs-notificationmenu-notification-title-icon" data-bind="image: $root.func._getIcon($data)" /><!--ko if: clickable-->'+('<a href="#" tabindex="-1" class="'+k+" "+ii+" msportalfx-tooltip-overflow\" role=\"button\" data-bind=\"text: title, title:title, attr:{'aria-label': $root.func._getNotificationAriaLabel($data), 'aria-describedby':  'description_' + $index() }\"><\/a>")+"<!-- /ko --><!--ko ifnot: clickable-->"+('<div tabindex="-1" class="'+k+" msportalfx-tooltip-overflow\" data-bind=\"text: title, title:title, attr:{'aria-label': $root.func._getNotificationAriaLabel($data), 'aria-describedby':  'description_' + $index() }\"><\/div>")+"<!-- /ko --><!--ko ifnot: status === MsPortalFx.Hubs.Notifications.NotificationStatus.InProgress-->"+('<time class="'+ni+' fxs-portal-title" data-bind="attr: { datetime: $root.func._timestampToString(timestamp) }, text: $root.func._timestampToString(timestamp)"><\/time>')+"<!-- /ko --><!--ko if: status === MsPortalFx.Hubs.Notifications.NotificationStatus.InProgress-->"+('<div class="'+ni+' fxs-portal-title" data-bind="text: $root.func._getPercentCompleteStr($data.percentComplete)"><\/div>')+"<!-- /ko --><\/div><!-- ko if: descriptionAsHtml -->"+('<div class="'+d+" fxs-portal-title msportalfx-tooltip-overflow\" data-bind=\"sanitizedHtml: description, attr: { id: 'description_' + $index() }, css: { '"+w+"': formSection }\"><\/div>")+"<!-- /ko --><!-- ko ifnot: descriptionAsHtml -->"+('<div class="'+d+" fxs-portal-title msportalfx-tooltip-overflow\" data-bind=\"text: description, attr: { id: 'description_' + $index() }, css: { '"+w+"': formSection }\"><\/div>")+'<!-- /ko --><!-- ko if: formSection --><div class="msportalfx-form fxs-notification-inlineform" data-bind="pcControl: formSection"><\/div><!-- /ko -->'+('<a class="'+ti+' fxs-display-none">'+i.encodeHtml(t.details)+"<\/a>")+"<\/div>"+('<button tabindex="-1" class=\''+et+"' title='"+i.encodeAttribute(vt)+"' aria-label='"+i.encodeAttribute(vt)+'\' data-bind="image: $root.dismissIcon"><\/button>')+('<button tabindex="-1" class=\''+ot+"' title='"+i.encodeAttribute(nt)+"' aria-label='"+i.encodeAttribute(nt)+'\' data-bind="image: $root.expandIcon"><\/button>')+"<\/div><\/li><\/ul><!-- /ko --><\/div><\/div>";ai=(function(e){function h(n,t,i){var r=e.call(this,n,t)||this;return r._contextPane=i.diContainer.get(s.RightContextPane),r._notificationManager=i.notificationManager,r.options.notifications=i.notificationManager.notifications,r}return __extends(h,e),h.prototype.dispose=function(){this._removeEventHandlers();e.prototype.dispose.call(this)},h.prototype.toggleNotificationsContextPane=function(){var t=this._contextPane,n=this.options,r;return n.isPaneOpen()?(n.isPaneOpen(!1),Q(t.close(!0))):(n.isPaneOpen(!0),lt({source:o.Source.TopBar,action:ct.NotificationMenuOpen}),r=this.options.notifications().filter((function(t){return t.isRecommendation&&t.timestamp.getTime()>n.lastPaneOpenedTime()})),r.forEach((function(n){var t=n.additionalProperties||{};i.extend(t,{status:y[n.status],correlationId:(n.correlationIds||[]).join(",")});lt({source:o.Source.NotificationHub,action:ct.RecommendationSurfaced,data:t})})),t.tryOpen(this))},h.prototype.onAddingContent=function(n){var t,i;return n.addChild($(ci)),t=n.element.findByClassName(p)[0],$(ut).addClass(kt).removeClass(gt).children("a").addClass(dt),t&&(i={data:this.options,func:this,dismissIcon:it.Shell.Close(),expandIcon:it.CaretDown()},r.applyBindings(i,t),this._attachEventHandlers($(t))),Q()},h.prototype.onRemovingContent=function(n){this.options.isPaneOpen(!1);n.clear();$(ut).addClass(gt).removeClass(kt);$(ut).children("a").removeClass(dt);this._removeEventHandlers()},h.prototype._getIcon=function(t){return n.iconMap[t.status]},h.prototype._timestampToString=function(n){var t="numeric";return n.toString({hour:t,minute:t})},h.prototype._getNotificationAriaLabel=function(n){var i=t.notificationLabel.format(hi[n.status],n.title,this._timestampToString(n.timestamp));return n.percentComplete&&(i+=this._getPercentCompleteStr(n.percentComplete)),i},h.prototype._getPercentCompleteStr=function(n){return!n?t.inProgress:t.percentComplete.format(n)},h.prototype._attachEventHandlers=function(n){var i=this;this._events=n.setEvents([b,".fxs-notificationspane-dismissitem",function(n){l(n);var u=r.dataFor(n.currentTarget),t=u.dismissableStates;t?i.options.notifications.remove((function(n){return t.indexOf(n.status)>-1})):i.options.notifications.removeAll()},],[u.default.mouseover,"."+ft,function(n){l(n);var i=$(n.currentTarget).parent().findByClassName(d),t=r.dataFor(n.currentTarget);!t.inlineForm&&pt(i,t)&&$($(n.currentTarget).find(st)[0]).css("visibility","visible")},],[u.default.mouseleave,"."+ft,function(n){l(n);$($(n.currentTarget).find(st)[0]).css("visibility","hidden")},],[b,"."+ii,function(n){l(n);var t=r.dataFor(n.currentTarget);i._notificationManager.handleNotificationClick(t,!0)},],[b,yi,function(n){l(n);var t=r.dataFor(n.currentTarget);i._notificationManager.showNotificationDetails(t)},],[b,pi,function(n){l(n);var u=r.dataFor(n.currentTarget);i.options.notifications.remove(u);c.read(t.notificationDismissed,0,"notificationspane")},],[b,st,function(n){l(n);var t=$(n.currentTarget),u=t.parent(),e=r.dataFor(n.currentTarget),i=u.findByClassName(d),o=u.findByClassName(ti);e.inlineForm||(i.hasClass(w)?(t.attr(wt,nt),t.attr(bt,nt),t.removeClass(ri),i.removeClass(w),f.hide(o)):(t.attr(wt,at),t.attr(bt,at),t.addClass(ri),i.addClass(w),yt(e)&&f.unhide(o)))},],[u.default.keydown,".fxs-notificationspane-list",function(n){var s=$(n.currentTarget),t=s.findByClassName(rt),f=s.findByClassName("fxs-notificationmenu-notification-li").first(),h=t.nextAll("li"),u,e,o;switch(n.keyCode){case 40:u=h.first();li(t,u,f);n.stopPropagation();break;case 38:u=t[0]===f[0]?h.last():t.prevAll("li").first();li(t,u,f);n.stopPropagation();break;case 13:case 32:e=$(n.target);e.hasClass(k)&&(o=r.dataFor(e[0]),o&&i._notificationManager.handleNotificationClick(o,!0));n.stopPropagation()}},])},h.prototype._removeEventHandlers=function(){i.disposeDisposable(this._events);this._events=null},h})(h.Widget);n.Widget=ai})(l||(l={})),l}))