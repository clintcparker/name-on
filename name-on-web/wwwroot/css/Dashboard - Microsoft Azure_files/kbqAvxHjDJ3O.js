define("Users/ViewModels/UserAddNew/UserCreationService",["require","exports","f","o","ko","Shared/AjaxExtensions","Users/UsersResources","CommonConstants","Users/Constants","_generated/ExtensionDefinition","Users/Utilities/UsersUtils","Shared/Utilities"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";r.defineProperty(t,"__esModule",{value:!0});var a=(function(){function n(n,t){this.businessScenarios=l.getBusinessScenarios();this._container=n;this._dataContext=t}return n.prototype.SupplyInitialData=function(){return{displayName:u.observable(""),userPrincipalName:u.observable(""),password:u.observable(""),profile:u.observable({givenName:u.observable(""),surname:u.observable(""),jobTitle:u.observable(""),department:u.observable("")}),properties:u.observable({sourceOfAuthority:u.observable(c.getUserSourceOfAuthorityText(s.userSourceTypes.cloud))})}},n.prototype.ReceiveResult=function(n,t){var f=this,i=n.profile(),r={displayName:u.observable(n.displayName()),userPrincipalName:u.observable(n.userPrincipalName()),givenName:u.observable(i.givenName()),surname:u.observable(i.surname()),jobTitle:u.observable(i.jobTitle()),department:u.observable(i.department()),passwordProfile:u.observable({password:u.observable(n.password()),forceChangePasswordNextLogin:u.observable(!0)}),selectedGroupIds:u.observableArray(n.selectedGroupIds()),rolesEntity:u.observable({adminType:u.observable(n.adminType()),enabledRoles:u.observable(n.enabledRoles())})};if(r.userPrincipalName())return this._dataContext.userIsUPNInAllowedDomainEntity.fetch(r.userPrincipalName(),this._container).then((function(n){var i=n.data();i.isUpnInVerifiedDomains()&&!i.isUpnInFederatedDomain()&&f.CreateUser(r,t)}))},n.prototype.CreateUser=function(n,t){var c=f.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.userManagement(),"CreateUser","CreateUser","Create a user",{uri:i.Base.Resources.getAppRelativeUri("/api/UserDetails"),type:o.httpVerbs.post,data:u.toJSON(n),contentType:o.httpContentTypes.applicationJson}),r={},e=h.NotificationDefinitions.CreateUserProfileNotification,s=i.UI.NotificationManager.create(e.name);return r.displayName=n.displayName(),s.raise(e.progress,null,r),c.then((function(n){s.raise(e.succeeded,null,r);t&&t(n)}),(function(){s.raise(e.error,null,r)})),Q(c)},n.prototype.ReInviteUser=function(n,t,i){i===void 0&&(i="");this.InviteUser(n,i,!0,(function(n){t.value(n)}))},n.prototype.ReInviteUser2=function(n,t,i){i===void 0&&(i="");this.InviteUser(n,i,!0,(function(n){t.value(n)}))},n.prototype.ReceiveResultFromInviteBlade=function(n,t,i){t===void 0&&(t="");var r={displayName:u.observable(n.displayName()),userPrincipalName:u.observable(n.displayName()),givenName:u.observable(null),surname:u.observable(null),jobTitle:u.observable(null),department:u.observable(null),passwordProfile:u.observable(null),selectedGroupIds:u.observableArray(null),rolesEntity:u.observable(null)};this.InviteUser(r,t,!1,i)},n.prototype.InviteUser=function(n,t,r,u,f){var s=this,h=null,c=null,o=new i.Hubs.Notifications.ClientNotification({title:e.inviteUserNotificationProgressTitle,description:e.inviteUserNotificationProgressDescription.format(n.displayName()),status:i.Hubs.Notifications.NotificationStatus.InProgress});o.publish();r?(c=this._dataContext.getReInvitePromise(n,t),c.then((function(t){s.InviteSuccessNotification(o,n);u&&u(t)})).catch((function(t){f&&f(t);s.InviteFailureNotification(o,n,t)}))):(h=this._dataContext.getInvitePromise(n,t),h.then((function(t){s.InviteSuccessNotification(o,n);u&&u(t)})).catch((function(t){f&&f(t);s.InviteFailureNotification(o,n,t)})))},n.prototype.InviteSuccessNotification=function(n,t){n.title=e.inviteUserNotificationSuccessTitle;n.description=e.inviteUserNotificationSuccessDescription.format(t.displayName());n.status=i.Hubs.Notifications.NotificationStatus.Success;n.publish()},n.prototype.InviteFailureNotification=function(n,t,i){var o=e.inviteUserNotificationErrorTitle.format(t.displayName()),r=e.inviteUserNotificationErrorDescription.format(t.displayName()),u={B2BUserExistsButNotGuest:e.inviteUserNotificationErrorUserAlreadyExistsAsMember.format(t.displayName()),OperationDisallowedByPolicy:e.inviteUserNotificationErrorUserIsBlockedByPolicyDescription.format(t.displayName()),AuthorizationException:e.b2bErrorAuthorizationException,InviteeInTenantDomain:e.b2bErrorInviteeInTenantDomain,GroupEmailAddressNotSupported:e.b2bErrorGroupEmailAddressNotSupported,ObjectSourceOnPremisesOrUnderMigration:e.b2bErrorObjectSourceOnPremisesOrUnderMigration,InvalidValueForPrimarySMTPAddress:e.b2bErrorInvalidValueForPrimarySMTPAddress,MsodsInviteFailed:e.b2bErrorMsodsInviteFailed,UserExistsButNotExternalUser:e.b2bErrorUserExistsButNotExternalUser,QuotaExceeded:e.b2bErrorQuotaExceeded,AmbiguousUser:e.b2bErrorAmbiguousUser,UserAccountDisabled:e.b2bErrorUserAccountDisabled,ExternalUserMSODSConnectionFailure:e.b2bErrorExternalUserMSODSConnectionFailure};for(var f in u)if(this._dataContext.didAjaxFailWithErrorCodeValue(i,f)){r=u[f];break}l.failClientNotificationAndOpenAadErrorDetails(o,r,n,i.responseJSON.ClientData)},n})();t.UserCreationService=a}))