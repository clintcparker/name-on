define("Viva.Controls/Controls/Visualization/Viva.ChartViewImpl",["require","exports","f","i","o","a","ko","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Util/Viva.ArrayUtil","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/Resources/ImplScriptResources","d3"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";var a;return (function(n){var d=i.ColorUtil,t=i.isNullOrUndefined,a=c.Chart,p="azc-chart-view",g="azc-chart-tooltip-circle",nt="azc-chart-selected-circle",tt="azc-chart-hovered-circle",it="azc-svg-style-fill",rt="azc-color-",ut="azc-chart-series-selected",ft="azc-chart-series-hovered",w=d.getRainbowColorCode(0),et=w.length,ot=2,st=4,ht=1,b="visibility",k=0,v=(function(){function f(n,t,i,r){this._noItemDataMessage="No data";this._inSetSliderTickColorClass=!1;this._viewImpl=n;this._seriesBase=t;this._seriesViewIndex=i;this._seriesIndex=r?this._viewImpl.seriesIndexDictionary(r.seriesName()):this._viewImpl.seriesIndexDictionary(t.name());this._seriesIndex||this._seriesIndex===0||(this._seriesIndex=i);this._seriesName=n.options.series()[this._seriesIndex].name();this._seriesName!==t.name()&&console.error("Series name from index does not match passed in name");this._seriesView=r;this.ltm=n.ltm.createChildLifetime();this.renderLifetimeManager=this.ltm.createChildLifetime();this._touchPointRadiusAddition=ht;this._hoveredPointRadiusAddition=st;this._selectedPointRadiusAddition=ot;this._xAxis=this._viewImpl.xAxes[this._viewImpl.mappedXAxisIndex[this._seriesIndex]];this._yAxis=this._viewImpl.yAxes[this._viewImpl.mappedYAxisIndex[this._seriesIndex]];this._navigationStarted=!1;this._currentChartItemIndex=0}return u.defineProperty(f.prototype,"_chartItemsSortByCoordinate",{get:function(){var n=this;return this._chartItemsComputed||(this._chartItemsLifetimeManager||(this._chartItemsLifetimeManager=new r.TriggerableLifetimeManager),this._chartItemsComputed=e.computed(this._chartItemsLifetimeManager,(function(){var t=o.SeriesUtilities.getChartItemArrayBySeriesBase(n._seriesBase),i,r;return t&&t.length>0?(n._xAxis.axisScaleType()===0||typeof t[0].xValue=="string"?(i=n._getScreenX,r=n):i=n._xAxis.mappedAxis().scale(),t.map((function(n){var t=i.call(r,n.xValue);return{chartItem:n,xCoordinate:t}})).sort((function(n,t){return n.xCoordinate-t.xCoordinate}))):null})),this._chartItemsComputed.extend({rateLimit:25})),this._chartItemsComputed.peek()},enumerable:!0,configurable:!0}),f.prototype.dispose=function(){this.ltm&&(this.ltm.dispose(),this.ltm=null)},f._selectLastItem=function(n,t,i){var u=t?t:Number(!!t),f=i?i:0,e=-(f/2),r=n.reduce((function(n,t){return t.xDistance<e?n:!n||t.xDistance<n.xDistance?t:n}),null);return r&&(u<=0||Math.abs(r.xDistance)<=u)?r.chartItem:null},f._selectClosestItem=function(n,t){var r=t?t:Number(!!t),i=n.reduce((function(n,t){return Math.abs(t.xDistance)<Math.abs(n.xDistance)?t:n}));return i&&(r<=0||Math.abs(i.xDistance)<=r)?i.chartItem:null},f.prototype.selectChartItemFromXCoordinate=function(n,t){var i=this._chartItemsSortByCoordinate,e=i,h=this._viewImpl.isHorizontalChart,c=h?-1:1,l=t&&t.selectFunction?t.selectFunction:f._selectClosestItem,o=2,r,u;return i&&i.length>0&&(i.length>64&&(r=s.binarySearch(i,{chartItem:null,xCoordinate:n},(function(n,t){return n.xCoordinate-t.xCoordinate})),r<0&&(r=~r),e=i.slice(Math.max(r-o,0),Math.min(r+o,i.length))),u=e.map((function(t){return t.xDistance=c*(n-t.xCoordinate),t})),u.length>0)?l(u,t?t.withinRange:null,t?t.rangeAdjustment:null):null},f.prototype.setSeriesHover=function(n,t){var r=this._viewImpl.options,u=this._viewImpl.chartViewIndex,s,f=this._seriesView,e=this._seriesIndex,i;u>=0&&u<r.views().length&&(s=r.views()[u],(!f||f.hoverable())&&(t&&e>=0?(i=new o.SeriesSubset,i.seriesViewIndex(this._seriesViewIndex),i.chartViewIndex(u),n?i.chartItems([n]):i.chartItems(this._getChartItems(e)),r.seriesHovers([i]),r.hoveredID([i])):(r.seriesHovers([]),r.hoveredID([]))))},f.prototype.updateSeriesLiveData=function(n){var i=this,r=(!this._seriesView||this._seriesView.selectable())&&this._viewImpl.options.seriesSelections().some((function(n){return n.chartViewIndex()===i._viewImpl.chartViewIndex&&n.seriesViewIndex()===i._seriesViewIndex})),t;switch(this._seriesBase.type()){case 1:t=this._seriesBase.value();this._viewImpl.options.yAxis.autoScaleUnit()&&(t=t/this._yAxis.conversionFactor());n.seriesLiveData(a.seriesLiveHorizontalThresholdFormatter.format(this._seriesName,this._yAxis.mappedAxis().tickFormat()(t)));break;case 2:n.seriesLiveData(a.seriesLiveVerticalThresholdFormatter.format(this._seriesName,this._xAxis.mappedAxis().tickFormat()(this._seriesBase.value())));break;case 0:case 3:n.seriesLiveData(a.seriesLiveFormatter.format(this._seriesName,this._seriesIndex+1,this._viewImpl.options.series().length,r?a.selected:a.unselected,this._chartItemsSortByCoordinate?this._chartItemsSortByCoordinate.length:0))}},f.prototype._disposeRenderDisposables=function(){this.renderLifetimeManager&&(this.renderLifetimeManager.dispose(),this.renderLifetimeManager=null);this.renderLifetimeManager=this.ltm.createChildLifetime()},f.prototype._getScreenX=function(n){return this._viewImpl._getScreenX(this._seriesIndex,this._xAxis.extractValue(n))},f.prototype._getScreenY=function(n){return this._viewImpl._getScreenY(this._seriesIndex,this._yAxis.extractValue(n))},f.prototype._toggleSeriesSelection=function(n){this._viewImpl.toggleSeriesSelection(this._seriesViewIndex,n)},f.prototype._attachSeriesComputeds=function(n){var t=this,i=this.renderLifetimeManager;e.computed(i,(function(){t._createSelectedPlots(n)}));e.computed(i,(function(){t._createHover(n)}));this._viewImpl._attachSeriesComputeds(n,this._seriesViewIndex,this._seriesView)},f.prototype._eventHandlerWrapper=function(n,t){var i=this._viewImpl._getEvents(),r={seriesName:this._seriesName,value:t};if(i&&i.pointClick)switch(n){case"pointmouseover":i.pointMouseEnter&&i.pointMouseEnter(r);break;case"pointmouseleave":i.pointMouseLeave&&i.pointMouseLeave(r);break;case"pointclick":i.pointClick&&i.pointClick(r);break;case"seriesmouseover":i.seriesMouseEnter&&i.seriesMouseEnter(r);break;case"seriesmouseleave":i.seriesMouseLeave&&i.seriesMouseLeave(r);break;case"seriesclick":i.seriesClick&&i.seriesClick(r)}},f.prototype._getChartItemArray=function(n){return n===void 0&&(n=!1),o.SeriesUtilities.getChartItemArrayBySeriesBase(this._seriesBase,n)},f.prototype._isDataXValueSortable=function(){return o.SeriesUtilities.isXValueSortable(this._seriesBase)},f.prototype._createArea=function(n,t,i){t===void 0&&(t=null);i===void 0&&(i=!1);switch(this._seriesBase.type()){case 1:return this._createHorizontalArea(n,i);case 2:return this._createVerticalArea(n,i);case 0:case 3:t=t||this._getInterpolation();var r=this._getChartItemArray(),u=this._createGeneralArea(t,i);return n.append("path").attr("d",u(r))}},f.prototype._createGeneralLine=function(n){var t=this;return l.svg.line().interpolate(f._getInterpolationString(n)).x((function(n){return t._getScreenX(n.xValue)})).y((function(n){return t._getScreenY(n.yValue)}))},f.prototype._renderSeries=function(){},f.prototype._createElement=function(n){return this._viewImpl.element.append("g").attr("class",n)},f.prototype._renderTooltips=function(){if(this._seriesView&&this._seriesView.showTooltip()){var n=this._createElement(g),t=this._createDataPlots(n,this._touchPointRadiusAddition);this._addTooltips(t)}},f.prototype._createSelectedPlots=function(n){var t=this,i=this._viewImpl.options.seriesSelections().filter((function(n){return n.chartViewIndex()===t._viewImpl.chartViewIndex&&n.seriesViewIndex()===t._seriesViewIndex})),r=i.length>0?i[0].chartItems():[];return this._updatePlots(n,r,nt,this._selectedPointRadiusAddition,2,!0)},f.prototype._createHover=function(t){var i;if(!this._inSetSliderTickColorClass){var u=n.ChartViewImpl._getCssClass(this._seriesViewIndex,this._seriesView),r=void 0,f=this._getHoveredChartItems();if(f&&(!this._seriesView||this._seriesView.hoverable())&&(this._createHoveredPlots(t,f),i=this._viewImpl.options.seriesHovers.peek(),i.length===1&&i[0].seriesViewIndex()===this._seriesViewIndex&&i[0].chartItems.peek().length===1&&(r=u)),this._xAxis)try{this._inSetSliderTickColorClass=!0;r?this._xAxis._sliderTickColorClass(r):this._xAxis._sliderTickColorClass.peek()===u&&this._xAxis._sliderTickColorClass("")}finally{this._inSetSliderTickColorClass=!1}}},f.prototype._getHoveredChartItems=function(){return this._filterChartItems(this._viewImpl.options.seriesHovers())},f.prototype._getSelectedChartItems=function(){return this._filterChartItems(this._viewImpl.options.seriesSelections())},f.prototype._createHoveredPlots=function(n,t){this._updatePlots(n,t,tt,this._hoveredPointRadiusAddition,2,!0)},f.prototype._createDataPlots=function(n,t){t===void 0&&(t=0);var i=this._getChartItemArray(!1);return this._updatePlots(n,i,it,t,1)},f.prototype._updatePlots=function(n,t,i,r,u,f){var e=this,o;r===void 0&&(r=0);u===void 0&&(u=0);var s=this._seriesView,c=(s&&s.hasOwnProperty("radius")?s.radius():2)+r,l=k++,h=!1;t=this._viewImpl._transformPlotValues(t,this._seriesViewIndex);o=n.selectAll("circle."+i).data(t);o.enter().append("circle");o.attr({"class":["circle"+l,i,].join(" "),r:c,cx:function(n){return e._getScreenX(n.xValue)},cy:function(n){return n.y0?e._getScreenY(n.yValue+n.y0):e._getScreenY(n.yValue)},"data-eventDataSeriesName":function(){return e._seriesBase.name()}}).style(b,"visible").on("click",(function(n){e._toggleSeriesSelection(n);e._eventHandlerWrapper("pointclick",n);e._eventHandlerWrapper("seriesclick",n);e._viewImpl._toggleSinglePlotSelection(e._seriesViewIndex)})).on("mousemove",(function(){h&&e._viewImpl.mouseMoveHandler()})).on("mouseover",(function(n){var t=!1;h=e._viewImpl.isHoverHandled=!0;u!==2&&(t=!0,e.setSeriesHover(n,t),e._eventHandlerWrapper("pointmouseover",n),e._eventHandlerWrapper("seriesmouseover",n))})).on("mouseleave",(function(n){if(u!==1){var t=e._viewImpl.isHoverHandled=!1;e.setSeriesHover(n,t);e._eventHandlerWrapper("pointmouseleave",n);e._eventHandlerWrapper("seriesmouseleave",n)}h=e._viewImpl.isHoverHandled=!1}));return f?o.exit().style(b,"hidden"):o.exit().remove(),o},f.prototype._addTooltips=function(n){var t=this,i=this._seriesView?this._seriesView.tooltipFormatter():"Series: '{0}' xValue: {1} yValue: {2}";n.append("title").text((function(n){return i.format(t._seriesBase.name(),n.xValue?n.xValue.toString():t._noItemDataMessage,n.yValue?n.yValue.toString():t._noItemDataMessage)}))},f.prototype._applyRenderingConditions=function(n,t){var i=this._createClipPath(n);i&&t.attr("clip-path","url(#"+i+")")},f.prototype._createSeriesElement=function(){return this._createElement(y._getCssClass(this._seriesIndex,this._seriesView))},f.prototype._getInterpolation=function(){return this._seriesView&&this._seriesView.hasOwnProperty("interpolation")?this._seriesView.interpolation():null},f.prototype._renderDataLabels=function(){var t=this,n=this._seriesView?this._seriesView.dataLabels():[],i,r;n&&n.length>0&&(i=this._viewImpl.xAxes[this._viewImpl.mappedXAxisIndex[this._seriesIndex]],r=this._viewImpl.yAxes[this._viewImpl.mappedYAxisIndex[this._seriesIndex]],n.forEach((function(n){var u=o.SeriesUtilities.getChartItemsByDataLabelAndSeries(t._seriesBase,n);u.forEach((function(u){t._renderDataLabel(u,n,i,r)}))})))},f.prototype._createHorizontalLine=function(n,i){var r=this;return i===void 0&&(i=null),l.svg.line().x((function(n,u){return u===0?0:t(i)?r._viewImpl.width:r._getScreenX(i)})).y(this._getScreenY(n))},f.prototype._createVerticalLine=function(n,i){var r=this;return i===void 0&&(i=null),l.svg.line().x(this._getScreenX(n)).y((function(n){return n===0?t(i)?0:r._getScreenY(i):r._viewImpl.height}))},f.prototype._handleKeyboardEvents=function(n,t){var f=this,o=h.getModifierKeys(n),i=this._chartItemsSortByCoordinate,r=i&&i.length,e=function(n){f._currentChartItemIndex>=n&&(f._currentChartItemIndex=0,f._navigationStarted=!0)},u;if(!r){this._navigationStarted=!1;this._currentChartItemIndex=0;return}if(o===0)switch(n.which){case 27:this._navigationStarted=!1;this._currentChartItemIndex=0;break;case 32:e(r);u=i[this._currentChartItemIndex].chartItem;this._toggleSeriesSelection(u);this._updateChartItemLiveData(i.length,u,t);break;case 37:case 39:this._navigationStarted?this._currentChartItemIndex=n.which===37?--this._currentChartItemIndex<0?r-1:this._currentChartItemIndex%r:++this._currentChartItemIndex%r:this._navigationStarted=!0;e(r);u=i[this._currentChartItemIndex].chartItem;this.setSeriesHover(u,!0);this.updateSeriesLiveData(t);this._updateChartItemLiveData(i.length,u,t);break;default:return}},f._getInterpolationString=function(n){switch(n){case 1:return"monotone";case 2:return"step-after";default:return"linear"}},f._getUniqueId=function(){return p+"-uniqueid-"+k++},f.prototype._isChartItemSelected=function(n){var t=this,f=this._viewImpl.options.seriesSelections(),i=f.filter((function(n){return n.chartViewIndex()===t._viewImpl.chartViewIndex&&n.seriesViewIndex()===t._seriesViewIndex})),r=!1,u;return(!this._seriesView||this._seriesView.selectable())&&i.length>0&&n&&(u=i[0].chartItems().filter((function(t){return n.xValue===t.xValue&&n.yValue===t.yValue})),r=u.length>0),r},f.prototype._updateChartItemLiveData=function(n,t,i){var u=this._isChartItemSelected(t),r=t.yValue;this._viewImpl.options.yAxis.autoScaleUnit()&&(r=r/this._yAxis.conversionFactor());i.chartItemLiveData(a.itemLiveFormatter.format(this._xAxis.mappedAxis().tickFormat()(t.xValue),this._yAxis.mappedAxis().tickFormat()(r),u?a.selected:a.unselected,this._currentChartItemIndex+1,n,this._seriesName))},f.prototype._getChartItems=function(){return o.SeriesUtilities.getChartItemArrayBySeriesBase(this._seriesBase,!0)},f.prototype._createHorizontalArea=function(n,t){t===void 0&&(t=!1);var u=this._seriesBase,i=this._getScreenY(u.value()),r=n.append("rect");return t?r.attr({width:this._viewImpl.width,height:i}):r.attr({width:this._viewImpl.width,height:this._viewImpl.height-i,y:i})},f.prototype._createGeneralArea=function(n,t){t===void 0&&(t=!1);var i=this._createGeneralLine(n),u=f._getInterpolationString(n),r=l.svg.area().interpolate(u).x(i.x());return t?r.y0(i.y()).y1(0):r.y0(this._viewImpl.height).y1(i.y())},f.prototype._createVerticalArea=function(n,t){t===void 0&&(t=!1);var u=this._seriesBase,i=this._getScreenX(u.value()),r=n.append("rect");return t?r.attr({width:this._viewImpl.width-i,height:this._viewImpl.height,x:i}):r.attr({width:i,height:this._viewImpl.height})},f.prototype._renderDataLabel=function(n,t,i,r){if(n.xValue!==null&&n.yValue!==null&&n.xValue>=i.valueScale().domain()[0]&&n.xValue<=i.valueScale().domain()[1]&&n.yValue>=r.valueScale().domain()[0]&&n.yValue<=r.valueScale().domain()[1]){var u=i.valueScale()(n.xValue),f=r.valueScale()(n.yValue)-5,e=i.getPointFormatter()(n.xValue),o=r.getPointFormatter()(n.yValue),h=t.formatter()||"{2}",s=15;u=Math.max(u,i.valueScale().range()[0]+s);u=Math.min(u,i.valueScale().range()[1]-s);f=Math.max(f,r.valueScale().range()[1]+10);this._viewImpl.element.append("g").attr({"class":"azc-chart-callout",transform:"translate("+u.toString()+", "+f.toString()+")"}).append("text").text(h.format(this._seriesBase.name(),e!==null?e:this._noItemDataMessage,o!==null?o:this._noItemDataMessage))}},f.prototype._createClipPath=function(n){var u=this,t,i,r;return this._seriesView?(t=this._seriesView.renderingConditions(),t===null||t.length===0)?null:(t.forEach((function(t){i=f._getUniqueId();var e=n.append("clipPath").attr("id",i);u._viewImpl._createClipPathSelection(t,e)&&(r&&e.attr("clip-path","url(#"+r+")"),r=i)})),i):null},f.prototype._filterChartItems=function(n){var t=this,r=[],u=i.find(n,(function(n){return n.chartViewIndex()===t._viewImpl.chartViewIndex&&n.seriesViewIndex()===t._seriesViewIndex}));return u&&(r=u.chartItems()),r},f})(),y;n.SeriesViewImpl=v;y=(function(){function n(){this.seriesViewImpls=[];this.chartViewIndex=null;this._reversed=e.observable(!1);this._viewClass=p;this._currentSeriesIndex=0;this._navigationStarted=!1}return u.defineProperty(n.prototype,"seriesViews",{get:function(){return this._seriesViews?this._seriesViews():this._view.seriesView()},enumerable:!0,configurable:!0}),u.defineProperty(n.prototype,"series",{get:function(){return this._series?this._series():this.options.series()},enumerable:!0,configurable:!0}),n.prototype.init=function(n){var t=this,i=this.ltm=n.createChildLifetime();this.renderLifetimeManager=i.createChildLifetime();this._currentSeriesIndex=0;this._navigationStarted=!1;this._seriesViews=e.computed(i,(function(){var i=t._reversed(),n=t._view.seriesView();return i?n.slice().reverse():n}));this._series=e.computed(i,(function(){var i=t._reversed(),n=t.options.series();return i?n.slice().reverse():n}));this.element.attr("class",this._viewClass);this._render()},n.prototype.dispose=function(){this._disposeSeriesViewImpls();this.ltm&&(this.ltm.dispose(),this.ltm=null);this.element.selectAll("circle").on("click",null).on("mouseover",null).on("mouseleave",null);this.element.remove()},n.prototype.toggleSeriesSelection=function(n,t){var c=this,f,u=this.options,s=this._getSeriesViewBySeriesViewIndex(n),h=this._getSeriesIndexBySeriesViewIndex(n),l=u.seriesSelections(),i=l.filter((function(t){return t.chartViewIndex()===c.chartViewIndex&&t.seriesViewIndex()===n})),r,e;(!s||s.selectable())&&(i.length>0?t?(e=i[0].chartItems().filter((function(n){return t.xValue===n.xValue&&t.yValue===n.yValue})),e.length>0?(i[0].chartItems.removeAll(e),i[0].chartItems().length===0&&u.seriesSelections.removeAll(i)):i[0].chartItems.push(t)):(f=this._getChartItems(h),i[0].chartItems().length!==f.length?i[0].chartItems(f):u.seriesSelections.removeAll(i)):(r=new o.SeriesSubset,r.seriesViewIndex(n),r.chartViewIndex(this.chartViewIndex),t?r.chartItems.push(t):r.chartItems(this._getChartItems(h)),u.seriesSelections.push(r)))},n.prototype.getXSliceSeriesSubset=function(n,t,i){var u=this,r=[];return this.seriesViewImpls.map((function(f,e){var h=f.selectChartItemFromXCoordinate(n,{rangeAdjustment:i,withinRange:t}),s;h&&(s=new o.SeriesSubset,s.seriesViewIndex(e),s.chartViewIndex(u.chartViewIndex),s.chartItems.push(h),r.push(s))})),r},n._iterateOverSeriesView=function(n,i,r){var f=n.seriesViews,u=n.options.series();return f.map((function(i,f){var e=n.seriesIndexDictionary(i.seriesName()),o;return!t(e)&&u[e]?(o=n._getSeriesViewImpl(u[e],f,i),r(o)):[]}))},n._getDefaultCssClassByIndex=function(n){return rt+w[n%et]},n._getCssClass=function(t,i){return i&&i.cssClass()||n._getDefaultCssClassByIndex(t)},n.prototype._transformPlotValues=function(n){return n},n.prototype._toggleSinglePlotSelection=function(){},n.prototype._disposeRenderDisposables=function(){this.renderLifetimeManager&&(this.renderLifetimeManager.dispose(),this.renderLifetimeManager=null);this.renderLifetimeManager=this.ltm.createChildLifetime()},n.prototype._disposeSeriesViewImpls=function(){this.seriesViewImpls.forEach((function(n){n.dispose()}));this.seriesViewImpls=[]},n.prototype._attachSeriesComputeds=function(n,t,i,r){var u=this,f;r===void 0&&(r=!0);f=this.renderLifetimeManager;r&&e.computed(f,(function(){var r=u._getHoveredSeriesViewIndexes();n.classed(ft,(!i||i.hoverable())&&r.length===1&&r[0]===t)}));e.computed(f,(function(){var r=(!i||i.selectable())&&u.options.seriesSelections().some((function(n){return n.chartViewIndex()===u.chartViewIndex&&n.seriesViewIndex()===t}));n.classed(ut,r)}))},n.prototype._getScreenX=function(n,i){var r=0,u=this.mappedXAxisIndex[n];return!t(u)&&!t(this.xAxes[u])&&(r=this.xAxes[u].valueScale()(i),r!==null&&r!==undefined)?r:0},n.prototype._getScreenY=function(n,i){var r=0,u=this.mappedYAxisIndex[n];return!t(u)&&!t(this.yAxes[u])&&(r=this.yAxes[u].valueScale()(i/this.yAxes[u].conversionFactor()),r!==null&&r!==undefined)?r:0},n.prototype._getEvents=function(){return this._view.hasOwnProperty("events")?this._view.events:null},n.prototype._createClipPathSelection=function(n,i){var r=this.seriesIndexDictionary(n.seriesName());if(!t(r)){var u=this.options,f=u.series()[r],e=n.conditionOperator()===0,o=new v(this,f,r,null);return o._createArea(i,n.interpolation(),e),!0}return!1},n.prototype._createSeriesViewImpl=function(n,t,i){return new v(this,n,t,i)},n.prototype._render=function(){this._disposeRenderDisposables();n._iterateOverSeriesView(this,this._view,(function(n){n._renderSeries();n._renderTooltips()}));n._iterateOverSeriesView(this,this._view,(function(n){n._renderDataLabels()}))},n.prototype._getHoveredSeriesViewIndexes=function(){var n=this;return this.options.seriesHovers().filter((function(t){return t.chartViewIndex()===n.chartViewIndex})).map((function(n){return n.seriesViewIndex()}))},n.prototype._getSeriesViewBySeriesViewIndex=function(n){var t=this.seriesViews;return t.length!==0&&n>=0&&n<this._view.seriesView().length?t[n]:null},n.prototype._getSeriesIndexBySeriesViewIndex=function(n){var t=this.seriesViews,i;return t.length===0?this.seriesViewImpls[n]?this.seriesViewImpls[n]._seriesIndex:null:n>=0&&n<this._view.seriesView().length?(i=t[n].seriesName(),this.seriesIndexDictionary(i)):null},n.prototype._canNavigateSeries=function(n){var i=this.seriesViewImpls.length,t;if(!i)return!1;if(!this._navigationStarted)return!0;if(t=this._currentSeriesIndex,n===38){if(++t>=i)return!1}else if(n===40&&--t<0)return!1;return!0},n.prototype._handleKeyboardEvents=function(n,t){var f=this,e=h.getModifierKeys(n),i=this.seriesViewImpls.length,r,u,o;if(!i){this._navigationStarted=!1;this._currentSeriesIndex=0;return}if(r=function(n){f._currentSeriesIndex>=n&&(f._currentSeriesIndex=0,f._navigationStarted=!0)},e===0)switch(n.which){case 27:for(this._navigationStarted=!1,this._currentSeriesIndex=0,u=0;u<i;u++)this.seriesViewImpls[u]._handleKeyboardEvents(n,t);break;case 32:case 37:case 39:this._navigationStarted=!0;r(i);this.seriesViewImpls[this._currentSeriesIndex]._handleKeyboardEvents(n,t);break;default:return}else e===8&&(n.which===38||n.which===40)?(this._navigationStarted?this._currentSeriesIndex=n.which===38?++this._currentSeriesIndex%i:--this._currentSeriesIndex<0?i-1:this._currentSeriesIndex%i:this._navigationStarted=!0,r(i),o=this.seriesViewImpls[this._currentSeriesIndex],o.setSeriesHover(null,!0),o.updateSeriesLiveData(t)):e===8&&n.which===32&&(r(i),this.toggleSeriesSelection(this._currentSeriesIndex,null),this.seriesViewImpls[this._currentSeriesIndex].updateSeriesLiveData(t))},n.prototype._getChartItems=function(n){return o.SeriesUtilities.getChartItemArrayBySeriesBase(this.options.series()[n],!0)},n.prototype._getSeriesViewImpl=function(n,t,i){return this.seriesViewImpls[t]||(this.seriesViewImpls[t]=this._createSeriesViewImpl(n,t,i)),this.seriesViewImpls[t]},n})();n.ChartViewImpl=y})(a||(a={})),a}));
define("Viva.Controls/Controls/Visualization/Viva.AreaChartViewImpl",["require","exports","f","ko","Viva.Controls/Util/Viva.Hatching","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(n,t,i,r,u,f,e){"use strict";var o;return (function(n){var c=i.ViewModels.Controls.Visualization.Chart,s="azc-chart-view-area",h="azc-areaChart-series",t="azc-svg-style-fill",f=(function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return __extends(i,n),i.prototype._renderSeries=function(){var n=this,o=this._seriesView,i,f=this._createSeriesElement(),s=!1,c;if(i=this._createArea(f),i){i.attr("class",t).on("click",(function(){n._toggleSeriesSelection(null);n._eventHandlerWrapper("seriesclick",null)})).on("mousemove",(function(){s&&n._viewImpl.mouseMoveHandler()})).on("mouseenter",(function(){var t=n._viewImpl.isHoverHandled=s=!0;n.setSeriesHover(null,t);n._eventHandlerWrapper("seriesmouseover",null)})).on("mouseleave",(function(){var t=n._viewImpl.isHoverHandled=s=!1;n.setSeriesHover(null,t);n._eventHandlerWrapper("seriesmouseleave",null)}));f.classed(h,!0);this._attachSeriesComputeds(f);c=o&&r.unwrap(o.areaHatchingPattern);c&&u.renderHatching(c,e.ChartViewImpl._getCssClass(this._seriesIndex,o),t,i,this._viewImpl.element);this._applyRenderingConditions(f,i)}},i.prototype._createSelectedPlots=function(){return null},i.prototype._createHoveredPlots=function(){return null},i})(e.SeriesViewImpl),o;n.AreaChartSeriesViewImpl=f;o=(function(n){function t(t){var i=n.call(this)||this;return i._viewClass=s,i._view=t,i}return __extends(t,n),t.prototype.dispose=function(){this.element.selectAll("path").on("click",null).on("mouseover",null).on("mouseleave",null);n.prototype.dispose.call(this)},t.prototype._createSeriesViewImpl=function(n,t,i){return new f(this,n,t,i)},t})(e.ChartViewImpl);n.AreaChartViewImpl=o})(o||(o={})),o}));
define("Viva.Controls/Controls/Visualization/Viva.StackedChartViewImpl",["require","exports","f","o","d3","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Util/Viva.Util"],(function(n,t,i,r,u,f){"use strict";var e;return (function(n){var s=i.ViewModels.Controls.Visualization.Chart,o="azc-chart-view-stacked",t=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t})(f.SeriesViewImpl),e;n.StackedChartSeriesViewImpl=t;e=(function(n){function i(t){var i=n.call(this)||this;return i._view=t,i._viewClass=o,i._reversed(!0),i}return __extends(i,n),i.prototype.dispose=function(){n.prototype.dispose.call(this)},i.prototype._createSeriesViewImpl=function(n,i,r){return new t(this,n,i,r)},i._allocArray=function(n,t){var i=0,r=new Array(t+1);for(r[0]=n,i=1;i<t+1;i++)r[i]={value:0,originalValue:null};return r},i.prototype._getNumberOfSeriesView=function(){return this._view.seriesView().length},i.prototype._getStringValue=function(n){return n instanceof Date?Number(n).toString():n.toString()},i.prototype._getSparseSeriesStackLayer=function(){var l=this,n={},s,e,t=0,a=this._getNumberOfSeriesView(),c=0,u,v=this.xAxes[0],y=this.yAxes[0],h=!0,o;return f.ChartViewImpl._iterateOverSeriesView(this,this._view,(function(r){for(u=r._getChartItemArray(!0),h=h&&r._isDataXValueSortable(),c=u.length,t=0;t<c;t++)s=v.extractValue(u[t].xValue),e=l._getStringValue(s),n[e]=n[e]||i._allocArray(s,a+1),n[e].originalValue=u[t].xValue,n[e][r._seriesViewIndex+1]={value:y.extractValue(u[t].yValue),originalValue:u[t].yValue}})),o=r.keys(n)||[],h&&(o=o.stableSort((function(t,i){var r=n[t],u=n[i],f=r&&r.originalValue,e=u&&u.originalValue;return Number(f)-Number(e)}))),f.ChartViewImpl._iterateOverSeriesView(this,this._view,(function(t){var u=[],i,e=t._seriesIndex,r=t._seriesView,s=r?r.seriesName():null;return o.forEach((function(i){n.hasOwnProperty(i)&&n[i]!==undefined&&u.push({x:n[i][0],y:n[i][t._seriesViewIndex+1].value,originalX:n[i].originalValue,originalY:n[i][t._seriesViewIndex+1].originalValue,seriesViewIndex:t._seriesViewIndex,seriesIndex:e})})),i=u,i.seriesViewIndex=t._seriesViewIndex,i.seriesName=s?r.seriesName():"Series"+e,i.cssClass=f.ChartViewImpl._getCssClass(e,r),u})).filter((function(n){return n.length!==0}))},i.prototype._getDenseSeriesStackLayer=function(){var n=this.xAxes[0],t=this.yAxes[0];return f.ChartViewImpl._iterateOverSeriesView(this,this._view,(function(i){var u=i._seriesView,o=i._seriesIndex,e=[],r,s=i._getChartItemArray();return s.length>0&&(e=s.map((function(r){return{x:n.extractValue(r.xValue),y:t.extractValue(r.yValue),originalX:r.xValue,originalY:r.yValue,seriesViewIndex:i._seriesViewIndex,seriesIndex:i._seriesIndex}}))),r=e,r.seriesViewIndex=i._seriesViewIndex,r.seriesName=u?u.seriesName():"Series"+o,r.cssClass=f.ChartViewImpl._getCssClass(o,u),e})).filter((function(n){return n.length!==0}))},i.prototype._getStackLayer=function(){var n=this._getNumberOfSeriesView()===1||!this._view.enableSparseSeries()?this._getDenseSeriesStackLayer():this._getSparseSeriesStackLayer();return n&&n.length>0?u.layout.stack()(n):[]},i.prototype._initializeChartData=function(){this._layers=this._getStackLayer();this._yStackMax=u.max(this._layers,(function(n){return u.max(n,(function(n){return n.y0+n.y}))}))},i})(f.ChartViewImpl);n.StackedChartViewImpl=e})(e||(e={})),e}));
define("Viva.Controls/Controls/Visualization/Viva.BarChartViewImpl",["require","exports","f","ko","$","d3","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.StackedChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(n,t,i,r,u,f,e,o){"use strict";var s;return (function(n){var k=i.ViewModels.Controls.Visualization.Chart,u=jQuery,l="azc-chart-view-bar",a="azc-svg-style-fill",v="azc-barChart-data-column",y="azc-barChart-series",t=".azc-barChart-series",p="azc-barChart-bar-positive",s="azc-chart-item-selected",w="azc-chart-item-hovered",b="azc-barChart-bar-negative",d=i.isDevelopmentMode,h=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._attachItemsComputeds=function(n){var t=this,i=this.renderLifetimeManager;r.computed(i,(function(){var i=t._getHoveredChartItems(),r=t._checkElementBelongsToChartItems(n,i);n.classed(w,r)}));r.computed(i,(function(){var i=t._getSelectedChartItems(),r=t._checkElementBelongsToChartItems(n,i);n.classed(s,r)}))},t.prototype._attachSeriesComputeds=function(n){var t=this;r.computed(this.renderLifetimeManager,(function(){t._getHoveredChartItems();n.classed(s,!1)}))},t.prototype._checkElementBelongsToChartItems=function(n,t){var r=this,i=n.datum(),u=i.x&&i.x.toString();return t&&t.some((function(n){return r._xAxis.extractValue(n.xValue).toString()===u}))},t})(o.StackedChartSeriesViewImpl),c;n.BarChartSeriesViewImpl=h;c=(function(n){function i(t){var i=n.call(this,t)||this;return i._view=t,i._viewClass=l,i}return __extends(i,n),i.prototype.init=function(t){n.prototype.init.call(this,t);this._initializeChartData();this._render()},i.prototype.dispose=function(){this.element.selectAll("rect").on("click",null).on("mouseover",null).on("mouseleave",null);n.prototype.dispose.call(this)},i.prototype.getXSliceSeriesSubset=function(t,i){return n.prototype.getXSliceSeriesSubset.call(this,t,i,this._step)},i.prototype._render=function(){var n=this,i,o=this,r,u=!1;if(!this._layers||this._layers.length===0){this.element.selectAll(t).remove();return}this._initializeBarSize();this.element.selectAll(t).remove();this._disposeRenderDisposables();r=this._getBarChartD3Settings();i=this.element.selectAll(t).data(this._layers).enter().append("g").attr("class",(function(n){return[y,n.cssClass].join(" ")}));i.each((function(n){var t=this,i=o.seriesViewImpls[n.seriesViewIndex];i._attachSeriesComputeds(f.select(t))}));this._bars=i.selectAll("rect").data((function(n){return n})).enter().append("rect").attr(r.attr).classed(r.classed).on("mousemove",(function(){u&&n.mouseMoveHandler()})).on("mouseenter",(function(t,i){var r=n.isHoverHandled=u=!0,f=new e.ChartItem(t.originalX,t.originalY);n.seriesViewImpls[t.seriesViewIndex].setSeriesHover(f,r);n._eventHandlerWrapper("mouseenter",t,i)})).on("mouseleave",(function(t,i){var r=n.isHoverHandled=u=!1,f=new e.ChartItem(t.originalX,t.originalY);n.seriesViewImpls[t.seriesViewIndex].setSeriesHover(f,r);n._eventHandlerWrapper("mouseleave",t,i)})).on("click",(function(t,i){var r=new e.ChartItem(t.originalX,t.originalY);n.toggleSeriesSelection(t.seriesViewIndex,r);n._eventHandlerWrapper("click",t,i)}));this._bars.each((function(n){var t=o.seriesViewImpls[n.seriesViewIndex];t._attachItemsComputeds(f.select(this))}))},i.prototype._createSeriesViewImpl=function(n,t,i){return new h(this,n,t,i)},i.prototype._barMouseEnter=function(n,t){this._view.events&&this._view.events.barMouseEnter&&this._view.events.barMouseEnter(n,t)},i.prototype._barMouseLeave=function(n,t){this._view.events&&this._view.events.barMouseLeave&&this._view.events.barMouseLeave(n,t)},i.prototype._barMouseClick=function(n,t){this._view.events&&this._view.events.barClick&&this._view.events.barClick(n,t)},i.prototype._eventHandlerWrapper=function(n,t,i){var r,f=this._getSeriesIndexBySeriesViewIndex(t.seriesViewIndex),u={seriesName:this.options.series()[f].name(),value:{xValue:t.x,yValue:t.y}};this._getNumberOfSeriesView()>1&&(this._view.barChartType()===0||this._view.barChartType()===1)&&(r=this._getEventData(t,i));switch(n){case"mouseenter":this._barMouseEnter(u,r);break;case"mouseleave":this._barMouseLeave(u,r);break;case"click":this._barMouseClick(u,r)}},i.prototype._initializeChartData=function(){if(this._getNumberOfSeriesView()<=0){this.element.selectAll(t).remove();this._layers=null;return}n.prototype._initializeChartData.call(this)},i.prototype._getXOffset=function(n,t){return t===!0?this._getScreenX(n.seriesIndex,n.x)+this._barWidthOffset:this._getScreenX(n.seriesIndex,n.x)-this._barWidthOffset},i.prototype._getEventData=function(n,t){for(var r=[],i=0,i=0;i<this._getNumberOfSeriesView();i++)this._layers[i][t].y>0&&r.push({seriesName:this.seriesViewImpls[i]._seriesName,value:{xValue:this._layers[i][t].x,yValue:this._layers[i][t].y}});return r},i.prototype._initializeBarSize=function(){var n=this._view.barPaddingRatio(),t=this.xAxes[0];this._step=t.step();this._barWidth=this._step*(1-n);this._barWidthOffset=this._barWidth/2;this._groupedBarWidth=this._getNumberOfSeriesView()>0?this._barWidth/this._getNumberOfSeriesView():this._barWidth},i.prototype._getBarChartD3Settings=function(){var n=[this._getDefaultBarChartD3Setting(),this._getExtendedBarChartD3Settings(),];return n.reduce((function(n,t){return{attr:u.extend(n.attr,t.attr),classed:u.extend(n.classed,t.classed)}}))},i.prototype._getDefaultBarChartD3Setting=function(){var t=this,i={x:function(n){return t._getXOffset(n)},y:this.height,width:this._barWidth,height:0},n={};return[v,a].forEach((function(t){n[t]=!0})),{attr:i,classed:n}},i.prototype._getExtendedBarChartD3Settings=function(){var n;switch(this._view.barChartType()){case 1:n=this._getGroupedBarChartD3Settings();break;case 2:n=this._getSplitBarChartSettings();break;case 0:default:n=this._getStackedBarChartD3Setting()}return n},i.prototype._getStackedBarChartD3Setting=function(){var n=this,u=this.isHorizontalChart,t=0,i=this.yAxes[t],r;return i.internalMin(0),i.internalMax(this._yStackMax),r=u?{x:function(i){return n._getScreenY(t,i.y0)},width:function(i){return Math.abs(n._getScreenY(t,i.y0+i.y)-n._getScreenY(t,i.y0))},y:function(t){return n._getXOffset(t)},height:this._barWidth}:{x:function(t){return n._getXOffset(t)},width:this._barWidth,y:function(i){return n._getScreenY(t,i.y0+i.y)},height:function(i){return n._getScreenY(t,i.y0)-n._getScreenY(t,i.y0+i.y)}},{attr:r}},i.prototype._getGroupedBarChartD3Settings=function(){var n=this,t=this.isHorizontalChart,i=t?{x:0,width:function(t,i,r){return n._getScreenY(r,t.y)},y:function(t,i,r){return n._getScreenX(r,t.x)+n._groupedBarWidth*(n._getNumberOfSeriesView()-r)-n._barWidth},height:this._groupedBarWidth}:{x:function(t,i,r){return n._getScreenX(r,t.x)+n._groupedBarWidth*r-n._barWidthOffset},width:this._groupedBarWidth,y:function(t,i,r){return n._getScreenY(r,t.y)},height:function(t,i,r){return n._getScreenY(r,0)-n._getScreenY(r,t.y)}};return{attr:i}},i.prototype._getSplitBarChartSettings=function(){var n=this,i=this.isHorizontalChart,t={},r=i?{x:function(t){return n._getScreenY(t.seriesIndex,Math.min(0,t.y))},width:function(t){return Math.abs(n._getScreenY(t.seriesIndex,t.y)-n._getScreenY(t.seriesIndex,0))},y:function(t){return n._getXOffset(t,!0)},height:this._groupedBarWidth}:{x:function(t){return n._getXOffset(t)},width:this._groupedBarWidth,y:function(t){return n._getScreenY(t.seriesIndex,Math.max(0,t.y))},height:function(t){return Math.abs(n._getScreenY(t.seriesIndex,t.y)-n._getScreenY(t.seriesIndex,0))}};return t[p]=function(n){return n.y>0},t[b]=function(n){return n.y<0},{attr:r,classed:t}},i})(o.StackedChartViewImpl);n.BarChartViewImpl=c})(s||(s={})),s}));
define("Viva.Controls/Controls/Visualization/Viva.LineChartViewImpl",["require","exports","f","ko","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(n,t,i,r,u,f){"use strict";var e;return (function(n){var c=i.ViewModels.Controls.Visualization.Chart,o="azc-svg-style-stroke",s="azc-chart-view-line",h="azc-lineChart-series",t=r.unwrap,u=(function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return __extends(i,n),i.prototype._renderSeries=function(){var n=this,u=this._seriesView,f,r,s,c=i._getLineStyleString(u?t(u.lineStyle):null),e=!1;f=this._createLineString(this._getInterpolation());f&&(r=this._createSeriesElement(),s=r.classed(h,!0).append("path").attr({d:f,"class":[o,c,].join(" ")}).on("click",(function(){n._toggleSeriesSelection(null);n._eventHandlerWrapper("seriesclick",null)})).on("mousemove",(function(){e&&n._viewImpl.mouseMoveHandler()})).on("mouseenter",(function(){var t=n._viewImpl.isHoverHandled=e=!0;n.setSeriesHover(null,t);n._eventHandlerWrapper("seriesmouseover",null)})).on("mouseleave",(function(){var t=n._viewImpl.isHoverHandled=e=!1;n.setSeriesHover(null,t);n._eventHandlerWrapper("seriesmouseleave",null)})),this._attachSeriesComputeds(r),this._applyRenderingConditions(r,r),(!u||t(u.showDataPoints))&&this._createDataPlots(r))},i._getLineStyleString=function(n){switch(n){case 1:return"azc-chart-lineStyleDotted";case 2:return"azc-chart-lineStyleDashed";case 3:return"azc-chart-lineStyleTrendline";case 4:return"azc-chart-lineStyleUsageThreshold";case 5:return"azc-chart-lineStyleWarningThreshold";default:return"azc-chart-lineStyleSolid"}},i.prototype._createLineString=function(n){var t,i=[];switch(this._seriesBase.type()){case 1:i=[0,1];t=this._createHorizontalLine(this._seriesBase.value());break;case 2:i=[0,1];t=this._createVerticalLine(this._seriesBase.value());break;case 0:case 3:t=this._createGeneralLine(n);i=this._getChartItemArray()}return t?t(i):null},i})(f.SeriesViewImpl),e;n.LineChartSeriesViewImpl=u;e=(function(n){function t(t){var i=n.call(this)||this;return i._viewClass=s,i._view=t,i}return __extends(t,n),t.prototype.dispose=function(){this.element.selectAll("path").on("click",null).on("mouseover",null).on("mouseleave",null);n.prototype.dispose.call(this)},t.prototype._createSeriesViewImpl=function(n,t,i){return new u(this,n,t,i)},t})(f.ChartViewImpl);n.LineChartViewImpl=e})(e||(e={})),e}));
define("Viva.Controls/Controls/Visualization/Viva.ScatterChartViewImpl",["require","exports","f","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(n,t,i,r,u){"use strict";var f;return (function(n){var c=i.ViewModels.Controls.Visualization.Chart,f="azc-chart-view-scatter",e="azc-scatterChart-series",o=5,s=5,h=1,t=(function(n){function t(t,i,r,u){var f=n.call(this,t,i,r,u)||this;return f._touchPointRadiusAddition=h,f._hoveredPointRadiusAddition=s,f._selectedPointRadiusAddition=o,f}return __extends(t,n),t.prototype._renderSeries=function(){var n=this._createSeriesElement(),t=this._createDataPlots(n);t&&(this._seriesView&&this._seriesView.showTooltip()&&this._addTooltips(t),n.classed(e,!0),this._attachSeriesComputeds(n),this._applyRenderingConditions(n,n))},t.prototype._renderTooltips=function(){},t})(u.SeriesViewImpl),r;n.ScatterChartSeriesViewImpl=t;r=(function(n){function i(t){var i=n.call(this)||this;return i._viewClass=f,i._view=t,i}return __extends(i,n),i.prototype._createSeriesViewImpl=function(n,i,r){return new t(this,n,i,r)},i})(u.ChartViewImpl);n.ScatterChartViewImpl=r})(f||(f={})),f}));
define("Viva.Controls/Controls/Visualization/Viva.StackedAreaChartViewImpl",["require","exports","f","ko","d3","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Util/Viva.Hatching","Viva.Controls/Controls/Visualization/Viva.StackedChartViewImpl","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(n,t,i,r,u,f,e,o,s){"use strict";var h;return (function(n){var rt=i.ViewModels.Controls.Visualization.Chart,l="azc-svg-style-fill",h="azc-chart-series-selected",nt="azc-chart-view-stackedArea",t="azc-stackedAreaChart-not-selected",b="azc-stackedAreaChart-series",tt="azc-chart-series-hovered",a="."+b,y="azc-stackedAreaChart-series-group",v="."+y,k="azc-stackedLineChart-series",c="."+k,p="azc-stackedLineChart-series-group",w="."+p,it="azc-stackedLineChart-series-hover",d=(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._attachAreaSeriesComputeds=function(n){this._viewImpl._attachSeriesComputeds(n,this._seriesViewIndex,this._seriesView,!1)},t.prototype._attachLineSeriesComputeds=function(n){var t=this,i=this.renderLifetimeManager;r.computed(i,(function(){var i=t._viewImpl._view.lineState();i!==1&&t._createSelectedPlots(n)}));r.computed(i,(function(){var i=t._viewImpl._view.lineState();i!==1&&t._createHover(n)}));this._viewImpl._attachSeriesComputeds(n,this._seriesViewIndex,this._seriesView)},t})(o.StackedChartSeriesViewImpl),g;n.StackedAreaChartSeriesViewImpl=d;g=(function(n){function i(t){var i=n.call(this,t)||this;return i._view=t,i._viewClass=nt,i}return __extends(i,n),i.prototype.init=function(t){n.prototype.init.call(this,t);this._initializeChartData();this._render()},i.prototype.dispose=function(){this.element.selectAll(a).selectAll("."+l).on("click",null).on("mouseover",null).on("mouseleave",null);this.element.selectAll(c).selectAll("."+l).on("click",null).on("mouseover",null).on("mouseleave",null);n.prototype.dispose.call(this)},i.prototype._initializeChartData=function(){if(this._getNumberOfSeriesView()<=0){this.element.selectAll(a).remove();this._layers=null;return}n.prototype._initializeChartData.call(this)},i.prototype._render=function(){var t=this,i=0,n=this.yAxes[i];this._disposeRenderDisposables();n.internalMin(0);n.internalMax(this._yStackMax);this._createStackedAreas(i,n);r.computed(this.renderLifetimeManager,(function(){t.element.selectAll(c).remove();var r=t._view.lineState();r!==1&&t._createStackedLines(i,n,r)}))},i.prototype._createStackedAreas=function(n){var o=this,c=this._getStackedAreaShape(n),i=this,f=!1;if(!this._layers){this.element.selectAll(a).remove();return}this.element.selectAll(a).remove();this._areas=this.element.selectAll(a).data(this._layers).enter().append("g").attr("class",(function(n,t){return[b,n.cssClass,y+t].join(" ")})).append("path").attr("d",(function(n){return c(n)})).attr("class",l).on("mousemove",(function(){f&&o.mouseMoveHandler()})).on("mouseenter",(function(n,t){var r=i.isHoverHandled=f=!0;i.isHoverHandled=!1;i.seriesViewImpls[t]._eventHandlerWrapper("seriesmouseover",null);i._setStackedAreaSeriesHover(i.element.select(v+t),t,r);i._setStackedLineSeriesHover(i.element.select(w+t),r)})).on("mouseleave",(function(n,t){var r=i.isHoverHandled=f=!1;i.seriesViewImpls[t]._eventHandlerWrapper("seriesmouseleave",null);i._setStackedAreaSeriesHover(i.element.select(v+t),t,r);i._setStackedLineSeriesHover(i.element.select(w+t),r)})).on("click",(function(n,r){var f=i.element.select(w+r);i.seriesViewImpls[r]._toggleSeriesSelection(null);i.seriesViewImpls[r]._eventHandlerWrapper("seriesclick",null);this.parentNode.getAttribute("class").indexOf(h)!==-1?(i._setStackedLineSeriesHover(f,!0),i._setStackedLineSeriesSelected(f,!0),u.select(this.parentNode).classed(t,!1),f.classed(t,!1)):(i._setStackedLineSeriesHover(f,!1),i._setStackedLineSeriesSelected(f,!1));i._markNotSelected()})).each((function(n,t){var f=i.seriesViewImpls[t],o=f&&f._seriesView,h=o&&r.unwrap(o.areaHatchingPattern);f&&(f._attachAreaSeriesComputeds(u.select(this.parentNode)),h&&e.renderHatching(h,s.ChartViewImpl._getCssClass(f._seriesIndex,o),l,u.select(this),i.element))}))},i.prototype._getStackedAreaShape=function(n){var t=this;return u.svg.area().x((function(i){return t._getScreenX(n,i.x)})).y0((function(i){return t._getScreenY(n,i.y0)})).y1((function(i){return t._getScreenY(n,i.y0+i.y)}))},i.prototype._createStackedLines=function(n,i,r){var o=this,f=this,s=this._getStackedLinesShape(n),e=!1;if(!this._layers){this.element.selectAll(c).remove();return}this.element.selectAll(c).remove();this._lines=this.element.selectAll(c).data(this._layers).enter().append("g").attr("class",(function(n,t){return[k,n.cssClass,p+t].join(" ")})).append("path").attr("d",(function(n){return s(n)})).attr("class",l).on("mousemove",(function(){e&&o.mouseMoveHandler()})).on("mouseenter",(function(n,t){var i=f.isHoverHandled=e=!0;f.isHoverHandled=!1;f._setStackedLineSeriesHover(u.select(this.parentNode),i);f._setStackedAreaSeriesHover(f.element.select(v+t),t,i)})).on("mouseleave",(function(n,t){var i=f.isHoverHandled=e=!1;this.parentNode.getAttribute("class").indexOf(h)===-1&&(f._setStackedLineSeriesHover(u.select(this.parentNode),i),f._setStackedAreaSeriesHover(f.element.select(v+t),t,i))})).on("click",(function(n,i){var r=f.element.select(v+i);f.seriesViewImpls[i]._toggleSeriesSelection(null);f.seriesViewImpls[i]._eventHandlerWrapper("seriesclick",null);this.parentNode.getAttribute("class").indexOf(h)!==-1?(f._setStackedLineSeriesHover(r,!0),f._setStackedLineSeriesSelected(r,!0),u.select(this.parentNode).classed(t,!1),r.classed(t,!1)):(f._setStackedLineSeriesHover(r,!1),f._setStackedLineSeriesSelected(r,!1));f._markNotSelected()})).each((function(n,t){var i=f.seriesViewImpls[t];i&&i._attachLineSeriesComputeds(u.select(this.parentNode))}));r===0&&this._createStackedLinePlots(n,i)},i.prototype._getStackedLinesShape=function(n){var t=this;return u.svg.line().x((function(i){return t._getScreenX(n,i.x)})).y((function(i){return t._getScreenY(n,i.y0+i.y)}))},i.prototype._setStackedAreaSeriesHover=function(n,t,i){var u=this.seriesViewImpls[t]._seriesView,r;(!u||u.hoverable())&&(n.classed(tt,i),i?(r=new f.SeriesId,r.chartViewIndex(this.seriesViewImpls[t]._viewImpl.chartViewIndex),r.seriesViewIndex(this.seriesViewImpls[t]._seriesViewIndex),this.options.hoveredID([r])):this.options.hoveredID([]))},i.prototype._setStackedLineSeriesHover=function(n,t){n.classed(it,t)},i.prototype._setStackedLineSeriesSelected=function(n,t){n.classed(h,t)},i.prototype._createStackedLinePlots=function(){var n=this;this.element.selectAll(c).each((function(t,i){var r=n.seriesViewImpls[i];r&&r._createDataPlots(u.select(this))}))},i.prototype._transformPlotValues=function(n,t){var i,u=[],e,r,o,s;return n&&n.length>0&&(this._layers&&(r=this._layers.first((function(n){var i=n;return i.seriesViewIndex===t}))),r&&(o=n.first((function(n){return!!n.xValue})).xValue instanceof Date,s=o?function(n){return i.yValue===n.originalY&&Number(i.xValue)===Number(n.originalX)}:function(n){return i.yValue===n.originalY&&i.xValue===n.originalX},n.forEach((function(n){i=n;var t=r.first(s);t&&(e=new f.StackedChartItem(t.originalX,t.originalY,t.y0),u.push(e))})))),u},i.prototype._toggleSinglePlotSelection=function(n){var i=this.element.select("."+p+n),r=this.element.select("."+y+n),u=!1;this.options.seriesSelections().forEach((function(t){n===t.seriesViewIndex()&&(u=!0)}));r&&i&&(u&&(i.classed(t,!1),i.classed(h,!0),r.classed(t,!1),r.classed(h,!0)),this._markNotSelected())},i.prototype._markNotSelected=function(){this.element.selectAll("."+h)[0].length>0?this.element.selectAll(":not(."+h+")").classed(t,!0):this.element.selectAll("."+t).classed(t,!1)},i.prototype._createSeriesViewImpl=function(n,t,i){return new d(this,n,t,i)},i})(o.StackedChartViewImpl);n.StackedAreaChartViewImpl=g})(h||(h={})),h}));
define("_generated/Less/Viva.Controls/Controls/Visualization/Viva.Chart.css",["require","exports","o","module"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});window.fx.injectCss(r,".azc-chartBase .azc-chart-axis{pointer-events:none}.azc-chartBase .azc-chart-axis .azc-chart-axis-x text,.azc-chartBase .azc-chart-axis .azc-chart-axis-y text,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x text,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y text{font-size:10px;stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-x .azc-chart-axis-caption{text-anchor:middle}.azc-chartBase .azc-chart-axis .azc-chart-axis-y .azc-chart-axis-caption{text-anchor:end}.azc-chart .azc-chart-noDataMessage,.azc-chart .azc-chart-view-area .azc-chart-callout,.azc-chart .azc-chart-view-line .azc-chart-callout,.azc-chart .azc-chart-view-scatter .azc-chart-callout{text-anchor:middle}.azc-chartBase .azc-chart-axis .azc-chart-axis-x line,.azc-chartBase .azc-chart-axis .azc-chart-axis-x path,.azc-chartBase .azc-chart-axis .azc-chart-axis-y line,.azc-chartBase .azc-chart-axis .azc-chart-axis-y path,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x line,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x path,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y line,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y path{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-area-border-line{stroke-width:1px;stroke:#dcdfe2}.azc-chartBase .azc-chart-axis .azc-chart-axis-hidden-line path,.azc-chartBase .azc-chart-axis .azc-chart-axis-hidden-ticks .azc-chart-axis-tick-line{stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-ticks .azc-chart-axis-tick-line{stroke-width:1px}.azc-chartBase .azc-chart-background{stroke-width:0;fill-opacity:0}.azc-chartBase .azc-chart-axis-gridline{stroke-width:1px;pointer-events:none}.azc-chartBase .azc-chart-background:not(.azc-chart-noninteractive),.azc-chartBase .azc-chart-data:not(.azc-chart-noninteractive){pointer-events:all}.azc-chart{text-rendering:optimizeLegibility}.azc-chart path{stroke-width:2}.azc-chart svg g.azc-lineChart-series path{fill:none!important}.azc-chart .azc-chart-view-line .azc-chart-lineStyleSolid{fill:none;stroke-dasharray:none;transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-line .azc-chart-lineStyleDotted{stroke-dasharray:3,3}.azc-chart .azc-chart-view-line .azc-chart-lineStyleDashed{stroke-dasharray:10,5}.azc-chart .azc-chart-view-line .azc-chart-lineStyleWarningThreshold{stroke-width:1px;stroke-dasharray:3,3}.azc-chart .azc-chart-view-line .azc-chart-lineStyleUsageThreshold{stroke-width:1px}.azc-chart .azc-chart-view-line .azc-chart-lineStyleTrendline{stroke-width:2px;opacity:.7;stroke-dasharray:4,4}.azc-chart .azc-chart-view-line .azc-chart-tooltip-circle{fill:none;stroke:none}.azc-chart .azc-chart-view-area{fill-opacity:.6}.azc-chart .azc-chart-view-area path{stroke-width:0;transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-area pattern.azc-hatchingPatternStyle{fill:none;stroke:#f4f5f6!important}.azc-chart .azc-chart-view-area pattern.azc-hatchingPatternStyle rect{stroke-width:0}.azc-chart .azc-chart-view-area pattern.azc-hatchingPatternStyle path{stroke-width:1}.azc-chart .azc-chart-view-area .azc-chart-tooltip-circle,.azc-chart .azc-chart-view-scatter .azc-chart-tooltip-circle{fill:none;stroke:none}.azc-chart .azc-chart-view-scatter .azc-chart-hovered-circle{opacity:.4}.azc-chart .azc-chart-view-scatter .azc-chart-selected-circle{opacity:.2}.azc-chart .azc-chart-view-bar .azc-barChart-series .azc-barChart-bar-positive{fill:#4682b4!important;stroke:#4682b4!important}.azc-chart .azc-chart-view-bar .azc-barChart-series .azc-barChart-bar-negative{fill:red!important;stroke:red!important}.azc-chart .azc-chart-view-bar .azc-barChart-series rect{transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-stackedArea pattern.azc-hatchingPatternStyle{fill:none;stroke:#f4f5f6!important}.azc-chart .azc-chart-view-stackedArea pattern.azc-hatchingPatternStyle rect{stroke-width:0}.azc-chart .azc-chart-view-stackedArea pattern.azc-hatchingPatternStyle path{stroke-width:1}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series .azc-svg-style-fill{opacity:1}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series path{stroke-width:0}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series.azc-stackedAreaChart-not-selected .azc-svg-style-fill{opacity:.15;transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-hovered .azc-svg-style-fill,.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-selected .azc-svg-style-fill{opacity:.8}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series path.azc-svg-style-fill{stroke-width:2px;fill:none;opacity:1}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-chart-series-hovered .azc-svg-style-fill,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-chart-series-selected .azc-svg-style-fill,.azc-chart.azc-chart-hovered .azc-chart-view-line .azc-lineChart-series.azc-chart-series-hovered path{stroke-width:3px}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected circle,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected circle.azc-chart-hovered-circle,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected path.azc-svg-style-fill{opacity:.3;transition:opacity .2s ease-in-out}.azc-chart.azc-chart-hovered .azc-chart-view-line,.azc-chart.azc-chart-selected .azc-chart-view-line{transition:opacity .3s}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-hovered .azc-svg-style-fill,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-selected .azc-svg-style-fill{opacity:.8}.azc-chart .azc-chart-view-stackedArea .azc-chart-series-selected .azc-svg-style-fill{opacity:1}.azc-chart .azc-chart-view-stackedArea .azc-chart-series-hovered .azc-svg-style-fill{opacity:.8}.azc-chart.azc-chart-hovered .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) rect,.azc-chart.azc-chart-selected .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) rect{opacity:.3}.azc-chart.azc-chart-hovered .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) rect.azc-chart-item-hovered,.azc-chart.azc-chart-hovered .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) rect.azc-chart-item-selected,.azc-chart.azc-chart-selected .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) rect.azc-chart-item-hovered,.azc-chart.azc-chart-selected .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) rect.azc-chart-item-selected{opacity:1}.azc-chart.azc-chart-hovered .azc-chart-view-area .azc-areaChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) .azc-svg-style-fill,.azc-chart.azc-chart-selected .azc-chart-view-area .azc-areaChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) .azc-svg-style-fill{fill-opacity:.3}.azc-chart.azc-chart-hovered .azc-chart-view-area .azc-areaChart-series.azc-chart-series-hovered .azc-svg-style-fill,.azc-chart.azc-chart-hovered .azc-chart-view-area .azc-areaChart-series.azc-chart-series-selected .azc-svg-style-fill,.azc-chart.azc-chart-selected .azc-chart-view-area .azc-areaChart-series.azc-chart-series-hovered .azc-svg-style-fill,.azc-chart.azc-chart-selected .azc-chart-view-area .azc-areaChart-series.azc-chart-series-selected .azc-svg-style-fill{fill-opacity:1}.azc-chart.azc-chart-hovered .azc-chart-view-line .azc-lineChart-series.azc-chart-series-hovered .azc-chart-series-hovered-projection{pointer-events:none;stroke-width:2px;opacity:.4}.azc-chart.azc-chart-hovered .azc-chart-view-line .azc-lineChart-series.azc-chart-series-hovered .azc-svg-style-stroke{opacity:1}.azc-chart.azc-chart-selected .azc-chart-view-line .azc-lineChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) .azc-svg-style-stroke,.azc-chart.azc-chart-selected .azc-chart-view-line .azc-lineChart-series:not(.azc-chart-series-selected):not(.azc-chart-series-hovered) circle{opacity:.3}.azc-chart .azc-chart-y-axis-slice{stroke-width:2px;pointer-events:none;opacity:.2}.azc-chart .azc-chart-noninteractive,.azc-chart.azc-chart-noninteractive{pointer-events:none!important}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line path{pointer-events:stroke}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line .azc-chart-hovered-circle,.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line .azc-chart-selected-circle{pointer-events:all}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line .azc-chart-hovered-circle{opacity:.4}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-area path{pointer-events:fill}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-scatter .azc-chart-hovered-circle,.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-scatter .azc-chart-selected-circle{pointer-events:all}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedAreaChart-series path{pointer-events:fill}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedLineChart-series path.azc-svg-style-fill{pointer-events:stroke}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedLineChart-series .azc-chart-hovered-circle,.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedLineChart-series .azc-chart-selected-circle{pointer-events:all}")}));
define("Viva.Controls/Controls/Visualization/Viva.Chart",["require","exports","f","o","a","ko","$","d3","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.StackedAreaChartViewImpl","Viva.Controls/Controls/Visualization/Viva.ScatterChartViewImpl","Viva.Controls/Controls/Visualization/Viva.LineChartViewImpl","Viva.Controls/Controls/Visualization/Viva.AreaChartViewImpl","Viva.Controls/Controls/Visualization/Viva.BarChartViewImpl","MsPortalImpl/Base/Base.KeyboardHelper","_generated/Less/Viva.Controls/Controls/Visualization/Viva.Chart.css"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";var p;return (function(n){var w=i,t=f.unwrap,p="azc-chart",b="azc-chart-y-axis-slice",k="azc-stroke-heavy",d="azc-chart-view",g="azc-chart-viewBox",nt=".azc-chart-viewBox",tt=(function(n){function i(t,i,r){var u=this,h,e,o;return r=r||{},r.viewModelType=r.viewModelType||s.ViewModel,u=n.call(this,t,i,r)||this,u._currentViewIndex=0,u._navigationStarted=!1,u._chartDataImmediateUpdatedCounter=0,u._internalViewImplsArray=[],u.element.attr("role","figure application").attr("tabindex",0).addClass(p),u.ltm.registerForDispose(u.element.setEvents(["focusin",function(){u.element.find(".azc-chart-series-live").attr("aria-live","polite");u.element.find(".azc-chart-item-live").attr("aria-live","polite")}],["focusout",function(){u.element.find(".azc-chart-series-live").attr("aria-live","off");u.element.find(".azc-chart-item-live").attr("aria-live","off")}],["keydown",function(n){u._handleKeyboardEvents(n,{seriesLiveData:u._seriesLiveData,chartItemLiveData:u._chartItemLiveData})}])),e=u._disposables,u.options.enableTrackXSlider.subscribe(e,h=function(n){o&&o.dispose();var t=u.options.seriesHovers;n?(t.hoversDelayed||(t.hoversDelayed=!0,t.extend({rateLimit:100,method:"notifyWhenChangesStop"})),o=e.createChildLifetime(),u._xSliceHoverTrackComputed=f.computed(o,(function(){u.options.xSliderCoordinate(u._getXSliderCoordinate())})),u._xSliderCoordinateSubscription=u.options.xSliderCoordinate.subscribe(o,(function(n){var t=u._getXSliderCoordinate();n!==null&&n!==t&&u._renderXSliceHover(n);n===null&&n!==t&&(u._cleanXSliceHover(),u._getXSliderCoordinate(null))}))):(u.options.xSliderCoordinate(null),t.hoversDelayed&&(t.hoversDelayed=!1,t.extend({rateLimit:0})))}),u._chartDataImmediateUpdated=f.computed(e,(function(){return u._checkForChartUpdate(),u._chartDataImmediateUpdatedCounter=u._chartDataImmediateUpdatedCounter+1&4095})),u._chartDataImmediateUpdated.subscribe(e,(function(){u._internalSeriesIndexDictionary=null;u._internalViewImplsArrayIsCurrent=!1})),f.computed(e,(function(){u._xSliderOn()||(u._cleanXSliceHover(),u._getXSliderCoordinate(null))})),h(u.options.enableTrackXSlider()),u._init(),u}return __extends(i,n),i.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(n.prototype.dispose.call(this),this._internalViewImplsArray&&this._internalViewImplsArray.length>0&&(this._internalViewImplsArray.forEach((function(n){n.dispose()})),this._internalViewImplsArray=[]),this._xSliceHoverTrackComputed&&(this._xSliceHoverTrackComputed.dispose(),this._xSliceHoverTrackComputed=null,this._xSliderCoordinateSubscription.dispose(),this._xSliderCoordinateSubscription=null),this._cleanup(),this._internalSeriesIndexDictionary=null,this._cleanElement(p))},r.defineProperty(i.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),i.prototype.toggleSeriesSelection=function(n,t,i){this._viewImplsArray[n].toggleSeriesSelection(t,i)},i.prototype.getSeriesName=function(n,t){var i=this._viewImplsArray[n];return i&&i.seriesViewImpls[t]?i.seriesViewImpls[t]._seriesName:null},i.prototype.getSeriesIndexForSeriesViewIndex=function(n,t){var i=this._viewImplsArray[n];return i&&i.seriesViewImpls[t]?i.seriesViewImpls[t]._seriesIndex:null},i.prototype._getSeriesViewsForSeriesIndex=function(n,t){var i=this._viewImplsArray[n];return i.seriesViewImpls.filter((function(n){return n._seriesIndex===t}))},i.prototype.setSeriesHover=function(n,t,i,r){var f=this._viewImplsArray[n],u;f&&(u=f.seriesViewImpls[t],u&&u.setSeriesHover(i,r))},i.prototype.getSeriesIndexBySeriesName=function(n){return this._seriesIndexDictionary[n]},i.prototype.getXAxisIndexBySeriesIndex=function(n){return this._mappedXAxisIndex[n]},i.prototype.getYAxisIndexBySeriesIndex=function(n){return this._mappedYAxisIndex[n]},i.prototype._renderXSliceHover=function(n){if(this._xSliderOn()&&!this._inRenderXSliceHover){this._inRenderXSliceHover=!0;var t=this._viewImplsArray.some((function(n){return n.isHoverHandled}));this._getXSliderCoordinate(n);this._renderXSlice(n,t);t||this._createXAxisSliceHover(n);this._inRenderXSliceHover=!1}},i.prototype._cleanXSliceHover=function(n){this._xSliderSvg&&this._xSliderSvg.style("display","none");n||this.options.seriesHovers([])},i.prototype._init=function(){this._render()},i.prototype._render=function(){this._checkForNoData();this._internalSeriesIndexDictionary||this._immediateSeriesUpdated();this._internalViewImplsArrayIsCurrent||this._reInitViewImplArray()},i.prototype._onChartDataUpdated=function(){n.prototype._onChartDataUpdated.call(this);this._render()},i.prototype._onChartSizeUpdated=function(){this._internalViewImplsArrayIsCurrent=!1;this._render()},i.prototype._plotAreaMouseEnter=function(){this.options.events&&this.options.events.plotAreaMouseEnter&&this._applyWithCoordinates(this.options.events.plotAreaMouseEnter)},i.prototype._plotAreaMouseMove=function(){if(this._xSliderOn()&&this.options.disableXSliderMouseout&&this.options.disableXSliderMouseout()){var n=this._getCoordinates()[0];this._getXSliderCoordinate(n);this._renderXSlice(n,!0)}},i.prototype._plotAreaMouseLeave=function(){this.options.events&&this.options.events.plotAreaMouseLeave&&this._applyWithCoordinates(this.options.events.plotAreaMouseLeave)},i.prototype._plotAreaClick=function(){this.options.events&&this.options.events.plotAreaClick&&this._applyWithCoordinates(this.options.events.plotAreaClick)},i.prototype._cleanup=function(){this._chartSvg.selectAll(".azc-chart-callout").remove();this._chartSvg.selectAll(nt).remove();this._internalViewImplsArray&&this._internalViewImplsArray.forEach((function(n){n.element.remove();n.dispose()}));this._internalViewImplsArray=[];this._internalViewImplsArrayIsCurrent=!1},i.prototype._checkForChartUpdate=function(){var u=this._options,r=u.views();return n.prototype._checkForChartUpdate.call(this),r?!0:!1,this._yAxes().forEach((function(n){n.checkForUpdate()})),this._xAxes().forEach((function(n){n.checkForUpdate()})),r&&r.length>0&&r.forEach((function(n){var r,u,f,e,o;switch(n.chartType()){case 0:r=n;r.seriesView().forEach((function(n){t(n.interpolation);t(n.lineStyle);t(n.showDataPoints);i._checkForUpdateSeriesView(n)}));break;case 4:case 3:case 5:u=n;u.seriesView().forEach((function(n){i._checkForUpdateSeriesView(n)}));break;case 1:f=n;f.seriesView().forEach((function(n){t(n.interpolation);t(n.areaHatchingPattern);i._checkForUpdateSeriesView(n)}));break;case 6:e=n;e.seriesView().forEach((function(n){t(n.interpolation);t(n.areaHatchingPattern);i._checkForUpdateSeriesView(n)}));break;case 2:o=n;o.seriesView().forEach((function(n){t(n.radius);i._checkForUpdateSeriesView(n)}))}})),!0},r.defineProperty(i.prototype,"_getXSliderCoordinate",{get:function(){var n=this._xSliceHoverCoordinate;return n||(this._xSliceHoverCoordinate=n=f.observable(null)),n},enumerable:!0,configurable:!0}),i.prototype._mouseMoveHandler=function(){this._renderXSliceHover(this._getCoordinates()[0])},i.prototype._mouseOutHandler=function(n){if(this._xSliderOn()){var r=!this.options.disableXSliderMouseout||!this.options.disableXSliderMouseout(),t=void 0,i=void 0;t=e(n.fromElement).closest(".azc-chart-canvas");t.length>0&&(i=e.contains(t[0],n.toElement),i&&(r=!0));r&&(i?this._getXSliderCoordinate(this._getCoordinates()[0]):(this._cleanXSliceHover(),this._getXSliderCoordinate(null)))}},i.prototype._handleKeyboardEvents=function(n,t){var u=this,f=y.getModifierKeys(n),i=this._internalViewImplsArray.length,e=function(n){u._currentViewIndex>=n&&(u._currentViewIndex=0,u._navigationStarted=!0)},o=function(n){n.preventDefault();n.stopPropagation()},r;if(!i){this._navigationStarted=!1;this._currentViewIndex=0;return}if(f===0){switch(n.which){case 27:for(this._navigationStarted=!1,this._currentViewIndex=0,r=0;r<i;r++)this._internalViewImplsArray[r]._handleKeyboardEvents(n,t);this.options.hoveredID([]);this.options.seriesHovers([]);this.options.seriesSelections([]);break;case 32:case 37:case 39:this._navigationStarted=!0;e(i);this._internalViewImplsArray[this._currentViewIndex]._handleKeyboardEvents(n,t);break;default:return}o(n)}else f===8&&(n.which===38||n.which===40)?(this._navigationStarted?n.which===38?this._viewImplsArray[this._currentViewIndex]._canNavigateSeries(38)||(this._currentViewIndex=++this._currentViewIndex%i):this._viewImplsArray[this._currentViewIndex]._canNavigateSeries(40)||(this._currentViewIndex=--this._currentViewIndex<0?i-1:this._currentViewIndex%i):this._navigationStarted=!0,e(i),this._internalViewImplsArray[this._currentViewIndex]._handleKeyboardEvents(n,t),o(n)):f===8&&n.which===32&&(e(i),this._internalViewImplsArray[this._currentViewIndex]._handleKeyboardEvents(n,t),o(n))},r.defineProperty(i.prototype,"_seriesIndexDictionary",{get:function(){return this._internalSeriesIndexDictionary||this._immediateSeriesUpdated(),this._internalSeriesIndexDictionary},enumerable:!0,configurable:!0}),r.defineProperty(i.prototype,"_viewImplsArray",{get:function(){return this._internalViewImplsArrayIsCurrent||this._reInitViewImplArray(),this._internalViewImplsArray},enumerable:!0,configurable:!0}),i.prototype._immediateSeriesUpdated=function(){this._internalSeriesIndexDictionary=i._createSeriesDictionary(this.options.series())},i.prototype._reInitViewImplArray=function(){var t=this,n,f=this._options,i=f.views();if(this._cleanup(),this._mapSeriesToAxis(),this._internalViewImplsArrayIsCurrent=!0,i&&i.length>0){var r=this._width(),u=this._height(),e=this._chartSvg.append("svg").attr({top:0,left:0,width:r,height:u,viewBox:"0 0 "+r+" "+u,"class":g});i.forEach((function(i,o){switch(i.chartType()){case 0:n=new l.LineChartViewImpl(i);break;case 1:n=new a.AreaChartViewImpl(i);break;case 6:n=new h.StackedAreaChartViewImpl(i);break;case 3:case 4:case 5:n=new v.BarChartViewImpl(i);break;case 2:n=new c.ScatterChartViewImpl(i);break;default:throw new Error("The view type is not specified.");}t._internalViewImplsArray.push(n);n.chartViewIndex=o;n.options=f;n.height=u;n.width=r;n.xAxes=t._xAxes();n.yAxes=t._yAxes();n.mappedXAxisIndex=t._mappedXAxisIndex;n.mappedYAxisIndex=t._mappedYAxisIndex;n.seriesIndexDictionary=function(n){return t.getSeriesIndexBySeriesName(n)};n.isHorizontalChart=t._isHorizontalChart();n.element=e.append("g").attr("class",d);n.mouseOutHandler=function(){t._mouseOutHandler()};n.mouseMoveHandler=function(){t._mouseMoveHandler()};n.init(t.ltm)}))}},i._checkForUpdateSeriesView=function(n){n.cssClass()?!0:!1;n.tooltipFormatter()?!0:!1;n.showTooltip()?!0:!1;i._checkForUpdateDataLabels(n.dataLabels());i._checkForUpdateRenderingConditions(n.renderingConditions())},i._checkForUpdateDataLabels=function(n){n.forEach((function(n){n.context()?!0:!1;n.formatter()?!0:!1;n.style()?!0:!1}))},i._checkForUpdateRenderingConditions=function(n){n.forEach((function(n){n.seriesName()?!0:!1;n.conditionOperator()?!0:!1;n.interpolation()?!0:!1}))},i.prototype._applyWithCoordinates=function(n){var t=this._getCoordinates(),i=this.getAxisInfoProvider(0),r=this.getAxisInfoProvider(1);n(t[0],t[1],i._getAxisValue(t[0]),r._getAxisValue(t[1]))},i.prototype._getCoordinates=function(n){var i=n||this._chartSvg.node(),t=o.mouse(i);return this._isHorizontalChart()?t.reverse():t},i.prototype._checkForNoData=function(){var t=this._options,n=t.series();n&&n.length!==0?this._axisElement.attr("display",null):this._axisElement.attr("display","none")},i._createSeriesDictionary=function(n){var t={};return(n||[]).forEach((function(n,i){n.name()&&(t[n.name()]=i)})),t},i.prototype._renderXSlice=function(n,t){var i=this,r,u;this._xSliderOn()&&(this._cleanXSliceHover(t),r=[0,1],u=o.svg.line().x((function(t){return i._isHorizontalChart()?t?i._width():0:n})).y((function(t){return i._isHorizontalChart()?n:t?i._height():0})),this._xSliderSvg||(this._xSliderSvg=this._chartSvg.append("path"),this._xSliderSvg.attr({"class":[b,k].join(" ")})),this._xSliderSvg.attr({d:u(r)}).style("display",null))},i.prototype._createXAxisSliceHover=function(n){if(!w.isNullOrUndefined(n)){var i=[],r,t=this.options.xSliderFilterHoverThreshold&&this.options.xSliderFilterHoverThreshold();t&&t<.5&&t>0&&(r=this._width()*t);this._viewImplsArray.forEach((function(t){i=i.concat(t.getXSliceSeriesSubset(n,r))}));this.options.seriesHovers(i)}},i})(s.Widget);n.Widget=tt})(p||(p={})),p}));
define("_generated/Less/MsPortalImpl.Controls/Controls/Visualization/Chart.css",["require","exports","o","module"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});window.fx.injectCss(r,'.fxc-chart .fxc-chart-graph-area,.fxc-chart .fxc-chart-legend-area{display:inline-block;vertical-align:top}.fxc-chart .fxc-chart-graph-and-legend{width:100%;white-space:nowrap}.fxc-chart .fxc-chart-graph-and-legend text{font-family:az_ea_font,"Segoe UI",wf_segoe-ui_normal,"Segoe WP",Tahoma,Arial,sans-serif;font-weight:400}.fxc-chart .fxc-chart-legend-area-container{height:100%;width:105px;display:inline-block;vertical-align:top}.fxc-chart .fxc-chart-legend-area{width:calc(100% - 25px);height:calc(100% - 2px);padding:0 10px 0 15px;margin-top:-4px;overflow:hidden}.fxc-chart .azc-metrics{width:calc(100% - 30px);padding:5px 15px 0}')}));
define("MsPortalImpl.Controls/Controls/Visualization/Chart",["require","exports","f","i","o","a","ko","$","d3","Fx/Controls/Legend","MsPortalImpl.Controls/Controls/Base/OptionsBase","Viva.Controls/Controls/Visualization/Viva.ChartBase","MsPortalImpl.Controls/Controls/Visualization/ChartViewModelConversionHelper","MsPortalFx/Globalization","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Resources/ImplScriptResources","Viva.Controls/Controls/Visualization/Viva.Chart","Viva.Controls/Util/Viva.Hatching","Viva.Controls/Util/Viva.Resize","Viva.Controls/Util/Viva.Util","MsPortalImpl/Controls/Helpers/LoadingAndNoData","MsPortalImpl/Base/Base.Timers","_generated/Less/Viva.Controls/Controls/Visualization/Viva.SvgBase.css","_generated/Less/MsPortalImpl.Controls/Controls/Visualization/Chart.css"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){"use strict";var tt;return (function(n){function ct(n,i){return t(n)?null:parseInt(n.split("_")[i])}function lt(n){return ct(n,1)}function at(n){return ct(n,0)}function oi(n){return ut+st[n%ri]}function si(n){var i=0,t;return n&&(t=n,t&&t.hasOwnProperty("areaHatchingPattern")&&(i=t.areaHatchingPattern())),i}function c(n){return n.yValue}function hi(n){return n.xValue}function vt(n,t){return t.first((function(t){return!n||t.name()===n}))}function yt(n){var t=o.Unit,r=i.UnitConversion.Unit[n];return t[r]}var pt=r.TriggerableLifetimeManager,wt=i.ViewModels,tt=wt.Controls,it=tt.DockedBalloon,rt=tt.Visualization,bt=rt.Chart,kt=bt.ViewModel,dt=rt.Metrics,t=i.isNullOrUndefined,gt=i.ColorUtil,o=i.UnitConversionUtil,b=jQuery,ut="azc-color-",ft="fxc-chart",ai=i.isDevelopmentMode,ni=85,et=175,ot=355,ti=65,ii=105,st=gt.getRainbowColorCode(0),ri=st.length,ht=p.Chart.noValueString,ui=".fxc-chart-graph-area",fi=".fxc-chart-graph-and-legend",ei="<div class='fxc-chart-graph-and-legend' data-bind='visible: !data.loading()'><div class='fxc-chart-graph-area'><\/div><!-- ko if: $ctl._showLegend --><div class='fxc-chart-legend-area-container'><div class='fxc-chart-legend-area' data-bind='pcLegend: $ctl._nestedLegendViewModel'><\/div><\/div><!-- /ko --><\/div><!-- ko if: $ctl._showMetrics() && !data.loading() --><div data-bind='pcMetrics: data.metrics'><\/div><!-- /ko -->",ci=(function(){var n=function(n,t){return function(i){return n(i,t)}},t=function(n,t){var i=n.last();return i&&t?t(i):i};return[n(t,hi),n(t,c),n(s.min,c),n(s.max,c),n(s.mean,c),n(s.sum,c),function(n){return n.length},]})(),li=(function(n){function r(t,i,r){var u=this,f,o;return i.controlType===97?(f=new pt,o=new kt(f),u=n.call(this,t,o,b.extend({fillBehavior:3},r))||this,u._convertedChartLtm=f,new a.ChartViewModelConversionHelper(i,o,u.ltm)):u=n.call(this,t,i,b.extend({fillBehavior:3},r))||this,u._nestedLegendViewModel=e.observable(),u._isResizing=!1,u._defaultNumberFormatter=v.NumberFormat.create({minimumFractionDigits:0,maximumFractionDigits:2}),u._initializeWidgets(),u}return __extends(r,n),u.defineProperty(r.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(this._convertedChartLtm&&(this._convertedChartLtm.dispose(),this._convertedChartLtm=null),n.prototype.dispose.call(this),this._cleanElement(ft))},r.prototype._initializeWidgets=function(){var r=this,s,tt,o,a,v,y,it,rt,p,w,b,d;this._sizeAllowMetricsToShow=e.observable(!0);this._sizeAllowLegendToShow=e.observable(!1);this._sizeBasedXTicks=e.observable(0);this._sizeBasedYTicks=e.observable(0);var c=this.element,f=this.options,n=this.ltm,u=this._nestedChartGraphViewModel=new l.ViewModel(this.vmBasicOption);u.populateFromObject(f);u.height=e.observable(0);u.width=e.observable(0);u.ariaLabel=f.ariaLabel;u.ariaDesc=f.ariaDesc;s=function(n,t){return n+"_"+t};e.computed(n,(function(){u.views().forEach((function(n){n.seriesView().forEach((function(n){var t=n.cssClass();t||n.cssClass(r._generateCssClassNameFromSeriesName(n.seriesName()))}))}))}));tt=this._showLegend=e.computed(n,(function(){return r._sizeAllowLegendToShow()&&f.legendPosition()!==0}));tt.subscribeAndRun(n,(function(f){var c;if(f){if(!o){o=n.createChildLifetime();var l=u.seriesSelections.map(o,(function(n,t){return s(t.chartViewIndex(),t.seriesViewIndex())})),v=e.computed(o,(function(){var n=[];return u.views().forEach((function(t,i){var r=t.chartType(),h=r===1||r===6,c=r===3||r===4||r===5||r===6,u=t.seriesView(),f,o;u&&(f=u.length-1,o=c?function(n){return f-n}:function(n){return n},u.forEach((function(t,r){t.hideFromLegend()||n.push({cssClass:t.cssClass,selected:e.observable(!1),seriesName:e.pureComputed((function(){return t.displayName()||t.seriesName()})),identity:s(i,o(r)),hatchingPattern:e.pureComputed((function(){return h?e.unwrap(t.areaHatchingPattern):0}))})})))})),n})),a=i.thunkArray(o,v);a.map(o,(function(n,t){var i=t;e.ignoreDependencies((function(){l.subscribeAndRun(n,(function(n){i.selected(n.indexOf(i.identity)>=0)}));i.selected.subscribeAndRun(n,(function(n){var t=i.identity,u=l().indexOf(t)>=0,f,e;(u&&!n||!u&&n)&&r._savedChartGraphInstance&&(f=lt(t),e=at(t),r._savedChartGraphInstance.toggleSeriesSelection(e,f,null))}))}))}));c=h.create(o,{itemSetting:{colorKey:"cssClass",indexKey:"identity",selectedKey:"selected",labelKey:"seriesName",hatchingKey:"hatchingPattern"},items:a,hoveredIndex:e.observable(null)});r._nestedLegendViewModel(c);e.computed(o,(function(){var n=c.hoveredIndex(),i,f;r._protectFromCircularHoverUpdate?r._protectFromCircularHoverUpdate=!1:t(n)?u.seriesHovers([]):(i=lt(n),f=at(n),r._savedChartGraphInstance.setSeriesHover(f,i,null,!0))}));e.computed(o,(function(){var f=u.seriesHovers(),e=u.hoveredID(),n,t,i=null;f.length===1?(n=f[0].seriesViewIndex.peek(),t=f[0].chartViewIndex.peek(),i=s(t,n)):e.length===1&&(n=e[0].seriesViewIndex.peek(),t=e[0].chartViewIndex.peek(),i=s(t,n));c.hoveredIndex.peek()!==i&&(r._protectFromCircularHoverUpdate=!0,c.hoveredIndex(i))}))}}else o&&o.dispose(),o=null,r._nestedLegendViewModel(null)}));e.computed(n,(function(){r._seriesIndexes={};(u.series()||[]).forEach((function(n,t){r._seriesIndexes[n.name()]=t}))}));this._showMetrics=e.computed(n,(function(){return r._sizeAllowMetricsToShow()&&f.metrics.visible()}));u.xAxis.ticks=e.computed(n,(function(){return f.xAxis.ticks()||r._sizeBasedXTicks()}));u.yAxis.ticks=e.computed(n,(function(){return f.yAxis.ticks()||r._sizeBasedYTicks()}));u.xAxis.unit=e.computed(n,(function(){return yt(f.xAxis.unit())}));u.yAxis.unit=e.computed(n,(function(){return yt(f.yAxis.unit())}));c.addClass(ft).attr("role","application").html(ei);this._bindDescendants();this._graphArea=c.find(ui);this._graphAndLegendArea=c.find(fi);v=function(){r._isResizing||r._calculateAndRenderGraph()};this._showMetrics.subscribe(n,v);f.metrics.size.subscribe(n,v);this._showLegend.subscribe(n,v);y=k.ResizeObserverEnabled;p=nt.throttleByAnimationFrame((function(t,i){n.isDisposed()||r._adjustLayoutBasedOnSize(t||it,i||rt)}));e.computed(n,[f.width,f.height],(function(n,t){y||p(n,t)})).extend({deferred:!0});w=function(n,t){y=!1;p(it=n,rt=t)};k.track(n,c,w);Q.delay(300).then((function(){y&&w(0,0)}));b=function(){n.isDisposed()||(a&&a.dispose(),a=n.createChildLifetime(),r._createMetricsComputed(a))};d=nt.throttle(n,b,50);f.series.subscribe(n,d);f.metricsRules.subscribe(n,d);b();g.setup(this,this.options)},r.prototype._getSelectedSeriesIndexes=function(){var n=this;return this._nestedChartGraphViewModel.seriesSelections().map((function(t){return n._getSeriesIndexFromSeriesName(n._getSeriesNameFromSeriesId(t))})).filter((function(n){return n!==null}))},r.prototype._getSeriesSelections=function(){var n=this.options.seriesSelections();return!n||n.length===0?this.options.seriesHovers():n},r.prototype._createMetricsComputed=function(n){var t=this;e.computed(n,(function(){var i=t.options,r=[],f=i.metricsRules()||[],u,o;i.seriesHovers();i.hoveredID();o=i.metrics.items.peek();f.length>0?(u=f.filter((function(n){return t._checkRuleMatch(n,!0)})),u.length===0&&(u=f.filter((function(n){var t=e.unwrap(n.scope);return t===0}))),u.forEach((function(i){var u=e.unwrap(i.metrics);(u||[]).forEach((function(u){r=r.concat(t._createMetrics(n,i,u))}))}))):r=o||[];t._updateMetricsViewModelData(n,r)})).extend({rateLimit:30})},r.prototype._updateMetricsViewModelData=function(n,t){var f=this.options.metrics.items.peek(),r,i,u;t.length>f.length?this.options.metrics.items(t):f.forEach((function(f,o){u=!1;o>=t.length?f.hide(!0):(f.hide(!1),d.fillObserableFields(t[o],f,["value","unit","caption","barCssClass","showBarColor","hatchingPattern","prioritized","unitAlignment"]),r=e.unwrap(t[o].infoBalloon),r?(f.hideInfoBalloon(!1),i=e.unwrap(f.infoBalloon),r!==i&&(i||(i=new it.ViewModel(n),i.type=r.type,u=!0),d.fillObserableFields(r,i,["balloonVisible","content","disabled","link","position",]),(u||i.type!==r.type)&&f.infoBalloon(i))):f.hideInfoBalloon(!0))}))},r.prototype._createMetrics=function(n,i,r){var c=this,h=[],u,l=this.options.hoveredID().map((function(n){return c._getSeriesNameFromSeriesId(n)})),a=e.unwrap(r.aggregationScope),v,f,o;switch(a){case 2:case 0:v=e.unwrap(i.scope);f=this._getMetricsRuleActionSeriesIndex(i,r);t(f)&&a===0&&v===0&&(f=this.options.series().length>0?0:null);u=this._createMetric(n,i,r,f,l);u&&h.push(u);break;case 1:o=this._getSelectedSeriesIndexes();o.length===0&&(o=s.range(this.options.series().length));o.forEach((function(t){u=c._createMetric(n,i,r,t,l);u&&h.push(u)}))}return h},r.prototype._createMetric=function(n,i,r,u,f){var nt=this.options.series(),s,ot=e.unwrap(r.colorCode),tt=e.unwrap(r.hatchingPattern),c,l,a,rt=ot?ut+ot:null,v,y,ft,h,et,st,p,ht,w,k=null,g,ct;return t(u)||nt.length===0||u>=nt.length?null:(s=new dt.SingleMetric(n),s.showBarColor(e.unwrap(r.showBarColor)),l=nt[u].name(),a=e.unwrap(r.title),w=e.unwrap(r.defaultInfoBalloon),w&&(k=new it.ViewModel(n),k.type=w.type,d.fillObserableFields(w,k,["balloonVisible","content","disabled","link","position",])),c=this._getFirstSeriesView(l),rt=rt||c&&c.cssClass()||this._generateCssClassNameFromSeriesName(l),a=a||c&&c.displayName()||l,tt=tt||si(c),f.indexOf(l)>=0&&s.prioritized(!0),s.caption(a),s.barCssClass(rt),s.infoBalloon(k),ht=tt,s.hatchingPattern(ht),v=e.unwrap(r.unit),h=this._calculateMetricsValue(u,i,r),et=b.isNumeric(h),v||(g=this._getOriginalUnit(u,r),y=g.unit,ft=g.autoScale&&et?o.getAppropriateUnit(h,y):y,p=o.getConversionFactor(y,ft),v=o.toString(ft,g.displaySIUnit),p&&p!==1&&(h=h/p)),ct=e.unwrap(r.aggregationType),ct===7&&et&&(st=parseFloat(h),h=st),s.unit(v),s.value(this._formatMetricsValue(h,r)),s)},r.prototype._xAxes=function(){return[this._nestedChartGraphViewModel.xAxis].concat(this._nestedChartGraphViewModel.secondaryXAxes())},r.prototype._yAxes=function(){return[this._nestedChartGraphViewModel.yAxis].concat(this._nestedChartGraphViewModel.secondaryYAxes())},r.prototype._getAxisByIndex=function(n,t){var i=l.SeriesUtilities.getAxisName(this._nestedChartGraphViewModel.series()[n],"x");switch(t){case"x":return vt(i,this._xAxes());case"y":return vt(i,this._yAxes())}return null},r.prototype._getOriginalUnit=function(n,t){var i,f=o.Unit.None,r,u={unit:f,autoScale:!0,displaySIUnit:!1},s=e.unwrap(t.aggregationType);switch(s){case 0:r="x";break;case 6:r=null;u.unit=o.Unit.Count;break;default:r="y"}return r&&(i=this._getAxisByIndex(n,r),i&&(u.unit=e.unwrap(i.unit),u.displaySIUnit=e.unwrap(i.displaySIUnit),i.autoScaleUnit&&(u.autoScale=i.autoScaleUnit()))),u},r.prototype._checkRuleMatch=function(n,t){var i=this._getSeriesSelections(),r=e.unwrap(n.scopeSeriesName),u=e.unwrap(n.scope);switch(u){case 4:return i.length>1&&this._checkAnyDataPointsSelected()&&this._matchSeriesSelection(r);case 3:return i.length===1&&i[0].chartItems().length>1&&this._matchSeriesSelection(r);case 2:return i.length===1&&i[0].chartItems().length===1&&this._matchSeriesSelection(r);case 0:default:return!t}},r.prototype._getSeriesNameFromSeriesId=function(n){var t=n.chartViewIndex(),i=n.seriesViewIndex();return this._getSeriesName(t,i)},r.prototype._matchSeriesSelection=function(n){var i=this;return t(n)?!0:this._getSeriesSelections().some((function(t){return i._getSeriesNameFromSeriesId(t)===n}))},r.prototype._checkAnyDataPointsSelected=function(){return this._getSeriesSelections().some((function(n){return!t(n.chartItems())&&n.chartItems().length>0}))},r.prototype._getMetricsRuleActionSeriesIndex=function(n,i){var u=e.unwrap(i.aggregationSeriesName)||e.unwrap(n.scopeSeriesName),r;return u?this._getSeriesIndexFromSeriesName(u):(r=this._getSeriesSelections(),!t(r)&&r.length>0?this._getSeriesIndexFromSeriesName(this._getSeriesNameFromSeriesId(r[0])):null)},r.prototype._calculateMetricsValue=function(n,t,i){var o=this,s=e.unwrap(i.aggregationType),r,h,c,u,f;return s===7?e.unwrap(i.customValue):(h=e.unwrap(i.aggregationScope),h===0?(c=e.unwrap(t.scope),r=c===0?this._getAllChartItems():this._getAllChartItems(!0)):(u=this._getSeriesSelections().filter((function(t){return o._getSeriesIndexFromSeriesName(o._getSeriesNameFromSeriesId(t))===n})),r=u&&u.length>0?this._getChartItemsSelected(u[0]):this._getAllChartItemsForSeriesName(n)),r.length>0&&(f=ci[s],f))?f(r):ht},r.prototype._formatMetricsValue=function(n,i){if(t(n))return ht;var u=e.unwrap(i.outputFormat),r=e.unwrap(i.formatOptions);return e.unwrap(i.unit)&&!u&&!r?n.toString():typeof n!="number"?isFinite(n)&&u?n.toString(u):n instanceof Date?r?v.DateTimeFormat.create(r).format(n):l.AxisWrapper._getGlobalizedDateValueForD3Defaults(n):n.toString():r?v.NumberFormat.create(r).format(n):this._defaultNumberFormatter.format(n)},r.prototype._getChartItemsSelected=function(n){var t=n.chartItems();return!t||t.length===0?this._getAllChartItemsForSeriesName(this._getSeriesIndexFromSeriesName(this._getSeriesNameFromSeriesId(n))):t},r.prototype._getAllChartItemsForSeriesName=function(n){var t=this._nestedChartGraphViewModel.series()[n];return t?l.SeriesUtilities.getChartItemArrayBySeriesBase(t,!0):[]},r.prototype._getAllChartItems=function(n){var i=this,t,r;return n===void 0&&(n=!1),t=[],n?this._getSeriesSelections().forEach((function(n){f.prototype.push.apply(t,i._getChartItemsSelected(n))})):(r=s.range(this.options.series().length),r.forEach((function(n){f.prototype.push.apply(t,i._getAllChartItemsForSeriesName(n))}))),t},r.prototype._getFirstSeriesView=function(n){var t=null;return this.options.views().some((function(i){return i.seriesView().some((function(i){return i.seriesName()===n?(t=i,!0):!1}))})),t},r.prototype._getSeriesIndexFromSeriesName=function(n){var r;if(this._savedChartGraphInstance&&(r=this._savedChartGraphInstance.getSeriesIndexBySeriesName(n)),t(r)){for(var u=this._nestedChartGraphViewModel.series(),i=void 0,f=u.length,i=0;i<f;i++)if(u[i].name()===n)return i;return null}return r},r.prototype._getSeriesName=function(n,i){var r,e,u,f;if(this._savedChartGraphInstance&&(r=this._savedChartGraphInstance.getSeriesName(n,i)),t(r)){if(e=this._nestedChartGraphViewModel.views(),u=e[n],u&&(f=u.seriesView()[i],f))return f.seriesName()}else return r;return null},r.prototype._generateCssClassNameFromSeriesName=function(n){var i=this._getSeriesIndexFromSeriesName(n);return t(i)?"":oi(i)},r.prototype._calculateAndRenderGraph=function(){var i=this._graphArea,r=this._width-(this._showLegend()?ii:0),t=this._height-(this._showMetrics()?ti:0),n;
//!!important force-render. JQuery height, width function. or css width and height.
i.css({width:r,height:t});this._graphAndLegendArea.css({height:t});n=this._nestedChartGraphViewModel;n.width(r);n.height(t);this._savedChartGraphInstance||this.widgets.push(this._savedChartGraphInstance=new w.Widget(i,n))},r.prototype._adjustLayoutBasedOnSize=function(n,i){var r,h;this._isResizing=!0;r=this.options;this._height=r.height()||i||this.element.height();this._width=r.width()||n||this.element.width();var f=!0,e=!0,u=2,o=5,s=10;this._isUnderHeight(ni)?(f=!1,u=null):this._isUnderHeight(et)?(u=0,f=!1,s=3):this._isUnderHeight(ot)&&(s=5);this._isUnderWidth(et)?(o=2,e=!1):this._isUnderWidth(ot)&&(o=3,e=!1);t(u)||(r.metrics.size(u),this._sizeBasedXTicks(o),this._sizeBasedYTicks(s));this._sizeAllowMetricsToShow(f);this._sizeAllowLegendToShow(e);this._calculateAndRenderGraph();this._isResizing=!1;h=r.sizeChanged();(h.width!==this._width||h.height!==this._height)&&r.sizeChanged({width:this._width,height:this._height})},r.prototype._isUnderHeight=function(n){return this._height<=n},r.prototype._isUnderWidth=function(n){return this._width<=n},r})(y.Widget);n.Widget=li})(tt||(tt={})),tt}))