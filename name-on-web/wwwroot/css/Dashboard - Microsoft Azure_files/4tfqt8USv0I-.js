var __extends;
define("ReleaseManagement/Data/DeploymentLogData",["require","exports","f","o","a"],(function(n,t,i,r,u){"use strict";r.defineProperty(t,"__esModule",{value:!0});i.Data.Metadata.setTypeMetadata("DeploymentLogMetadata",{name:"DeploymentLogMetadata",properties:{id:{isArray:!1,itemType:null,persistEdits:!0},status:{isArray:!1,itemType:null,persistEdits:!0},status_text:{isArray:!1,itemType:null,persistEdits:!0},author_email:{isArray:!1,itemType:null,persistEdits:!0},author:{isArray:!1,itemType:null,persistEdits:!1},deployer:{isArray:!1,itemType:null,persistEdits:!1},message:{isArray:!1,itemType:null,persistEdits:!1},progress:{isArray:!1,itemType:null,persistEdits:!1},received_time:{isArray:!1,itemType:null,persistEdits:!1},start_time:{isArray:!1,itemType:null,persistEdits:!1},end_time:{isArray:!1,itemType:null,persistEdits:!1},last_success_end_time:{isArray:!1,itemType:null,persistEdits:!1},complete:{isArray:!1,itemType:null,persistEdits:!1},active:{isArray:!1,itemType:null,persistEdits:!1},url:{isArray:!1,itemType:null,persistEdits:!1},site_name:{isArray:!1,itemType:null,persistEdits:!1},log_url:{isArray:!1,itemType:null,persistEdits:!1},is_readonly:{isArray:!1,itemType:null,persistEdits:!1}},idProperties:["id","end_time","active"],entityType:!0});var f=(function(){function n(){}return n.createView=function(n){var t=new i.Data.QueryCache({entityTypeName:"DeploymentLogMetadata",sourceUri:function(n){return"https://management.azure.com"+n.webAppResourceUri+"/deployments?api-version=2016-03-01"},setAuthorizationHeader:!0,processServerResponse:function(n){var r=[],i,f,t;if(n&&n.value&&(i=n.value,u.isArray(i)))for(f in i)t=i[f].properties,t.status_text=t&&t.status===4?"Successful":"Failed",r.push(t);return{data:r}}});return t.createView(n)},n})();t.DeploymentDataQueryHelper=f}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/DisconnectCICommandViewModel",["require","exports","f","o","$","ReleaseManagement/TypeScript/Utilities/ArmUtils","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources","Core/TypeScript/ViewModels/BaseCommandViewModel","ReleaseManagement/TypeScript/Utilities/LogHelper"],(function(n,t,i,r,u,f,e,o,s){"use strict";r.defineProperty(t,"__esModule",{value:!0});var h=i.Base.Diagnostics.Telemetry,c=(function(n){function t(t,r,u){var f=n.call(this,t)||this;return f._dataContext=u,f.icon(i.Base.Images.Disconnect()),f.enabled(f._dataContext.isContinuousDeploymentConfigured()),f._dataContext.isContinuousDeploymentConfigured.subscribe(t,(function(n){f.enabled(n)})),f}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=u.Deferred();return n.websiteUri&&(this._websiteUri=n.websiteUri),t.promise()},t.prototype.execute=function(){this._confirmationMessageBox=new i.ViewModels.Dialogs.MessageBox(e.disconnectCIConfirmationMessageTitle,e.disconnectCIConfirmationMessageText,4);this.dialog(this._confirmationMessageBox)},t.prototype.dialogClick=function(n){var t=this,r=this.dialog();r===this._confirmationMessageBox&&n===6&&(s.LogHelper.LogInfo("DisconnectCD: Entered Disconnect CD"),h.trace({source:"DisconnectCICommandViewModel",action:"RemoveCITriggerStart"}),f.AppServiceArmApiUtilities.beginGetContinuousDeploymentMetadata(this._dataContext).then((function(n){var i=[];i.push(t._beginResetAllSitesConfigScmType(n),t._beginRemoveContinuousIntegrationTrigger(n));Q.all(i).then((function(){h.trace({source:"DisconnectCICommandViewModel",action:"RemoveCITriggerSuccessful"});t._beginPushKuduLogForDisconnectCI(n);t._notifySuccess()})).catch((function(n){Q.allSettled(i).then((function(){h.trace({source:"DisconnectCICommandViewModel",action:"CDDisconnectFailed"});s.LogHelper.LogError("DisconnectCD: Exited Disconnect CD with failure: {0}".format(n));t._notifyFailure()}))}))}),(function(){return t._notifyFailure()})),this.dialog(null),this.enabled(!1),this._notification=i.Hubs.Notifications.ClientNotification.publish({title:e.disconnectCIInprogressTitle,description:e.disconnectCIInprogressTitle,status:i.Hubs.Notifications.NotificationStatus.InProgress}))},t.prototype._beginResetAllSitesConfigScmType=function(n){var r=this,i=Q.defer(),t=[];return!n.prodAppDetails||!n.prodAppUri?t.push(this._beginResetSiteConfigScmType(this._dataContext.appServiceArmManager.appServiceResourceData().id)):(t.push(this._beginResetSiteConfigScmType(n.prodAppUri)),!n.testAppName||!n.testAppUri||t.push(this._beginResetSiteConfigScmType(n.testAppUri)),!n.slotAppName||!n.slotAppUri||t.push(this._beginResetSiteConfigScmType(n.slotAppUri))),Q.all(t).then((function(){r._dataContext.isContinuousDeploymentConfigured(!1);i.resolve("")}),(function(n){h.trace({source:"DisconnectCICommandViewModel",action:"ResetAllSitesConfigScmTypeFailed"});i.reject(n)})),i.promise},t.prototype._beginResetSiteConfigScmType=function(n){var i=this,t=Q.defer();return this._dataContext.appServiceArmManager.beginGetAppServiceSiteConfig(n).then((function(r){r.properties.scmType="";i._dataContext.appServiceArmManager.beginUpdateAppServiceSiteConfig(r,n).then((function(){t.resolve("")}),(function(i){t.reject("DisconnectCD: Failed to reset SCM type for site: {0}, error: {1}".format(n,i))}))}),(function(i){t.reject("DisconnectCD: Failed to get AppServiceSiteConfig site: {0}, error: {1}".format(n,i))})),t.promise},t.prototype._beginRemoveContinuousIntegrationTrigger=function(n){var t=Q.defer();return!n.vstsAccountId||!n.vstsProjectId||!n.vstsBuildDefinitionId?t.resolve(""):this._dataContext.webApiManager.beginRemoveContinuousIntegrationTrigger(n.vstsBuildDefinitionId,n.vstsAccountId,n.vstsProjectId).then((function(){t.resolve("")}),(function(i){h.trace({source:"DisconnectCICommandViewModel",action:"RemovingCITriggerFailed"});t.reject("DisconnectCD: Failed to remove CD trigger for build definition id {0}, error: {1}".format(n.vstsBuildDefinitionId,i))})),t.promise},t.prototype._beginPushKuduLogForDisconnectCI=function(n){var r=Q.defer(),u=Date.now().toString(),i="",t="",f;return!n.prodAppDetails||!n.prodAppUri?(i=this._dataContext.appServiceArmManager.appServiceResourceData().id,t=this._dataContext.appServiceArmManager.appServiceResourceData().name,t=this._dataContext.appServiceArmManager.appServiceResourceData().isSlot?t.replace("/","-"):t):(i=n.prodAppUri,t=n.prodAppDetails.appServiceName),f={id:u,properties:{id:u,status:4,active:!1,author:"VSTS",deployer:"VSTS",message:JSON.stringify({type:"CDDisconnect",prodAppName:t,message:e.cDDisconnectLogMessage})}},this._dataContext.appServiceArmManager.beginPushAppServiceDeploymentLog(f,i,u).then((function(){r.resolve("")}),(function(n){s.LogHelper.LogError("DisconnectCD: Failed to push Disconnect log to Kudu with websiteResourceUri:"+i+". Error: "+n);h.trace({source:"DisconnectCICommandViewModel",action:"PushDisconnectLogToKuduFailed"});r.resolve("")})),r.promise},t.prototype._notifySuccess=function(){h.trace({source:"DisconnectCICommandViewModel",action:"CDDisconnected"});s.LogHelper.LogInfo("DisconnectCD: Exited Disconnect CD with success");!this._notification||(this._notification.title=e.disconnectCISuccessTitle,this._notification.uri="https://go.microsoft.com/fwlink/?linkid=831312",this._notification.description=e.disconnectCISuccessDescription,this._notification.status=i.Hubs.Notifications.NotificationStatus.Success,this._notification.publish())},t.prototype._notifyFailure=function(){!this._notification||(this._dataContext.isContinuousDeploymentConfigured()?(this.enabled(!0),this._notification.title=e.disconnectCIFailureTitle,this._notification.status=i.Hubs.Notifications.NotificationStatus.Error,this._notification.description=e.disconnectCIScmUpdateFailureDescription):(this._notification.title=e.disconnectCIWarningTitle,this._notification.status=i.Hubs.Notifications.NotificationStatus.Warning,this._notification.description=e.disconnectCITriggerUpdateFailureDescription),this._notification.uri="https://go.microsoft.com/fwlink/?linkid=831312",this._notification.publish())},t})(o.BaseCommandViewModel);t.DisconnectCICommandViewModel=c}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/EditCDCommandViewModel",["require","exports","f","o","$","ReleaseManagement/TypeScript/Utilities/ArmUtils"],(function(n,t,i,r,u,f){"use strict";r.defineProperty(t,"__esModule",{value:!0});var e=(function(n){function t(t,r,u){var f=n.call(this)||this;return f.enabled(!1),f._dataContext=u,f._container=t,f.icon(i.Base.Images.Edit()),f}return __extends(t,n),t.prototype.onInputsSet=function(){var n=this,t=u.Deferred();return f.AppServiceArmApiUtilities.beginGetCDEnabled(this._dataContext).then((function(i){i&&n._updateCommandStatus(i);t.resolve()}),(function(){return t.reject()})),this._dataContext.isContinuousDeploymentConfigured.subscribe(this._container,(function(t){t&&n._updateCommandStatus(t);n.enabled(t)})),t.promise()},t.prototype._updateCommandStatus=function(n){var t=this;this.enabled(n);n&&f.AppServiceArmApiUtilities.beginGetContinuousDeploymentMetadata(this._dataContext).then((function(n){!n.vstsConfiguredCDEndpoint||n.vstsConfiguredCDEndpoint===""||t.navigateUri(n.vstsConfiguredCDEndpoint)}))},t})(i.ViewModels.UriCommand);t.EditCDCommandViewModel=e}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/RefreshDeploymentHistoryCommandViewModel",["require","exports","f","o","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources"],(function(n,t,i,r,u){"use strict";r.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t,r,f){var e=n.call(this)||this;return e._container=t,e._dataContext=f,e.icon(i.Base.Images.Refresh()),e.text(u.refreshCommand),e.enabled(e._dataContext.isContinuousDeploymentConfigured()),e._dataContext.isContinuousDeploymentConfigured.subscribe(e._container,(function(n){e.enabled(n)})),e}return __extends(t,n),t.prototype.onInputsSet=function(){return null},t.prototype.execute=function(){this._dataContext.refreshList(!0)},t})(i.ViewModels.Command);t.RefreshDeploymentHistoryCommandViewModel=f}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/SyncCommandViewModel",["require","exports","f","o","ReleaseManagement/TypeScript/Utilities/ArmUtils","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources","Core/TypeScript/ViewModels/BaseCommandViewModel"],(function(n,t,i,r,u,f,e){"use strict";r.defineProperty(t,"__esModule",{value:!0});var o=(function(n){function t(t,r,u,f){var e=n.call(this,t)||this;return!f||(e._notification=f),e._container=t,e._dataContext=u,e.icon(i.Base.Images.Pending()),e.enabled(e._dataContext.isContinuousDeploymentConfigured()),e._dataContext.isContinuousDeploymentConfigured.subscribe(e._container,(function(n){e.enabled(n)})),e}return __extends(t,n),t.prototype.onInputsSet=function(){return null},t.prototype.execute=function(){this._confirmationMessageBox=new i.ViewModels.Dialogs.MessageBox(f.syncConfirmationMessageTitle,f.syncConfirmationMessageText,4);this.dialog(this._confirmationMessageBox)},t.prototype.dialogClick=function(n){var t=this,r=this.dialog();r===this._confirmationMessageBox&&n===6&&(this._notification?(this._notification.title=f.syncInprogressTitle,this._notification.description=f.syncInprogressDescription,this._notification.status=i.Hubs.Notifications.NotificationStatus.InProgress,this._notification.publish()):this._notification=i.Hubs.Notifications.ClientNotification.publish({title:f.syncInprogressTitle,description:f.syncInprogressDescription,status:i.Hubs.Notifications.NotificationStatus.InProgress}),u.AppServiceArmApiUtilities.beginGetContinuousDeploymentMetadata(this._dataContext).then((function(n){!n.vstsAccountId||!n.vstsProjectId||!n.vstsBuildDefinitionId?t._notifyFailure(f.failedToSyncMissingCDInfo):t._dataContext.webApiManager.beginQueueBuild(n.vstsAccountId,n.vstsBuildDefinitionId,n.vstsProjectId).then((function(i){t._notifySuccess();t._beginPushKuduLogForSync(n,i).then((function(){t._dataContext.refreshList(!0)}))})).catch((function(){t._notifyFailure(f.failedToSyncDescription)}))})))},t.prototype._notifySuccess=function(){!this._notification||(this._notification.title=f.syncSucceededTitle,this._notification.description=f.syncSuccededDescription,this._notification.status=i.Hubs.Notifications.NotificationStatus.Success,this._notification.publish())},t.prototype._notifyFailure=function(n){this.enabled(!0);!this._notification||(this._notification.title=f.failedToSyncTitle,this._notification.description=n,this._notification.status=i.Hubs.Notifications.NotificationStatus.Error,this._notification.publish())},t.prototype._beginPushKuduLogForSync=function(n,t){var r=Q.defer(),u=Date.now().toString(),f="",i="";!n.prodAppDetails||!n.prodAppUri?(f=this._dataContext.appServiceArmManager.appServiceResourceData().id,i=this._dataContext.appServiceArmManager.appServiceResourceData().name,i=this._dataContext.appServiceArmManager.appServiceResourceData().isSlot?i.replace("/","-"):i):(f=n.prodAppUri,i=n.prodAppDetails.appServiceName);var o=t.url,e=o.split("/"),s=e[0]+"//"+e[2]+"/",h={id:u,properties:{id:u,status:4,active:!1,author:"VSTSRM",deployer:"VSTSRM",message:JSON.stringify({type:"Sync",prodAppName:i,buildId:t.id,collectionUrl:s,teamProject:n.vstsProjectId,message:""})}};return this._dataContext.appServiceArmManager.beginPushAppServiceDeploymentLog(h,f,u).then((function(){r.resolve("")}),(function(){r.reject("")})),r.promise},t})(e.BaseCommandViewModel);t.SyncCommandViewModel=o}));__extends=this&&this.__extends||
(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ContinuousIntegrationBladeViewModel",["require","exports","f","o","ko","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources","_generated/Svg"],(function(n,t,i,r,u,f,e){"use strict";r.defineProperty(t,"__esModule",{value:!0});var o=(function(n){function t(t,r,o){var s=n.call(this)||this;return s.websiteResourceUri=u.observable(""),s.title(f.continuousIntegrationBladeTitle),s.icon(i.Base.Images.CustomImageWithOptions(e.Content.Icons.cDTitleImage,{isLogo:!0})),s._dataContext=o,s._dataContext.continuousIntegrationBladeState(null),s._dataContext.continuousIntegrationBladeStateMessage(""),u.reactor(t,(function(){s.contentState(s._dataContext.continuousIntegrationBladeState());s.contentStateDisplayText(s._dataContext.continuousIntegrationBladeStateMessage())})),s}return __extends(t,n),t.prototype.onInputsSet=function(n){return this.websiteResourceUri(n.websiteResourceUri),this._dataContext.appServiceArmManager.setWebSiteResourceUri(this.websiteResourceUri()),this._dataContext.currentResourceUri=this.websiteResourceUri(),null},t})(i.ViewModels.Blade);t.ContinuousIntegrationBladeViewModel=o}));
define("ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ContinuousIntegrationListPartViewModel",["require","exports","f","o","ko","ReleaseManagement/TypeScript/Models/ContinuousIntegrationModel","ReleaseManagement/Data/DeploymentLogData","ReleaseManagement/TypeScript/Resources/ReleaseManagementResources","_generated/Svg","Core/TypeScript/TFS.Core","ReleaseManagement/TypeScript/Utilities/LogHelper","ReleaseManagement/TypeScript/Utilities/ArmUtils","ReleaseManagement/TypeScript/Utilities/ReleaseManagementUtils","ReleaseManagement/TypeScript/Utilities/ValidationUtils","ReleaseManagement/TypeScript/Converters/ContinuousIntegrationModelToWebApiConverter","ReleaseManagement/TypeScript/Utilities/Utils","ReleaseManagement/TypeScript/Service/ServiceConstants"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";r.defineProperty(t,"__esModule",{value:!0});var b=i.Base.Diagnostics.Telemetry,k=i.ViewModels.Controls.InfoBox,d=(function(){function n(n,t,r){var e=this,s;this.activityLogHeader=u.observable(o.activityLogHeader);this.landingBladeHeader=u.observable();this.landingBladePointers=u.observableArray([]);this.landingBladePara=u.observableArray([]);this.landingBladeIcon=u.observable();this.scmQueryInProgress=u.observable(!0);this.operationInProgress=u.observable(!1);this.activeDeploymentFound=u.observable(!1);this.cdIcon=u.observable();this._deploymentMetadata={};this._isLinuxAppService=u.observable(!1);this._isImageSourceBuiltin=u.observable(!0);this._enableCD=u.observable(!0);this._hasAzurePermissions=u.observable(!0);this._refreshTime=5e3;this._container=n;this._dataContext=r;this._activityDetailsLog=u.observableArray([]);this.activeDeploymentLog=u.observable({});this.currentAppName=u.observable("");this.scmType=u.observable(f.ScmType.None);this.fetchLogsPromises=[];this.infoBoxViewModel=new k.ViewModel(this._container,null);this.infoBoxViewModel.text=u.observable(o.infoBoxKuduConfiguredText);this.infoBoxViewModel.image=u.observable(i.Base.Images.Polychromatic.Info());this._dataContext.isContinuousDeploymentConfigured(!1);this.selector=new i.ViewModels.Forms.Selector.ViewModel(this._container);this.selector.selectable=i.ViewModels.Part.createSelectableViewModel();this.selector.selectable.selectedValue({detailBlade:"SetupContinuousIntegrationBlade",detailBladeInputs:{}});this.cdButton=new i.ViewModels.Controls.SimpleButton.ViewModel(this._container,{disabled:!1,primary:!0,text:o.configureLabel,onClick:function(){e.selector.selectable.isSelected(!0)}});u.reactor(this._container,(function(){e.cdButton.disabled(!e._enableCD())}));this._dataContext.continuousIntegrationBladeState.subscribe(this._container,(function(n){n===1?(e._dataContext.continuousIntegrationBladeState(null),e._dataContext.continuousIntegrationBladeStateMessage(""),e._initialize().then((function(){return e.operationInProgress(!1)}))):n===5?e.operationInProgress(!0):n===3&&e._initialize().then((function(){return e.operationInProgress(!1)}))}));this._dataContext.isContinuousDeploymentConfigured.subscribe(n,(function(n){n||e._initialize()}));s=new f.SetupCDData;this._setUpCDButton();this._setUpGrid();u.reactor(n,(function(){if(e._isLinuxAppService()){var n="Registry";e._isImageSourceBuiltin()&&(n="Builtin");e.selector.selectable.selectedValue({detailBlade:"LinuxAppServiceSetupBlade",detailBladeInputs:{websiteResourceUri:e.websiteUri,imageSource:n}})}}))}return n.prototype._initializeLandingBladeContent=function(){this.landingBladePointers([]);this.landingBladePara([]);this.scmType()==f.ScmType.None?(this._enableCD(!0),this.landingBladeHeader(o.landingBladeHeader),this._isLinuxAppService()?this.landingBladePointers.push({icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladePointer1},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladePointer3},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladePointer4}):this.landingBladePointers.push({icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladePointer1},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladePointer2},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladePointer3},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladePointer4})):(this.landingBladeHeader(o.landingBladeKuduConfiguredHeader),this.landingBladePointers.push({icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladeKuduConfiguredPointer1},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladeKuduConfiguredPointer2},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladeKuduConfiguredPointer3},{icon:i.Base.Images.StatusBadge.Success(),text:o.landingBladeKuduConfiguredPointer4}),this._enableCD(!1));this._isLinuxAppService()?(this._isImageSourceBuiltin()?this.landingBladePara.push(o.landingPageParaForBuiltinImagesInLinuxWebApp):this.landingBladePara.push(o.landingBladePara1ForLinuxWebApp,o.landingBladePara2ForLinuxWebApp,o.landingBladePara3ForLinuxWebApp),this.landingBladeIcon(s.Content.Icons.code_Build_Deploy)):(this.landingBladePara.push(o.landingBladePara1,o.landingBladePara2),this.landingBladeIcon(s.Content.Icons.code_Build_Test_Deploy))},n.prototype._setUpCDButton=function(){var n=this;this.selector.selectable.selectedValue({detailBlade:"SetupContinuousIntegrationBlade",detailBladeInputs:{}});this.setupContinuousIntegrationCollector=new i.ViewModels.ParameterCollector(this._container,{selectable:this.selector.selectable,supplyInitialData:function(){return new f.SetupCDData},receiveResult:function(t){n.setupContinuousIntegration(t)}})},n.prototype._setUpGrid=function(){var n=this,t,r;this._dataContext.refreshList.subscribe(this._container,(function(t){t&&(n._updateGrid(),n._dataContext.refreshList(!1))}));this.deploymentLogGridViewModel=new i.ViewModels.Controls.Lists.Grid.ViewModel(this._container,u.observableArray([]),i.ViewModels.Controls.Lists.Grid.Extensions.Groupable,{groupable:{groupKey:u.observable("date"),headerFormat:i.ViewModels.Controls.Lists.Grid.Format.ShortDate,sortOrder:u.observable(2),sortFunction:i.ViewModels.Controls.Lists.Grid.SortFunction.DateTime}});this.deploymentLogGridViewModel.noRowsMessage(o.deploymentLogGridLoadingMessage);this._prodAppLogsView=this._initializeQueryView();this.deploymentLogGridViewModel.items=this._activityDetailsLog;this.deploymentLogGridViewModel.showHeader=!1;t="<div style='display:inline-block;vertical-align:middle;margin-right:10px;'>   <span data-bind='image:settings.item.icon' style='display:inline-block;width:18px;height:18px;'><\/span><\/div><div style='display:inline-block;vertical-align:middle;margin:5px;'>   <b><p data-bind='text:settings.item.message' style='margin:0;'><\/p><\/b>      <p data-bind='foreach: settings.item.urlInfo()' style='margin:0;'>           <!-- ko if: $data.urlIcon -->           <span data-bind='image:urlIcon' style='display:inline-block;width:10px;height:10px;margin-right:1px;'><\/span>           <!-- /ko -->           <a data-bind='attr:{href:url}' target= '_blank'>               <span data-bind='text:urlText' style= 'margin-right:10px;'><\/span>           <\/a>       <\/p><\/div> ";r=[{itemKey:"id",name:u.observable(o.deploymentLogGridActivityDetailsLabel),width:u.observable("80%"),format:i.ViewModels.Controls.Lists.Grid.Format.HtmlBindings,formatOptions:{htmlBindingsTemplate:t}},{itemKey:"time",name:u.observable(o.deploymentLogGridTimeLabel),width:u.observable("20%"),format:i.ViewModels.Controls.Lists.Grid.Format.ShortTime}];this.deploymentLogGridViewModel.columns=u.observableArray(r)},n.prototype.onInputsSet=function(n){n.websiteUri&&(this.websiteUri=n.websiteUri);try{if(this._dataContext.continuousIntegrationBladeState()!==5)return Q.all([this._initialize()])}catch(t){c.LogHelper.LogError(t)}},n.prototype._initializeQueryView=function(){var n=this,t=e.DeploymentDataQueryHelper.createView(this._container);return t._interceptNotFound=function(t){n._dataContext.continuousIntegrationBladeState(2);n._dataContext.continuousIntegrationBladeStateMessage(o.failedToFetchDeploymentLogsMessage.format(t.webAppResourceUri))},t},n.prototype._initialize=function(){var n=this;return this._dataContext.appServiceArmManager.clearAppServiceResourceData(),this._dataContext.appServiceArmManager.fetchAppServiceResourceData().then((function(){var t=n._dataContext.appServiceArmManager.appServiceResourceData();return n._isLinuxAppService(t.properties.reserved),n._dataContext.appServiceArmManager.beginGetAppServiceSiteConfig().then((function(t){t.properties.linuxFxVersion.split("|")[0]=="DOCKER"&&n._isImageSourceBuiltin(!1);n.scmQueryInProgress(!1);t.properties.scmType==="VSTSRM"?(b.trace({source:"ContinuousIntegrationListPartViewModel",action:"ScmType-VSTSRM"}),n.scmType(f.ScmType.VSTSRM),n._dataContext.isContinuousDeploymentConfigured(!0),n._setAppNamesFromMetadata()):t.properties.scmType==="None"?(b.trace({source:"ContinuousIntegrationListPartViewModel",action:"ScmType-None"}),n.scmType(f.ScmType.None)):(b.trace({source:"ContinuousIntegrationListPartViewModel",action:"ScmType-Kudu"}),n.scmType(f.ScmType.Kudu));n._initializeLandingBladeContent()}),(function(){c.LogHelper.LogError("Error fetching app service type")}))}))},n.prototype._validateAzurePermissions=function(){var n=this;return Q.spread([v.ValidationUtils.isSubscriptionEnabled(p.ResourceUriHelper.getSubscriptionIdFromUri(this.websiteUri)),v.ValidationUtils.hasRoleAssignmentPermissionsAtScope(this.websiteUri),v.ValidationUtils.canCreateAadApp()],(function(t,i,r){t&&i&&!r||(n._dataContext.continuousIntegrationBladeState(3),n._hasAzurePermissions(!1));t?r?(n._dataContext.continuousIntegrationBladeStateMessage(r),b.trace({source:"ContinuousIntegrationListPartViewModel",action:"NoPermissionToCreateApp-WebAppService"})):i||(n._dataContext.continuousIntegrationBladeStateMessage(o.noPermissionsToAssignRoles),b.trace({source:"ContinuousIntegrationListPartViewModel",action:"NoPermissionToAssignRoles-WebAppService"})):(n._dataContext.continuousIntegrationBladeStateMessage(o.subscriptionNotEnabled),b.trace({source:"ContinuousIntegrationListPartViewModel",action:"SubscriptionNotEnabled-WebAppService"}))}),(function(){c.LogHelper.LogWarning(o.failedToValidateAzurePermissions)}))},n.prototype.setupContinuousIntegration=function(n){var t=this,i;return c.LogHelper.LogInfo("_setupContinuousIntegration: Entered setup CD method"),this._dataContext.continuousIntegrationBladeState(5),this._dataContext.continuousIntegrationBladeStateMessage(o.validatingPermissions),this._hasAzurePermissions(!0),i=Q.defer(),this._validateAzurePermissions().then((function(){if(t._hasAzurePermissions())return t._dataContext.continuousIntegrationBladeStateMessage(o.cDInProgressMessage),t._dataContext.appServiceArmManager.fetchAppServiceResourceData().then((function(){return t.setupContinuousDeliveryV2(n,t._dataContext.appServiceArmManager.appServiceResourceData())})).then((function(){t._dataContext.continuousIntegrationBladeState(1);t._dataContext.continuousIntegrationBladeStateMessage(o.cDSuccessNotificationMessage);i.resolve()}),(function(n){t._dataContext.continuousIntegrationBladeState(3);t._dataContext.continuousIntegrationBladeStateMessage(n);i.resolve()}));i.resolve()})).catch((function(n){t._dataContext.continuousIntegrationBladeState(3);t._dataContext.continuousIntegrationBladeStateMessage(n);i.resolve()})),i.promise},n.prototype.setupContinuousDeliveryV2=function(n,t){var i=this;b.trace({source:"ContinuousIntegrationListPartViewModel",action:"CDSetupJobBegin"});var r=Q.defer(),u=y.provisioningConfigurationConverter.getProvisioningConfiguration(n,t),f=this.getOrCreateAccount(n,t.subscriptionId);return Q.all([u,f]).spread((function(n,t){i._dataContext.webApiManager.beginCreateProvisioningConfiguration(i._dataContext,n,t).then((function(n){b.trace({source:"ContinuousIntegrationListPartViewModel",action:"CDSetupJobQueued"});i._dataContext.notificationsHelper.publishInProgressNotification(t,i._dataContext.appServiceArmManager.getWebSiteResourceUri());i.monitorContinuousDeliveryConfigurationJob(t,n.id).then(r.resolve,r.reject)}),(function(n){c.LogHelper.LogError("ContinuousIntegrationListPartViewModel::setupContinuousDeliveryV2: Failed to queue the job. Error: "+n);b.trace({source:"ContinuousIntegrationListPartViewModel",action:"SetupCDJobCallFailed"});r.reject(o.setupCDJobCallFailedWithError.format(n))}))}),(function(n){c.LogHelper.LogError("ContinuousIntegrationListPartViewModel::setupContinuousDeliveryV2: Failed to create account or send payload. Error: "+n);b.trace({source:"ContinuousIntegrationListPartViewModel",action:"SetupCDJobCallFailed"});r.reject(n)})),r.promise},n.prototype.monitorContinuousDeliveryConfigurationJob=function(n,t){var u=this,r=Q.defer();return this._dataContext.webApiManager.beginGetProvisioningConfiguration(t,n).then((function(f){if(f.ciConfiguration&&f.ciConfiguration.result){if(f.ciConfiguration.result.status.toString()=="succeeded")return u._dataContext.notificationsHelper.updateNotification(o.cDSuccessNotificationMessage,i.Hubs.Notifications.NotificationStatus.Success),b.trace({source:"ContinuousIntegrationListPartViewModel",action:"SetupCDJobPassed"}),r.resolve("");if(f.ciConfiguration.result.status.toString()=="failed"||f.ciConfiguration.result.status.toString()=="cancelled"){u._dataContext.notificationsHelper.updateNotification(o.cDFailedNotificationMessage,i.Hubs.Notifications.NotificationStatus.Error);var e=o.cDFailedNotificationMessage;return e=e.concat(f.ciConfiguration.result.statusMessage?". {0} {1}".format(o.errorLabel,f.ciConfiguration.result.statusMessage):""),c.LogHelper.LogError("ContinuousIntegrationListPartViewModel::monitorContinuousDeliveryConfigurationJob: Job failed. Error: "+e),b.trace({source:"ContinuousIntegrationListPartViewModel",action:"SetupCDJobFailed"}),r.reject(e)}}setTimeout((function(){u.monitorContinuousDeliveryConfigurationJob(n,t).then(r.resolve,r.reject)}),u._refreshTime)}),(function(n){return c.LogHelper.LogError("ContinuousIntegrationListPartViewModel::monitorContinuousDeliveryConfigurationJob: Get failed. Error: "+n),b.trace({source:"ContinuousIntegrationListPartViewModel",action:"SetupCDGetCallFailed"}),r.reject(n)})),r.promise},n.prototype.getOrCreateAccount=function(n,t){var r=Q.defer(),u=!1,e,o,i=null;if(n.sourceConfiguration().sourceProviderType()===f.ProviderType.VSTS)i=n.sourceConfiguration().account();else{if(n.buildConfiguration&&n.buildConfiguration()&&n.buildConfiguration().createNewAccount()?(u=!0,e=n.buildConfiguration().ciAccount(),o=n.buildConfiguration().location()):n.teamConfiguration&&n.teamConfiguration()&&n.teamConfiguration().createNewAccount()&&(u=!0,e=n.teamConfiguration().ciAccount(),o=n.teamConfiguration().location()),u)return a.ReleaseManagementUtils.createVSTSAccount(e,t,o.regionCode,w.CustomerIntelligenceEntryPoint.IbizaCD);n.buildConfiguration&&n.buildConfiguration()?i=n.buildConfiguration().selectedAccount():n.teamConfiguration&&n.teamConfiguration()&&(i=n.teamConfiguration().selectedAccount())}return i?r.resolve(i.name()):(c.LogHelper.LogError("Could not resolve the account to configure Continuous delivery."),r.reject("Could not resolve the account to configure Continuous delivery.")),r.promise},n.prototype._setAppNamesFromMetadata=function(){var n=this;try{return this._dataContext.appServiceArmManager.fetchAppServiceResourceData().then((function(){var t=l.AppServiceArmApiUtilities.getAppServiceNameDetails(n._dataContext.appServiceArmManager.appServiceResourceData().name),i=n._dataContext.appServiceArmManager.appServiceResourceData().isSlot,r=l.AppServiceArmApiUtilities.getAppServiceBaseUri(n._dataContext.appServiceArmManager.appServiceResourceData().id,i);n._deploymentMetadata.prodAppDetails=t;n._deploymentMetadata.prodAppUri=l.AppServiceArmApiUtilities.getAppServiceUri(r,n._deploymentMetadata.prodAppDetails);i?n.currentAppName(t.appServiceSlotName):n.currentAppName(o.productionAppLabel);l.AppServiceArmApiUtilities.beginGetContinuousDeploymentMetadata(n._dataContext).then((function(i){i.prodAppDetails&&(n._deploymentMetadata=i,n._deploymentMetadata.slotAppName&&(n._slotView=n._initializeQueryView()),n._deploymentMetadata.testAppName?(n._testAppView=n._initializeQueryView(),n.cdIcon(s.Content.Icons.code_Build_Test_Deploy),h.StringUtils.ignoreCaseComparer(t.appServiceName,n._deploymentMetadata.testAppName)==0&&n.currentAppName(t.appServiceName)):n.cdIcon(s.Content.Icons.code_Build_Deploy));n._updateGrid()}),(function(){c.LogHelper.LogError("Error fetching app service metadata");n._dataContext.continuousIntegrationBladeState(2);n._dataContext.continuousIntegrationBladeStateMessage(o.errorFetchingMetadataMessage.format(n._dataContext.appServiceArmManager.appServiceResourceData().name));n._updateGrid()}))}))}catch(t){throw new Error(t);}},n.prototype._updateGrid=function(){var t=this,n;try{this._activityDetailsLog([]);this.deploymentLogGridViewModel.noRowsMessage(o.deploymentLogGridLoadingMessage);n=[];this.fetchLogsPromises=[];this.activeDeploymentFound(!1);this._deploymentMetadata.prodAppDetails&&n.push(this._refreshProdAppLogs());this._deploymentMetadata.slotAppName&&n.push(this._refreshSlotLogs());this._deploymentMetadata.testAppName&&n.push(this._refreshTestAppLogs());Q.all(n).then((function(){Q.all(t.fetchLogsPromises).then((function(){var n,i;t.deploymentLogGridViewModel.noRowsMessage(o.deploymentLogGridNoRowsMessage);t.activeDeploymentLog().id==undefined&&(n=u.observableArray([]),n.push({urlIcon:u.observable(s.Content.Icons.cD_Build),urlText:u.observable("--"),url:u.observable("")},{urlIcon:u.observable(s.Content.Icons.cD_Release),urlText:u.observable("--"),url:u.observable("")}),i={id:u.observable((new Date).toDateString()),icon:u.observable({}),date:u.observable(new Date),time:u.observable(new Date),message:u.observable(""),urlInfo:n},t.activeDeploymentLog(i))}))}))}catch(i){c.LogHelper.LogError("Error in _updateGrid"+i)}},n.prototype._refreshProdAppLogs=function(){var n=this;return this._prodAppLogsView.refresh().then((function(){n.fetchLogsPromises.push(n._prodAppLogsView.fetch({webAppResourceUri:n._deploymentMetadata.prodAppUri}).then((function(){var t=n._deploymentMetadata.prodAppDetails.appServiceSlotName?n._deploymentMetadata.prodAppDetails.appServiceSlotName:o.productionAppLabel;n._populateActivityDetails(n._prodAppLogsView,t)})))}))},n.prototype._refreshSlotLogs=function(){var n=this;return this._slotView.refresh().then((function(){n.fetchLogsPromises.push(n._slotView.fetch({webAppResourceUri:n._deploymentMetadata.slotAppUri}).then((function(){n._populateActivityDetails(n._slotView,n._deploymentMetadata.slotAppName)})))}))},n.prototype._refreshTestAppLogs=function(){var n=this;return this._testAppView.refresh().then((function(){n.fetchLogsPromises.push(n._testAppView.fetch({webAppResourceUri:n._deploymentMetadata.testAppUri}).then((function(){n._populateActivityDetails(n._testAppView,n._deploymentMetadata.testAppName)})))}))},n.prototype._populateActivityDetails=function(n,t){for(var i,c,v,u,a=n.items(),r=this._activityDetailsLog(),s=0;s<a.length;s++)if(i=a[s],h.StringUtils.ignoreCaseComparer(i.deployer.peek(),"vsts")==0&&(i.status.peek()==3||i.status.peek()==4)){if(c=new Date(i.end_time.peek()),v=i.message.peek(),this._isMessageFormatJSON(v)){var e=t,o=JSON.parse(i.message.peek()),l=this._assignLogType(o.type);if(l===f.KuduLogMessageType.Other)continue;l===f.KuduLogMessageType.CDDisconnect?e=o.prodAppName:h.StringUtils.ignoreCaseComparer(e,this._deploymentMetadata.testAppName)!=0&&(e=o.slotName);u=this._createDeploymentLogFromJSONMessage(i,o,c,l,e)}else u=this._createDeploymentLogFromStringMessage(i,c);r.first((function(n){return n.id()===u.id()}))||r.push(u);i.active.peek()&&t==this.currentAppName()&&(this.activeDeploymentLog(this._getActiveDeployment(u)),this.activeDeploymentFound(!0))}r=r.sort((function(n,t){return t.time().valueOf()-n.time().valueOf()}));this._activityDetailsLog(r)},n.prototype._getActiveDeployment=function(n){return{id:n.id,icon:n.icon,date:n.date,time:n.time,message:n.message,urlInfo:this._getUrlInfoForActiveDeployment(n.urlInfo)}},n.prototype._getUrlInfoForActiveDeployment=function(n){for(var i=u.observableArray([]),t=0;t<n().length;t++)(n()[t].urlText.peek().search("Build")!=-1||n()[t].urlText.peek().search("Release")!=-1)&&i.push(n()[t]);return i},n.prototype._isMessageFormatJSON=function(n){try{JSON.parse(n)}catch(t){return!1}return!0},n.prototype._assignLogType=function(n){n=n.toLowerCase();switch(n){case"deployment":return f.KuduLogMessageType.Deployment;case"slotswap":return f.KuduLogMessageType.SlotSwap;case"cddeploymentconfiguration":return f.KuduLogMessageType.CDDeploymentConfiguration;case"localgitcdconfiguration":return f.KuduLogMessageType.LocalGitCdConfiguration;case"cdslotcreation":return f.KuduLogMessageType.CDSlotCreation;case"cdaccountcreated":return f.KuduLogMessageType.CDAccountCreated;case"cdtestwebappcreation":return f.KuduLogMessageType.CDTestWebAppCreation;case"cddisconnect":return f.KuduLogMessageType.CDDisconnect;case"sync":return f.KuduLogMessageType.Sync;case"start azure app service":return f.KuduLogMessageType.StartAzureAppService;case"stop azure app service":return f.KuduLogMessageType.StopAzureAppService;case"restart azure app service":return f.KuduLogMessageType.RestartAzureAppService;default:return f.KuduLogMessageType.Other}},n.prototype._createDeploymentLogFromJSONMessage=function(n,t,r,f,e){return{id:u.observable(n.id.peek()),icon:u.observable(n.status.peek()===4?i.Base.Images.StatusBadge.Success():i.Base.Images.StatusBadge.Failed()),date:u.observable(new Date(r.getFullYear(),r.getMonth(),r.getDate())),time:u.observable(r),message:u.observable(this._getMessage(t,n.status.peek(),f,e)),urlInfo:this._getUrlInfoFromJSONMessage(t)}},n.prototype._createDeploymentLogFromStringMessage=function(n,t){var r=n.message.peek();return{id:u.observable(n.id.peek()),icon:u.observable(n.status.peek()===4?i.Base.Images.StatusBadge.Success():i.Base.Images.StatusBadge.Failed()),date:u.observable(new Date(t.getFullYear(),t.getMonth(),t.getDate())),time:u.observable(t),message:u.observable(n.status.peek()===4?o.deploymentSuccessMessage:o.deploymentFailedMessage),urlInfo:this._getUrlInfoFromStringMessage(r)}},n.prototype._getUrlInfoFromStringMessage=function(n){var t=u.observableArray([]);return n.search("buildId")!=-1&&t.push({urlIcon:u.observable(s.Content.Icons.cD_Build),urlText:u.observable(o.continuousIntegrationListPartBuildLink.format(n.substring(n.search("=")+1,n.search("&")))),url:u.observable(n.substr(n.search("https")))}),n.search("releaseId")!=-1&&t.push({urlIcon:u.observable(s.Content.Icons.cD_Release),urlText:u.observable(o.continuousIntegrationListPartReleaseLink.format(n.substring(n.search("=")+1,n.search("&")))),url:u.observable(n.substr(n.search("https")))}),t},n.prototype._getUrlInfoFromJSONMessage=function(n){var t=u.observableArray([]),i,r,f;return n.commitId&&(i=this._getCommitUrl(n),i&&t.push({urlIcon:u.observable(s.Content.Icons.cD_Commit),urlText:u.observable(o.continuousIntegrationListPartSourceVersionLink.format(n.commitId.substr(0,10))),url:u.observable(i)})),n.buildNumber&&(r=this._getBuildUrl(n),r&&t.push({urlIcon:u.observable(s.Content.Icons.cD_Build),urlText:u.observable(o.continuousIntegrationListPartBuildLink.format(n.buildNumber)),url:u.observable(r)})),n.releaseId&&(f=this._getReleaseUrl(n),f&&t.push({urlIcon:u.observable(s.Content.Icons.cD_Release),urlText:u.observable(o.continuousIntegrationListPartReleaseLink.format(n.releaseId)),url:u.observable(f)})),n.VSTSRM_BuildDefinitionWebAccessUrl&&t.push({urlText:u.observable(o.continuousIntegrationListPartBuildDefinitionLink),url:u.observable(n.VSTSRM_BuildDefinitionWebAccessUrl)}),n.VSTSRM_ConfiguredCDEndPoint&&t.push({urlText:u.observable(o.continuousIntegrationListPartReleaseDefinitionLink),url:u.observable(n.VSTSRM_ConfiguredCDEndPoint)}),n.VSTSRM_BuildWebAccessUrl&&t.push({urlText:u.observable(o.continuousIntegrationListPartBuildTriggeredLink),url:u.observable(n.VSTSRM_BuildWebAccessUrl)}),n.AppUrl&&t.push({urlText:u.observable(o.continuousIntegrationListPartWebAppLink),url:u.observable(n.AppUrl)}),n.SlotUrl&&t.push({urlText:u.observable(o.continuousIntegrationListPartSlotLink),url:u.observable(n.SlotUrl)}),n.VSTSRM_AccountUrl&&t.push({urlText:u.observable(o.continuousIntegrationListPartVstsAccountLink),url:u.observable(n.VSTSRM_AccountUrl)}),n.VSTSRM_RepoUrl&&t.push({urlText:u.observable(o.continuousIntegrationListPartRepositoryUrlLink),url:u.observable(n.VSTSRM_RepoUrl)}),t},n.prototype._getMessage=function(n,t,i,r){r=r?r:n.slotName;switch(i){case f.KuduLogMessageType.Deployment:return t===4?"{0} to {1}".format(o.deploymentSuccessMessage,r):"{0} to {1}".format(o.deploymentFailedMessage,r);case f.KuduLogMessageType.SlotSwap:return t===4?"{0} {1} with {2}".format(o.slotSwapSuccessMessage,n.sourceSlot,n.targetSlot):"{0} {1} with {2}".format(o.slotSwapFailureMessage,n.sourceSlot,n.targetSlot);case f.KuduLogMessageType.CDDeploymentConfiguration:return t===4?o.successfulySetupCDMessage:o.setupCDFailedMessage;case f.KuduLogMessageType.LocalGitCdConfiguration:return o.successfullySetupCDWithoutTriggeringBuildMessage;case f.KuduLogMessageType.CDAccountCreated:return t===4?o.vSTSAccountCreationSuccessMessage:o.vSTSAccountCreationFailedMessage;case f.KuduLogMessageType.CDSlotCreation:return t===4?o.slotCreationSuccessMessage:o.slotCreationFailedMessage;case f.KuduLogMessageType.CDTestWebAppCreation:return t===4?o.testAppCreationSuccessMessage:o.testAppCreationFailedMessage;case f.KuduLogMessageType.CDDisconnect:return o.cDDisconnectMessage.format(r);case f.KuduLogMessageType.StartAzureAppService:return t===4?o.startAzureAppServiceSuccessMessage.format(r):o.startAzureAppServiceFailedMessage.format(r);case f.KuduLogMessageType.StopAzureAppService:return t===4?o.stopAzureAppServiceSuccessMessage.format(r):o.stopAzureAppServiceFailedMessage.format(r);case f.KuduLogMessageType.RestartAzureAppService:return t===4?o.restartAzureAppServiceSuccessMessage.format(r):o.restartAzureAppServiceFailedMessage.format(r);case f.KuduLogMessageType.Sync:return o.syncSuccededDescription;default:return""}},n.prototype._getBuildUrl=function(n){return n.buildId!=null?"{0}{1}/_build?buildId={2}&_a=summary".format(n.collectionUrl,n.teamProject,n.buildId):""},n.prototype._getReleaseUrl=function(n){return n.releaseId!=null?"{0}{1}/_apps/hub/ms.vss-releaseManagement-web.hub-explorer?releaseId={2}&_a=release-summary".format(n.collectionUrl,n.teamProject,n.releaseId):""},n.prototype._getCommitUrl=function(n){if(n.commitId!=null){var t=n.repoProvider.toLowerCase();switch(t){case"tfsgit":return"{0}{1}/_git/{2}/commit/{3}".format(n.collectionUrl,n.teamProject,n.repoName,n.commitId);case"tfsversioncontrol":return"{0}{1}/_versionControl/changeset/{2}".format(n.collectionUrl,n.teamProject,n.commitId);default:return""}}return""},n})();t.ContinuousIntegrationListPartViewModel=d}));
define("_generated/Blades/ContinuousIntegrationBlade",["require","exports","f","_generated/Blades/VersionControl.css","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ContinuousIntegrationBladeViewModel","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/ContinuousIntegrationListPartViewModel","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/RefreshDeploymentHistoryCommandViewModel","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/DisconnectCICommandViewModel","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/EditCDCommandViewModel","ReleaseManagement/TypeScript/ViewModels/ContinuousIntegration/Commands/SyncCommandViewModel"],(function(n,t,i,r){"use strict";var u;return (function(n){n.blade={name:"ContinuousIntegrationBlade",inputs:["websiteResourceUri"],templateKeyInputs:["websiteResourceUri"],commandGroup:"ContinuousIntegrationBladeCommands",viewModelName:"ReleaseManagement$ContinuousIntegrationBladeViewModel",lenses:[{name:"ContinuousIntegrationList",partInstances:[{name:"ContinuousIntegrationListPart",inline:{styleSheets:[{file:"Blades/VersionControl.css",content:r}],viewModel:"ReleaseManagement$ContinuousIntegrationListPartViewModel",partKind:0,inputs:["websiteUri"],bindings:[{property:"websiteUri",valuesFrom:[{referenceType:3,property:"content.websiteResourceUri"}]}],details:[{asSubJourney:!0,invocationInputArguments:[{valuesFrom:[{referenceType:0,property:"content.selector.selectable"}]}],parameterCollector:"content.setupContinuousIntegrationCollector"}],initialSize:8,supportedSizes:[8],htmlTemplateInline:{file:"LandingPage.html",content:"<!-- ko if: scmQueryInProgress() || operationInProgress()  --> <div data-bind=\"image: MsPortalFx.Base.Images.Loading.EllipsisSquare()\" style=\"width: 40px; margin: 0px auto\"> <\/div> <!-- /ko --> <!-- ko if: !scmQueryInProgress() && !operationInProgress()  --> <!-- ko if: scmType() != 1 --> <div> <!-- ko if: scmType() == 2 --> <div data-bind=\"pcControl: infoBoxViewModel\"><\/div> <br/> <!-- /ko --> <b><p data-bind=\"text:landingBladeHeader\" style=\"font-size:large;\"><\/p><\/b> <div data-bind=\"foreach: landingBladePointers\"> <span data-bind='image:icon' style='display:inline-block;vertical-align:middle;width:18px;height:18px;margin-right:5px;'><\/span> <p data-bind='text:text' style='display:inline-block;vertical-align:middle;margin:5px;'><\/p><br/> <\/div> <p data-bind=\"image:landingBladeIcon\" style='display:block;width:400px;height:60px;margin-left:auto;margin-right:auto;margin-top:50px;margin-bottom:50px;'><\/p> <div data-bind=\"foreach: landingBladePara\"> <p data-bind=\"text: $data\"><\/p> <\/div> <div data-bind=\"pcControl: cdButton\" style=\"margin-top: 5%;\"><\/div> <\/div> <!-- /ko --> <!-- ko if: scmType() == 1 --> <div> <div> <!-- ko if: cdIcon --> <div data-bind=\"image:cdIcon\" style=\"display:inline-block;vertical-align:middle;height: 75px;\"> <\/div> <!-- /ko --> <!-- ko if: activeDeploymentLog().id --> <div style=\"display:inline-block;vertical-align:middle;right:5%;position:absolute;\"> <!-- ko if: activeDeploymentFound() --> <div style='display:inline-block;vertical-align:middle;margin-right:10px;'> <span data-bind='image:activeDeploymentLog().icon' style='display:inline-block;width:24px;height:24px;'><\/span> <\/div> <!-- /ko --> <div style='display:inline-block;vertical-align:middle;margin:5px;'> <b><p data-bind='text:currentAppName' style='font-weight:bold;margin:0;'><\/p><\/b> <p data-bind='foreach: activeDeploymentLog().urlInfo' style='margin:0;'> <span data-bind='image: urlIcon' style='display:inline-block;width:10px;height:10px;margin-right:5px;'><\/span> <a data-bind='attr: {href :url}' target='_blank'> <span data-bind='text: urlText' style='margin-right:10px;'><\/span> <\/a> <\/p> <\/div> <\/div> <!-- /ko --> <\/div> <br/> <p data-bind=\"text: activityLogHeader\" class=\"msportalfx-text-header-regular\"><\/p> <div style=\"clear:left\" data-bind='pcControl: deploymentLogGridViewModel'><\/div> <\/div> <!-- /ko --> <!-- /ko --> "}}}]}],viewModelInputs:[{property:"websiteResourceUri",valuesFrom:[{referenceType:1,property:"websiteResourceUri"}]}],width:1,locked:!0,pinnable:!1,attributes:0}})(u||(u={})),u}))