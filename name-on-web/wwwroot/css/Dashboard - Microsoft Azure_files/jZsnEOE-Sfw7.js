define("Core/TypeScript/TFS.Proxy",["require","exports","f","o","$","Core/TypeScript/TFS.Azure.Context","Core/TypeScript/TFS.Core"],(function(n,t,i,r,u,f,e){"use strict";r.defineProperty(t,"__esModule",{value:!0});var o=(function(){function n(){}return n.getProxyContentWindow=function(t){var i=n.getOrigin(t);return n._cachedProxyPromises[i]||(n._cachedProxyPromises[i]=n.createIframe(i)),n._cachedProxyPromises[i]},n.getProxyAntiForgeryTokenValue=function(t){var i=n.getOrigin(t),r=n.getIframeId(i);return n._cachedTokens[r]},n.getProxyAntiForgeryTokenValue2=function(t){var i=n.getOrigin(t),r=n.getIframeId(i);return n._cached2Tokens[r]},n.createIframe=function(t){return u.Deferred((function(r){var o,e,s=n.getIframeId(t),h=n.getProxyUrl(t);h&&f.isHosted()?(o=u("<div />").addClass("proxy-iframe-host-container"),u("body").append(o),e=u("<iframe frameborder='0' src=\"javascript:''\" />").addClass("extension-iframe").attr("id",s).attr("name",s).attr("src",h),e.load((function(){i.Base.Security.getAuthorizationToken().then((function(u){var f={type:"GET",beforeSend:function(n){n.setRequestHeader("Authorization",u.header);i.sessionId&&n.setRequestHeader("X-TFS-Session",i.sessionId)},xhr:function(){return new e[0].contentWindow.XMLHttpRequest},dataType:"html",traditional:!0};n.fetchTokens(r,e,t,f)}))})),e.appendTo(o)):n.fetchTokens(r,null,t,{type:"GET",dataType:"html",traditional:!0})})).promise()},n.fetchTokens=function(t,i,r,f){var e=n.getTokenUrl(r);e?jQuery.ajax(e,f).done((function(t){n._cachedTokens[n.getIframeId(r)]=u(t).find("input[name='__RequestVerificationToken']").attr("value");n._cached2Tokens[n.getIframeId(r)]=u(t).find("input[name='__RequestVerificationToken2']").attr("value")})).always((function(){i?t.resolve(i[0].contentWindow):t.resolve(null)})):t.resolve(null)},n.getOrigin=function(n){var t=e.UrlUtils.URL_REGEX.exec(n);return f.isHosted()?t[0].substr(0,t[0].indexOf(t[9])):"onpremise"},n.getOriginHost=function(n){var t=e.UrlUtils.URL_REGEX.exec(n);return f.isHosted()?t[4]:"onpremise"},n.getOriginPort=function(n){var t=e.UrlUtils.URL_REGEX.exec(n);return f.isHosted()?t[5]:"8080"},n.getProxyUrl=function(t){var i=f.getAzureTfsContext().spsLocation,r=f.getAzureTfsContext().extensionConfiguration.serverUrl;return i&&i.indexOf(t)===0||f.isSpsAccountUrl(t)?t+"/"+n.SPS_PROXY_RELATIVE_PATH:r&&r.indexOf(t)===0?null:t+"/"+n.PROXY_RELATIVE_PATH},n.getTokenUrl=function(t){if(f.isHosted()){var i=f.getAzureTfsContext().spsLocation,r=f.getAzureTfsContext().extensionConfiguration.serverUrl;return i&&i.indexOf(t)===0||f.isSpsAccountUrl(t)?t+"/"+n.SPS_TOKEN_RELATIVE_PATH:r&&r.indexOf(t)===0?null:t+"/"+n.TOKEN_RELATIVE_PATH}return f.getAzureTfsContext().extensionConfiguration.serverUrl+"/"+n.TOKEN_RELATIVE_PATH},n.isPortalExtensionUrl=function(n){var t=f.getAzureTfsContext().extensionConfiguration.serverUrl;return n&&t&&n.indexOf(t)===0?!0:!1},n.getIframeId=function(t){return"proxyHost_"+n.getOriginHost(t)+"_"+n.getOriginPort(t)},n})();o.PROXY_RELATIVE_PATH="_AzureTfsExt/Proxy";o.TOKEN_RELATIVE_PATH="_AzureTfsExt/Token";o.SPS_PROXY_RELATIVE_PATH="_AzureSpsExt/Proxy";o.SPS_TOKEN_RELATIVE_PATH="_AzureSpsExt/Token";o._cachedProxyPromises={};o._cachedTokens={};o._cached2Tokens={};t.ProxyHost=o}));
define("Core/TypeScript/TFS.Core.Ajax",["require","exports","f","o","$","Core/TypeScript/TFS.Core","Core/TypeScript/TFS","Core/TypeScript/TFS.Diag","Core/TypeScript/TFS.Core.Utils","Core/TypeScript/TFS.Proxy","Core/TypeScript/TFS.Azure.Context"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function w(n,t,i,r,u){if(o.logTracePoint("Ajax.response-received",u.requestId),u.isComplete=!0,delete p[u.requestId],r)try{r(n,t,i)}catch(f){o.logTracePoint("Ajax.callback-exception",f);l(f)}o.logTracePoint("Ajax.callback-complete",u.requestId);u.options&&u.options.tracePoint&&o.logTracePoint(u.options.tracePoint)}function it(n,t){return function(i,r,u){w(i,r,u,t,n)}}function rt(n,t){return function(i,r){w(null,r,i,(function(){if(r==="timeout")l(Error.ajaxTimeout(i),t);else if(i.status===0)y||a||f.delay(this,2e3,(function(){y||a||l(Error.network(i),t)}));else if(i.status>=12e3&&i.status<13e3)y||a||l(Error.network(i),t);else{if(a&&r==="abort")return;try{var n=s.parseMSJSON(i.responseText,!1)}catch(u){}n?l(Error.serverError(n),t):l(Error.ajax(i,i.statusText||i.status),t)}}),n)}}function ut(n,t){var i,r;return i={isComplete:!1,requestId:k++,options:t,xhr:undefined},r=n+" ("+i.requestId+")",o.logTracePoint("Ajax.request-started",r),p[i.requestId]=i,i}function ft(n){var t;return typeof n=="string"&&(n=n.replace(/\u2028/g,"\\u2028")),t=s.parseMSJSON(n,!1),o.assert(!u.isArray(t),"Received JSON data from the server which is an array.  Sending JSON arrays from the server leaves us open to JSON Hijacking attacks.  Ensure that the server code is making use of the SecureJsonResult class."),t.hasOwnProperty("__wrappedArray")&&(t=t.__wrappedArray),t}function et(n,t){return this._issueRequest(n,t,!1)}function ot(n,t,r,f,e){var o,s,l;return r===void 0&&(r=!1),f===void 0&&(f=null),e===void 0&&(e=null),t||(t={}),t.type||(t.type="GET"),t.dataType||(t.dataType="json"),o=ut(n,t),o.xhr=u.Deferred(),s=h.ProxyHost.isPortalExtensionUrl(n)||!r&&c.isPortalFeatureEnabled("UseCORS")?u.Deferred().resolve():h.ProxyHost.getProxyContentWindow(n),l=i.Base.Security.getAuthorizationToken(),Q.all([l,s]).spread((function(i,u){i&&i.header?b(o,n,t,i,r,u,f,e):i.then((function(i){i&&i.header&&b(o,n,t,i,r,u,f,e)}))})).fail((function(){console.error("Failed to get Authorization token from the shell")})),o}function b(n,t,r,f,e,o,s,l){var a={beforeSend:function(n){if(c.isHosted())if(i.isFeatureEnabled("canmodifyextensions"))if(!i.getFeatureValue("authTokenOverride"))i.getFeatureValue("bearerTokenOverride")?n.setRequestHeader("Authorization","Bearer "+i.getFeatureValue("bearerTokenOverride")):n.setRequestHeader("Authorization",f.header);else{var u="Basic ",e=":";e=e.concat(i.getFeatureValue("authTokenOverride"));u=u.concat(btoa(e));n.setRequestHeader("Authorization",u)}else n.setRequestHeader("Authorization",f.header);(c.isMsaAccountUrl(t)||r&&r.useMsaPassthrough)&&n.setRequestHeader("X-VSS-ForceMsaPassThrough","true");lt(n)},success:it(n,s),error:rt(n,l),dataType:"json",traditional:!0,timeout:d},v;e&&(r.data=u.extend(r.data||{},{__RequestVerificationToken:h.ProxyHost.getProxyAntiForgeryTokenValue(t)}),v=h.ProxyHost.getProxyAntiForgeryTokenValue2(t),v&&(r.data=u.extend(r.data,{__RequestVerificationToken2:v})));a.converters={"text json":ft};o&&(a.xhr=function(){return new o.XMLHttpRequest});try{jQuery.ajax(t,u.extend(a,r)).then(n.xhr.resolve,n.xhr.reject)}catch(y){n.xhr.reject(y)}}function st(n,t,i,r,f){return this._issueRequest(n,u.extend({type:"GET",data:t},f),!1,i,r)}function ht(n,t,i,r,u){return this.postMvcJson(n,!0,t,i,r,u)}function ct(n,t,i,r,f,e){return this._issueRequest(n,u.extend({type:"POST",data:i},e),t,r,f)}function lt(n){i.sessionId&&n.setRequestHeader("X-TFS-Session",i.sessionId)}r.defineProperty(t,"__esModule",{value:!0});var a=!1,y=!1,k=1,d=3e5,l=e.handleError,p,g="Ajax request failed with status: {0}.",nt="Ajax request has been timed out.",tt="TF400893: Team Foundation Server services are not available. This is most likely caused by a network error. Please check your connection and try again.",v;(function(n){n.AjaxException="TFS.Core.Ajax.AjaxException";n.AjaxTimeoutException="TFS.Core.Ajax.AjaxTimeoutException";n.NetworkException="TFS.Core.Ajax.NetworkException"})(v=t.Exceptions||(t.Exceptions={}));p={};Error.ajax=function(n,t){var i=Error.create(f.StringUtils.format(g,t),{name:v.AjaxException,response:n.responseText,xhr:n});return i.popStackFrame(),i};Error.ajaxTimeout=function(n){var t=Error.create(nt,{name:v.AjaxTimeoutException,status:n.status,xhr:n});return t.popStackFrame(),t};Error.network=function(n){var t=Error.create(tt,{name:v.NetworkException,status:n.status,xhr:n});return t.popStackFrame(),t};t.endRequest=w;t.issueRequest=et;t._issueRequest=ot;t.getMSJSON=st;t.postMSJSON=ht;t.postMvcJson=ct}))