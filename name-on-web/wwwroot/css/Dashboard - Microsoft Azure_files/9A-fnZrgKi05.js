define("RegisteredApps/RegisteredAppsArea",["require","exports","f","o","a","ko","Shared/AjaxExtensions","CommonConstants","Shared/BaseArea"],(function(n,t,i,r,u,f,e,o,s){"use strict";var h,l,v;r.defineProperty(t,"__esModule",{value:!0});h=RegisteredApps.Graph.v16Internal;l=RegisteredApps.Graph;t.AreaName="RegisteredApps",(function(n){n[n.None=0]="None";n[n.Admin=1]="Admin";n[n.User=2]="User"})(v=t.ConsentNeededStates||(t.ConsentNeededStates={}));t.stringEntityType={name:"stringEntityType",properties:{value:null},entityType:!0};i.Data.Metadata.setTypeMetadata(t.stringEntityType.name,t.stringEntityType);var c=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/{objectId}?expand={expand}&getLogoUrl={getLogoUrl}"),p=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications"),w=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/{0}/ServicePrincipals"),b=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications?searchText={0}&searchAll={1}&top={2}&nextLink={3}&putCachedLogoUrlOnly={4}"),k=i.Base.Resources.getAppRelativeUri("/api/ManagedApplications/GetApplicationsLogo/"),a=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/{0}/ApplicationOwners/{1}"),d=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/{id}/ApplicationOwners"),g=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/ServicePrincipals?searchText={searchText}&top={top}"),y=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/{0}/Manifest"),nt=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/{0}/Manifest?downloadLogo={1}"),tt=i.Base.Resources.getAppRelativeUri("api/RegisteredApplications/ServicePrincipals/{id}"),it=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/Schema"),rt=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/AppAdminUX"),ut=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/Count"),ft=i.Base.Resources.getAppRelativeUri("/api/RegisteredApplications/{0}/Consent?onBehalfOfAll={1}"),et=i.Base.Resources.getAppRelativeUri("api/ManagedApplications/{0}?isOnPremApp={1}"),ot=(function(n){function r(r,u,s){var w=n.call(this,t.AreaName,RegisteredApps.ErrorCodes.ErrorCodesType)||this;return w.notifiers=r,w.sharedDataContext=u,w.featureConfigurationsContext=s,w.addNotifier=f.observable(),w.editedNotifier=f.observable(),w.deletedNotifier=f.observable(),w.ownerChooseColumnNotifier=f.observable({showObjectId:f.observable(!1),showJobTitle:f.observable(!1),showDepartment:f.observable(!1),showCompany:f.observable(!1),showEmail:f.observable(!1),showType:f.observable(!1)}),w.consentNeededState=f.observable(v.None),w.consentOnBehalfOfAllNeeded=f.observable(!1),w.operations={},w.applicationsQuery=new i.Data.QueryCache({entityTypeName:h.ApplicationType,sourceUri:function(n){return b.format(encodeURIComponent(n.searchText),n.searchAll,encodeURIComponent(n.top.toString()),encodeURIComponent(n.nextLink),n.putCachedLogoUrlOnly)},poll:!1,navigation:{loadByContinuationToken:function(n,t,i){var r=i?"":n.metadata()?n.metadata().continuationToken:"";return n.fetch({searchText:t.searchText,searchAll:t.searchAll,top:t.top,nextLink:r,putCachedLogoUrlOnly:t.putCachedLogoUrlOnly})}},processServerResponse:function(n){return{data:n.items,navigationMetadata:{continuationToken:n.nextLink}}},supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyData(w.businessScenarios.registeredApps(),"GetApplications","GetApplications","Retrieve a list of registered applications",n,t,i,r,u,f)}}),w.applicationEntity=new i.Data.EntityCache({entityTypeName:h.ApplicationType,sourceUri:i.Data.uriFormatter(c,!0),poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyDataPerTargetObject(w.businessScenarios.registeredApps(),"GetApplication","GetApplication","Retrieve application",u.objectId,"Application",n,t,i,r,u,f)}}),w.totalApplicationCountEntity=new i.Data.EntityCache({sourceUri:function(){return ut},poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyData(w.businessScenarios.registeredApps(),"GetApplicationCount","GetApplicationCount","Retrieve the number of registered applications",n,t,i,r,u,f)}}),w.applicationServicePrincipalEntity=new i.Data.EntityCache({entityTypeName:h.ServicePrincipalType,sourceUri:i.Data.uriFormatter(tt,!0),poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyDataPerTargetObject(w.businessScenarios.registeredApps(),"GetApplicationServicePrincipal","GetApplicationServicePrincipal","Retrieves the service principal for the Application with given App ID",u,"Application",n,t,i,r,u,f)}}),w.ownerCountNotifier=f.observable(0),w.applicationOwnersQuery=new i.Data.QueryCache({entityTypeName:h.ApplicationOwnerType,sourceUri:i.Data.uriFormatter(d,!0),poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyDataPerTargetObject(w.businessScenarios.registeredApps(),"GetApplicationOwners","GetApplicationOwners","Retrieve list of application owners",u,"Application",n,t,i,r,u,f)}}),w.applicationOwnerEntity=new i.Data.EntityCache({entityTypeName:h.ApplicationOwnerType,sourceUri:function(n){return a.format(encodeURIComponent(n.appObjectId),encodeURIComponent(n.userId))},poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyDataPerTargetObject(w.businessScenarios.registeredApps(),"GetApplicationOwner","GetApplicationOwner","Retrieve application owner",u.appObjectId,"Application",n,t,i,r,u,f)}}),w.applicationEditScopeCache=i.Data.EditScopeCache.createNew({entityTypeName:h.ApplicationDetailsType,supplyExistingData:function(n){return w.applicationEntity.fetch({objectId:n},null).then((function(n){return n.data()}))},saveEditScopeChanges:function(n,t){var r=t.root;return i.isNullOrUndefined(r)||i.isNullOrUndefined(r.keyCredentials)||!i.isObservableArray(r.keyCredentials)||r.keyCredentials().forEach((function(n){delete n.thumbprint})),e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(w.businessScenarios.registeredApps(),"UpdateApplication","UpdateApplication","Update an application",n,"Application",{uri:i.Data.uriFormatter(c,!0)({objectId:n}),type:o.httpVerbs.put,data:f.toJSON(r),contentType:o.httpContentTypes.applicationJson}).then((function(){return w.editedNotifier(r),{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}}))}}),w.applicationAddScopeCache=i.Data.EditScopeCache.createNew({supplyNewData:function(){return{displayName:f.observable(),publicClient:f.observable(),identifierUris:f.observableArray()}},saveEditScopeChanges:function(n,t){var r=t.root;return e.AuthenticatedToAdIbizaUx.trackedAjax(w.businessScenarios.registeredApps(),"AddApplication","AddApplication","Add an application",{uri:p,type:o.httpVerbs.post,data:f.toJSON(r),contentType:o.httpContentTypes.applicationJson}).then((function(n){return w.addNotifier({objectId:f.observable(n.objectId),appId:f.observable(n.appId),displayName:f.observable(n.displayName),homepage:f.observable(n.homePage),logoUrl:f.observable(n.logoUrl),publicClient:f.observable(n.publicClient)}),{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}}))}}),w.applicationKeysEditScopeCache=i.Data.EditScopeCache.createNew({entityTypeName:h.ApplicationDetailsType,supplyExistingData:function(n){return w.applicationEntity.fetch({objectId:n},null).then((function(n){return n.data()}))},saveEditScopeChanges:function(n,t,r){return w._keysSavePromise(n,t,r).then((function(){return{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}}))}}),w.keyState=f.observable(0),w.passwordCreated=!1,w.publicKeyCreated=!1,w.applicationManifest=new i.Data.EntityCache({entityTypeName:l.GraphManifestType,sourceUri:function(n){return y.format(n)},poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyDataPerTargetObject(w.businessScenarios.registeredApps(),"GetApplicationManifest","GetApplicationManifest","Get application manifest",u,"Application",n,t,i,r,u,f)}}),w.applicationManifestEditScopeCache=i.Data.EditScopeCache.createNew({dataCache:w.applicationManifest,entityTypeName:l.GraphManifestType,serializeParams:function(n){return n},supplyExistingData:function(n){return w.applicationManifest.fetch(n,null).then((function(n){return n.data()}))},saveEditScopeChanges:function(n,t){var r=t.root;return w.updateApplicationManifest(r).then((function(){return{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}}))}}),w.servicePrincipalsQuery=new i.Data.QueryCache({entityTypeName:h.ServicePrincipalType,sourceUri:i.Data.uriFormatter(g,!0),poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyData(w.businessScenarios.registeredApps(),"GetServicePrincipals","GetServicePrincipals","Get service principals",n,t,i,r,u,f)}}),w.applicationPermissionsEditScopeCache=i.Data.EditScopeCache.createNew({entityTypeName:h.RequiredResourceAccessType,supplyExistingData:function(n){return w.applicationEntity.fetch({objectId:n,expand:"resourceApp"},null).then((function(n){var t=n.data();return t.requiredResourceAccess}))},saveEditScopeChanges:function(n,t){return w._permisionSavePromise(n,t).then((function(){return{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}}))}}),w.urlEditScopeCache=i.Data.EditScopeCache.createNew({entityTypeName:t.stringEntityType.name,supplyExistingData:function(n){return w.applicationEntity.fetch({objectId:n},null).then((function(n){var t=n.data(),i=f.observableArray();return t.replyUrls()&&t.replyUrls().length>0&&t.replyUrls().forEach((function(n){i.push({value:f.observable(n)})})),i}))},saveEditScopeChanges:function(n,t){var r=f.observableArray(),u;return t.root().forEach((function(n){t.getEditState(n)()!==i.Data.EditState.Deleted&&n.value&&n.value()&&r.push(n.value())})),t.getCreated(t.root)().forEach((function(n){n.value&&n.value()&&r.push(n.value())})),u={objectId:f.observable(n),replyUrls:r},e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(w.businessScenarios.registeredApps(),"UpdateApplicationUrl","UpdateApplicationUrl","Update the URL of an application",n,"Application",{uri:i.Data.uriFormatter(c,!0)({objectId:n}),type:o.httpVerbs.put,data:f.toJSON(u),contentType:o.httpContentTypes.applicationJson}).then((function(){return w.applicationEntity.applyChanges((function(n,t){w.updateEntityCache(u,t)}),(function(t){return t.objectId===n})),{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}}))}}),w.getAppAdminUX=new i.Data.EntityCache({entityTypeName:t.stringEntityType.name,sourceUri:i.Data.uriFormatter(rt,!0),poll:!1,supplyData:function(n,t,i,r,u,f){return e.AuthenticatedToAdIbizaUx.trackedSupplyData(w.businessScenarios.registeredApps(),"IsApplicationAdmin","IsApplicationAdmin","Verify if user is application or global admin",n,t,i,r,u,f)},extendEntryLifetimes:!0}),w.keysUploadState=f.observable(),w.crossAreaNotifiers=r,w.featureConfigurations=s,w}return __extends(r,n),r.prototype.createOperation=function(){var n=i.newGuid();return this.operations[n]={revertChanges:null},n},r.prototype.getOperation=function(n){return this.operations[n]},r.prototype.disposeOperation=function(n){this.operations[n]&&delete this.operations[n]},r.prototype.applicationsLogo=function(n){return e.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.registeredApps(),"GetApplicationLogos","GetApplicationLogos","Gets the logos for a list of applications",{uri:k,data:f.toJSON(n),type:o.httpVerbs.post,contentType:o.httpContentTypes.applicationJson})},r.prototype.addApplicationOwner=function(n){var t=this,i=a.format(encodeURIComponent(n.appObjectId),encodeURIComponent(n.userId)),r=e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"AddApplicationOwner","AddApplicationOwner","Add an application owner",n.appObjectId,"Application",{uri:i,type:o.httpVerbs.post});return r.then((function(){return t.applicationOwnersQuery.refreshAll((function(t){return t===n.appObjectId}))}))},r.prototype.deleteApplicationOwner=function(n){var t=this;return e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"DeleteApplicationOwner","DeleteApplicationOwner","Delete an application owner",n.appObjectId,"Application",{uri:a.format(encodeURIComponent(n.appObjectId),encodeURIComponent(n.userId)),type:o.httpVerbs.delete}).then((function(){t.applicationOwnersQuery.applyChanges((function(i,r){t.removeOwnerFromDataSet(r,n.userId)}));t.applicationOwnerEntity.applyChanges((function(i,r){t.removeOwnerFromDataSet(r,n.userId)}))}))},r.prototype.removeOwnerFromDataSet=function(n,t){var i=null,r=n.data();u.isArray(r)?r.first((function(n){if(n.objectId()===t)return i=n,!0})):i=r.objectId()===t?r:null;i!=null&&n.removeItem(i)},r.prototype.deleteApplication=function(n){var t=e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"DeleteApplication","DeleteApplication","Delete an application",n.objectId,"Application",{uri:i.Data.uriFormatter(c,!0)(n),type:o.httpVerbs.delete});return Q(t)},r.prototype.deleteOnPremApplication=function(n){var t=e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"DeleteOnPremApplication","DeleteOnPremApplication","Delete an application",n,"ServicePrincipal",{uri:et.format(encodeURI(n),!0),type:o.httpVerbs.delete});return Q(t)},r.prototype.applicationConsent=function(n,t){var i=e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"GrantApplicationConsent","GrantApplicationConsent","Grant an application consent",n,"Application",{uri:ft.format(encodeURIComponent(n),t),type:o.httpVerbs.post});return Q(i)},r.prototype.createAppServicePrincipal=function(n){return e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"CreateServicePrincipal","CreateServicePrincipal","Create service principal for app",n,"ServicePrincipal",{uri:w.format(encodeURIComponent(n)),type:o.httpVerbs.post})},r.prototype._keysSavePromise=function(n,t,r){var u=this,s=f.observableArray([]),h=f.observableArray([]),a,l;return this.passwordCreated=!1,this.publicKeyCreated=!1,t.root.passwordCredentials().forEach((function(n){t.getEditState(n)()!==i.Data.EditState.Deleted&&(n.value(null),s.push(n))})),t.root.keyCredentials().forEach((function(n){t.getEditState(n)()!==i.Data.EditState.Deleted&&(n.value(null),delete n.thumbprint,h.push(n))})),r.forEach((function(n){n.editState===i.Data.EditState.Created&&(n.entity.passwordDescription?(n.entity.keyId(i.newGuid().toLowerCase()),s.push(n.entity),u.passwordCreated=!0):(n.entity.customKeyIdentifier(undefined),delete n.entity.thumbprint,n.entity.startDate(undefined),n.entity.endDate(undefined),h.push(n.entity),u.publicKeyCreated=!0))})),a={objectId:f.observable(n),passwordCredentials:s,keyCredentials:h},l=e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"UpdateApplicationKeys","UpdateApplicationKeys","Update applcation keys",n,"Application",{uri:i.Data.uriFormatter(c,!0)({objectId:n}),type:o.httpVerbs.put,data:f.toJSON(a),contentType:o.httpContentTypes.applicationJson}),l.then((function(n){return n.passwordCredentials.forEach((function(n){r.forEach((function(t){t.entity.passwordDescription&&n.keyId===t.entity.keyId()&&t.editState===i.Data.EditState.Created&&t.entity.passwordDescription()&&(t.entity.value(n.value),t.entity.startDate(n.startDate),t.entity.endDate(n.endDate))}))})),n.keyCredentials.forEach((function(n){r.forEach((function(t){t.entity.usage&&n.keyId===t.entity.keyId()&&t.editState===i.Data.EditState.Created&&(t.entity.thumbprint=n.thumbprint,t.entity.startDate(n.startDate),t.entity.endDate(n.endDate),t.entity.customKeyIdentifier(n.customKeyIdentifier),t.entity.value(null))}))})),u.passwordCreated&&u.keyState(2),{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}})),Q(l)},r.prototype.disposeKeys=function(n){this.applicationEntity.applyChanges((function(n,t){var r=t.data().passwordCredentials(),f,i;if(u.isArray(r))for(f=r.length,i=0;i<f;i++)r[i].value()!==null&&r[i].value(null)}),(function(t){return t.objectId===n}))},r.prototype.updateApplicationManifest=function(n){var t=this,r=e.AuthenticatedToAdIbizaUx.trackedAjax(this.businessScenarios.registeredApps(),"UpdateApplicationManifest","UpdateApplicationManifest","Update an application manifest",{uri:y.format(n.objectId()),type:o.httpVerbs.put,data:f.toJSON(n),contentType:o.httpContentTypes.applicationJson});return r.then((function(r){t.applicationEntity.applyChanges((function(n,i){t.updateEntityCache(r,i)}),(function(t){return t.objectId===n.objectId()}));var u={objectId:f.observable(r.objectId),appId:f.observable(r.appId),displayName:f.observable(r.displayName),homepage:f.observable(r.homepage),publicClient:f.observable(r.publicClient)};return i.isNullOrUndefined(r.logoUrl)||(u.logoUrl=f.observable(r.logoUrl),u.logoChanged=f.observable(!0)),t.editedNotifier(u),{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}})),Q(r)},r.prototype._permisionSavePromise=function(n,t){var a=this,r=f.observableArray([]),s=f.observableArray([]),h=t.getCreated(t.root),l,u;return t.root().forEach((function(n){t.getEditState(n)()===i.Data.EditState.Deleted&&s.push(n)})),t.root().forEach((function(n){t.getEditState(n)()!==i.Data.EditState.Deleted&&r.push(n)})),h().forEach((function(n){r.push(n)})),l={objectId:f.observable(n),requiredResourceAccess:r},u=e.AuthenticatedToAdIbizaUx.trackedAjaxPerTargetObject(this.businessScenarios.registeredApps(),"UpdateApplicationPermissions","UpdateApplicationPermissions","Update the permissions of an application",n,"Application",{uri:i.Data.uriFormatter(c,!0)({objectId:n}),type:o.httpVerbs.put,data:f.toJSON(l),contentType:o.httpContentTypes.applicationJson}),u.then((function(){return a.applicationEntity.applyChanges((function(n,t){s().forEach((function(n){var i=t.data().requiredResourceAccess().first((function(t){return t.resourceAppId()===n.resourceAppId()}));t.removeItem(i,null,t.data().requiredResourceAccess())}));h().forEach((function(n){var i=f.mapping.fromJS(f.mapping.toJS(n));t.addItems(0,[i],null,!0,t.data().requiredResourceAccess)}))}),(function(t){return t.objectId===n&&t.expand==null})),{action:i.Data.AcceptEditScopeChangesAction.AcceptClientChanges}})),Q(u)},r.prototype.updateEntityCache=function(n,t){var i=t.data();i&&(f.mapping.fromJS(n,{},i),t.data.notifySubscribers())},r.prototype.removeServicePrincipalFromDataCaches=function(n){this.applicationServicePrincipalEntity.applyChanges((function(t,i){var r=i.data();r.objectId().localeCompareIgnoreCase(n)===0&&i.removeItem(i.data())}))},r.prototype.getDownloadManifestUrl=function(n,t){return window.location.protocol+"//"+window.location.host+nt.format(n,t)},r.prototype.getManifestSchemaUrl=function(){return window.location.protocol+"//"+window.location.host+it},r})(s.BaseArea);t.DataContext=ot}))