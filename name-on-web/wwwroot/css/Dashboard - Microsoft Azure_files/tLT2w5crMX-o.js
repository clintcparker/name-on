var __extends;define("WebsitesExtension/TypeScript/SlotSwap/Data/SlotPickerModels",["require","exports","o","ko"],(function(n,t,i,r){"use strict";var u,f,e;i.defineProperty(t,"__esModule",{value:!0}),(function(n){n[n.complete=0]="complete";n[n.twoPhase=1]="twoPhase"})(u=t.SwapType||(t.SwapType={})),(function(n){n[n.none=0]="none";n[n.finish=1]="finish";n[n.cancel=2]="cancel"})(f=t.TwoPhaseSwapAction||(t.TwoPhaseSwapAction={}));e=(function(){function n(){this.inputs={resourceUri:r.observable("")};this.outputs={source:r.observable(""),dest:r.observable(""),swapType:r.observable(u.complete),twoPhaseSwapAction:r.observable(f.none)};this.informationData={diffs:r.observableArray([])}}return n})();t.SlotSwapFormData=e}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.
create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/ViewModels/Parts/WebsiteAddSlotPart",["require","exports","f","o","ko","$","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Models/WebsiteResourceId","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/Environment/QuotaSettings","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/Data/Data.Websites","Fx/Controls/DropDown"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";var y;return (function(n){var r=(function(){function n(n,t){this.addSlotData={slotName:u.observable(""),configSource:u.observable(""),resourceUri:u.observable(undefined),showConfigOption:u.observable(!0)};this.addSlotData.resourceUri(n);t!==null&&t!==undefined&&this.addSlotData.showConfigOption(t)}return n})(),t;n.AddSlotModel=r;t=(function(n){function t(t,r,f){var o=n.call(this,t,r)||
this;return o.showConfigOption=u.observable(!0),o.resources={summary:e.WebsiteAddSlotPart.summary,notStandardModeMessage:e.WebsiteAddSlotPart.notStandardModeMessage},o._resourceUri=u.observable(undefined),o._maxNumOfSlotsIncludingThisSite=u.observable(0),o.enableProvisioning(!1),o._websiteView=f.websitesData.websiteCache.createView(t),o._slotsView=f.websitesData.websiteSlotsCache.createView(t),o._allSlots=a.createAllSlotsComputedArray(t,o._slotsView),o.needToScaleUpForAddingMoreSlot=u.pureComputed((function(){return!o._websiteView.item()||!o._slotsView.items()?!1:o._maxNumOfSlotsIncludingThisSite()!==-1&&o._slotsView.items().length+1>=o._maxNumOfSlotsIncludingThisSite()})),o.siteDataLoaded=u.pureComputed((function(){return!!o._websiteView.item()})),o.slotNameTextField=o._createSlotNameTextField(t),o.configSourceDropDown=o._createConfigSourceDropDown(t),o.formSection=new i.ViewModels.Forms.StaticSection.ViewModel(t,[o.slotNameTextField,o.configSourceDropDown]),o.sections.push(o.formSection),
o}return __extends(t,n),t.prototype.onInputsReceived=function(n){var t=this,r=i.ViewModels.ParameterCollection.Models.parametersToModel(n.inputParameters),f=[],u;return!r.addSlotData.resourceUri()||this._resourceUri()&&this._resourceUri()===r.addSlotData.resourceUri()?null:(this._resourceUri(r.addSlotData.resourceUri()),u=s.WebsiteResourceId.fromCsmResourceId(this._resourceUri()),this.showConfigOption(r.addSlotData.showConfigOption()),f.push(this._websiteView.fetch(u).then((function(){var n=t._websiteView.item();return h.getFeatureLimit(u.SubscriptionId,c.QuotaSettings.numberOfSlotsPerSite,n.Sku(),n.ComputeMode()).then((function(n){t._maxNumOfSlotsIncludingThisSite(n)}))}))),f.push(this._slotsView.fetch(u)),Q.all(f).then((function(){if(!t.needToScaleUpForAddingMoreSlot()){var n=[];n.push({text:e.addSlotConfigSourceDefaultOption,value:""});t._allSlots().forEach((function(t){n.push({text:t.DisplayName(),value:t.Name()})}));n.sort(t._sortSlotByValue);t.configSourceDropDown.items(n)}})))},t.prototype.
_createSlotNameTextField=function(n){var r=this,t=new i.ViewModels.Forms.TextBox.ViewModel(n,this,this.createEditScopeAccessor((function(n){return n.addSlotData.slotName})),{label:u.observable(e.addSlotNameLabel),validations:u.observableArray([new i.ViewModels.RequiredValidation(e.validationRequired),new i.ViewModels.CustomValidation("",l.validateEntityName),new i.ViewModels.MaxLengthValidation(o.Validations.websiteNameMaxLength,e.websiteNameMaxLength),new i.ViewModels.CustomValidation("",function(n){return Q(r._validateSlotNameIsUniqueWithinSite(n))})]),defaultValue:u.observable(e.WebsiteAddSlotPart.SlotNameTextField.emptyValueText),infoBalloonContent:u.observable(e.WebsiteAddSlotPart.SlotNameTextField.balloonText)});return t.delayValidationTimeout(500),t.valueUpdateTrigger=4,t},t.prototype._createConfigSourceDropDown=function(n){var t=[];return t.push({text:e.addSlotConfigSourceDefaultOption,value:""}),new v.ViewModel(n,this,this.createEditScopeAccessor((function(n){return n.addSlotData.
configSource})),{label:u.observable(e.addSlotConfigSourceLabel),items:t})},t.prototype._validateSlotNameIsUniqueWithinSite=function(n){var i=f.Deferred(),t={valid:!0,message:""};return n&&(t.valid=!this._slotsView.items().first((function(t){return AntUx.StringEx.equals(t.SlotName(),n,AntUx.StringComparison.IgnoreCase)}))&&!AntUx.StringEx.equals("production",n,AntUx.StringComparison.IgnoreCase),t.message=e.websiteSlotNameNotAvailable.format(n)),i.resolve(t),i.promise()},t.prototype._sortSlotByValue=function(n,t){return n.value>t.value?1:n.value<t.value?-1:0},t})(i.ViewModels.ParameterCollection.BaseFormViewModel);n.WebsiteAddSlotPart=t})(y||(y={})),y}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/ViewModels/Commands/LaunchAddSlotCommand",
["require","exports","f","o","ko","WebsitesExtension/TypeScript/ViewModels/Parts/WebsiteAddSlotPart","WebsitesExtension/TypeScript/Operations/Operations","WebsitesExtension/TypeScript/Models/WebsiteResourceId","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/Environment/QuotaSettings","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";r.defineProperty(t,"__esModule",{value:!0});"use strict";var a=(function(n){function t(t,r,f){var e=n.call(this,t,r)||this;return e._resourceUri=u.observable(undefined),e._hasPermissions=u.observable(!0),e._maxNumOfSlotsIncludingThisSite=u.observable(0),e._isFunctionApp=u.observable(!1),e.icon(i.Base.Images.Add()),e._websiteView=f.websitesData.websiteCache.createView(t),e._slotsView=f.websitesData.websiteSlotsCache.createView(t),e.enabled=u.pureComputed((function(){return!e._slotsView.items()||e._websiteView.
loading()?!1:e._hasPermissions()&&!e._isFunctionApp()&&(e._maxNumOfSlotsIncludingThisSite()===-1||e._slotsView.items().length+1<e._maxNumOfSlotsIncludingThisSite())})),f.websitesDataUpdated.subscribe(t,(function(n){n&&e._websiteView.refresh().then((function(){e._updateSlotQuota()}))})),e}return __extends(t,n),t.prototype._updateSlotQuota=function(){var t=this,n=this._websiteView.item();h.getFeatureLimit(n.SubscriptionId(),c.QuotaSettings.numberOfSlotsPerSite,n.Sku(),n.ComputeMode()).then((function(n){t._maxNumOfSlotsIncludingThisSite(n)}))},t.prototype.onInputsSet=function(t){var r=this,f=!t.resourceUri?o.WebsiteResourceId.toCsmResourceId(t.WebsiteId):t.resourceUri,u,i;return this._resourceUri(f),u=o.WebsiteResourceId.fromCsmResourceId(this._resourceUri()),i=[],i.push(this._websiteView.fetch(u).then((function(){var n=r._websiteView.item();r._isFunctionApp(n.Kind().toLowerCase()===l.KindsAvailable.Functions.toLowerCase());r._updateSlotQuota()}))),i.push(this._slotsView.fetch(u)),i.push(this._checkPermissions(
f)),i.push(n.prototype.onInputsSet.call(this,t)),Q.all(i)},t.prototype.getProviderInputs=function(){var n=new i.ViewModels.ParameterCollection.ParameterCollectionInput,t=new f.AddSlotModel(this._resourceUri(),this._websiteView.item()&&this._websiteView.item().Kind()!==l.KindsAvailable.Functions);return n.inputParameters=i.ViewModels.ParameterCollection.Models.modelToParameters(t),n},t.prototype.onProviderCommit=function(n,t){var r=this._websiteView.item(),u=i.ViewModels.ParameterCollection.Models.parametersToModel(t.outputParameters),f;return u.addSlotData.slotName()&&(f=r.Kind()===l.KindsAvailable.Functions?r.Name():u.addSlotData.configSource(),e.createWebsiteSlot(r,u.addSlotData.slotName(),f)),Q(!0)},t.prototype._checkPermissions=function(n){var t=this;return i.Base.Security.hasPermission(n,[s.AssetTypes.Website.Permissions.actionConfigList]).then((function(n){t._hasPermissions(n)}))},t})(i.ViewModels.ParameterCollection.BaseCommandViewModel);t.LaunchAddSlotCommand=a}));__extends=this&&this.
__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/ViewModels/Parts/Upsell/SlotsUpsellPart",["require","exports","o","ko","WebsitesExtension/TypeScript/ViewModels/Parts/Upsell/UpsellPartBase","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Models/WebsiteResourceId","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/Environment/QuotaSettings","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/Environment/RuntimeType","WebsitesExtension/TypeScript/Utility/Utility.WebHostingPlan"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";i.defineProperty(t,"__esModule",{value:!0});var a=(function(n){function t(
t,i,u){var a=n.call(this,t,i,u)||this;return a.needToScaleUpForAddingMoreSlot=r.observable(!1),a._maxNumOfSlotsIncludingThisSite=r.observable(-1),a.showUpSell=r.observable(!1),a.resources.scaleUpMessage=r.observable(""),a._slotsView=u.websitesData.websiteSlotsCache.createView(t),r.reactor(t,(function(){a._slotsView.items()&&a._siteView.item()&&(a._maxNumOfSlotsIncludingThisSite()!==-1&&a._slotsView.items().length+1>=a._maxNumOfSlotsIncludingThisSite()?(c.isOnPrem()?a.resources.scaleUpMessage(h.WebsiteAddSlotPart.quotaLimitReached):a._siteView.item().properties().sku()===f.ServerFarmSku.dynamic?a.resources.scaleUpMessage(h.WebsiteAddSlotPart.dynamicLimitReached):l.isStandardSKUOrHigher(a._siteView.item().properties().sku())?a.resources.scaleUpMessage(h.WebsiteAddSlotPart.skuLimitReached):a.resources.scaleUpMessage(h.WebsiteAddSlotPart.notStandardModeMessage),a.showUpSell(!0)):a.showUpSell(!1))})),u.websitesDataUpdated.subscribe(t,(function(n){n&&a._siteView.refresh().then((function(){var n=
a._siteView.item(),t=e.WebsiteResourceId.fromCsmResourceId(n.id());o.getFeatureLimit(t.SubscriptionId,s.QuotaSettings.numberOfSlotsPerSite,n.properties().sku(),n.properties().computeMode()).then((function(n){a._maxNumOfSlotsIncludingThisSite(n)}))}))})),a}return __extends(t,n),t.prototype.onInputsSet=function(t){var i=this;return n.prototype.onInputsSet.call(this,t).then((function(){var n=i._siteView.item(),t;if(n)t=e.WebsiteResourceId.fromCsmResourceId(n.id()),Q.all([i._slotsView.fetch(t),o.getFeatureLimit(t.SubscriptionId,s.QuotaSettings.numberOfSlotsPerSite,n.properties().sku(),n.properties().computeMode())]).then((function(n){i._maxNumOfSlotsIncludingThisSite(n[1])}));else return Q.reject("Why are we checking for slots on a serverFarm?")}))},t})(u.UpsellPartBase);t.SlotsUpsellPart=a}))