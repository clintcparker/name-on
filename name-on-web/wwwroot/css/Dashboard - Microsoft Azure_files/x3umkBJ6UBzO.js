define("MsPortalImpl/UI/Commands/UI.Commands.Lists",["require","exports","f","ko","MsPortalImpl/Base/Base.Router.Blade","MsPortalImpl/Base/Base.SelectableSet2","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/Commands/UI.ShellCommands","MsPortalImpl/Resources/ImplScriptResources"],(function(n,t,i,r,u,f,e,o,s){"use strict";var h;return (function(n){function c(n,t){var i=n.model,f=n.locator;return t.finder.locateAsync(f).then((function(o){var s=f.getExtensionLocator();return o.menuBlade?t.extensionManager.getExtensionByName(s.name).then((function(n){var f={inputs:r.toJS(i)};return f.inputs._msPortalFxForPinning=!0,Q(n.getViewModel(o.viewModelName,{onInputsSetParameters:f})).then((function(r){var f;return Q(r.onInputsSetPromise).then((function(){var t=o.menuBlade.isV2,n=r.content,i=t?n.viewModel().viewModel._msPortalFxMenu:n.menu;return i._msPortalFxData.overviewPromise})).then((function(n){return(f=n.id,n.supplyBladeReference)?Q(n.supplyBladeReference()):Q(n.supplyBladeReferenceAsync())})).then((function(s){n.releaseViewModel(r);var h=u.getDeepLink(t.diContainer,n,o,i,f,null,null,!0);return{locator:e.Locator.forExtension(s.extensionName).withBlade(s.bladeName),model:s.parameters,defaultMenuItemId:f,deepLink:h}}))}))})):n}))}var v=i.Base,t=v.Images,h=s.ListCommands,l,a;n.getOverviewModelAndLocator=c;l=(function(n){function r(i,r,u,f){var e=n.call(this,i,r,h.pinToStartboard,!0)||this;return e.commandName=o.CommandNames.PinListItem,e.icon(t.Pin()),e._selectableSet=u.selectableSet,e._getModelAndLocatorPromise=f,e}return __extends(r,n),r.prototype.bind=function(t){n.prototype.bind.call(this,t);this.enabled(f.getSelectedItems(this._selectableSet).length===1)},r.prototype.execute=function(t){var r=this;Q(this._getModelAndLocatorPromise()).then((function(n){return c(n,r._services)})).then((function(n){if(n)return i.require("MsPortalImpl/UI/UI.Desktop.Actions").then((function(t){return t.pinBladeToStartboard(n,r._services)}))})).finally((function(){n.prototype.execute.call(r,t)}))},r})(o.ShellCommand);n.PinListItem=l;a=(function(n){function i(i,r){var u=n.call(this,i,null,r.deleteRowCommandTitle||h.deleteListItem,!1)||this;return u._itemsToDelete=[],u.commandName=o.CommandNames.DeleteListItem,u._listData=r,u.icon(t.Blank()),u}return __extends(i,n),i.prototype.bind=function(t){n.prototype.bind.call(this,t);this._listData.selectableSet&&(this._itemsToDelete=f.getSelectedItems(this._listData.selectableSet));this.enabled(this._listData.markForDelete&&this._itemsToDelete.length>0)},i.prototype.execute=function(t){var i=this;n.prototype.execute.call(this,t);this._itemsToDelete.forEach((function(n){i._listData.markForDelete(n.data)}))},i})(o.ShellCommand);n.DeleteListItem=a})(h||(h={})),h}));
define("MsPortalImpl/UI/Compositions/UI.Composition.ContextMenuContainer.DemandLoad",["require","exports","f","i","o","ko","$","MsPortalImpl/Base/Base.SelectableSet2","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/Commands/UI.Commands","MsPortalImpl/UI/Commands/UI.Commands.Base","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpenerBase","MsPortalImpl/UI/Compositions/UI.Composition.ContextMenuContainer","MsPortalImpl/UI/Commands/UI.Commands.Lists","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Commands/UI.ShellCommands","MsPortalImpl/Base/Base.EventTypes"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";var k;return (function(t){function et(n,t,i,r,u,f,s,h){var c=[],d=e(u.target),g=new k(n,i),a=f&&f.listData&&f.listData.selectableSet,it=a&&o.getSelectedItems(a)||[],p,rt;return f.entityType===2&&v.composeShellCommands(n,i,c,s,t),f.commandGroup&&nt(n,t,i,r,f.commandGroup,f.listData,f.viewModel,c,g),f.controlCommands&&f.controlCommands.forEach((function(t){var i=new w.ControlCommand(n,t);c.push(i)})),f.entityType===1?(rt=it.length===1&&a.itemsArePinnable()?tt(n,it,i,t,h,f).then((function(n){n&&c.push(n)}),(function(n){l.error(n)})):Q(),p=rt.then((function(){f.listData.markForDelete&&c.push(new y.DeleteListItem(n,f.listData))}))):p=Q(),p.then((function(){if(c.length){var n=e.Event(b.default.fxcontextmenu);n.clientX=u.clientX;n.clientY=u.clientY;d.trigger(n,{commands:c,isControlContextMenu:!0,srcElement:d[0]})}})),g}function nt(t,i,r,u,f,e,l,a,v){var p,w,b,d=null,g=v||new k(t,r),y=e&&e.selectableSet,it=y&&o.getSelectedItems(y)||[],nt,tt;f&&(nt=r.locator.getExtensionLocator().name,d=h.Locator.forExtension(u.name).withCommandGroup(f),p=i.finder.locate(d,nt),p?p.commands.forEach((function(n){var f,e;ot(n,r)&&(w=n.name?n.name:n.text,b=r.toString()+"[Command:"+w+"]",it.length>1?f=new c.ExtensionMultiselectCommandMenuItemImpl(t,u,r,n,r.partDefinition,i,y):(e={viewModelName:b,viewModel:l,isPartListItem:!0},f=new c.ExtensionCommandMenuItemImpl(t,u,g,n,r.partDefinition,i,e,!!y),g.addExtensionCommand(f)),a.push(f))})):(tt=r.locator.getExtensionLocator().name,s.logToExtension(n,tt,2,"Could not display the context menu for "+r+".  Could not find command group '"+f+"' in extension "+u.name+".")))}function tt(n,t,i,r,u,e){var v=e.listData,c=v.selectableSet,s=c,p=a.getAssociatedDetailDefinition(c,i.getViewModel(),i.partDefinition),l=r.assetTypeService;return Q.fcall((function(){if(!p){if(c instanceof o.SelectableSet2&&s.dynamicSelectionProvider)return new y.PinListItem(n,r,v,function(){var n=t[0].data(),r=s.pinProvider?Q(s.pinProvider(n)):Q(undefined);return r.then((function(t){return t?Q({model:undefined,locator:i.locator,onPin:function(){return Q(t)}}):Q(s.dynamicSelectionProvider(s.selectedIds().length?s.selectedIds()[0]:null,n)).then((function(t){var i,r,u;if(t){if(i=void 0,t.detailBlade?i=t.detailBlade:t.assetType&&(r=l.getAssetType(t.extension,t.assetType),i=r.assetTypeManifest.bladeName),i)return{model:t.detailBladeInputs,locator:h.Locator.forExtension(t.extension).withBlade(i)};if(t.resourceId)return n.externalLink&&n.externalLink()?(r=l.getAssetTypeByResourceType(n.resourceType).assetTypeManifest.name,u={model:{notice:{assetType:r,assetTypeExtension:n.extensionName(),linkUri:n.externalLink(),resource:{id:n.id,name:n.name}}},locator:h.Locator.forExtension(rt).withBlade(g.BladeNames.Hubs.BrowseLinkBlade)},u):Q(l.mapResourceIdToAssetId(f.unwrap(t.resourceId))).then((function(n){var i=l.getAssetType(t.extension,n.assetType).assetTypeManifest;return{model:t.detailBladeInputs,locator:h.Locator.forExtension(t.extension).withBlade(i.bladeName)}}))}throw new Error("When trying to create a pin command from Selectable set 2, the dynamic selection call returned a value that was not a DynamicBladeSelection, DynamicResourceSelection or a DynamicAssetSelection");}))}))})}else return new y.PinListItem(n,r,v,function(){return it(i.toString(),c,e.viewModel,p,u)})}))}function ot(n,t){var i=t.parent&&t.getPartsContainer();return i?n.details&&i.flags&1?(l.error("Part '{0}' cannot have the open blade command '{1}', because it is inside the context blade.".format(t.toString(),n.name||n.text)),!1):!0:!0}function it(n,t,i,r,u){return v.createSelection(t,i).then((function(n){return u.createBladeModelForSelectedItem(r,n)}),(function(){l.error("Part Selection: createSelection's view model RPC failed. Part: {0}.".format(n))}))}function st(n,t,i){u.defineProperty(t,n,{get:function(){return i[n]},set:function(t){i[n]=t}})}function ht(n,t,i){t[n]=i[n].bind(i)}var d=i.Base,g=d.Constants,rt=g.ExtensionNames.Hubs,ut=d.Diagnostics,ft=i.Helpers,l=ut.createLog(n),k;t.fireContextMenuEvent=et;t.addCommandGroupCommands=nt;t.addPinCommand=tt;t.getSelectionTarget=it;k=(function(){function n(n,t){var i=this;this._extensionCommands=[];this._ltm=n.createChildLifetime();this._partComposition=t;["id","locator","children","templateKey","parent","widget","widgetState","isComposed","eligibleForBinding",].forEach((function(n){return st(n,i,t)}));["addChild","removeChildAt","sortChildren","getLoadDelayed","toString","awaitComposed","awaitOnInputsSetComplete","awaitContentRevealed","getBindableContainer","getPartsContainer","save","compose","resetLayout","getDiagnosticsData","getCompositionType","getCreationState","getInputPropertyBindings","onDispose","offDispose",].forEach((function(n){return ht(n,i,t)}))}return n.prototype.registerForDispose=function(n){return this._ltm.registerForDispose(n)},n.prototype.createChildLifetime=function(){return this._ltm.createChildLifetime()},n.prototype.isDisposed=function(){return this._ltm.isDisposed()},n.prototype.dispose=function(){this._ltm&&this._ltm.dispose()},n.prototype.addExtensionCommand=function(n){this._extensionCommands.push(n)},n.prototype.getViewModel=function(n,t){if(n===4){var i=p.findCommand(this._extensionCommands,t,this+"");return i&&i.getViewModel()||{}}return this._partComposition.getViewModel(n,t)},n.prototype.getViewModelAsync=function(n,t){if(n===4){var i=p.findCommand(this._extensionCommands,t,this.toString());return i?i.getViewModelAsync():ft.Deferred().reject(r.createError("Failed to find command named '{0}' in the part '{1}'".format(t,this._partComposition.toString()))).promise()}return this._partComposition.getViewModelAsync(n,t)},n})()})(k||(k={})),k}));
define("MsPortalImpl/UI/Compositions/UI.Composition.ContextMenuV2",["require","exports","f","$","MsPortalImpl/Base/Base.SelectableSet2","MsPortalImpl/UI/Compositions/UI.Composition.ContextMenuContainer.DemandLoad","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/UI/Compositions/UI.Composition.Selectable2Registrar","MsPortalImpl/UI/Commands/UI.ShellCommands","MsPortalImpl/Widgets/Widgets.CommandBar","MsPortalImpl/Base/Base.EventTypes","MsPortalImpl/Extension/Extension.Definition.Locator"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";var a;return (function(t){function w(n,t,i){function w(n,t){var i=t.contextMenuArgs,r=i&&i.listData&&i.listData.selectableSet._msPortalFxSupplyCommands||i&&i.supplyCommands;return v=i&&i.listData&&i.listData.selectableSet,Q(r(t.dataItem)).then((function(n){y=n||[]}))}function b(n,r){var b=v&&u.getSelectedItems(v)||[],w=r.contextMenuArgs.controlCommands,c=t.partComposition,k=c.getViewModel(),d=c.partDefinition,p;if(y.some((function(n){return n.type===3}))){a.error("OpenBladeButton is not supported in the supplyCommands API.  Use OpenBladeButton2. Source: '{0}'".format(i.locator.toString()));n.indicateTaskComplete();return}if(!o.registerOpenBladeCommands(y,k,i,"_contextMenu2Selectables",{selectableSet:v,dataItem:r.dataItem,partDefinition:d})){n.indicateTaskComplete();return}return p=c.createChildLifetime(),y.forEach((function(n){if(n.type===13){var i=n,o=l.Locator.forExtension(i.commandGroupOwner),u=t.services,s=u.finder.locate(o);f.addCommandGroupCommands(p,u,c,s,i.commandGroup,r.contextMenuArgs.listData,i.viewModel,e)}else e.push(h.createItem(p,n,c.locator,t.services,{executeLifetime:c}))})),w&&w.forEach((function(n){var t=new s.ControlCommand(p,n);e.push(t)})),v&&v.itemsArePinnable()?f.addPinCommand(p,b,c,t.services,i.getBladeOpener(),r.contextMenuArgs).then((function(n){n&&e.push(n)}),(function(n){a.error(n)})):void 0}function k(n,t){var u=t.evt,f=r(u.target),i;e.length&&(i=r.Event(c.default.fxcontextmenu),i.clientX=u.clientX,i.clientY=u.clientY,f.trigger(i,{commands:e,isControlContextMenu:!0,srcElement:f[0]}));return}var y,e=[],v,p=[];return p[0]=w,p[1]=b,p[2]=k,p}var v=i.Base,y=v.Diagnostics,p=i.ViewModels,b=p.Toolbars,a=y.createLog(n);t.OpenContextMenuPipeline=e.createDescriptor();t.OpenContextMenuPipeline.registerFactory(w)})(a||(a={})),a}))