var __extends;define("WebsitesExtension/TypeScript/Common/Validation/ServerFarmValidators",["require","exports","o","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants","WebsitesExtension/TypeScript/Utility/Utility.Website"],(function(n,t,i,r,u,f){"use strict";i.defineProperty(t,"__esModule",{value:!0});var e=(function(){function n(){}return n.prototype.validate=function(n){return n.value.length>u.Validations.webHostingPlanMaxLength?Q({valid:!1,message:r.webHostingPlanMaxLengthValidation.format(u.Validations.webHostingPlanMaxLength)}):f.validateEntityName(n.value)},n})();t.ServerFarmNameValidator=e}));define("WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger",["require","exports","WebsitesExtension/TypeScript/Utility/Utility.Website"],(function(n,t,i){"use strict";var r;return (function(n){function r(t,r){n.selectedSource=t;n.telemetryGuid=i.Guid.newGuid();n.steps=r.incObjCount(n.telemetryGuid,n.telemetryGuid)}function u(i,r,u){u===void
0&&(u=null);n.steps=i.incObjCount(n.telemetryGuid,n.telemetryGuid);var f="step={0}".format(n.steps);!u||(f="{0};{1}".format(f,u));t(r,f)}function t(t,r){var u="sessionId={0};{1}".format(n.telemetryGuid,r);i.logTelemetry(n.selectedSource,t,u)}n.sourceAppCreateV2="WebAppCreateV2";n.sourceAppServicePlanCreate="AppServicePlanCreate";n.sourceAPI="APICreate";n.sourceConnection="ConnectionCreate";n.telemetryGuid="";n.steps=0;n.selectedSource="";n.resetTelemetry=r;n.logCreateStep=u;n.logTelemetry=t})(r||(r={})),r}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ViewModels/CreateASPBladeViewModel",["require","exports","f","o","Websites/ClientResources/GeneralResources"],(function(
n,t,i,r,u){"use strict";r.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(){var t=n.call(this)||this;return t.title(u.webHostingPlanBladeTitleCreate),t.subtitle(u.webHostingPlanBladeSubtitleCreate),t.icon(i.Base.Images.Polychromatic.WebHosting()),t}return __extends(t,n),t})(i.ViewModels.Blade);t.CreateASPBladeViewModel=f}));define("WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/Validators",["require","exports","f","o","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/IPv4Address","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/IPv4Subnet","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Utilities/Utilities","Websites/ClientResources/ExtensionCoreResources"],(function(n,t,i,r,u,f,e,o){"use strict";r.defineProperty(t,"__esModule",{value:!0});var s=(function(){function n(){}return n.getIpAddressValidator=function(){return new i.ViewModels.CustomValidation("",function(n){var t={valid:!0,message:undefined};if(n!=="")try{new
u(n)}catch(i){t.valid=!1;t.message=i.message}return Q(e.convertToPromise(t))})},n.getIpAddressInRangeValidator=function(n,t){return new i.ViewModels.CustomValidation("",function(i){var f=new u(i),r={valid:!0,message:undefined};return f.isIpInRange(n,t)||(r.valid=!1,r.message=o.Network.Validation.notInRange.format(n.toString(),u.bytesToAddressString(t.subnetBytes-1))),Q(e.convertToPromise(r))})},n.getIpAddressInSubnetValidator=function(n){return new i.ViewModels.CustomValidation("",function(t){var r=new u(t),i={valid:!0,message:undefined};return n.doesContainIp(r)||(i.valid=!1,i.message=o.Network.Validation.notInSubnet.format(n.toString())),Q(e.convertToPromise(i))})},n.getIpAddressNotReservedValidator=function(n){return new i.ViewModels.CustomValidation("",function(t){for(var f=new u(t),i={valid:!0,message:undefined},r=0;r<n.length;++r)if(f.equals(n[r])){i.valid=!1;i.message=o.Network.Validation.reserved;break}return Q(e.convertToPromise(i))})},n.getCidrSubnetValidator=function(n,t){return new
i.ViewModels.CustomValidation("",function(i){var r={valid:!0,message:undefined},u;try{u=new f(i);n&&t&&(u.prefix>n||u.prefix<t)?(r.valid=!1,r.message=o.Network.Validation.betweenPrefix.format(t,n)):n&&u.prefix>n&&(r.valid=!1,r.message=o.Network.Validation.maxPrefix.format(n))}catch(s){r.valid=!1;r.message=s.message}return Q(e.convertToPromise(r))})},n.getSubnetIsContainedInAddressSpaceValidator=function(n){return new i.ViewModels.CustomValidation("",function(t){var i={valid:!0,message:undefined},r,u;if(n())try{r=new f(t);u=new f(n());u.isOtherSubnetContained(r)||(i.valid=!1,i.message=o.Network.Validation.subnetNotContained.format(n()))}catch(e){i.valid=!1;i.message=e.message}else i.valid=!1,i.message=o.Network.Validation.missingAddressSpace;return Q(i)})},n.getAddressSpaceContainsAllSubnets=function(n){return new i.ViewModels.CustomValidation("",function(t){var i={valid:!0,message:undefined},r;try{r=new f(t);n()&&n().forEach((function(n){var t=new f(n);r.isOtherSubnetContained(t)||(i.valid=
!1,i.message=o.Network.Validation.subnetNotContained.format(n))}))}catch(u){i.valid=!1;i.message=u.message}return Q(i)})},n.getSubnetDoesntOverlapWithOtherSubnets=function(n){return new i.ViewModels.CustomValidation("",function(t){var i={valid:!0,message:undefined},r;try{r=new f(t);n().forEach((function(n){var t=new f(n);r.doesSubnetOverlap(t)&&(i.valid=!1,i.message=o.Network.Validation.subnetOverlaps.format(n))}))}catch(u){i.valid=!1;i.message=u.message}return Q(i)})},n.getPrivateSubnetValidator=function(){return new i.ViewModels.CustomValidation("",function(n){var t={valid:!1,message:o.Network.Validation.privateSpace},r=[new f("172.16.0.0/12"),new f("192.168.0.0/16"),new f("10.0.0.0/8")],i;try{i=new f(n);r.forEach((function(n){n.isOtherSubnetContained(i)&&(t.valid=!0,t.message=undefined)}))}catch(u){t.valid=!1;t.message=u.message}return Q(e.convertToPromise(t))})},n.getCidrValidator=function(n){var t=this;return new i.ViewModels.CustomValidation("",function(i){return Q(t.performCidrValidation(
n,i))})},n.performCidrValidation=function(n,t){var i;try{i=new f(t)}catch(e){return{valid:!1,message:e.message}}if(n.prefixRequired&&t.split("/").length!==2)return{valid:!1,message:o.Network.Validation.prefix.format(t)};if(n.cidrBlockValidationRequired){var s=i.subnetMaskBytes,r=u.bytesToAddressString(s),h=r===i.getIpAddress();if(!h)return{valid:!1,message:o.Network.Validation.invalidCIDRBlockWithSuggestion.format(t,r,i.prefix)}}if(n.maxCidr&&n.minCidr&&n.maxCidr===n.minCidr){if(i.prefix!==n.maxCidr)return{valid:!1,message:o.Network.Validation.exactPrefix.format(n.maxCidr)}}else{if(n.maxCidr&&i.prefix>n.maxCidr)return{valid:!1,message:o.Network.Validation.maxPrefix.format(n.maxCidr)};if(n.minCidr&&i.prefix<n.minCidr)return{valid:!1,message:o.Network.Validation.minPrefix.format(n.minCidr)}}return{valid:!0,message:null}},n.getRangeValidationWithSummaryText=function(n){var t=this;return new i.ViewModels.CustomValidation("",function(i){var r=t.tryGetAddressRangeSummary(i,n),u="";return r||
(u=o.Network.Validation.malformedSubnet.format(i)),Q({valid:r,message:u})})},n.tryGetAddressRangeSummary=function(n,t){try{var i=new f(n);return t(o.Network.Validation.addressRangeSummary.format(i.getFirstAddressInRange(),i.getLastAddressInRange())),!0}catch(r){t(o.Network.Validation.emptyAddressRange)}return!1},n})();t.Validators=s}));define("WebsitesExtension/TypeScript/Models/GeoRegion",["require","exports","o"],(function(){"use strict";var n;return (function(n){var i=(function(){function n(){}return n})(),t;n.GeoRegion=i;t=(function(){function n(n,t,i,r,u){this.id=n;this.displayName=t;this.location=i;this.hostingEnvironmentName=r;this.domainSuffix=u}return n.GetRegions=function(t){return t.map((function(t){return new n(t.Name().replace(/\s/g,"").toLowerCase(),t.Name(),t.Name(),null,null)}))},n.GetRegionsV2=function(t){return t.map((function(t){return new n(t.name().replace(/\s/g,"").toLowerCase(),t.name(),t.name(),null,null)}))},n.GetHostingEnvironments=function(t){return t.map((function(t){var
i="{0}({1})".format(t.Name().toUpperCase(),t.Location());return new n(t.Name().replace(/\s/g,"").toLowerCase(),i,t.Location(),t.Name(),t.DnsSuffix())}))},n.GetHostingEnvironmentsV2=function(t){return t.map((function(t){var i="{0}({1})".format(t.name().toUpperCase(),t.location());return new n(t.name().replace(/\s/g,"").toLowerCase(),i,t.location(),t.name(),null)}))},n})();n.RegionPickerObject=t})(n||(n={})),n}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();define("WebsitesExtension/TypeScript/CreateV2/ViewModels/CreateASPPartViewModel",["require","exports","f","o","a","ko","WebsitesExtension/TypeScript/Utility/Utility.Billing","Websites/ClientResources/GeneralResources","WebsitesExtension/TypeScript/ExtensionAssets/Constants",
"Websites/ClientResources/CreateResources","WebsitesExtension/TypeScript/CreateV2/CreateTelemetryLogger","WebsitesExtension/TypeScript/Models/GeoRegion","WebsitesExtension/TypeScript/Data/Data.Locations","WebsitesExtension/TypeScript/Environment/RuntimeType","WebsitesExtension/TypeScript/Utility/Utility.Specs","WebsitesExtension/TypeScript/SpecPicker/WebsiteSpecData","WebsitesExtension/TypeScript/Utility/Utility.Website","WebsitesExtension/TypeScript/ViewModels/Creates/WorkerPoolPicker","WebsitesExtension/TypeScript/Common/Validation/ServerFarmValidators","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/Validators","WebsitesExtension/TypeScript/Deprecated/ExtensionCore/Network/IPv4Subnet","WebsitesExtension/TypeScript/Environment/Environment.Switcher","WebsitesExtension/TypeScript/_generated/ExtensionDefinition","Fx/Controls/DropDown","WebsitesExtension/TypeScript/_generated/BladeReferences","WebsitesExtension/TypeScript/ExtensionAssets/Constants"],(function(n,t,i,r,u,f,e,
o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){"use strict";r.defineProperty(t,"__esModule",{value:!0});var ft=i.ViewModels.Forms,et=(function(n){function t(t,r,u){var e=n.call(this,t)||this;return e._locationsArray=f.observable(null),e.isLoading=f.observable(!0),e._premiumApp=!1,e._forbiddenComputeMode=null,e._isLinux=!1,e._isXenon=!1,e._regionOptions=[],e._vnetsAvailableInLocation=f.observableArray([]),e._allVnetsAvailable=f.observableArray([]),e.subnetSpaceUseableRange=f.observable(""),e._AvailableSubnets=f.observableArray([]),e._createFromAppBlade=!1,e.features=f.observableArray([]),e._vnetMockObject=f.observable({location:f.observable("")}),e._container=t,e._partName=s.EnvPartNames.CreateWebsiteWizardPartASPCreatorV2,e._dataContext=u,e._tCount=u.objectCache.incObjCount(e._partName,e._partName),c.logCreateStep(u.objectCache,"Create ASP Blade Opened"),e._AseNameValidationQuery=u.aseData.HostNameAvailable.createView(t),e._appServicePlansView=e._dataContext.websitesData.webhostingPlansForSubsCacheFromArm.
createView(t),e._hostingEnvironmentView=e._dataContext.aseData.aseCache.createView(t),e._lightHostingEnvironmentListView=e._dataContext.aseData.aseDataLightweightCache.createView(t),e._heavyHostingEnvironmentListView=e._dataContext.aseData.aseDataQueryCache.createView(t),e._locationsView=e._dataContext.locations.DeploymentLocationQuery.createView(t,{interceptNotFound:!1}),e._locationsArmView=e._dataContext.locations.ArmLocationQuery.createView(t,{interceptNotFound:!1}),e._geoLocationsView=e._dataContext.locations.geoLocationQuery.createView(t),e._onPremPricingTiersView=v.isOnPrem()?e._dataContext.pricingTiersData.PricingTierCache.createView(t):null,e.setupActionBar(t),e.parameterProvider=new i.ViewModels.ParameterProvider(t,{mapIncomingDataForEditScopeAsync:e._mapIncomingDataForEditScope.bind(e),mapOutgoingDataForCollector:function(n){var h=n.locationId().split(";"),t=null,c,r,u,l,o,a;return h.length===2?(n.region(h[0]),c=h[1],e._hostingEnvironmentView.item()&&e._hostingEnvironmentView.
item().Name()===c&&(t=e._hostingEnvironmentView.item(),n.hostingEnvironmentId(t.Id()))):(n.region(h[0]),n.hostingEnvironmentId(null)),r=y.getWebsiteSpecDetails(n.sku()),u=!1,t&&(l=t&&t.Kind&&t.Kind(),u=l!==s.ASEv2.kind),o=v.isOnPrem()?i.find(e._onPremPricingTiersView.items(),(function(t){return p.getOnPremSpecId(t)===n.sku()})):null,a={SubscriptionId:f.observable(""),ResourceGroup:f.observable(""),Name:n.name,Id:f.observable(""),Sku:v.isOnPrem()?f.observable(o.SkuName()):!u?f.observable(r.Sku):f.observable(s.ServerFarmSku.premium),SkuFamily:v.isOnPrem()?f.observable(r.Sku):undefined,Location:n.region,OldPortalRedirectUrl:f.observable(""),Status:f.observable(0),WorkerSize:u?f.observable(+n.workerPool()):f.observable(r.VMSize),WorkerSizeId:v.isOnPrem()?f.observable(o.WorkerTierId()):u?f.observable(+n.workerPool()):f.observable(r.VMSize),WorkerTierName:v.isOnPrem()?f.observable(o.WorkerTierName()):f.observable(""),NumberOfWorkers:f.observable(1),HostingEnvironmentId:n.hostingEnvironmentId()?
n.hostingEnvironmentId:f.observable(""),HostingEnvironmentProfile:f.observable(null),NumberOfSites:f.observable(0),WebSpace:f.observable(""),IsLinux:f.observable(e._isLinux),IsXenon:f.observable(e._isXenon),Reserved:f.observable(e._isLinux),ComputeMode:v.isOnPrem()?f.observable(o.ComputeMode()):undefined,AseCreateData:r.Sku!==s.ServerFarmSku.isolated&&!t?f.observable(null):f.observable({AseName:n.aseName,VnetId:!!e._vnetSelectDropdown&&!!e._vnetSelectDropdown.value()&&f.observable(e._vnetSelectDropdown.value().id),VnetName:n.vnetNew()?n.vnetName:f.observable(e._vnetSelectDropdown.value().name),VnetNew:n.vnetNew,SubnetAddressSpace:n.vnetNew()?f.observable(s.VirtualNetworks.DefaultSubnetAddress):n.subnetAddressSpace,SubnetName:n.vnetNew()?f.observable(n.aseName()+"-subnet"):n.subnetName})},a}}),e.editScope=e.parameterProvider.editScope,e._initializeFormFields(t,r),e}return __extends(t,n),t.prototype.setupActionBar=function(n){this.actionBar=new i.ViewModels.ActionBars.GenericActionBar.ViewModel(
n);this.valid.subscribe(n,this.actionBar.valid)},r.defineProperty(t.prototype,"_dataModel",{get:function(){var n=this.editScope();return n&&n.root},enumerable:!0,configurable:!0}),t.prototype._initializeFormFields=function(n){var t=this,u=new k.ServerFarmNameValidator,r;this.nameTextBox=new i.ViewModels.Forms.TextBox.ViewModel(n,this,"name",{label:f.observable(h.Wizard.Steps.WebHostingPlan.title),emptyValueText:f.observable(h.aspName),validations:f.observableArray([new i.ViewModels.RequiredValidation(h.Wizard.Validation.required),new i.ViewModels.CustomValidation("",function(n){return u.validate({value:n})}),new i.ViewModels.CustomValidation("",function(n){return t._validateHostingPlanName(n)})])});this.nameTextBox.delayValidationTimeout(500);this.nameTextBox.valueUpdateTrigger=4;this.LocationDropBox=new it.ViewModel(n,this,"locationId",{label:f.observable(h.Wizard.Steps.Location.title),validations:f.observableArray([new i.ViewModels.RequiredValidation(h.Wizard.Validation.required),new
i.ViewModels.CustomValidation("",function(n){var i=Q.defer(),u=n.split(";"),r;return u.length===1?Q({valid:!0,message:""}):(r=t._lightHostingEnvironmentListView.items().first((function(n){return n.name()===u[1]})),r?t._checkAseWriteAccess(r.id()).then((function(n){return n?i.resolve({valid:!0,message:""}):i.resolve({valid:!1,message:o.aSEWritePermissionRequired})})):i.resolve({valid:!1,message:o.aSEWritePermissionRequired}),i.promise)}),new i.ViewModels.CustomValidation("",function(n){var i=Q.defer(),u=n.split(";"),r=null;return u.length>1&&(r=t._lightHostingEnvironmentListView.items().first((function(n){return n.name()===u[1]}))),t._isLinux&&(!!r||t.editScope().root.sku().toLowerCase().indexOf("isolated")>-1)?r&&r.kind()!==s.ASEv2.kind?i.resolve({valid:!1,message:o.aSEInvalidAseVersionForLinux}):i.resolve({valid:!0,message:""}):i.resolve({valid:!0,message:""}),i.promise})])});this.LocationDropBox.delayValidationTimeout(500);this.LocationDropBox.value.subscribe(n,(function(n){var r,u,i;if(t._vnetMockObject(
{location:f.observable(n)}),r=!!t.LocationDropBox.value()&&t.LocationDropBox.value().split(";").length>1,c.logCreateStep(t._dataContext.objectCache,"ASP Location Changed","Location={0}".format(n)),r?(t.generalSection.children.remove(t.pricingTierSelector),t.generalSection.children.remove(t.workerPoolSelector)):(t.generalSection.children.remove(t.workerPoolSelector),t.generalSection.children().first((function(n){return n===t.pricingTierSelector}))||t.generalSection.children.push(t.pricingTierSelector)),u=n.split(";"),r){if(t.generalSection.children.remove(t.workerPoolSelector),t.generalSection.children.remove(t._aseSection),i=t._lightHostingEnvironmentListView.items().first((function(n){return n.name()===u[1]})),!i)return;i.kind&&i.kind()===s.ASEv2.kind?(t.generalSection.children.indexOf(t.pricingTierSelector)===-1&&t.generalSection.children.push(t.pricingTierSelector),t.pricingTierSelector.value()&&t.pricingTierSelector.value().indexOf(s.ServerFarmSKUSpecs.isolated)!==-1||t.pricingTierSelector.
value(s.ServerFarmSKUSpecs.small_isolated),t.actionBar.disabled(!0),t.pricingTierSelector.enabled(!1),t._hostingEnvironmentView.fetch(i.id()).then((function(){t.actionBar.disabled(!1);t.pricingTierSelector.enabled(!0)}))):(t.actionBar.disabled(!0),t.workerPoolSelector.enabled(!1),t.generalSection.children.push(t.workerPoolSelector),t._hostingEnvironmentView.fetch(i.id()).then((function(){t.workerPoolSelector.enabled(!0);t.actionBar.disabled(!1);var i=t._hostingEnvironmentView.item(),n=i.EnvironmentCapacities().first((function(n){return n.AvailableCapacity()>0}));n?t._dataModel.workerPool(n.WorkerSize()):t._dataModel.workerPool(0)})))}else t._vnetsAvailableInLocation(t._allVnetsAvailable().filter((function(t){return t.location.toLowerCase().replaceAll(" ","")===n.toLowerCase().replaceAll(" ","")}))),t.pricingTierSelector.value()&&t.pricingTierSelector.value().endsWith(s.ServerFarmSKUSpecs.isolated)?t._createFromAppBlade?t.generalSection.children.indexOf(t._aseSection)===-1&&t.generalSection.children.
push(t._aseSection):t.pricingTierSelector.value(s.ServerFarmSKUSpecs.small_standard):t.generalSection.children.indexOf(t._aseSection)>-1&&t.generalSection.children.remove(t._aseSection)}));this.pricingTierSelector=new ft.Selector.ViewModel(n,this,"sku",{label:f.observable(h.Wizard.Steps.PricingTier.title),validations:f.observableArray([new i.ViewModels.RequiredValidation(h.Wizard.Validation.required)])});this.pricingTierSelector.displayText=f.pureComputed((function(){var n,r;return v.isOnPrem()?(n=i.find(t._onPremPricingTiersView.items(),(function(n){return p.getOnPremSpecId(n)===t.pricingTierSelector.value()})),n?n.Name()+" "+n.SkuName():""):(r=y.findSpecBySpecId(t.pricingTierSelector.value(),p.getAzureSpecData().specs),t.pricingTierSelector.value()&&"{0}  {1}".format(r.specCode,r.title))}));v.isNationalCloud()||v.isOnPrem()?this.pricingTierCollector=new i.ViewModels.ParameterCollector(n,{supplyInitialData:function(){c.logCreateStep(t._dataContext.objectCache,"Opened ASP Price Picker");var
i=(!v.isNationalCloud()||v.isFairfax())&&(t._createFromAppBlade||t.pricingTierSelector.value().indexOf(s.ServerFarmSKUSpecs.isolated)!==-1),n={includeEnterprise:i,excludeMulti:t.LocationDropBox.value().indexOf(";")!==-1,premiumApp:t._premiumApp,forbiddenSkus:t._forbiddenSkus,forbiddenComputeMode:t._forbiddenComputeMode,isLinux:t._isLinux,isXenon:t._isXenon,regionId:t.LocationDropBox.value().split(";")[0]};return v.isOnPrem()&&(n.numberOfWorkers=1),{fromCollectorToProvider:{subscriptionId:t._selectedSubscriptionId,selectedSpecId:t.pricingTierSelector.value(),selectRecommendedView:!0,options:n}}},supplyProviderConfig:function(){},receiveResult:function(n){var i=n.fromProviderToCollector.selectedSpecId;c.logCreateStep(t._dataContext.objectCache,"Changed Pricing Tier","PricingTier={0}".format(i));t.pricingTierSelector.value(i);t.LocationDropBox.validate(t.LocationDropBox.validate()+1);i.indexOf(s.ServerFarmSKUSpecs.isolated)===-1||t.LocationDropBox.value().split(";").length>1?t.generalSection.
children.remove(t._aseSection):t.generalSection.children.indexOf(t._aseSection)===-1&&t.generalSection.children.push(t._aseSection)},selectable:this.pricingTierSelector.selectable}):this.pricingTierSelector.selectable.isSelected.subscribe(this._container,(function(n){if(n){var i=t.LocationDropBox.value().split(";"),r=t._getCleanForbiddenSkus(),u=t._createFromAppBlade||i.length>1;t._container.openBlade(new rt.SpecPickerFrameBladeReference({id:"/subscriptions/"+t._selectedSubscriptionId,data:{subscriptionId:t._selectedSubscriptionId,location:i[0],hostingEnvironmentName:i.length>1?i[1]:null,allowAseV2Creation:u,forbiddenSkus:r,isLinux:t._isLinux,isXenon:t._isXenon,selectedLegacySkuName:t.pricingTierSelector.value()}},function(n,i){n===2&&(t.pricingTierSelector.value(i.value),t.LocationDropBox.validate(t.LocationDropBox.validate()+1),i.value.indexOf(s.ServerFarmSKUSpecs.isolated)===-1||t.LocationDropBox.value().split(";").length>1?t.generalSection.children.remove(t._aseSection):t.generalSection.
children.indexOf(t._aseSection)===-1&&t.generalSection.children.push(t._aseSection));setTimeout((function(){t.pricingTierSelector.selectable.isSelected(!1)}))}))}}));this.workerPoolSelector=new ft.Selector.ViewModel(n,this,"workerPool",{label:f.observable(o.workerPoolColumn)});this.workerPoolSelector.displayText=f.pureComputed((function(){return o.workerPool.format(t.workerPoolSelector.value()+1)}));this.workerPoolCollector=new i.ViewModels.ParameterCollector(n,{supplyInitialData:function(){c.logCreateStep(t._dataContext.objectCache,"Opened ASE Price Picker");var n=t._hostingEnvironmentView.item(),i=b.prepareInputsWithHostingEnv(n,0);return{fromCollectorToProvider:{subscriptionId:t._selectedSubscriptionId,selectedSpecId:"",options:{options:i.options}}}},supplyProviderConfig:function(){},receiveResult:function(n){c.logCreateStep(t._dataContext.objectCache,"Changed Pricing Tier","");var i=n.fromProviderToCollector.selectedSpecId;t.workerPoolSelector.value(i)},selectable:this.workerPoolSelector.
selectable});r={children:f.observableArray([this.nameTextBox,this.LocationDropBox,this.pricingTierSelector,this.workerPoolSelector])};this._setupAseForm(n);this._vnetsAvailableInLocation.subscribe(n,(function(n){n.length===0?(t._vnetCreateOrSelect.value(!0),t._vnetCreateOrSelect.enabled(!1)):(t._vnetCreateOrSelect.enabled(!0),t._vnetSelectDropdown.items(n.map((function(n){return{disabled:f.observable(!1),value:n,text:f.observable(n.name)}}))),t._vnetSelectDropdown.value(n.first()))}));this.generalSection=new ft.Section.ViewModel(n,r);this.sections.push(this.generalSection)},t.prototype._setupAseForm=function(n){var t=this,u=new i.ViewModels.Forms.TextBox.ViewModel(n,this,"aseName",{label:f.observable(o.aseName),emptyValueText:f.observable(h.aseName),infoBalloonContent:f.observable(o.aseNameInfoBaloon),validations:f.observableArray([new i.ViewModels.RequiredValidation(h.Wizard.Validation.required),new i.ViewModels.MinLengthValidation(s.Validations.websiteNameMinLength,o.websiteNameMinLength),
new i.ViewModels.MaxLengthValidation(s.Validations.aseNameMaxLength,o.aseNameMaxLength),new i.ViewModels.CustomValidation("",w.validateEntityName),new i.ViewModels.CustomValidation("",function(n){return t.validateAseName(t._selectedSubscriptionId,n)})])}),r;this._setupVNet(n);this._aseCostSection=new ft.Selector.ViewModel(n,{label:f.observable(o.aSECreatePricingDetails)});this._container.registerSelectable(this._container,"AsePricingDetailsChevron",this._aseCostSection.selectable);r={children:f.observableArray([u,this.vnetFullSection,this._aseCostSection])};this._aseSection=new ft.Section.ViewModel(n,r)},t.prototype._setupVNet=function(n){var t=this,e,h,c,l,a,v;this.vnetFullSection=new ft.Section.ViewModel(n);e={label:f.observable(o.vNETLabel),options:f.observableArray([{text:f.observable(o.createNew),value:!0},{text:f.observable(o.selectExisting),value:!1}]),infoBalloonContent:f.observable(o.aseVnetSelectInfoBaloon),defaultValue:f.observable(!0),validations:f.observableArray([new i.ViewModels.
RequiredValidation]),radioButtonStyle:!0};this._vnetCreateOrSelect=new ft.OptionsGroup.ViewModel(n,this,"vnetNew",e);h={emptyValueText:f.observable(""),validations:f.observableArray([new i.ViewModels.RequiredValidation,new i.ViewModels.RegExMatchValidation(s.Regex.vnetName,o.vnetNameRegexValidation),new i.ViewModels.CustomValidation("",function(n){var i=!0,r="",u=t._allVnetsAvailable().first((function(t){return AntUx.StringEx.equals(t.name,n,AntUx.StringComparison.IgnoreCase)}));return!u||(i=!1,r=o.vnetExistsError),Q({valid:i,message:r})})])};c=new ft.TextBox.ViewModel(n,this,"vnetName",h);this._vnetSelectDropdown=new it.ViewModel(n,{ariaLabel:f.observable(o.vNETLabel),validations:f.observableArray([new i.ViewModels.RequiredValidation])});var u=new it.ViewModel(n,{infoBalloonContent:f.observable(o.aseAddressBlockInfoBaloon),label:f.observable(o.addressSpace),validations:f.observableArray([new i.ViewModels.RequiredValidation])}),y={emptyValueText:f.observable(""),label:f.observable(o.subnetName),
infoBalloonContent:f.observable(o.aseSubnetNameInfoBaloon),validations:f.observableArray([new i.ViewModels.RequiredValidation(o.validationRequired),new i.ViewModels.CustomValidation("",function(n){var i=!0,r="",u;if(!t._vnetSelectDropdown.value())return Q({valid:i,message:r});try{u=t._vnetSelectDropdown.value().subnets.first((function(t){return AntUx.StringEx.equals(n,t.name,AntUx.StringComparison.IgnoreCase)}));!u||(i=!1,r=o.subnetExistsError)}catch(f){i=!1;r=f.message}return Q({valid:i,message:r})})])},p=new ft.TextBox.ViewModel(n,this,"subnetName",y),r=new it.ViewModel(n,{infoBalloonContent:f.observable(o.aseAddressBlockInfoBaloon),label:f.observable(o.subnetSize),validations:f.observableArray([new i.ViewModels.RequiredValidation(o.fullVnet)])});u.value.subscribe(n,(function(n){t._AvailableSubnets(t._generateGaps(n));var i=t._AvailableSubnets().map((function(n){return n.split("/")[1]})).distinct();r.items(i.map((function(n){return{disabled:f.observable(!1),value:n,text:f.observable(g.GetNumberOfHostIpsInBlock(
Number(n))+" "+o.availableAddresses+" (/"+n+")")}})));r.value(i.first());t._updateSubnetAddressSpace(r.value())}));r.value.subscribe(n,(function(n){t._updateSubnetAddressSpace(n)}));this._vnetSelectDropdown.value.subscribe(n,(function(n){u.items(n.addressSpace.addressPrefixes.map((function(n){return{disabled:f.observable(!1),value:n,text:f.observable(n)}})));u.value(n.addressSpace.addressPrefixes.first())}));l={children:f.observableArray([this._vnetSelectDropdown,u,p,r])};this.existingVnetFormSection=new ft.Section.ViewModel(n,l);a=[this._vnetCreateOrSelect,c];v=[this._vnetCreateOrSelect,this.existingVnetFormSection];this._vnetCreateOrSelect.value.subscribe(n,(function(n){t.vnetFullSection.children(n?a:v)})).callback(this._vnetCreateOrSelect.value())},t.prototype._getCleanForbiddenSkus=function(){var n=this._forbiddenSkus;return!u.isArray(this._forbiddenSkus)&&this._forbiddenSkus?n=this._forbiddenSkus.split(","):this._forbiddenSkus||(n=[]),n.first((function(n){return n.toLowerCase()==="basic"}))&&
(n=n.concat(ut.ServerFarmSKUSpecs.small_basic,ut.ServerFarmSKUSpecs.medium_basic,ut.ServerFarmSKUSpecs.large_basic)),n.first((function(n){return n.toLowerCase()==="standard"}))&&(n=n.concat(ut.ServerFarmSKUSpecs.small_standard,ut.ServerFarmSKUSpecs.medium_standard,ut.ServerFarmSKUSpecs.large_standard)),n.first((function(n){return n.toLowerCase()==="premium"}))&&(n=n.concat(ut.ServerFarmSKUSpecs.small_premium,ut.ServerFarmSKUSpecs.medium_premium,ut.ServerFarmSKUSpecs.large_premium)),n.first((function(n){return n.toLowerCase()==="premiumv2"}))&&(n=n.concat(ut.ServerFarmSKUSpecs.small_premiumV2,ut.ServerFarmSKUSpecs.medium_premiumV2,ut.ServerFarmSKUSpecs.large_premiumV2)),n.first((function(n){return n.toLowerCase()==="isolated"}))&&(n=n.concat(ut.ServerFarmSKUSpecs.small_isolated,ut.ServerFarmSKUSpecs.medium_isolated,ut.ServerFarmSKUSpecs.large_isolated)),n.first((function(n){return n.toLowerCase()==="premiumcontainer"}))&&(n=n.concat(ut.ServerFarmSKUSpecs.small_premium_container,ut.ServerFarmSKUSpecs.
medium_premium_container,ut.ServerFarmSKUSpecs.large_premium_container)),n},t.prototype._updateSubnetAddressSpace=function(n){this._dataModel.subnetAddressSpace(this._AvailableSubnets().first((function(t){return t.indexOf("/"+n)!==-1})))},t.prototype._mapIncomingDataForEditScope=function(n){return this._createFromAppBlade=!0,this._setDefaults(n)},t.prototype._setDefaults=function(n){var t=this,u=this.parameterProvider.configFromCollector(),k,c,h,g,r,y,d,it;this._premiumApp=!!u&&!!u.premium;this._forbiddenSkus=!!u&&u.forbiddenSkus;this._forbiddenComputeMode=!!u&&u.forbiddenComputeMode;this._isLinux=this._isLinux||!!u&&!!u.isLinux;this._isXenon=!!u&&!!u.isXenon;k=!!u&&!!u.hideLocation;c=!!u&&u.workerPool;c||(c=0);k&&this.generalSection.children.remove(this.LocationDropBox);h=!!u&&u.inASE;g=v.isOnPrem()?"":this._isXenon?s.ServerFarmSKUSpecs.small_premium_container:this._isLinux?s.ServerFarmSKUSpecs.small_premiumV2:s.ServerFarmSKUSpecs.small_standard;r={name:f.observable(),region:f.observable(
),hostingEnvironmentId:f.observable(h),sku:f.observable(g),subscription:n.subscription,locationId:f.observable(),workerPool:f.observable(c),aseName:f.observable(),vnetNew:f.observable(!0),vnetId:f.observable(),vnetName:f.observable(),vnetAddressSpace:f.observable(),subnetName:f.observable(),subnetAddressSpace:f.observable(),os:f.observable()};this._forbiddenSkus&&this._forbiddenSkus.indexOf(s.ServerFarmSku.standard)>-1&&!v.isOnPrem()&&r.sku(s.ServerFarmSKUSpecs.small_premium);this._selectedSubscriptionId=n.subscription();var b=Q.defer(),rt=w.telemetryStartTrace(this._partName,"LoadRegionItems",this._tCount),ut=this._appServicePlansView.fetch(this._selectedSubscriptionId);return this._aseCostSection.selectable.selectedValue({detailBlade:tt.BladeNames.asePricingDetailsBlade,detailBladeInputs:{subscriptionId:this._selectedSubscriptionId,vnet:this._vnetMockObject}}),this._isXenon?y=a.Locations.getDeploymentLocations(this._geoLocationsView,this._locationsArmView,n.subscription(),s.Asset.xenonLocationQuery).
then((function(n){t._locationsArray(n);n.locations()&&n.locations().first()&&(t.defaultResourceGroupLocation=n.locations().first().name())})):this._isLinux?(d=Q.defer(),a.Locations.getDeploymentLocations(this._geoLocationsView,this._locationsArmView,n.subscription(),s.Asset.linuxLocationQuery).then((function(i){t._locationsArray(i);i.locations()&&i.locations().first()&&(t.defaultResourceGroupLocation=i.locations().first().name());y=a.Locations.getDeploymentLocations(t._locationsView,t._locationsArmView,n.subscription()).then((function(n){t._locationsArray().hostingEnvironmentDeploymentInfos=n.hostingEnvironmentDeploymentInfos;d.resolve(t._locationsArray())}))})),y=d.promise):y=a.Locations.getDeploymentLocations(this._locationsView,this._locationsArmView,n.subscription()).then((function(n){t._locationsArray(n);n.locations()&&n.locations().first()&&(t.defaultResourceGroupLocation=n.locations().first().name())})),it=i.Azure.getSubscriptionInfo(this._selectedSubscriptionId),it.then((function(u){var
a,d;t.features(nt.getFeaturesSubProvided(s.EnvPartNames.CreateWebsiteWizardPartV2,u));a=Q.resolve([]);nt.hasFeature(t.features(),s.EnvFeature.NoVnet)||(a=t._dataContext.aseData.vnetV2Cache.fetch(t._selectedSubscriptionId,t._container).then((function(n){return f.toJS(n.data())})));d=[y,t._lightHostingEnvironmentListView.fetch(n.subscription()),a];v.isOnPrem()&&d.push(t._onPremPricingTiersView.fetch(n.subscription()));Q.all(d).then((function(a){var et=null,ht=a[2],it,g,ot,y,ft,tt,d,st;t._allVnetsAvailable(ht);w.telemetryCompleteTrace(rt,t._tCount);it=t._locationsArray();g=l.RegionPickerObject.GetRegionsV2(it.locations());(!k||h)&&(ot=l.RegionPickerObject.GetHostingEnvironmentsV2(it.hostingEnvironmentDeploymentInfos()),g=g.concat(ot));y=g.map((function(n){var t=n.displayName;return!n.hostingEnvironmentName||(t="{0};{1}".format(n.location,n.hostingEnvironmentName)),{text:f.observable(n.displayName),value:t,disabled:f.observable(!1)}}));t._regionOptions=y;ft=y.filter((function(n){return n.value.split(
";").length===2}));tt=[];v.isOnPrem()||tt.push({text:o.appServiceEnvironment,children:ft.length>0?ft:[{text:o.noAseInSub,disabled:f.observable(!0),value:null}]});tt.push({text:o.georegions,children:y.filter((function(n){return n.value.split(";").length<2})).sortBy((function(n){return f.toJS(n.text)}))});t.LocationDropBox.items(tt);d=y.first((function(n){return n.value.split(";").length===2&&!n.disabled()}));!h||(st=i.ViewModels.Services.ResourceTypes.parseResourceDescriptor(h),d=y.first((function(n){return n.value.indexOf(st.resource)!==-1})));d?r.workerPool(c):(d=y.first((function(n){return!n.disabled()})),nt.hasFeature(t.features(),s.EnvFeature.DefaultToFree)?t._isLinux?r.sku(p.specIds.smallBasic):r.sku(p.specIds.free):e.isAzurePassSubscription(e.fxSubscriptionToHubsSubscription(u))&&r.sku(p.specIds.shared));r.locationId(d?d.value:"");!h&&t._lightHostingEnvironmentListView.items().length>0&&(et=t._heavyHostingEnvironmentListView.fetch(n.subscription()).then((function(){var u=t._heavyHostingEnvironmentListView.
items().filter((function(n){var i=n&&n.properties&&n.properties()&&n.properties().environmentCapacities&&n.properties().environmentCapacities()&&n.properties().environmentCapacities().filter((function(n){return n.availableCapacity()>0})),r=n&&!!n.kind&&n.kind()===s.ASEv2.kind,u=!!t._regionOptions.first((function(t){return t.value.toLowerCase().indexOf(n.name().toLowerCase())>-1}));return u&&(i&&i.length>0||r)})),e=u.first((function(n){return n.id()===r.hostingEnvironmentId()})),i=t._regionOptions,h,c,n,l,a,v;i=i.filter((function(n){var r=n.value.split(";").length>1,i=null;return r&&(i=u.first((function(t){return n.value.indexOf(t.name())>-1})),t._isLinux&&i&&i.kind&&i.kind()!==s.ASEv2.kind&&n.disabled(!0)),!r||!!i}));h=i.filter((function(n){return n.value.split(";").length===2}));c=[{text:o.appServiceEnvironment,children:h.length>0?h:[{text:o.noAseInSub,disabled:f.observable(!0),value:null}]},{text:o.georegions,children:i.filter((function(n){return n.value.split(";").length<2})).sortBy((function(n){return f.
toJS(n.text)}))}];t.LocationDropBox.items(c);e?(a=e.properties().environmentCapacities().first((function(n){return n.workerSizeId()===r.workerPool()})),a.availableCapacity()<1&&(v=e.properties().environmentCapacities().first((function(n){return n.availableCapacity()>0})).workerSizeId(),r.workerPool(v))):(n=u.first(),n?(n.kind&&n.kind()===s.ASEv2.kind?(r.hostingEnvironmentId(n.id()),r.workerPool(0),r.sku(s.ServerFarmSKUSpecs.small_isolated)):(r.hostingEnvironmentId(n.id()),l=n.properties().environmentCapacities().first((function(n){return n.availableCapacity()>0})).workerSizeId(),r.workerPool(l)),r.locationId(i.first((function(t){return t.value.indexOf(n.name())>-1})).value)):(r.hostingEnvironmentId(null),r.workerPool(0),r.locationId(i.first().value)))})));Q.all([ut,et]).then((function(){t.isLoading(!1);b.resolve(r)}),(function(){b.reject()}))}),(function(){b.reject()}))})),b.promise},t.prototype._checkAseWriteAccess=function(n){return i.Base.Security.hasPermission(n,[tt.AssetTypes.Website.Permissions.action])}
,t.prototype._validateHostingPlanName=function(n){var t=Q.defer(),u,i,r;if(n&&AntUx.StringEx.equals(n,s.Validations.webHostingPlanRestrictedName,AntUx.StringComparison.IgnoreCase))return t.resolve({valid:!1,message:o.hostingPlanNameDefaultFailureMessage.format(s.Validations.webHostingPlanRestrictedName)}),t.promise;if(n)for(i=0;i<this._appServicePlansView.items().length;i++)if(r=this._appServicePlansView.items()[i],r.Name().toLowerCase()===n.toLowerCase())return t.resolve({message:o.hostingPlanNameConflictMessageSubscription,valid:!1}),t.promise;return t.resolve({valid:!0,message:u}),t.promise},t.prototype._generateGaps=function(n){var t,f,i;if(n){var e=Number(n.split("/")[1]),r=[],u=new g(n);for(t=s.VNET.maxAllowedSubnetSpaceForAse;t>e;t--)f=this._vnetSelectDropdown.value().subnets.map((function(n){return new g(n.addressPrefix)})),i=u.getChildSubnet(t,f.filter((function(n){return u.doesContainIp(n)}))),i&&d.Validators.performCidrValidation({prefixRequired:!0,cidrBlockValidationRequired:!0,
maxCidr:s.VNET.maxAllowedSubnetSpaceForAse},i.toString()).valid&&r.push(i.toString());return r}},t.prototype.validateAseName=function(n,t){var u=this,i=Q.defer(),r=o.aseNameNotAvailable;return t?this._AseNameValidationQuery.fetch({Name:t,subscriptionId:n}).then((function(){i.resolve({valid:u._AseNameValidationQuery.item(),message:r})})):i.resolve({valid:!0,message:r}),i.promise},t})(ft.Form.ViewModel);t.CreateASPPartViewModel=et}))