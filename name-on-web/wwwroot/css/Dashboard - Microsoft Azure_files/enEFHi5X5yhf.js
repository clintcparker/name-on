define("HubsExtension/ArmHelpers/Models/ArmResourceInstance",["require","exports","f","o","HubsExtension/ArmHelpers/Models/ArmResource","HubsExtension/ArmHelpers/Models/ArmResourceGroup"],(function(n,t,i,r,u,f){"use strict";function s(n){return n?e.isResourceGroupId(n.id)?f.toResourceGroup(n):e.isResourceId(n.id)||e.isTenantResource(n.id)?u.toResource(n):null:null}r.defineProperty(t,"__esModule",{value:!0});var o=i.Base.Diagnostics,e=i.ViewModels.Services.ResourceTypes,h=o.createLog(n);t.toResourceInstance=s}));
define("HubsExtension/_generated/HtmlTs/Tagsv2/Blades/ResourceRowColumn",["require","exports","f"],(function(){"use strict";return function(){return'<div class="ext-res-field"> <div class="ext-field-resource"><span class="msportalfx-gridcolumn-assetsvg-icon" aria-hidden="true" data-bind="image:value.item.icon,attr:{title:value.item.assetType}"><\/span><span class="msportalfx-gridcolumn-assetsvg-text"><span class="ext-res-field-text" data-bind="attr:{title:value.item.nameFormatted}"><span class="ext-res-field-name" data-bind="text:value.item.name"><\/span><span class="ext-res-field-type" data-bind="text:value.item.typeFormatted"><\/span><\/span><\/span><\/div> <div class="ext-field-status"><!-- ko if: value.item.resultImage --><span class="msportalfx-tile-status-icon ext-status-icon" aria-hidden="true" data-bind="image:value.item.resultImage,attr:{title:value.item.errorStatus}"><\/span><!-- /ko --><span data-bind="text:value.item.status,attr:{title:value.item.status},css:{\'ext-status-error\':value.item.statusError}"><\/span><!-- ko if: value.item.showBalloon --><div data-bind="pcControl:value.item.statusBalloon"><\/div><!-- /ko --><\/div> <!-- ko if: value.item.errorStatus --><div class="ext-field-status"><span class="ext-status-error" data-bind="text:value.item.errorStatus,attr:{title:value.item.errorStatus}"><\/span><!-- ko if: value.item.showErrorBalloon --><div data-bind="pcControl:value.item.errorBalloon"><\/div><!-- /ko --><\/div><!-- /ko --> <\/div> <div class="ext-commandhotspot" data-bind="pcControl:value.delete,attr:{title:value.deleteTooltip}"><div class="ext-commandimage" data-bind="image:MsPortalFx.Base.Images.Delete()"><\/div><\/div>'}}));
define("HubsExtension/Tagsv2/ResourcesEditorGridViewModel",["require","exports","i","o","ko","Fx/Controls/HotSpot","FxInternal/Controls/Grid2/GridB","FxInternal/Data/ArrayListNavigator","HubsExtension/Tags/TagsClientStrings","HubsExtension/_generated/HtmlTs/Tagsv2/Blades/ResourceRowColumn"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";r.defineProperty(t,"__esModule",{value:!0});var c=i.ViewModels.Controls.Lists,l=new c.Grid2.Formatters.HtmlTemplate({template:h()}),a=(function(n){function t(t,i){var e=this,h=i.gridItems,c=i.removeResource,r;return e=n.call(this,t,{dataNavigator:new o(t,{sourceItems:h,getId:function(n){return n.resourceId},getModel:function(n){return r&&r.dispose(),r=t.createChildLifetime(),n.map((function(t){var i={resource:{item:t}};return n.length>1&&(i.resource.delete=new f.ViewModel(r,{onClick:function(){c(t)}}),i.resource.deleteTooltip=s.Common.deleteResourceTooltip),i}))}}),showHeader:!1,columns:u.observableArray([{id:"resource",format:l},])})||this,e.dataNavigator.items.subscribe(t,(function(n){if(n.length===1){var t=n[0].data().resource.delete;t&&t.disabled(!0)}})),e}return __extends(t,n),t})(e.ViewModel);t.ResourcesEditorGridViewModel=a}));
define("HubsExtension/Tagsv2/Blades/AssignTagsBlade",["require","exports","f","i","o","ko","Fx/Composition/TemplateBlade","Fx/Controls/Button","HubsExtension/ResourceMap/ResourceMapClientStrings","HubsExtension/Tags/TagsClientStrings","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ArmHelpers/Models/ArmResourceInstance","HubsExtension/Common/AssetTypeCache","HubsExtension/Common/HubsObservables","HubsExtension/Common/ResourceIconMap","HubsExtension/Tags/TagsArea","HubsExtension/Tags/TagsStartup","HubsExtension/Tagsv2/ResourcesEditorGridViewModel","HubsExtension/Tagsv2/TagsEditorGridViewModel","HubsExtension/Tagsv2/Tagsv2Area"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function wt(n,t,r,u){var f=[];return t.forEach((function(n){pt(n)?f.push(Q({resourceId:n,uri:c.resourceGroupApi(n)})):lt(n)?f.push(Q(c.resourceApi(n).then((function(t){return{resourceId:n,uri:t}})))):f.push(Q.reject({resourceId:n,failure:"Cannot assign tags to ID which is not resource or resource group: <"+n+">"}))})),Q.allSettled(f).then((function(t){var f=[],e=new i.Map;return t.forEach((function(n){n.state==="fulfilled"?(f.push(n.value.uri),e.set(n.value.uri,n.value.resourceId)):u(n.reason.resourceId,n.reason.failure)})),Q(c.callBatchWithContinuation(f,(function(n){r(l.toResourceInstance(n))}),(function(n){u(e.get(n.api),JSON.stringify(n.reason))}),!1,n))}))}function tt(n,t,i,r,u){n.status(t);n.statusError(!!i);n.showBalloon(!!r);n.statusBalloon().content(u)}function ft(n,t,r,f){var e=!0;return t&&t.forEach((function(t){var a,v,y,w,b;if(f&&t.resultImage(undefined),!t.canWrite){tt(t,h.Common.Status.readonly,!0,!0,h.Common.readonly.format(t.name));e=!1;return}if(!t.tagsSupported){tt(t,h.Common.Status.classicResource,!0,!0,h.Common.classicResource.format(t.name));e=!1;return}var p=r.get(t.resourceId),o=i.clone(p.resource.tags),d=u.keys(o).map((function(n){return{name:n.toLowerCase(),value:o[n]}})),s=[],l=[];n.forEach((function(n,t){switch(n.type){case 1:var r=i.find(d,(function(n){return n.name===t}));r&&r.value!==n.newValue?s.push(n.newName):r||l.push(n.newName);o[n.newName]=n.newValue;break;case 2:case 3:throw"Should never have a delete or modify operation in assign tags";}}));p.appliedTags=o;a=u.keys(o).filter((function(n){return!c.isHiddenTag(n)})).length;a>15?(tt(t,h.Common.Status.tooManyTags.format(a),!0,!0,h.Common.tooManyTagsWithCount.format(t.name,a)),e=!1):(v=new i.Map,y=new i.Map,v.set(1,l.length),y.set(1,l.join(", ")),v.set(3,s.length),y.set(3,s.join(", ")),w=k.formatChanges(v),l.length||s.length?(b=k.formatChangesForBalloon(y),tt(t,w,!1,!0,b)):tt(t,h.Common.Status.tagsToBeAdded.format(0)))})),e}function et(n,t,r){if(!t.length)return Q();var u=t.shift(),f=i.clone(u.resourceTags);return p.patchResourceTags(u.resourceId,u.resourceTags).then((function(i){return r({resourceId:u.resourceId,result:1,newTags:i,originalTags:f}).then((function(){return et(n,t,r)}))})).catch((function(i){return r({resourceId:u.resourceId,result:2,reason:i.message||i}).then((function(){return et(n,t,r)}))}))}function at(n,t){n(t===1?h.AssignTags.Subtitle.singular:h.AssignTags.Subtitle.plural.format(t))}function it(n,t,i){n.assetType(i);n.nameFormatted(h.Common.nameFormat.format(t,i));n.typeFormatted(h.Common.typeFormat.format(i))}var rt;u.defineProperty(t,"__esModule",{value:!0});var ot=i.Base,g=ot.Images,st=i.ViewModels,ut=st.Controls,ht=ut.DockedBalloon,nt=st.Services.ResourceTypes,ct=c.makeResourceManagerTelemetry,vt=g.Polychromatic.ResourceGroup(),yt=s.AssetTypeNames.ResourceGroup.singular,pt=nt.isResourceGroupId,lt=nt.isResourceId;rt=(function(){function n(){this.title=h.AssignTags.title;this.subtitle=f.observable();this.nameTitle=h.Common.nameColumn;this.valueTitle=h.Common.valueColumn;this.resourcesTitle=h.Common.resourcesTitle;this.validationTitle=h.Common.validationTitle;this.validationErrors=f.observableArray();this._allTags=f.observableArray();this._tags=f.observableArray();this._tagItems=f.observableArray();this._resourceItems=f.observableArray();this._operations=f.observable(new i.Map);this._updateMap=u.create(null);this._newTagsMap=u.create(null);this._hasWritePermission=new i.Map;this._isClassicResource=new i.Map}return n.prototype._setInfoBox=function(n,t,i){var r=this._errorInfoBoxLifetime;this._errorInfoBoxLifetime=null;(i||t)&&(this._errorInfoBoxLifetime=n.createChildLifetime(),this.errorInfoBox(new ut.InfoBox.ViewModel(this._errorInfoBoxLifetime,null,!1,{image:f.observable(i),text:f.observable(t)})));r&&r.dispose()},n.prototype._getResourceAndGroupItems=function(n,t,r,u,e,o){var s=this;return wt(n,t,(function(n){var u=n.id.toLowerCase(),v=lt(u),h=n.trimmedName||n.name,t,c,l;o.set(u,{resource:n,appliedTags:n.tags});t={resourceId:u,originalResourceId:n.id,name:h,nameFormatted:f.observable(h),typeFormatted:f.observable(),icon:f.observable(),assetType:f.observable(),canWrite:!!s._hasWritePermission.get(u),tagsSupported:!s._isClassicResource.get(u),status:f.observable(),statusError:f.observable(!1),showBalloon:f.observable(!1),statusBalloon:f.observable(new ht.ViewModel(r)),resultImage:f.observable(),errorStatus:f.observable(),showErrorBalloon:f.observable(!1),errorBalloon:f.observable(new ht.ViewModel(r))};e.push(t);v?(c=nt.buildResourceTypeFromResourceId(u),l=i.memoizeQ((function(i){return a.getResourceTypeAssetTypeInformation(i,!0).then((function(i){if(i){var r={assetTypeInformation:i,extensionName:i.extensionName};t.icon(i.icon);it(t,h,r.assetTypeInformation.compositeDisplayName.singular);y.checkItemKind({setIcon:t.icon,setAssetTypeDisplayName:function(n){it(t,h,n)}},u,n.kind,r)}else t.icon(g.Polychromatic.ResourceDefault()),it(t,h,c)}))})),l(c)):(t.icon(vt),it(t,h,yt))}),(function(n,t){u.push(h.Common.resourceFailure.format(n,t))}))},n.prototype._enableControls=function(n){this.saveButton.disabled(!n);this.cancelButton.disabled(!n);this.tagsGrid.disabled(!n);this.resourcesGrid.disabled(!n)},n.prototype._initializeInfoBox=function(){var n=this.context.container,t=this._tags;this.infoBox=f.explicitComputed(n,[t],(function(){return t().length>=15?new ut.InfoBox.ViewModel(n,null,!1,{text:f.observable(h.Common.maximumTagsReached.format(15)),image:f.observable(g.Info())}):null}));this.errorInfoBox=f.observable(null)},n.prototype._initializeActionBar=function(){var n=this,r=this.context,f=r.model,t=r.container;this.saveButton=o.create(t,{text:h.Common.assign,disabled:!0,onClick:function(){var r='<a href="'+i.getEnvironmentValue("hubsLinks").tagsHelp+'" target="_blank">'+h.Common.tagsInfoLinkText+"<\/a>",e;n._setInfoBox(t,null);e=n.tagsGrid.validateAllEditors().then((function(e){if(!e){n._setInfoBox(t,h.Common.cannotSaveWithFailedValidations,g.StatusBadge.Failed());return}n._enableControls(!1);n.validationErrors([]);var l=ct("AssignTagsBlade.getresourcesforpatch"),a=n._resourceItems().map((function(n){return n.originalResourceId})),s=new i.Map,o=[],c=!1;return n._getResourceAndGroupItems(l,a,t,n.validationErrors,o,s).then((function(){if(!ft(n._operations(),o,s,!0)||n.validationErrors().length){n._setInfoBox(t,h.Common.cannotSaveWithFailedValidations,g.StatusBadge.Failed());n._enableControls(!0);c=!0;return}if(!c){n._resourceItems(o);n._resources=s;var e=[],l=o.map((function(n){var t=s.get(n.resourceId),r=!i.deepEquals(t.resource.tags,t.appliedTags);return r||e.push(n),r&&{resourceId:n.originalResourceId,resourceTags:t.appliedTags}})).filter((function(n){return!!n}));return et(f,l,(function(t){var f=i.find(o,(function(n){return n.originalResourceId===t.resourceId})),e;switch(t.result){case 1:f.resultImage(g.StatusBadge.Success());f.errorStatus(undefined);e=t.newTags||u.create(null);n._updateMap[t.resourceId]=!0;n._newTagsMap[t.resourceId]=e;p.notifyTagsChangeForResource(t.resourceId,t.originalTags,e);break;default:c=!0;f.resultImage(g.StatusBadge.Failed());f.errorStatus("* "+t.reason);n.validationErrors.push(h.Common.failedToSaveTagsForResource.format(f.name,t.reason,r))}return Q()}))}})).then((function(){!ft(n._operations(),n._resourceItems(),n._resources)||c?(n._setInfoBox(t,h.Common.someResourcesFailedToSave.format(r),g.StatusBadge.Failed()),n._enableControls(!0)):t.closeCurrentBlade({update:n._updateMap,newTags:n._newTagsMap})}))}),(function(i){n._setInfoBox(t,h.Common.failedToSaveTags.format(i.message||i,r),g.StatusBadge.Critical());n._enableControls(!0)}));t.operations.add(e,{blockUi:!1,shieldType:1})}});this.cancelButton=o.create(t,{text:h.Common.cancel,disabled:!0,style:1,onClick:function(){t.closeCurrentBlade({update:n._updateMap});n._enableControls(!1)}})},n.prototype._initializeGrid=function(){var n=this,t=this.context.container,i=this._tags;this.tagsGrid=new k.TagsEditorGridViewModel(t,{gridItems:this._tagItems,allTags:this._allTags,operations:this._operations,addTag:function(n){i.push(n)},removeTag:function(n){i.remove((function(t){return t.name()===n.name()}))}});this.resourcesGrid=new b.ResourcesEditorGridViewModel(t,{gridItems:this._resourceItems,removeResource:function(t){n._resources.delete(t.resourceId);n._resourceItems.remove((function(n){return n.resourceId===t.resourceId}));at(n.subtitle,n._resourceItems().length)}})},n.prototype.onInitialize=function(){var n=this,s=this.context,t=s.container,c=s.parameters,l=this._tags,b=this._tagItems,o=this._resourceItems,k=this.validationErrors,e,a,u,y,p;return(this._resources=new i.Map,e=this._operations,a=new ot.Debouncer(function(n,t){return t},function(){return ft(e(),o(),n._resources,!0),Q(!0)},500),f.reactor(t,(function(){a.execute([e()])})),this._initializeInfoBox(),this._initializeActionBar(),this._initializeGrid(),u=c.resources,this._initialTags=c.tags,y=ct("AssignTagsBlade.resources"),u.length<1||u.length>100)?(this._setInfoBox(t,h.AssignTags.tooManyResources.format(100),g.StatusBadge.Critical()),this.saveButton.disabled(!0),this.cancelButton.disabled(!1),this.tagsGrid.disabled(!0),this.resourcesGrid.disabled(!0),Q(!0)):(f.reactor(t,l,(function(t){var i=t.map((function(n){return{data:n}}));i.length<15&&i.push({data:n.tagsGrid.newTagItemData,isNewRowEditor:!0});b(i)})),p=u.map((function(t){return r.Security.hasPermission(t,["./write"]).then((function(i){if(n._hasWritePermission.set(t.toLowerCase(),i),nt.isResourceId(t)){var r=nt.buildResourceTypeFromResourceId(t).toLowerCase();n._isClassicResource.set(t.toLowerCase(),d.classicResourceTypes[r])}}))})),o.subscribe(t,(function(t){t&&!t.length&&n._enableControls(!1)})),Q.all(p).then((function(){return v.getSelectedSubscriptions().then((function(i){var r;return i.subscribeAndRun(t,(function(i){r=w.getAllTags(i.map((function(n){return n.subscriptionId})),500).then((function(i){n._allTags(i.tagItems);n._errorInfoBoxLifetime=w.handleSubscriptionErrors(t,n._errorInfoBoxLifetime,i,n.errorInfoBox)}))})),r})).then((function(){var s=u.length,f,i,r;return at(n.subtitle,s),f=[],i=e(),n._initialTags&&n._initialTags.forEach((function(n){i.set(n.name.toLowerCase(),{type:1,newName:n.name,newValue:n.value})})),e(i),l(f),r=[],n._getResourceAndGroupItems(y,u,t,k,r,n._resources).then((function(){o(r);n._enableControls(!0)}))}))})))},n})();rt=__decorate([e.Decorator({forExport:!0,htmlTemplate:"AssignTagsBlade.html",styleSheets:["Common.css"]}),e.ForContextPane.Decorator({width:2}),e.LegacyFeatures.Decorator({width:2}),e.ReturnsData.Decorator()],rt);t.AssignTagsBlade=rt}));
define("HubsExtension/_generated/adapters/blade/AssignTagsBladeAdapter",["require","exports","o","Fx/Composition/ViewModelAdapters","HubsExtension/Tagsv2/Blades/AssignTagsBlade"],(function(n,t,i,r,u){"use strict";i.defineProperty(t,"__esModule",{value:!0});var f=(function(n){function t(t,i,r){return n.call(this,t,i,r,u.AssignTagsBlade)||this}return __extends(t,n),t})(r.ViewModelAdapter);t.AssignTagsBladeAdapter=f}));
define("HubsExtension/_generated/Blades/AssignTagsBlade",["require","exports","o","HubsExtension/_generated/Blades/Common.css","HubsExtension/_generated/adapters/blade/AssignTagsBladeAdapter"],(function(n,t,i,r){"use strict";i.defineProperty(t,"__esModule",{value:!0});t.blade={name:"AssignTagsBlade",entryPoint:{module:"HubsExtension/_generated/adapters/blade/AssignTagsBladeAdapter","export":"AssignTagsBladeAdapter"},inputs:["resources"],optionalInputs:["tags"],viewModelName:"Tagsv2$AssignTagsBladeAdapter",lenses:[],width:2,pinnable:!1,style:8,toolbar:{source:{valuesFrom:[{referenceType:0,property:"content.commandBar"}]}},templateBlade:{partSize:9,htmlTemplateInline:{file:"AssignTagsBlade.html",content:'<div class="msportalfx-docking ext-tagsv2-container"> <div class="msportalfx-docking-body"> <!-- ko if: infoBox --> <div class="ext-infobox" data-bind="pcControl:infoBox"><\/div> <!-- /ko --> <!-- ko if: errorInfoBox --> <div class="ext-infobox" data-bind="pcControl:errorInfoBox"><\/div> <!-- /ko --> <!-- ko if: validationErrors && validationErrors.length --> <div class="ext-section-title" data-bind="text:validationTitle"><\/div> <!-- ko foreach: validationErrors --> <div class="ext-validationError" data-bind="text:$data"><\/div> <!-- /ko --> <!-- /ko --> <div class="ext-grid-header"> <div class="ext-header-column" data-bind="text:nameTitle"><\/div> <div class="ext-header-column" data-bind="text:valueTitle"><\/div> <\/div> <div class="ext-grid" data-bind="pcControl:tagsGrid"><\/div> <div class="ext-section-title" data-bind="text:resourcesTitle"><\/div> <div class="ext-grid2" data-bind="pcControl:resourcesGrid"><\/div> <\/div> <div class=\'msportalfx-docking-footer ext-top-padding ext-bottom-padding\'> <div data-bind=\'pcControl:saveButton\' class=\'ext-okbutton\'><\/div> <div data-bind=\'pcControl:cancelButton\' class=\'ext-cancelbutton\'><\/div> <\/div> <\/div>'},styleSheets:[{file:"Blades/Common.css",content:r}],isV2:!0},attributes:1,contextPaneWidth:2}}))